cscope 15 /c/Users/leoou/OneDrive/Desktop/projects/ResourcesTest               0000547397
	@C:\Users\leoou\OneDrive\Desktop\LodePNG\lodepng\lodepng.cpp

31 
	~"lodïng.h
"

33 #ifde‡
LODEPNG_COMPILE_DISK


34 
	~<limôs.h
>

35 
	~<°dio.h
>

38 #ifde‡
LODEPNG_COMPILE_ALLOCATORS


39 
	~<°dlib.h
>

42 #i‡
deföed
(
_MSC_VER
) && (_MSC_VER >= 1310)

43 #¥agm®
w¨nög
–
dißbÀ
 : 4244 )

44 #¥agm®
w¨nög
–
dißbÀ
 : 4996 )

47 c⁄° * 
	gLODEPNG_VERSION_STRING
 = "20210627";

73 #ifde‡
LODEPNG_COMPILE_ALLOCATORS


74 * 
	$lodïng_mÆloc
(
size_t
 
size
) {

75 #ifde‡
LODEPNG_MAX_ALLOC


76 if(
size
 > 
LODEPNG_MAX_ALLOC
)  0;

78  
	`mÆloc
(
size
);

79 
	}
}

82 * 
	$lodïng_ªÆloc
(* 
±r
, 
size_t
 
√w_size
) {

83 #ifde‡
LODEPNG_MAX_ALLOC


84 if(
√w_size
 > 
LODEPNG_MAX_ALLOC
)  0;

86  
	`ªÆloc
(
±r
, 
√w_size
);

87 
	}
}

89 
	$lodïng_‰ì
(* 
±r
) {

90 
	`‰ì
(
±r
);

91 
	}
}

94 * 
lodïng_mÆloc
(
size_t
 
size
);

95 * 
lodïng_ªÆloc
(* 
±r
, 
size_t
 
√w_size
);

96 
lodïng_‰ì
(* 
±r
);

101 #i‡(
deföed
(
__STDC_VERSION__
Ë&& (__STDC_VERSION__ >199901L)Ë|| (deföed(
__˝lu•lus
) && (__cplusplus >= 199711L))

102 
	#LODEPNG_INLINE
 
ölöe


	)

104 
	#LODEPNG_INLINE


	)

108 #i‡(
deföed
(
__GNUC__
Ë&& (__GNUC__ > 3 || (__GNUC__ =3 && 
__GNUC_MINOR__
 >= 1))) ||\

109 (
deföed
(
_MSC_VER
Ë&& (
	g_MSC_VER
 >= 1400)) || \

110 (
deföed
(
__WATCOMC__
Ë&& (__WATCOMC__ >1250Ë&& !
	$deföed
(
__˝lu•lus
))

111 
	#LODEPNG_RESTRICT
 
__ª°ri˘


	)

113 
	#LODEPNG_RESTRICT


	)

120 
	$lodïng_mem˝y
(* 
LODEPNG_RESTRICT
 
d°
,

121 c⁄° * 
LODEPNG_RESTRICT
 
§c
, 
size_t
 
size
) {

122 
size_t
 
i
;

123 
i
 = 0; i < 
size
; i++Ë((*)
d°
)[i] = ((c⁄° *)
§c
)[i];

124 
	}
}

126 
	$lodïng_mem£t
(* 
LODEPNG_RESTRICT
 
d°
,

127 
vÆue
, 
size_t
 
num
) {

128 
size_t
 
i
;

129 
i
 = 0; i < 
num
; i++Ë((*)
d°
)[i] = ()
vÆue
;

130 
	}
}

133 
size_t
 
	$lodïng_°æí
(c⁄° * 
a
) {

134 c⁄° * 
‹ig
 = 
a
;

136 ()(&
lodïng_°æí
);

137 *
a
)á++;

138  (
size_t
)(
a
 - 
‹ig
);

139 
	}
}

141 
	#LODEPNG_MAX
(
a
, 
b
Ë((◊Ë> (b)Ë? (aË: (b))

	)

142 
	#LODEPNG_MIN
(
a
, 
b
Ë((◊Ë< (b)Ë? (aË: (b))

	)

143 
	#LODEPNG_ABS
(
x
Ë((xË< 0 ? -(xË: (x))

	)

145 #i‡
deföed
(
LODEPNG_COMPILE_PNG
Ë|| deföed(
LODEPNG_COMPILE_DECODER
)

148 
	$lodïng_addoÊ
(
size_t
 
a
, size_à
b
, size_t* 
ªsu…
) {

149 *
ªsu…
 = 
a
 + 
b
;

150  *
ªsu…
 < 
a
;

151 
	}
}

154 #ifde‡
LODEPNG_COMPILE_DECODER


157 
	$lodïng_muloÊ
(
size_t
 
a
, size_à
b
, size_t* 
ªsu…
) {

158 *
ªsu…
 = 
a
 * 
b
;

159  (
a
 !0 && *
ªsu…
 /á !
b
);

160 
	}
}

162 #ifde‡
LODEPNG_COMPILE_ZLIB


164 
	$lodïng_gtoÊ
(
size_t
 
a
, size_à
b
, size_à
c
) {

165 
size_t
 
d
;

166 if(
	`lodïng_addoÊ
(
a
, 
b
, &
d
))  1;

167  
d
 > 
c
;

168 
	}
}

180 
	#CERROR_BREAK
(
îr‹v¨
, 
code
){\

181 
îr‹v¨
 = 
code
;\

183 }

	)

186 
	#ERROR_BREAK
(
code
Ë
	`CERROR_BREAK
(
îr‹
, code)

	)

189 
	#CERROR_RETURN_ERROR
(
îr‹v¨
, 
code
){\

190 
îr‹v¨
 = 
code
;\

191  
code
;\

192 }

	)

195 
	#CERROR_TRY_RETURN
(
ˇŒ
){\

196 
îr‹
 = 
ˇŒ
;\

197 if(
îr‹
) Érror;\

198 }

	)

201 
	#CERROR_RETURN
(
îr‹v¨
, 
code
){\

202 
îr‹v¨
 = 
code
;\

204 }

	)

215 #ifde‡
LODEPNG_COMPILE_ZLIB


216 #ifde‡
LODEPNG_COMPILE_ENCODER


218 
	suive˘‹
 {

219 * 
	md©a
;

220 
size_t
 
	msize
;

221 
size_t
 
	mÆlocsize
;

222 } 
	tuive˘‹
;

224 
	$uive˘‹_˛ónup
(* 
p
) {

225 ((
uive˘‹
*)
p
)->
size
 = ((uive˘‹*Ì)->
Ælocsize
 = 0;

226 
	`lodïng_‰ì
(((
uive˘‹
*)
p
)->
d©a
);

227 ((
uive˘‹
*)
p
)->
d©a
 = 
NULL
;

228 
	}
}

231 
	$uive˘‹_ªsize
(
uive˘‹
* 
p
, 
size_t
 
size
) {

232 
size_t
 
Ælocsize
 = 
size
 * ();

233 if(
Ælocsize
 > 
p
->allocsize) {

234 
size_t
 
√wsize
 = 
Ælocsize
 + (
p
->allocsize >> 1u);

235 * 
d©a
 = 
	`lodïng_ªÆloc
(
p
->d©a, 
√wsize
);

236 if(
d©a
) {

237 
p
->
Ælocsize
 = 
√wsize
;

238 
p
->
d©a
 = (*)data;

242 
p
->
size
 = size;

244 
	}
}

246 
	$uive˘‹_öô
(
uive˘‹
* 
p
) {

247 
p
->
d©a
 = 
NULL
;

248 
p
->
size
 =Ö->
Ælocsize
 = 0;

249 
	}
}

252 
	$uive˘‹_push_back
(
uive˘‹
* 
p
, 
c
) {

253 if(!
	`uive˘‹_ªsize
(
p
,Ö->
size
 + 1))  0;

254 
p
->
d©a
[p->
size
 - 1] = 
c
;

256 
	}
}

263 
	sucve˘‹
 {

264 * 
	md©a
;

265 
size_t
 
	msize
;

266 
size_t
 
	mÆlocsize
;

267 } 
	tucve˘‹
;

270 
	$ucve˘‹_ªsize
(
ucve˘‹
* 
p
, 
size_t
 
size
) {

271 if(
size
 > 
p
->
Ælocsize
) {

272 
size_t
 
√wsize
 = 
size
 + (
p
->
Ælocsize
 >> 1u);

273 * 
d©a
 = 
	`lodïng_ªÆloc
(
p
->d©a, 
√wsize
);

274 if(
d©a
) {

275 
p
->
Ælocsize
 = 
√wsize
;

276 
p
->
d©a
 = (*)data;

280 
p
->
size
 = size;

282 
	}
}

284 
ucve˘‹
 
	$ucve˘‹_öô
(* 
buf„r
, 
size_t
 
size
) {

285 
ucve˘‹
 
v
;

286 
v
.
d©a
 = 
buf„r
;

287 
v
.
Ælocsize
 = v.
size
 = size;

288  
v
;

289 
	}
}

293 #ifde‡
LODEPNG_COMPILE_PNG


294 #ifde‡
LODEPNG_COMPILE_ANCILLARY_CHUNKS


297 
	$°rög_˛ónup
(** 
out
) {

298 
	`lodïng_‰ì
(*
out
);

299 *
out
 = 
NULL
;

300 
	}
}

303 * 
	$Æloc_°rög_sized
(c⁄° * 
ö
, 
size_t
 
ösize
) {

304 * 
out
 = (*)
	`lodïng_mÆloc
(
ösize
 + 1);

305 if(
out
) {

306 
	`lodïng_mem˝y
(
out
, 
ö
, 
ösize
);

307 
out
[
ösize
] = 0;

309  
out
;

310 
	}
}

313 * 
	$Æloc_°rög
(c⁄° * 
ö
) {

314  
	`Æloc_°rög_sized
(
ö
, 
	`lodïng_°æí
(in));

315 
	}
}

321 #i‡
deföed
(
LODEPNG_COMPILE_DECODER
Ë|| deföed(
LODEPNG_COMPILE_PNG
)

322 
	$lodïng_ªad32bôI¡
(c⁄° * 
buf„r
) {

323  ((()
buf„r
[0] << 24u) | (()buffer[1] << 16u) |

324 (()
buf„r
[2] << 8u) | ()buffer[3]);

325 
	}
}

328 #i‡
deföed
(
LODEPNG_COMPILE_PNG
Ë|| deföed(
LODEPNG_COMPILE_ENCODER
)

330 
	$lodïng_£t32bôI¡
(* 
buf„r
, 
vÆue
) {

331 
buf„r
[0] = ()((
vÆue
 >> 24) & 0xff);

332 
buf„r
[1] = ()((
vÆue
 >> 16) & 0xff);

333 
buf„r
[2] = ()((
vÆue
 >> 8) & 0xff);

334 
buf„r
[3] = ()((
vÆue
 ) & 0xff);

335 
	}
}

342 #ifde‡
LODEPNG_COMPILE_DISK


345 
	$lodïng_fûesize
(c⁄° * 
fûíame
) {

346 
FILE
* 
fûe
;

347 
size
;

348 
fûe
 = 
	`f›í
(
fûíame
, "rb");

349 if(!
fûe
)  -1;

351 if(
	`f£ek
(
fûe
, 0, 
SEEK_END
) != 0) {

352 
	`f˛o£
(
fûe
);

356 
size
 = 
	`·ñl
(
fûe
);

358 if(
size
 =
LONG_MAX
) size = -1;

360 
	`f˛o£
(
fûe
);

361  
size
;

362 
	}
}

365 
	$lodïng_buf„r_fûe
(* 
out
, 
size_t
 
size
, c⁄° * 
fûíame
) {

366 
FILE
* 
fûe
;

367 
size_t
 
ªadsize
;

368 
fûe
 = 
	`f›í
(
fûíame
, "rb");

369 if(!
fûe
)  78;

371 
ªadsize
 = 
	`‰ód
(
out
, 1, 
size
, 
fûe
);

372 
	`f˛o£
(
fûe
);

374 if(
ªadsize
 !
size
)  78;

376 
	}
}

378 
	$lodïng_lﬂd_fûe
(** 
out
, 
size_t
* 
outsize
, c⁄° * 
fûíame
) {

379 
size
 = 
	`lodïng_fûesize
(
fûíame
);

380 if(
size
 < 0)  78;

381 *
outsize
 = (
size_t
)
size
;

383 *
out
 = (*)
	`lodïng_mÆloc
((
size_t
)
size
);

384 if(!(*
out
Ë&& 
size
 > 0)  83;

386  
	`lodïng_buf„r_fûe
(*
out
, (
size_t
)
size
, 
fûíame
);

387 
	}
}

390 
	$lodïng_ßve_fûe
(c⁄° * 
buf„r
, 
size_t
 
buf„rsize
, c⁄° * 
fûíame
) {

391 
FILE
* 
fûe
;

392 
fûe
 = 
	`f›í
(
fûíame
, "wb" );

393 if(!
fûe
)  79;

394 
	`fwrôe
(
buf„r
, 1, 
buf„rsize
, 
fûe
);

395 
	`f˛o£
(
fûe
);

397 
	}
}

407 #ifde‡
LODEPNG_COMPILE_ZLIB


408 #ifde‡
LODEPNG_COMPILE_ENCODER


411 
ucve˘‹
* 
	md©a
;

412 
	mbp
;

413 } 
	tLodePNGBôWrôî
;

415 
	$LodePNGBôWrôî_öô
(
LodePNGBôWrôî
* 
wrôî
, 
ucve˘‹
* 
d©a
) {

416 
wrôî
->
d©a
 = data;

417 
wrôî
->
bp
 = 0;

418 
	}
}

421 
	#WRITEBIT
(
wrôî
, 
bô
){\

423 if(((
wrôî
->
bp
) & 7u) == 0) {\

424 if(!
	`ucve˘‹_ªsize
(
wrôî
->
d©a
, wrôî->d©a->
size
 + 1)) ;\

425 
wrôî
->
d©a
->d©a[wrôî->d©a->
size
 - 1] = 0;\

427 (
wrôî
->
d©a
->d©a[wrôî->d©a->
size
 - 1]Ë|(
bô
 << ((wrôî->
bp
) & 7u));\

428 ++
wrôî
->
bp
;\

429 }

	)

432 
	$wrôeBôs
(
LodePNGBôWrôî
* 
wrôî
, 
vÆue
, 
size_t
 
nbôs
) {

433 if(
nbôs
 == 1) {

434 
	`WRITEBIT
(
wrôî
, 
vÆue
);

437 
size_t
 
i
;

438 
i
 = 0; i !
nbôs
; ++i) {

439 
	`WRITEBIT
(
wrôî
, ()((
vÆue
 >> 
i
) & 1));

442 
	}
}

445 
	$wrôeBôsRevî£d
(
LodePNGBôWrôî
* 
wrôî
, 
vÆue
, 
size_t
 
nbôs
) {

446 
size_t
 
i
;

447 
i
 = 0; i !
nbôs
; ++i) {

449 
	`WRITEBIT
(
wrôî
, ()((
vÆue
 >> (
nbôs
 - 1u - 
i
)) & 1u));

451 
	}
}

454 #ifde‡
LODEPNG_COMPILE_DECODER


457 c⁄° * 
	md©a
;

458 
size_t
 
	msize
;

459 
size_t
 
	mbôsize
;

460 
size_t
 
	mbp
;

461 
	mbuf„r
;

462 } 
	tLodePNGBôRódî
;

465 
	$LodePNGBôRódî_öô
(
LodePNGBôRódî
* 
ªadî
, c⁄° * 
d©a
, 
size_t
 
size
) {

466 
size_t
 
ãmp
;

467 
ªadî
->
d©a
 = data;

468 
ªadî
->
size
 = size;

470 if(
	`lodïng_muloÊ
(
size
, 8u, &
ªadî
->
bôsize
))  105;

473 if(
	`lodïng_addoÊ
(
ªadî
->
bôsize
, 64u, &
ãmp
))  105;

474 
ªadî
->
bp
 = 0;

475 
ªadî
->
buf„r
 = 0;

477 
	}
}

494 
	$ísuªBôs9
(
LodePNGBôRódî
* 
ªadî
, 
size_t
 
nbôs
) {

495 
size_t
 
°¨t
 = 
ªadî
->
bp
 >> 3u;

496 
size_t
 
size
 = 
ªadî
->size;

497 if(
°¨t
 + 1u < 
size
) {

498 
ªadî
->
buf„r
 = (Ïódî->
d©a
[
°¨t
 + 0] | (()reader->data[start + 1] << 8u);

499 
ªadî
->
buf„r
 >>‘ódî->
bp
 & 7u);

502 
ªadî
->
buf„r
 = 0;

503 if(
°¨t
 + 0u < 
size
Ë
ªadî
->
buf„r
 |ªadî->
d©a
[start + 0];

504 
ªadî
->
buf„r
 >>‘ódî->
bp
 & 7u);

505  
ªadî
->
bp
 + 
nbôs
 <ªadî->
bôsize
;

507 
	}
}

510 
	$ísuªBôs17
(
LodePNGBôRódî
* 
ªadî
, 
size_t
 
nbôs
) {

511 
size_t
 
°¨t
 = 
ªadî
->
bp
 >> 3u;

512 
size_t
 
size
 = 
ªadî
->size;

513 if(
°¨t
 + 2u < 
size
) {

514 
ªadî
->
buf„r
 = (Ïódî->
d©a
[
°¨t
 + 0] | (()reader->data[start + 1] << 8u) |

515 (()
ªadî
->
d©a
[
°¨t
 + 2] << 16u);

516 
ªadî
->
buf„r
 >>‘ódî->
bp
 & 7u);

519 
ªadî
->
buf„r
 = 0;

520 if(
°¨t
 + 0u < 
size
Ë
ªadî
->
buf„r
 |ªadî->
d©a
[start + 0];

521 if(
°¨t
 + 1u < 
size
Ë
ªadî
->
buf„r
 |((Ïódî->
d©a
[start + 1] << 8u);

522 
ªadî
->
buf„r
 >>‘ódî->
bp
 & 7u);

523  
ªadî
->
bp
 + 
nbôs
 <ªadî->
bôsize
;

525 
	}
}

528 
LODEPNG_INLINE
 
	$ísuªBôs25
(
LodePNGBôRódî
* 
ªadî
, 
size_t
 
nbôs
) {

529 
size_t
 
°¨t
 = 
ªadî
->
bp
 >> 3u;

530 
size_t
 
size
 = 
ªadî
->size;

531 if(
°¨t
 + 3u < 
size
) {

532 
ªadî
->
buf„r
 = (Ïódî->
d©a
[
°¨t
 + 0] | (()reader->data[start + 1] << 8u) |

533 (()
ªadî
->
d©a
[
°¨t
 + 2] << 16u) | (()reader->data[start + 3] << 24u);

534 
ªadî
->
buf„r
 >>‘ódî->
bp
 & 7u);

537 
ªadî
->
buf„r
 = 0;

538 if(
°¨t
 + 0u < 
size
Ë
ªadî
->
buf„r
 |ªadî->
d©a
[start + 0];

539 if(
°¨t
 + 1u < 
size
Ë
ªadî
->
buf„r
 |((Ïódî->
d©a
[start + 1] << 8u);

540 if(
°¨t
 + 2u < 
size
Ë
ªadî
->
buf„r
 |((Ïódî->
d©a
[start + 2] << 16u);

541 
ªadî
->
buf„r
 >>‘ódî->
bp
 & 7u);

542  
ªadî
->
bp
 + 
nbôs
 <ªadî->
bôsize
;

544 
	}
}

547 
LODEPNG_INLINE
 
	$ísuªBôs32
(
LodePNGBôRódî
* 
ªadî
, 
size_t
 
nbôs
) {

548 
size_t
 
°¨t
 = 
ªadî
->
bp
 >> 3u;

549 
size_t
 
size
 = 
ªadî
->size;

550 if(
°¨t
 + 4u < 
size
) {

551 
ªadî
->
buf„r
 = (Ïódî->
d©a
[
°¨t
 + 0] | (()reader->data[start + 1] << 8u) |

552 (()
ªadî
->
d©a
[
°¨t
 + 2] << 16u) | (()reader->data[start + 3] << 24u);

553 
ªadî
->
buf„r
 >>‘ódî->
bp
 & 7u);

554 
ªadî
->
buf„r
 |(((Ïódî->
d©a
[
°¨t
 + 4] << 24uË<< (8u - (ªadî->
bp
 & 7u)));

557 
ªadî
->
buf„r
 = 0;

558 if(
°¨t
 + 0u < 
size
Ë
ªadî
->
buf„r
 |ªadî->
d©a
[start + 0];

559 if(
°¨t
 + 1u < 
size
Ë
ªadî
->
buf„r
 |((Ïódî->
d©a
[start + 1] << 8u);

560 if(
°¨t
 + 2u < 
size
Ë
ªadî
->
buf„r
 |((Ïódî->
d©a
[start + 2] << 16u);

561 if(
°¨t
 + 3u < 
size
Ë
ªadî
->
buf„r
 |((Ïódî->
d©a
[start + 3] << 24u);

562 
ªadî
->
buf„r
 >>‘ódî->
bp
 & 7u);

563  
ªadî
->
bp
 + 
nbôs
 <ªadî->
bôsize
;

565 
	}
}

568 
	$≥ekBôs
(
LodePNGBôRódî
* 
ªadî
, 
size_t
 
nbôs
) {

570  
ªadî
->
buf„r
 & ((1u << 
nbôs
) - 1u);

571 
	}
}

574 
	$adv™˚Bôs
(
LodePNGBôRódî
* 
ªadî
, 
size_t
 
nbôs
) {

575 
ªadî
->
buf„r
 >>
nbôs
;

576 
ªadî
->
bp
 +
nbôs
;

577 
	}
}

580 
	$ªadBôs
(
LodePNGBôRódî
* 
ªadî
, 
size_t
 
nbôs
) {

581 
ªsu…
 = 
	`≥ekBôs
(
ªadî
, 
nbôs
);

582 
	`adv™˚Bôs
(
ªadî
, 
nbôs
);

583  
ªsu…
;

584 
	}
}

587 
	$lode_≤g_ã°_bôªadî
(c⁄° * 
d©a
, 
size_t
 
size
,

588 
size_t
 
num°ïs
, c⁄° size_t* 
°ïs
, * 
ªsu…
) {

589 
size_t
 
i
;

590 
LodePNGBôRódî
 
ªadî
;

591 
îr‹
 = 
	`LodePNGBôRódî_öô
(&
ªadî
, 
d©a
, 
size
);

592 if(
îr‹
)  0;

593 
i
 = 0; i < 
num°ïs
; i++) {

594 
size_t
 
°ï
 = 
°ïs
[
i
];

595 
ok
;

596 if(
°ï
 > 25Ë
ok
 = 
	`ísuªBôs32
(&
ªadî
, step);

597 if(
°ï
 > 17Ë
ok
 = 
	`ísuªBôs25
(&
ªadî
, step);

598 if(
°ï
 > 9Ë
ok
 = 
	`ísuªBôs17
(&
ªadî
, step);

599 
ok
 = 
	`ísuªBôs9
(&
ªadî
, 
°ï
);

600 if(!
ok
)  0;

601 
ªsu…
[
i
] = 
	`ªadBôs
(&
ªadî
, 
°ï
);

604 
	}
}

607 
	$ªvî£Bôs
(
bôs
, 
num
) {

609 
i
, 
ªsu…
 = 0;

610 
i
 = 0; i < 
num
; i++Ë
ªsu…
 |((
bôs
 >> (num - i - 1u)) & 1u) << i;

611  
ªsu…
;

612 
	}
}

618 
	#FIRST_LENGTH_CODE_INDEX
 257

	)

619 
	#LAST_LENGTH_CODE_INDEX
 285

	)

621 
	#NUM_DEFLATE_CODE_SYMBOLS
 288

	)

623 
	#NUM_DISTANCE_SYMBOLS
 32

	)

625 
	#NUM_CODE_LENGTH_CODES
 19

	)

628 c⁄° 
	gLENGTHBASE
[29]

633 c⁄° 
	gLENGTHEXTRA
[29]

638 c⁄° 
	gDISTANCEBASE
[30]

643 c⁄° 
	gDISTANCEEXTRA
[30]

649 c⁄° 
	gCLCL_ORDER
[
NUM_CODE_LENGTH_CODES
]

657 
	sHuffm™Tªe
 {

658 * 
	mcodes
;

659 * 
	mÀngths
;

660 
	mmaxbôÀn
;

661 
	mnumcodes
;

663 * 
	mèbÀ_Àn
;

664 * 
	mèbÀ_vÆue
;

665 } 
	tHuffm™Tªe
;

667 
	$Huffm™Tªe_öô
(
Huffm™Tªe
* 
åì
) {

668 
åì
->
codes
 = 0;

669 
åì
->
Àngths
 = 0;

670 
åì
->
èbÀ_Àn
 = 0;

671 
åì
->
èbÀ_vÆue
 = 0;

672 
	}
}

674 
	$Huffm™Tªe_˛ónup
(
Huffm™Tªe
* 
åì
) {

675 
	`lodïng_‰ì
(
åì
->
codes
);

676 
	`lodïng_‰ì
(
åì
->
Àngths
);

677 
	`lodïng_‰ì
(
åì
->
èbÀ_Àn
);

678 
	`lodïng_‰ì
(
åì
->
èbÀ_vÆue
);

679 
	}
}

683 
	#FIRSTBITS
 9u

	)

687 
	#INVALIDSYMBOL
 65535u

	)

690 
	$Huffm™Tªe_makeTabÀ
(
Huffm™Tªe
* 
åì
) {

691 c⁄° 
hódsize
 = 1u << 
FIRSTBITS
;

692 c⁄° 
mask
 = (1u << 
FIRSTBITS
) - 1u;

693 
size_t
 
i
, 
num¥e£¡
, 
poöãr
, 
size
;

694 * 
maxÀns
 = (*)
	`lodïng_mÆloc
(
hódsize
 * ());

695 if(!
maxÀns
)  83;

698 
	`lodïng_mem£t
(
maxÀns
, 0, 
hódsize
 * (*maxlens));

699 
i
 = 0; i < 
åì
->
numcodes
; i++) {

700 
symbﬁ
 = 
åì
->
codes
[
i
];

701 
l
 = 
åì
->
Àngths
[
i
];

702 
ödex
;

703 if(
l
 <
FIRSTBITS
) ;

705 
ödex
 = 
	`ªvî£Bôs
(
symbﬁ
 >> (
l
 - 
FIRSTBITS
), FIRSTBITS);

706 
maxÀns
[
ödex
] = 
	`LODEPNG_MAX
(maxÀns[ödex], 
l
);

709 
size
 = 
hódsize
;

710 
i
 = 0; i < 
hódsize
; ++i) {

711 
l
 = 
maxÀns
[
i
];

712 if(
l
 > 
FIRSTBITS
Ë
size
 += (1u << (l - FIRSTBITS));

714 
åì
->
èbÀ_Àn
 = (*)
	`lodïng_mÆloc
(
size
 * (*tree->table_len));

715 
åì
->
èbÀ_vÆue
 = (*)
	`lodïng_mÆloc
(
size
 * (*tree->table_value));

716 if(!
åì
->
èbÀ_Àn
 || !åì->
èbÀ_vÆue
) {

717 
	`lodïng_‰ì
(
maxÀns
);

722 
i
 = 0; i < 
size
; ++iË
åì
->
èbÀ_Àn
[i] = 16;

725 
poöãr
 = 
hódsize
;

726 
i
 = 0; i < 
hódsize
; ++i) {

727 
l
 = 
maxÀns
[
i
];

728 if(
l
 <
FIRSTBITS
) ;

729 
åì
->
èbÀ_Àn
[
i
] = 
l
;

730 
åì
->
èbÀ_vÆue
[
i
] = 
poöãr
;

731 
poöãr
 +(1u << (
l
 - 
FIRSTBITS
));

733 
	`lodïng_‰ì
(
maxÀns
);

736 
num¥e£¡
 = 0;

737 
i
 = 0; i < 
åì
->
numcodes
; ++i) {

738 
l
 = 
åì
->
Àngths
[
i
];

739 
symbﬁ
 = 
åì
->
codes
[
i
];

741 
ªvî£
 = 
	`ªvî£Bôs
(
symbﬁ
, 
l
);

742 if(
l
 == 0) ;

743 
num¥e£¡
++;

745 if(
l
 <
FIRSTBITS
) {

747 
num
 = 1u << (
FIRSTBITS
 - 
l
);

748 
j
;

749 
j
 = 0; j < 
num
; ++j) {

751 
ödex
 = 
ªvî£
 | (
j
 << 
l
);

752 if(
åì
->
èbÀ_Àn
[
ödex
] != 16)  55;

753 
åì
->
èbÀ_Àn
[
ödex
] = 
l
;

754 
åì
->
èbÀ_vÆue
[
ödex
] = 
i
;

759 
ödex
 = 
ªvî£
 & 
mask
;

760 
maxÀn
 = 
åì
->
èbÀ_Àn
[
ödex
];

762 
èbÀÀn
 = 
maxÀn
 - 
FIRSTBITS
;

763 
°¨t
 = 
åì
->
èbÀ_vÆue
[
ödex
];

764 
num
 = 1u << (
èbÀÀn
 - (
l
 - 
FIRSTBITS
));

765 
j
;

766 if(
maxÀn
 < 
l
)  55;

767 
j
 = 0; j < 
num
; ++j) {

768 
ªvî£2
 = 
ªvî£
 >> 
FIRSTBITS
;

769 
ödex2
 = 
°¨t
 + (
ªvî£2
 | (
j
 << (
l
 - 
FIRSTBITS
)));

770 
åì
->
èbÀ_Àn
[
ödex2
] = 
l
;

771 
åì
->
èbÀ_vÆue
[
ödex2
] = 
i
;

776 if(
num¥e£¡
 < 2) {

783 
i
 = 0; i < 
size
; ++i) {

784 if(
åì
->
èbÀ_Àn
[
i
] == 16) {

788 
åì
->
èbÀ_Àn
[
i
] = (ò< 
hódsize
Ë? 1 : (
FIRSTBITS
 + 1);

789 
åì
->
èbÀ_vÆue
[
i
] = 
INVALIDSYMBOL
;

797 
i
 = 0; i < 
size
; ++i) {

798 if(
åì
->
èbÀ_Àn
[
i
] == 16)  55;

803 
	}
}

810 
	$Huffm™Tªe_makeFromLígths2
(
Huffm™Tªe
* 
åì
) {

811 * 
blcou¡
;

812 * 
√xtcode
;

813 
îr‹
 = 0;

814 
bôs
, 
n
;

816 
åì
->
codes
 = (*)
	`lodïng_mÆloc
—ªe->
numcodes
 * ());

817 
blcou¡
 = (*)
	`lodïng_mÆloc
((
åì
->
maxbôÀn
 + 1) * ());

818 
√xtcode
 = (*)
	`lodïng_mÆloc
((
åì
->
maxbôÀn
 + 1) * ());

819 if(!
åì
->
codes
 || !
blcou¡
 || !
√xtcode
Ë
îr‹
 = 83;

821 if(!
îr‹
) {

822 
n
 = 0;Ç !
åì
->
maxbôÀn
 + 1;Ç++Ë
blcou¡
[n] = 
√xtcode
[n] = 0;

824 
bôs
 = 0; bô†!
åì
->
numcodes
; ++bôsË++
blcou¡
[åì->
Àngths
[bits]];

826 
bôs
 = 1; bô†<
åì
->
maxbôÀn
; ++bits) {

827 
√xtcode
[
bôs
] = (√xtcode[bô†- 1] + 
blcou¡
[bits - 1]) << 1u;

830 
n
 = 0;Ç !
åì
->
numcodes
; ++n) {

831 if(
åì
->
Àngths
[
n
] != 0) {

832 
åì
->
codes
[
n
] = 
√xtcode
[åì->
Àngths
[n]]++;

834 
åì
->
codes
[
n
] &((1u <<Åªe->
Àngths
[n]) - 1u);

839 
	`lodïng_‰ì
(
blcou¡
);

840 
	`lodïng_‰ì
(
√xtcode
);

842 if(!
îr‹
Ëîr‹ = 
	`Huffm™Tªe_makeTabÀ
(
åì
);

843  
îr‹
;

844 
	}
}

851 
	$Huffm™Tªe_makeFromLígths
(
Huffm™Tªe
* 
åì
, c⁄° * 
bôÀn
,

852 
size_t
 
numcodes
, 
maxbôÀn
) {

853 
i
;

854 
åì
->
Àngths
 = (*)
	`lodïng_mÆloc
(
numcodes
 * ());

855 if(!
åì
->
Àngths
)  83;

856 
i
 = 0; i !
numcodes
; ++iË
åì
->
Àngths
[i] = 
bôÀn
[i];

857 
åì
->
numcodes
 = ()numcodes;

858 
åì
->
maxbôÀn
 = maxbitlen;

859  
	`Huffm™Tªe_makeFromLígths2
(
åì
);

860 
	}
}

862 #ifde‡
LODEPNG_COMPILE_ENCODER


868 
	sBPMNode
 {

869 
	mweight
;

870 
	mödex
;

871 
BPMNode
* 
	mèû
;

872 
	mö_u£
;

873 } 
	tBPMNode
;

876 
	sBPMLi°s
 {

878 
	mmemsize
;

879 
BPMNode
* 
	mmem‹y
;

880 
	mnum‰ì
;

881 
	m√xt‰ì
;

882 
BPMNode
** 
	m‰ìli°
;

884 
	mli°size
;

885 
BPMNode
** 
	mchaös0
;

886 
BPMNode
** 
	mchaös1
;

887 } 
	tBPMLi°s
;

890 
BPMNode
* 
	$bpmnode_¸óã
(
BPMLi°s
* 
li°s
, 
weight
, 
ödex
, 
BPMNode
* 
èû
) {

891 
i
;

892 
BPMNode
* 
ªsu…
;

895 if(
li°s
->
√xt‰ì
 >li°s->
num‰ì
) {

897 
i
 = 0; i !
li°s
->
memsize
; ++iËli°s->
mem‹y
[i].
ö_u£
 = 0;

898 
i
 = 0; i !
li°s
->
li°size
; ++i) {

899 
BPMNode
* 
node
;

900 
node
 = 
li°s
->
chaös0
[
i
];Çodê!0;Çodênode->
èû
Ënode->
ö_u£
 = 1;

901 
node
 = 
li°s
->
chaös1
[
i
];Çodê!0;Çodênode->
èû
Ënode->
ö_u£
 = 1;

904 
li°s
->
num‰ì
 = 0;

905 
i
 = 0; i !
li°s
->
memsize
; ++i) {

906 if(!
li°s
->
mem‹y
[
i
].
ö_u£
Ëli°s->
‰ìli°
[li°s->
num‰ì
++] = &lists->memory[i];

908 
li°s
->
√xt‰ì
 = 0;

911 
ªsu…
 = 
li°s
->
‰ìli°
[li°s->
√xt‰ì
++];

912 
ªsu…
->
weight
 = weight;

913 
ªsu…
->
ödex
 = index;

914 
ªsu…
->
èû
 =Åail;

915  
ªsu…
;

916 
	}
}

919 
	$bpmnode_s‹t
(
BPMNode
* 
Àaves
, 
size_t
 
num
) {

920 
BPMNode
* 
mem
 = (BPMNode*)
	`lodïng_mÆloc
((*
Àaves
Ë* 
num
);

921 
size_t
 
width
, 
cou¡î
 = 0;

922 
width
 = 1; width < 
num
; width *= 2) {

923 
BPMNode
* 
a
 = (
cou¡î
 & 1Ë? 
mem
 : 
Àaves
;

924 
BPMNode
* 
b
 = (
cou¡î
 & 1Ë? 
Àaves
 : 
mem
;

925 
size_t
 
p
;

926 
p
 = 0;Ö < 
num
;Ö +2 * 
width
) {

927 
size_t
 
q
 = (
p
 + 
width
 > 
num
) ?Çum : (p + width);

928 
size_t
 
r
 = (
p
 + 2 * 
width
 > 
num
) ?Çum : (p + 2 * width);

929 
size_t
 
i
 = 
p
, 
j
 = 
q
, 
k
;

930 
k
 = 
p
; k < 
r
; k++) {

931 if(
i
 < 
q
 && (
j
 >
r
 || 
a
[i].
weight
 <a[j].weight)Ë
b
[
k
] =á[i++];

932 
b
[
k
] = 
a
[
j
++];

935 
cou¡î
++;

937 if(
cou¡î
 & 1Ë
	`lodïng_mem˝y
(
Àaves
, 
mem
, (*ÀavesË* 
num
);

938 
	`lodïng_‰ì
(
mem
);

939 
	}
}

942 
	$bound¨yPM
(
BPMLi°s
* 
li°s
, 
BPMNode
* 
Àaves
, 
size_t
 
num¥e£¡
, 
c
, 
num
) {

943 
œ°ödex
 = 
li°s
->
chaös1
[
c
]->
ödex
;

945 if(
c
 == 0) {

946 if(
œ°ödex
 >
num¥e£¡
) ;

947 
li°s
->
chaös0
[
c
] =Üi°s->
chaös1
[c];

948 
li°s
->
chaös1
[
c
] = 
	`bpmnode_¸óã
÷i°s, 
Àaves
[
œ°ödex
].
weight
,Üastindex + 1, 0);

951 
sum
 = 
li°s
->
chaös0
[
c
 - 1]->
weight
 +Üi°s->
chaös1
[c - 1]->weight;

952 
li°s
->
chaös0
[
c
] =Üi°s->
chaös1
[c];

953 if(
œ°ödex
 < 
num¥e£¡
 && 
sum
 > 
Àaves
[œ°ödex].
weight
) {

954 
li°s
->
chaös1
[
c
] = 
	`bpmnode_¸óã
÷i°s, 
Àaves
[
œ°ödex
].
weight
,Üa°ödex + 1,Üi°s->chaös1[c]->
èû
);

957 
li°s
->
chaös1
[
c
] = 
	`bpmnode_¸óã
÷i°s, 
sum
, 
œ°ödex
,Üists->chains1[c - 1]);

960 if(
num
 + 1 < ()(2 * 
num¥e£¡
 - 2)) {

961 
	`bound¨yPM
(
li°s
, 
Àaves
, 
num¥e£¡
, 
c
 - 1, 
num
);

962 
	`bound¨yPM
(
li°s
, 
Àaves
, 
num¥e£¡
, 
c
 - 1, 
num
);

965 
	}
}

967 
	$lodïng_huffm™_code_Àngths
(* 
Àngths
, c⁄° * 
‰equícõs
,

968 
size_t
 
numcodes
, 
maxbôÀn
) {

969 
îr‹
 = 0;

970 
i
;

971 
size_t
 
num¥e£¡
 = 0;

972 
BPMNode
* 
Àaves
;

974 if(
numcodes
 == 0)  80;

975 if((1u << 
maxbôÀn
Ë< ()
numcodes
)  80;

977 
Àaves
 = (
BPMNode
*)
	`lodïng_mÆloc
(
numcodes
 * (*leaves));

978 if(!
Àaves
)  83;

980 
i
 = 0; i !
numcodes
; ++i) {

981 if(
‰equícõs
[
i
] > 0) {

982 
Àaves
[
num¥e£¡
].
weight
 = ()
‰equícõs
[
i
];

983 
Àaves
[
num¥e£¡
].
ödex
 = 
i
;

984 ++
num¥e£¡
;

988 
	`lodïng_mem£t
(
Àngths
, 0, 
numcodes
 * (*lengths));

995 if(
num¥e£¡
 == 0) {

996 
Àngths
[0] =Üengths[1] = 1;

997 } if(
num¥e£¡
 == 1) {

998 
Àngths
[
Àaves
[0].
ödex
] = 1;

999 
Àngths
[
Àaves
[0].
ödex
 == 0 ? 1 : 0] = 1;

1001 
BPMLi°s
 
li°s
;

1002 
BPMNode
* 
node
;

1004 
	`bpmnode_s‹t
(
Àaves
, 
num¥e£¡
);

1006 
li°s
.
li°size
 = 
maxbôÀn
;

1007 
li°s
.
memsize
 = 2 * 
maxbôÀn
 * (maxbitlen + 1);

1008 
li°s
.
√xt‰ì
 = 0;

1009 
li°s
.
num‰ì
 =Üi°s.
memsize
;

1010 
li°s
.
mem‹y
 = (
BPMNode
*)
	`lodïng_mÆloc
÷i°s.
memsize
 * (*lists.memory));

1011 
li°s
.
‰ìli°
 = (
BPMNode
**)
	`lodïng_mÆloc
÷i°s.
memsize
 * (BPMNode*));

1012 
li°s
.
chaös0
 = (
BPMNode
**)
	`lodïng_mÆloc
÷i°s.
li°size
 * (BPMNode*));

1013 
li°s
.
chaös1
 = (
BPMNode
**)
	`lodïng_mÆloc
÷i°s.
li°size
 * (BPMNode*));

1014 if(!
li°s
.
mem‹y
 || !li°s.
‰ìli°
 || !li°s.
chaös0
 || !li°s.
chaös1
Ë
îr‹
 = 83;

1016 if(!
îr‹
) {

1017 
i
 = 0; i !
li°s
.
memsize
; ++iËli°s.
‰ìli°
[i] = &li°s.
mem‹y
[i];

1019 
	`bpmnode_¸óã
(&
li°s
, 
Àaves
[0].
weight
, 1, 0);

1020 
	`bpmnode_¸óã
(&
li°s
, 
Àaves
[1].
weight
, 2, 0);

1022 
i
 = 0; i !
li°s
.
li°size
; ++i) {

1023 
li°s
.
chaös0
[
i
] = &li°s.
mem‹y
[0];

1024 
li°s
.
chaös1
[
i
] = &li°s.
mem‹y
[1];

1028 
i
 = 2; i !2 * 
num¥e£¡
 - 2; ++iË
	`bound¨yPM
(&
li°s
, 
Àaves
,Çum¥e£¡, ()
maxbôÀn
 - 1, ()i);

1030 
node
 = 
li°s
.
chaös1
[
maxbôÀn
 - 1];Çode;Çodênode->
èû
) {

1031 
i
 = 0; i !
node
->
ödex
; ++iË++
Àngths
[
Àaves
[i].index];

1035 
	`lodïng_‰ì
(
li°s
.
mem‹y
);

1036 
	`lodïng_‰ì
(
li°s
.
‰ìli°
);

1037 
	`lodïng_‰ì
(
li°s
.
chaös0
);

1038 
	`lodïng_‰ì
(
li°s
.
chaös1
);

1041 
	`lodïng_‰ì
(
Àaves
);

1042  
îr‹
;

1043 
	}
}

1046 
	$Huffm™Tªe_makeFromFªquícõs
(
Huffm™Tªe
* 
åì
, c⁄° * 
‰equícõs
,

1047 
size_t
 
möcodes
, size_à
numcodes
, 
maxbôÀn
) {

1048 
îr‹
 = 0;

1049 !
‰equícõs
[
numcodes
 - 1] &&Çumcode†> 
möcodes
) --numcodes;

1050 
åì
->
Àngths
 = (*)
	`lodïng_mÆloc
(
numcodes
 * ());

1051 if(!
åì
->
Àngths
)  83;

1052 
åì
->
maxbôÀn
 = maxbitlen;

1053 
åì
->
numcodes
 = ()numcodes;

1055 
îr‹
 = 
	`lodïng_huffm™_code_Àngths
(
åì
->
Àngths
, 
‰equícõs
, 
numcodes
, 
maxbôÀn
);

1056 if(!
îr‹
Ëîr‹ = 
	`Huffm™Tªe_makeFromLígths2
(
åì
);

1057  
îr‹
;

1058 
	}
}

1062 
	$gíî©eFixedLôLíTªe
(
Huffm™Tªe
* 
åì
) {

1063 
i
, 
îr‹
 = 0;

1064 * 
bôÀn
 = (*)
	`lodïng_mÆloc
(
NUM_DEFLATE_CODE_SYMBOLS
 * ());

1065 if(!
bôÀn
)  83;

1068 
i
 = 0; i <143; ++iË
bôÀn
[i] = 8;

1069 
i
 = 144; i <255; ++iË
bôÀn
[i] = 9;

1070 
i
 = 256; i <279; ++iË
bôÀn
[i] = 7;

1071 
i
 = 280; i <287; ++iË
bôÀn
[i] = 8;

1073 
îr‹
 = 
	`Huffm™Tªe_makeFromLígths
(
åì
, 
bôÀn
, 
NUM_DEFLATE_CODE_SYMBOLS
, 15);

1075 
	`lodïng_‰ì
(
bôÀn
);

1076  
îr‹
;

1077 
	}
}

1080 
	$gíî©eFixedDi°™˚Tªe
(
Huffm™Tªe
* 
åì
) {

1081 
i
, 
îr‹
 = 0;

1082 * 
bôÀn
 = (*)
	`lodïng_mÆloc
(
NUM_DISTANCE_SYMBOLS
 * ());

1083 if(!
bôÀn
)  83;

1086 
i
 = 0; i !
NUM_DISTANCE_SYMBOLS
; ++iË
bôÀn
[i] = 5;

1087 
îr‹
 = 
	`Huffm™Tªe_makeFromLígths
(
åì
, 
bôÀn
, 
NUM_DISTANCE_SYMBOLS
, 15);

1089 
	`lodïng_‰ì
(
bôÀn
);

1090  
îr‹
;

1091 
	}
}

1093 #ifde‡
LODEPNG_COMPILE_DECODER


1098 
	$huffm™DecodeSymbﬁ
(
LodePNGBôRódî
* 
ªadî
, c⁄° 
Huffm™Tªe
* 
codëªe
) {

1099 
code
 = 
	`≥ekBôs
(
ªadî
, 
FIRSTBITS
);

1100 
l
 = 
codëªe
->
èbÀ_Àn
[
code
];

1101 
vÆue
 = 
codëªe
->
èbÀ_vÆue
[
code
];

1102 if(
l
 <
FIRSTBITS
) {

1103 
	`adv™˚Bôs
(
ªadî
, 
l
);

1104  
vÆue
;

1106 
ödex2
;

1107 
	`adv™˚Bôs
(
ªadî
, 
FIRSTBITS
);

1108 
ödex2
 = 
vÆue
 + 
	`≥ekBôs
(
ªadî
, 
l
 - 
FIRSTBITS
);

1109 
	`adv™˚Bôs
(
ªadî
, 
codëªe
->
èbÀ_Àn
[
ödex2
] - 
FIRSTBITS
);

1110  
codëªe
->
èbÀ_vÆue
[
ödex2
];

1112 
	}
}

1115 #ifde‡
LODEPNG_COMPILE_DECODER


1123 
	$gëTªeInÊ©eFixed
(
Huffm™Tªe
* 
åì_Œ
, Huffm™Tªe* 
åì_d
) {

1124 
îr‹
 = 
	`gíî©eFixedLôLíTªe
(
åì_Œ
);

1125 if(
îr‹
) Érror;

1126  
	`gíî©eFixedDi°™˚Tªe
(
åì_d
);

1127 
	}
}

1130 
	$gëTªeInÊ©eDy«mic
(
Huffm™Tªe
* 
åì_Œ
, Huffm™Tªe* 
åì_d
,

1131 
LodePNGBôRódî
* 
ªadî
) {

1133 
îr‹
 = 0;

1134 
n
, 
HLIT
, 
HDIST
, 
HCLEN
, 
i
;

1137 * 
bôÀn_Œ
 = 0;

1138 * 
bôÀn_d
 = 0;

1140 * 
bôÀn_˛
 = 0;

1141 
Huffm™Tªe
 
åì_˛
;

1143 if(!
	`ísuªBôs17
(
ªadî
, 14))  49;

1146 
HLIT
 = 
	`ªadBôs
(
ªadî
, 5) + 257;

1148 
HDIST
 = 
	`ªadBôs
(
ªadî
, 5) + 1;

1150 
HCLEN
 = 
	`ªadBôs
(
ªadî
, 4) + 4;

1152 
bôÀn_˛
 = (*)
	`lodïng_mÆloc
(
NUM_CODE_LENGTH_CODES
 * ());

1153 if(!
bôÀn_˛
)  83 ;

1155 
	`Huffm™Tªe_öô
(&
åì_˛
);

1157 !
îr‹
) {

1159 if(
	`lodïng_gtoÊ
(
ªadî
->
bp
, 
HCLEN
 * 3,Ñódî->
bôsize
)) {

1160 
	`ERROR_BREAK
(50);

1162 
i
 = 0; i !
HCLEN
; ++i) {

1163 
	`ísuªBôs9
(
ªadî
, 3);

1164 
bôÀn_˛
[
CLCL_ORDER
[
i
]] = 
	`ªadBôs
(
ªadî
, 3);

1166 
i
 = 
HCLEN
; i !
NUM_CODE_LENGTH_CODES
; ++i) {

1167 
bôÀn_˛
[
CLCL_ORDER
[
i
]] = 0;

1170 
îr‹
 = 
	`Huffm™Tªe_makeFromLígths
(&
åì_˛
, 
bôÀn_˛
, 
NUM_CODE_LENGTH_CODES
, 7);

1171 if(
îr‹
) ;

1174 
bôÀn_Œ
 = (*)
	`lodïng_mÆloc
(
NUM_DEFLATE_CODE_SYMBOLS
 * ());

1175 
bôÀn_d
 = (*)
	`lodïng_mÆloc
(
NUM_DISTANCE_SYMBOLS
 * ());

1176 if(!
bôÀn_Œ
 || !
bôÀn_d
Ë
	`ERROR_BREAK
(83 );

1177 
	`lodïng_mem£t
(
bôÀn_Œ
, 0, 
NUM_DEFLATE_CODE_SYMBOLS
 * (*bitlen_ll));

1178 
	`lodïng_mem£t
(
bôÀn_d
, 0, 
NUM_DISTANCE_SYMBOLS
 * (*bitlen_d));

1181 
i
 = 0;

1182 
i
 < 
HLIT
 + 
HDIST
) {

1183 
code
;

1184 
	`ísuªBôs25
(
ªadî
, 22);

1185 
code
 = 
	`huffm™DecodeSymbﬁ
(
ªadî
, &
åì_˛
);

1186 if(
code
 <= 15) {

1187 if(
i
 < 
HLIT
Ë
bôÀn_Œ
[i] = 
code
;

1188 
bôÀn_d
[
i
 - 
HLIT
] = 
code
;

1189 ++
i
;

1190 } if(
code
 == 16) {

1191 
ª∂ígth
 = 3;

1192 
vÆue
;

1194 if(
i
 =0Ë
	`ERROR_BREAK
(54);

1196 
ª∂ígth
 +
	`ªadBôs
(
ªadî
, 2);

1198 if(
i
 < 
HLIT
 + 1Ë
vÆue
 = 
bôÀn_Œ
[i - 1];

1199 
vÆue
 = 
bôÀn_d
[
i
 - 
HLIT
 - 1];

1201 
n
 = 0;Ç < 
ª∂ígth
; ++n) {

1202 if(
i
 >
HLIT
 + 
HDIST
Ë
	`ERROR_BREAK
(13);

1203 if(
i
 < 
HLIT
Ë
bôÀn_Œ
[i] = 
vÆue
;

1204 
bôÀn_d
[
i
 - 
HLIT
] = 
vÆue
;

1205 ++
i
;

1207 } if(
code
 == 17) {

1208 
ª∂ígth
 = 3;

1209 
ª∂ígth
 +
	`ªadBôs
(
ªadî
, 3);

1212 
n
 = 0;Ç < 
ª∂ígth
; ++n) {

1213 if(
i
 >
HLIT
 + 
HDIST
Ë
	`ERROR_BREAK
(14);

1215 if(
i
 < 
HLIT
Ë
bôÀn_Œ
[i] = 0;

1216 
bôÀn_d
[
i
 - 
HLIT
] = 0;

1217 ++
i
;

1219 } if(
code
 == 18) {

1220 
ª∂ígth
 = 11;

1221 
ª∂ígth
 +
	`ªadBôs
(
ªadî
, 7);

1224 
n
 = 0;Ç < 
ª∂ígth
; ++n) {

1225 if(
i
 >
HLIT
 + 
HDIST
Ë
	`ERROR_BREAK
(15);

1227 if(
i
 < 
HLIT
Ë
bôÀn_Œ
[i] = 0;

1228 
bôÀn_d
[
i
 - 
HLIT
] = 0;

1229 ++
i
;

1232 
	`ERROR_BREAK
(16);

1235 if(
ªadî
->
bp
 >Ñódî->
bôsize
) {

1239 
	`ERROR_BREAK
(50);

1242 if(
îr‹
) ;

1244 if(
bôÀn_Œ
[256] =0Ë
	`ERROR_BREAK
(64);

1247 
îr‹
 = 
	`Huffm™Tªe_makeFromLígths
(
åì_Œ
, 
bôÀn_Œ
, 
NUM_DEFLATE_CODE_SYMBOLS
, 15);

1248 if(
îr‹
) ;

1249 
îr‹
 = 
	`Huffm™Tªe_makeFromLígths
(
åì_d
, 
bôÀn_d
, 
NUM_DISTANCE_SYMBOLS
, 15);

1254 
	`lodïng_‰ì
(
bôÀn_˛
);

1255 
	`lodïng_‰ì
(
bôÀn_Œ
);

1256 
	`lodïng_‰ì
(
bôÀn_d
);

1257 
	`Huffm™Tªe_˛ónup
(&
åì_˛
);

1259  
îr‹
;

1260 
	}
}

1263 
	$öÊ©eHuffm™Block
(
ucve˘‹
* 
out
, 
LodePNGBôRódî
* 
ªadî
,

1264 
bty≥
, 
size_t
 
max_ouçut_size
) {

1265 
îr‹
 = 0;

1266 
Huffm™Tªe
 
åì_Œ
;

1267 
Huffm™Tªe
 
åì_d
;

1269 
	`Huffm™Tªe_öô
(&
åì_Œ
);

1270 
	`Huffm™Tªe_öô
(&
åì_d
);

1272 if(
bty≥
 =1Ë
îr‹
 = 
	`gëTªeInÊ©eFixed
(&
åì_Œ
, &
åì_d
);

1273 
îr‹
 = 
	`gëTªeInÊ©eDy«mic
(&
åì_Œ
, &
åì_d
, 
ªadî
);

1275 !
îr‹
) {

1277 
code_Œ
;

1278 
	`ísuªBôs25
(
ªadî
, 20);

1279 
code_Œ
 = 
	`huffm™DecodeSymbﬁ
(
ªadî
, &
åì_Œ
);

1280 if(
code_Œ
 <= 255) {

1281 if(!
	`ucve˘‹_ªsize
(
out
, out->
size
 + 1)Ë
	`ERROR_BREAK
(83 );

1282 
out
->
d©a
[out->
size
 - 1] = ()
code_Œ
;

1283 } if(
code_Œ
 >
FIRST_LENGTH_CODE_INDEX
 && code_Œ <
LAST_LENGTH_CODE_INDEX
) {

1284 
code_d
, 
di°™˚
;

1285 
numexåabôs_l
, 
numexåabôs_d
;

1286 
size_t
 
°¨t
, 
backw¨d
, 
Àngth
;

1289 
Àngth
 = 
LENGTHBASE
[
code_Œ
 - 
FIRST_LENGTH_CODE_INDEX
];

1292 
numexåabôs_l
 = 
LENGTHEXTRA
[
code_Œ
 - 
FIRST_LENGTH_CODE_INDEX
];

1293 if(
numexåabôs_l
 != 0) {

1295 
Àngth
 +
	`ªadBôs
(
ªadî
, 
numexåabôs_l
);

1299 
	`ísuªBôs32
(
ªadî
, 28);

1300 
code_d
 = 
	`huffm™DecodeSymbﬁ
(
ªadî
, &
åì_d
);

1301 if(
code_d
 > 29) {

1302 if(
code_d
 <= 31) {

1303 
	`ERROR_BREAK
(18);

1305 
	`ERROR_BREAK
(16);

1308 
di°™˚
 = 
DISTANCEBASE
[
code_d
];

1311 
numexåabôs_d
 = 
DISTANCEEXTRA
[
code_d
];

1312 if(
numexåabôs_d
 != 0) {

1314 
di°™˚
 +
	`ªadBôs
(
ªadî
, 
numexåabôs_d
);

1318 
°¨t
 = 
out
->
size
;

1319 if(
di°™˚
 > 
°¨t
Ë
	`ERROR_BREAK
(52);

1320 
backw¨d
 = 
°¨t
 - 
di°™˚
;

1322 if(!
	`ucve˘‹_ªsize
(
out
, out->
size
 + 
Àngth
)Ë
	`ERROR_BREAK
(83 );

1323 if(
di°™˚
 < 
Àngth
) {

1324 
size_t
 
f‹w¨d
;

1325 
	`lodïng_mem˝y
(
out
->
d©a
 + 
°¨t
, out->d©®+ 
backw¨d
, 
di°™˚
);

1326 
°¨t
 +
di°™˚
;

1327 
f‹w¨d
 = 
di°™˚
; f‹w¨d < 
Àngth
; ++forward) {

1328 
out
->
d©a
[
°¨t
++] = out->d©a[
backw¨d
++];

1331 
	`lodïng_mem˝y
(
out
->
d©a
 + 
°¨t
, out->d©®+ 
backw¨d
, 
Àngth
);

1333 } if(
code_Œ
 == 256) {

1336 
	`ERROR_BREAK
(16);

1339 if(
ªadî
->
bp
 >Ñódî->
bôsize
) {

1343 
	`ERROR_BREAK
(51);

1345 if(
max_ouçut_size
 && 
out
->
size
 > max_output_size) {

1346 
	`ERROR_BREAK
(109);

1350 
	`Huffm™Tªe_˛ónup
(&
åì_Œ
);

1351 
	`Huffm™Tªe_˛ónup
(&
åì_d
);

1353  
îr‹
;

1354 
	}
}

1356 
	$öÊ©eNoCom¥essi⁄
(
ucve˘‹
* 
out
, 
LodePNGBôRódî
* 
ªadî
,

1357 c⁄° 
LodePNGDecom¥essSëtögs
* 
£âögs
) {

1358 
size_t
 
byãpos
;

1359 
size_t
 
size
 = 
ªadî
->size;

1360 
LEN
, 
NLEN
, 
îr‹
 = 0;

1363 
byãpos
 = (
ªadî
->
bp
 + 7u) >> 3u;

1366 if(
byãpos
 + 4 >
size
)  52;

1367 
LEN
 = ()
ªadî
->
d©a
[
byãpos
] + (()reader->data[bytepos + 1] << 8u); bytepos += 2;

1368 
NLEN
 = ()
ªadî
->
d©a
[
byãpos
] + (()reader->data[bytepos + 1] << 8u); bytepos += 2;

1371 if(!
£âögs
->
ign‹e_∆í
 && 
LEN
 + 
NLEN
 != 65535) {

1375 if(!
	`ucve˘‹_ªsize
(
out
, out->
size
 + 
LEN
))  83;

1378 if(
byãpos
 + 
LEN
 > 
size
)  23;

1380 
	`lodïng_mem˝y
(
out
->
d©a
 + out->
size
 - 
LEN
, 
ªadî
->d©®+ 
byãpos
, LEN);

1381 
byãpos
 +
LEN
;

1383 
ªadî
->
bp
 = 
byãpos
 << 3u;

1385  
îr‹
;

1386 
	}
}

1388 
	$lodïng_öÊ©ev
(
ucve˘‹
* 
out
,

1389 c⁄° * 
ö
, 
size_t
 
ösize
,

1390 c⁄° 
LodePNGDecom¥essSëtögs
* 
£âögs
) {

1391 
BFINAL
 = 0;

1392 
LodePNGBôRódî
 
ªadî
;

1393 
îr‹
 = 
	`LodePNGBôRódî_öô
(&
ªadî
, 
ö
, 
ösize
);

1395 if(
îr‹
) Érror;

1397 !
BFINAL
) {

1398 
BTYPE
;

1399 if(!
	`ísuªBôs9
(&
ªadî
, 3))  52;

1400 
BFINAL
 = 
	`ªadBôs
(&
ªadî
, 1);

1401 
BTYPE
 = 
	`ªadBôs
(&
ªadî
, 2);

1403 if(
BTYPE
 == 3)  20;

1404 if(
BTYPE
 =0Ë
îr‹
 = 
	`öÊ©eNoCom¥essi⁄
(
out
, &
ªadî
, 
£âögs
);

1405 
îr‹
 = 
	`öÊ©eHuffm™Block
(
out
, &
ªadî
, 
BTYPE
, 
£âögs
->
max_ouçut_size
);

1406 if(!
îr‹
 && 
£âögs
->
max_ouçut_size
 && 
out
->
size
 > settings->max_output_size)Érror = 109;

1407 if(
îr‹
) ;

1410  
îr‹
;

1411 
	}
}

1413 
	$lodïng_öÊ©e
(** 
out
, 
size_t
* 
outsize
,

1414 c⁄° * 
ö
, 
size_t
 
ösize
,

1415 c⁄° 
LodePNGDecom¥essSëtögs
* 
£âögs
) {

1416 
ucve˘‹
 
v
 = 
	`ucve˘‹_öô
(*
out
, *
outsize
);

1417 
îr‹
 = 
	`lodïng_öÊ©ev
(&
v
, 
ö
, 
ösize
, 
£âögs
);

1418 *
out
 = 
v
.
d©a
;

1419 *
outsize
 = 
v
.
size
;

1420  
îr‹
;

1421 
	}
}

1423 
	$öÊ©ev
(
ucve˘‹
* 
out
, c⁄° * 
ö
, 
size_t
 
ösize
,

1424 c⁄° 
LodePNGDecom¥essSëtögs
* 
£âögs
) {

1425 if(
£âögs
->
cu°om_öÊ©e
) {

1426 
îr‹
 = 
£âögs
->
	`cu°om_öÊ©e
(&
out
->
d©a
, &out->
size
, 
ö
, 
ösize
, settings);

1427 
out
->
Ælocsize
 = out->
size
;

1428 if(
îr‹
) {

1430 
îr‹
 = 110;

1432 if(
£âögs
->
max_ouçut_size
 && 
out
->
size
 > sëtögs->max_ouçut_sizeË
îr‹
 = 109;

1434  
îr‹
;

1436  
	`lodïng_öÊ©ev
(
out
, 
ö
, 
ösize
, 
£âögs
);

1438 
	}
}

1442 #ifde‡
LODEPNG_COMPILE_ENCODER


1448 c⁄° 
size_t
 
	gMAX_SUPPORTED_DEFLATE_LENGTH
 = 258;

1452 
size_t
 
	$£¨chCodeIndex
(c⁄° * 
¨øy
, 
size_t
 
¨øy_size
, size_à
vÆue
) {

1454 
size_t
 
À·
 = 1;

1455 
size_t
 
right
 = 
¨øy_size
 - 1;

1457 
À·
 <
right
) {

1458 
size_t
 
mid
 = (
À·
 + 
right
) >> 1;

1459 if(
¨øy
[
mid
] >
vÆue
Ë
right
 = mid - 1;

1460 
À·
 = 
mid
 + 1;

1462 if(
À·
 >
¨øy_size
 || 
¨øy
[À·] > 
vÆue
)Üeft--;

1463  
À·
;

1464 
	}
}

1466 
	$addLígthDi°™˚
(
uive˘‹
* 
vÆues
, 
size_t
 
Àngth
, size_à
di°™˚
) {

1473 
Àngth_code
 = ()
	`£¨chCodeIndex
(
LENGTHBASE
, 29, 
Àngth
);

1474 
exåa_Àngth
 = ()(
Àngth
 - 
LENGTHBASE
[
Àngth_code
]);

1475 
di°_code
 = ()
	`£¨chCodeIndex
(
DISTANCEBASE
, 30, 
di°™˚
);

1476 
exåa_di°™˚
 = ()(
di°™˚
 - 
DISTANCEBASE
[
di°_code
]);

1478 
size_t
 
pos
 = 
vÆues
->
size
;

1480 
ok
 = 
	`uive˘‹_ªsize
(
vÆues
, vÆues->
size
 + 4);

1481 if(
ok
) {

1482 
vÆues
->
d©a
[
pos
 + 0] = 
Àngth_code
 + 
FIRST_LENGTH_CODE_INDEX
;

1483 
vÆues
->
d©a
[
pos
 + 1] = 
exåa_Àngth
;

1484 
vÆues
->
d©a
[
pos
 + 2] = 
di°_code
;

1485 
vÆues
->
d©a
[
pos
 + 3] = 
exåa_di°™˚
;

1487 
	}
}

1491 c⁄° 
	gHASH_NUM_VALUES
 = 65536;

1492 c⁄° 
	gHASH_BIT_MASK
 = 65535;

1494 
	sHash
 {

1495 * 
	mhód
;

1497 * 
	mchaö
;

1498 * 
	mvÆ
;

1502 * 
	mhódz
;

1503 * 
	mchaöz
;

1504 * 
	mzîos
;

1505 } 
	tHash
;

1507 
	$hash_öô
(
Hash
* 
hash
, 
wödowsize
) {

1508 
i
;

1509 
hash
->
hód
 = (*)
	`lodïng_mÆloc
((Ë* 
HASH_NUM_VALUES
);

1510 
hash
->
vÆ
 = (*)
	`lodïng_mÆloc
((Ë* 
wödowsize
);

1511 
hash
->
chaö
 = (*)
	`lodïng_mÆloc
((Ë* 
wödowsize
);

1513 
hash
->
zîos
 = (*)
	`lodïng_mÆloc
((Ë* 
wödowsize
);

1514 
hash
->
hódz
 = (*)
	`lodïng_mÆloc
((Ë* (
MAX_SUPPORTED_DEFLATE_LENGTH
 + 1));

1515 
hash
->
chaöz
 = (*)
	`lodïng_mÆloc
((Ë* 
wödowsize
);

1517 if(!
hash
->
hód
 || !hash->
chaö
 || !hash->
vÆ
 || !hash->
hódz
|| !hash->
chaöz
 || !hash->
zîos
) {

1522 
i
 = 0; i !
HASH_NUM_VALUES
; ++iË
hash
->
hód
[i] = -1;

1523 
i
 = 0; i !
wödowsize
; ++iË
hash
->
vÆ
[i] = -1;

1524 
i
 = 0; i !
wödowsize
; ++iË
hash
->
chaö
[i] = i;

1526 
i
 = 0; i <
MAX_SUPPORTED_DEFLATE_LENGTH
; ++iË
hash
->
hódz
[i] = -1;

1527 
i
 = 0; i !
wödowsize
; ++iË
hash
->
chaöz
[i] = i;

1530 
	}
}

1532 
	$hash_˛ónup
(
Hash
* 
hash
) {

1533 
	`lodïng_‰ì
(
hash
->
hód
);

1534 
	`lodïng_‰ì
(
hash
->
vÆ
);

1535 
	`lodïng_‰ì
(
hash
->
chaö
);

1537 
	`lodïng_‰ì
(
hash
->
zîos
);

1538 
	`lodïng_‰ì
(
hash
->
hódz
);

1539 
	`lodïng_‰ì
(
hash
->
chaöz
);

1540 
	}
}

1544 
	$gëHash
(c⁄° * 
d©a
, 
size_t
 
size
, size_à
pos
) {

1545 
ªsu…
 = 0;

1546 if(
pos
 + 2 < 
size
) {

1551 
ªsu…
 ^(()
d©a
[
pos
 + 0] << 0u);

1552 
ªsu…
 ^(()
d©a
[
pos
 + 1] << 4u);

1553 
ªsu…
 ^(()
d©a
[
pos
 + 2] << 8u);

1555 
size_t
 
amou¡
, 
i
;

1556 if(
pos
 >
size
)  0;

1557 
amou¡
 = 
size
 - 
pos
;

1558 
i
 = 0; i !
amou¡
; ++iË
ªsu…
 ^(()
d©a
[
pos
 + i] << (i * 8u));

1560  
ªsu…
 & 
HASH_BIT_MASK
;

1561 
	}
}

1563 
	$cou¡Zîos
(c⁄° * 
d©a
, 
size_t
 
size
, size_à
pos
) {

1564 c⁄° * 
°¨t
 = 
d©a
 + 
pos
;

1565 c⁄° * 
íd
 = 
°¨t
 + 
MAX_SUPPORTED_DEFLATE_LENGTH
;

1566 if(
íd
 > 
d©a
 + 
size
)Énd = data + size;

1567 
d©a
 = 
°¨t
;

1568 
d©a
 !
íd
 && *data == 0) ++data;

1570  ()(
d©a
 - 
°¨t
);

1571 
	}
}

1574 
	$upd©eHashChaö
(
Hash
* 
hash
, 
size_t
 
wpos
, 
hashvÆ
, 
numzîos
) {

1575 
hash
->
vÆ
[
wpos
] = ()
hashvÆ
;

1576 if(
hash
->
hód
[
hashvÆ
] !-1Ëhash->
chaö
[
wpos
] = hash->head[hashval];

1577 
hash
->
hód
[
hashvÆ
] = ()
wpos
;

1579 
hash
->
zîos
[
wpos
] = 
numzîos
;

1580 if(
hash
->
hódz
[
numzîos
] !-1Ëhash->
chaöz
[
wpos
] = hash->headz[numzeros];

1581 
hash
->
hódz
[
numzîos
] = ()
wpos
;

1582 
	}
}

1593 
	$ícodeLZ77
(
uive˘‹
* 
out
, 
Hash
* 
hash
,

1594 c⁄° * 
ö
, 
size_t
 
öpos
, size_à
ösize
, 
wödowsize
,

1595 
möm©ch
, 
ni˚m©ch
, 
œzym©chög
) {

1596 
size_t
 
pos
;

1597 
i
, 
îr‹
 = 0;

1599 
maxchaöÀngth
 = 
wödowsize
 >= 8192 ? windowsize : windowsize / 8u;

1600 
maxœzym©ch
 = 
wödowsize
 >8192 ? 
MAX_SUPPORTED_DEFLATE_LENGTH
 : 64;

1602 
u£zîos
 = 1;

1603 
numzîos
 = 0;

1605 
off£t
;

1606 
Àngth
;

1607 
œzy
 = 0;

1608 
œzyÀngth
 = 0, 
œzyoff£t
 = 0;

1609 
hashvÆ
;

1610 
cuºít_off£t
, 
cuºít_Àngth
;

1611 
¥ev_off£t
;

1612 c⁄° *
œ°±r
, *
f‹ïå
, *
back±r
;

1613 
hashpos
;

1615 if(
wödowsize
 == 0 || windowsize > 32768)  60;

1616 if((
wödowsize
 & (windowsize - 1)) != 0)  90;

1618 if(
ni˚m©ch
 > 
MAX_SUPPORTED_DEFLATE_LENGTH
)Çicematch = MAX_SUPPORTED_DEFLATE_LENGTH;

1620 
pos
 = 
öpos
;Öo†< 
ösize
; ++pos) {

1621 
size_t
 
wpos
 = 
pos
 & (
wödowsize
 - 1);

1622 
chaöÀngth
 = 0;

1624 
hashvÆ
 = 
	`gëHash
(
ö
, 
ösize
, 
pos
);

1626 if(
u£zîos
 && 
hashvÆ
 == 0) {

1627 if(
numzîos
 =0Ënumzîo†
	`cou¡Zîos
(
ö
, 
ösize
, 
pos
);

1628 if(
pos
 + 
numzîos
 > 
ösize
 || 
ö
[pos +Çumzeros - 1] != 0) --numzeros;

1630 
numzîos
 = 0;

1633 
	`upd©eHashChaö
(
hash
, 
wpos
, 
hashvÆ
, 
numzîos
);

1636 
Àngth
 = 0;

1637 
off£t
 = 0;

1639 
hashpos
 = 
hash
->
chaö
[
wpos
];

1641 
œ°±r
 = &
ö
[
ösize
 < 
pos
 + 
MAX_SUPPORTED_DEFLATE_LENGTH
 ? insize :Öos + MAX_SUPPORTED_DEFLATE_LENGTH];

1644 
¥ev_off£t
 = 0;

1646 if(
chaöÀngth
++ >
maxchaöÀngth
) ;

1647 
cuºít_off£t
 = ()(
hashpos
 <
wpos
 ? wpo†- hashpo†: wpo†- hashpo†+ 
wödowsize
);

1649 if(
cuºít_off£t
 < 
¥ev_off£t
) ;

1650 
¥ev_off£t
 = 
cuºít_off£t
;

1651 if(
cuºít_off£t
 > 0) {

1653 
f‹ïå
 = &
ö
[
pos
];

1654 
back±r
 = &
ö
[
pos
 - 
cuºít_off£t
];

1657 if(
numzîos
 >= 3) {

1658 
skù
 = 
hash
->
zîos
[
hashpos
];

1659 if(
skù
 > 
numzîos
) skip =Çumzeros;

1660 
back±r
 +
skù
;

1661 
f‹ïå
 +
skù
;

1664 
f‹ïå
 !
œ°±r
 && *
back±r
 == *foreptr) {

1665 ++
back±r
;

1666 ++
f‹ïå
;

1668 
cuºít_Àngth
 = ()(
f‹ïå
 - &
ö
[
pos
]);

1670 if(
cuºít_Àngth
 > 
Àngth
) {

1671 
Àngth
 = 
cuºít_Àngth
;

1672 
off£t
 = 
cuºít_off£t
;

1675 if(
cuºít_Àngth
 >
ni˚m©ch
) ;

1679 if(
hashpos
 =
hash
->
chaö
[hashpos]) ;

1681 if(
numzîos
 >3 && 
Àngth
 >Çumzeros) {

1682 
hashpos
 = 
hash
->
chaöz
[hashpos];

1683 if(
hash
->
zîos
[
hashpos
] !
numzîos
) ;

1685 
hashpos
 = 
hash
->
chaö
[hashpos];

1687 if(
hash
->
vÆ
[
hashpos
] !()
hashvÆ
) ;

1691 if(
œzym©chög
) {

1692 if(!
œzy
 && 
Àngth
 >3 &&Üígth <
maxœzym©ch
 &&Üígth < 
MAX_SUPPORTED_DEFLATE_LENGTH
) {

1693 
œzy
 = 1;

1694 
œzyÀngth
 = 
Àngth
;

1695 
œzyoff£t
 = 
off£t
;

1698 if(
œzy
) {

1699 
œzy
 = 0;

1700 if(
pos
 =0Ë
	`ERROR_BREAK
(81);

1701 if(
Àngth
 > 
œzyÀngth
 + 1) {

1703 if(!
	`uive˘‹_push_back
(
out
, 
ö
[
pos
 - 1])Ë
	`ERROR_BREAK
(83 );

1705 
Àngth
 = 
œzyÀngth
;

1706 
off£t
 = 
œzyoff£t
;

1707 
hash
->
hód
[
hashvÆ
] = -1;

1708 
hash
->
hódz
[
numzîos
] = -1;

1709 --
pos
;

1713 if(
Àngth
 >3 && 
off£t
 > 
wödowsize
Ë
	`ERROR_BREAK
(86 );

1716 if(
Àngth
 < 3) {

1717 if(!
	`uive˘‹_push_back
(
out
, 
ö
[
pos
])Ë
	`ERROR_BREAK
(83 );

1718 } if(
Àngth
 < 
möm©ch
 || (Àngth =3 && 
off£t
 > 4096)) {

1721 if(!
	`uive˘‹_push_back
(
out
, 
ö
[
pos
])Ë
	`ERROR_BREAK
(83 );

1723 
	`addLígthDi°™˚
(
out
, 
Àngth
, 
off£t
);

1724 
i
 = 1; i < 
Àngth
; ++i) {

1725 ++
pos
;

1726 
wpos
 = 
pos
 & (
wödowsize
 - 1);

1727 
hashvÆ
 = 
	`gëHash
(
ö
, 
ösize
, 
pos
);

1728 if(
u£zîos
 && 
hashvÆ
 == 0) {

1729 if(
numzîos
 =0Ënumzîo†
	`cou¡Zîos
(
ö
, 
ösize
, 
pos
);

1730 if(
pos
 + 
numzîos
 > 
ösize
 || 
ö
[pos +Çumzeros - 1] != 0) --numzeros;

1732 
numzîos
 = 0;

1734 
	`upd©eHashChaö
(
hash
, 
wpos
, 
hashvÆ
, 
numzîos
);

1739  
îr‹
;

1740 
	}
}

1744 
	$deÊ©eNoCom¥essi⁄
(
ucve˘‹
* 
out
, c⁄° * 
d©a
, 
size_t
 
d©asize
) {

1748 
size_t
 
i
, 
numdeÊ©eblocks
 = (
d©asize
 + 65534u) / 65535u;

1749 
d©≠os
 = 0;

1750 
i
 = 0; i !
numdeÊ©eblocks
; ++i) {

1751 
BFINAL
, 
BTYPE
, 
LEN
, 
NLEN
;

1752 
fú°byã
;

1753 
size_t
 
pos
 = 
out
->
size
;

1755 
BFINAL
 = (
i
 =
numdeÊ©eblocks
 - 1);

1756 
BTYPE
 = 0;

1758 
LEN
 = 65535;

1759 if(
d©asize
 - 
d©≠os
 < 65535uË
LEN
 = ()datasize - datapos;

1760 
NLEN
 = 65535 - 
LEN
;

1762 if(!
	`ucve˘‹_ªsize
(
out
, out->
size
 + 
LEN
 + 5))  83;

1764 
fú°byã
 = ()(
BFINAL
 + ((
BTYPE
 & 1u) << 1u) + ((BTYPE & 2u) << 1u));

1765 
out
->
d©a
[
pos
 + 0] = 
fú°byã
;

1766 
out
->
d©a
[
pos
 + 1] = ()(
LEN
 & 255);

1767 
out
->
d©a
[
pos
 + 2] = ()(
LEN
 >> 8u);

1768 
out
->
d©a
[
pos
 + 3] = ()(
NLEN
 & 255);

1769 
out
->
d©a
[
pos
 + 4] = ()(
NLEN
 >> 8u);

1770 
	`lodïng_mem˝y
(
out
->
d©a
 + 
pos
 + 5, d©®+ 
d©≠os
, 
LEN
);

1771 
d©≠os
 +
LEN
;

1775 
	}
}

1782 
	$wrôeLZ77d©a
(
LodePNGBôWrôî
* 
wrôî
, c⁄° 
uive˘‹
* 
lz77_ícoded
,

1783 c⁄° 
Huffm™Tªe
* 
åì_Œ
, c⁄° Huffm™Tªe* 
åì_d
) {

1784 
size_t
 
i
 = 0;

1785 
i
 = 0; i !
lz77_ícoded
->
size
; ++i) {

1786 
vÆ
 = 
lz77_ícoded
->
d©a
[
i
];

1787 
	`wrôeBôsRevî£d
(
wrôî
, 
åì_Œ
->
codes
[
vÆ
],Åªe_Œ->
Àngths
[val]);

1788 if(
vÆ
 > 256) {

1789 
Àngth_ödex
 = 
vÆ
 - 
FIRST_LENGTH_CODE_INDEX
;

1790 
n_Àngth_exåa_bôs
 = 
LENGTHEXTRA
[
Àngth_ödex
];

1791 
Àngth_exåa_bôs
 = 
lz77_ícoded
->
d©a
[++
i
];

1793 
di°™˚_code
 = 
lz77_ícoded
->
d©a
[++
i
];

1795 
di°™˚_ödex
 = 
di°™˚_code
;

1796 
n_di°™˚_exåa_bôs
 = 
DISTANCEEXTRA
[
di°™˚_ödex
];

1797 
di°™˚_exåa_bôs
 = 
lz77_ícoded
->
d©a
[++
i
];

1799 
	`wrôeBôs
(
wrôî
, 
Àngth_exåa_bôs
, 
n_Àngth_exåa_bôs
);

1800 
	`wrôeBôsRevî£d
(
wrôî
, 
åì_d
->
codes
[
di°™˚_code
],Åªe_d->
Àngths
[distance_code]);

1801 
	`wrôeBôs
(
wrôî
, 
di°™˚_exåa_bôs
, 
n_di°™˚_exåa_bôs
);

1804 
	}
}

1807 
	$deÊ©eDy«mic
(
LodePNGBôWrôî
* 
wrôî
, 
Hash
* 
hash
,

1808 c⁄° * 
d©a
, 
size_t
 
d©≠os
, size_à
d©´nd
,

1809 c⁄° 
LodePNGCom¥essSëtögs
* 
£âögs
, 
föÆ
) {

1810 
îr‹
 = 0;

1824 
uive˘‹
 
lz77_ícoded
;

1825 
Huffm™Tªe
 
åì_Œ
;

1826 
Huffm™Tªe
 
åì_d
;

1827 
Huffm™Tªe
 
åì_˛
;

1828 * 
‰equícõs_Œ
 = 0;

1829 * 
‰equícõs_d
 = 0;

1830 * 
‰equícõs_˛
 = 0;

1831 * 
bôÀn_Œd
 = 0;

1832 * 
bôÀn_Œd_e
 = 0;

1833 
size_t
 
d©asize
 = 
d©´nd
 - 
d©≠os
;

1844 
BFINAL
 = 
föÆ
;

1845 
size_t
 
i
;

1846 
size_t
 
numcodes_Œ
, 
numcodes_d
, 
numcodes_Œd
, 
numcodes_Œd_e
, 
numcodes_˛
;

1847 
HLIT
, 
HDIST
, 
HCLEN
;

1849 
	`uive˘‹_öô
(&
lz77_ícoded
);

1850 
	`Huffm™Tªe_öô
(&
åì_Œ
);

1851 
	`Huffm™Tªe_öô
(&
åì_d
);

1852 
	`Huffm™Tªe_öô
(&
åì_˛
);

1854 
‰equícõs_Œ
 = (*)
	`lodïng_mÆloc
(286 * (*frequencies_ll));

1855 
‰equícõs_d
 = (*)
	`lodïng_mÆloc
(30 * (*frequencies_d));

1856 
‰equícõs_˛
 = (*)
	`lodïng_mÆloc
(
NUM_CODE_LENGTH_CODES
 * (*frequencies_cl));

1858 if(!
‰equícõs_Œ
 || !
‰equícõs_d
 || !
‰equícõs_˛
Ë
îr‹
 = 83;

1862 !
îr‹
) {

1863 
	`lodïng_mem£t
(
‰equícõs_Œ
, 0, 286 * (*frequencies_ll));

1864 
	`lodïng_mem£t
(
‰equícõs_d
, 0, 30 * (*frequencies_d));

1865 
	`lodïng_mem£t
(
‰equícõs_˛
, 0, 
NUM_CODE_LENGTH_CODES
 * (*frequencies_cl));

1867 if(
£âögs
->
u£_lz77
) {

1868 
îr‹
 = 
	`ícodeLZ77
(&
lz77_ícoded
, 
hash
, 
d©a
, 
d©≠os
, 
d©´nd
, 
£âögs
->
wödowsize
,

1869 
£âögs
->
möm©ch
, sëtögs->
ni˚m©ch
, sëtögs->
œzym©chög
);

1870 if(
îr‹
) ;

1872 if(!
	`uive˘‹_ªsize
(&
lz77_ícoded
, 
d©asize
)Ë
	`ERROR_BREAK
(83 );

1873 
i
 = 
d©≠os
; i < 
d©´nd
; ++iË
lz77_ícoded
.
d©a
[i - datapos] = data[i];

1877 
i
 = 0; i !
lz77_ícoded
.
size
; ++i) {

1878 
symbﬁ
 = 
lz77_ícoded
.
d©a
[
i
];

1879 ++
‰equícõs_Œ
[
symbﬁ
];

1880 if(
symbﬁ
 > 256) {

1881 
di°
 = 
lz77_ícoded
.
d©a
[
i
 + 2];

1882 ++
‰equícõs_d
[
di°
];

1883 
i
 += 3;

1886 
‰equícõs_Œ
[256] = 1;

1889 
îr‹
 = 
	`Huffm™Tªe_makeFromFªquícõs
(&
åì_Œ
, 
‰equícõs_Œ
, 257, 286, 15);

1890 if(
îr‹
) ;

1892 
îr‹
 = 
	`Huffm™Tªe_makeFromFªquícõs
(&
åì_d
, 
‰equícõs_d
, 2, 30, 15);

1893 if(
îr‹
) ;

1895 
numcodes_Œ
 = 
	`LODEPNG_MIN
(
åì_Œ
.
numcodes
, 286);

1896 
numcodes_d
 = 
	`LODEPNG_MIN
(
åì_d
.
numcodes
, 30);

1898 
numcodes_Œd
 = 
numcodes_Œ
 + 
numcodes_d
;

1899 
bôÀn_Œd
 = (*)
	`lodïng_mÆloc
(
numcodes_Œd
 * (*bitlen_lld));

1901 
bôÀn_Œd_e
 = (*)
	`lodïng_mÆloc
(
numcodes_Œd
 * (*bitlen_lld_e));

1902 if(!
bôÀn_Œd
 || !
bôÀn_Œd_e
Ë
	`ERROR_BREAK
(83);

1903 
numcodes_Œd_e
 = 0;

1905 
i
 = 0; i !
numcodes_Œ
; ++iË
bôÀn_Œd
[i] = 
åì_Œ
.
Àngths
[i];

1906 
i
 = 0; i !
numcodes_d
; ++iË
bôÀn_Œd
[
numcodes_Œ
 + i] = 
åì_d
.
Àngths
[i];

1910 
i
 = 0; i !
numcodes_Œd
; ++i) {

1911 
j
 = 0;

1912 
i
 + 
j
 + 1 < 
numcodes_Œd
 && 
bôÀn_Œd
[i + j + 1] == bitlen_lld[i]) ++j;

1914 if(
bôÀn_Œd
[
i
] =0 && 
j
 >= 2) {

1915 ++
j
;

1916 if(
j
 <= 10) {

1917 
bôÀn_Œd_e
[
numcodes_Œd_e
++] = 17;

1918 
bôÀn_Œd_e
[
numcodes_Œd_e
++] = 
j
 - 3;

1920 if(
j
 > 138) j = 138;

1921 
bôÀn_Œd_e
[
numcodes_Œd_e
++] = 18;

1922 
bôÀn_Œd_e
[
numcodes_Œd_e
++] = 
j
 - 11;

1924 
i
 +(
j
 - 1);

1925 } if(
j
 >= 3) {

1926 
size_t
 
k
;

1927 
num
 = 
j
 / 6u, 
ª°
 = j % 6u;

1928 
bôÀn_Œd_e
[
numcodes_Œd_e
++] = 
bôÀn_Œd
[
i
];

1929 
k
 = 0; k < 
num
; ++k) {

1930 
bôÀn_Œd_e
[
numcodes_Œd_e
++] = 16;

1931 
bôÀn_Œd_e
[
numcodes_Œd_e
++] = 6 - 3;

1933 if(
ª°
 >= 3) {

1934 
bôÀn_Œd_e
[
numcodes_Œd_e
++] = 16;

1935 
bôÀn_Œd_e
[
numcodes_Œd_e
++] = 
ª°
 - 3;

1937 
j
 -
ª°
;

1938 
i
 +
j
;

1940 
bôÀn_Œd_e
[
numcodes_Œd_e
++] = 
bôÀn_Œd
[
i
];

1945 
i
 = 0; i !
numcodes_Œd_e
; ++i) {

1946 ++
‰equícõs_˛
[
bôÀn_Œd_e
[
i
]];

1949 if(
bôÀn_Œd_e
[
i
] >= 16) ++i;

1952 
îr‹
 = 
	`Huffm™Tªe_makeFromFªquícõs
(&
åì_˛
, 
‰equícõs_˛
,

1953 
NUM_CODE_LENGTH_CODES
, NUM_CODE_LENGTH_CODES, 7);

1954 if(
îr‹
) ;

1957 
numcodes_˛
 = 
NUM_CODE_LENGTH_CODES
;

1959 
numcodes_˛
 > 4u && 
åì_˛
.
Àngths
[
CLCL_ORDER
[numcodes_cl - 1u]] == 0) {

1960 
numcodes_˛
--;

1978 
	`wrôeBôs
(
wrôî
, 
BFINAL
, 1);

1979 
	`wrôeBôs
(
wrôî
, 0, 1);

1980 
	`wrôeBôs
(
wrôî
, 1, 1);

1985 
HLIT
 = ()(
numcodes_Œ
 - 257);

1986 
HDIST
 = ()(
numcodes_d
 - 1);

1987 
HCLEN
 = ()(
numcodes_˛
 - 4);

1988 
	`wrôeBôs
(
wrôî
, 
HLIT
, 5);

1989 
	`wrôeBôs
(
wrôî
, 
HDIST
, 5);

1990 
	`wrôeBôs
(
wrôî
, 
HCLEN
, 4);

1993 
i
 = 0; i !
numcodes_˛
; ++iË
	`wrôeBôs
(
wrôî
, 
åì_˛
.
Àngths
[
CLCL_ORDER
[i]], 3);

1996 
i
 = 0; i !
numcodes_Œd_e
; ++i) {

1997 
	`wrôeBôsRevî£d
(
wrôî
, 
åì_˛
.
codes
[
bôÀn_Œd_e
[
i
]],Åªe_˛.
Àngths
[bitlen_lld_e[i]]);

1999 if(
bôÀn_Œd_e
[
i
] =16Ë
	`wrôeBôs
(
wrôî
, bitlen_lld_e[++i], 2);

2000 if(
bôÀn_Œd_e
[
i
] =17Ë
	`wrôeBôs
(
wrôî
, bitlen_lld_e[++i], 3);

2001 if(
bôÀn_Œd_e
[
i
] =18Ë
	`wrôeBôs
(
wrôî
, bitlen_lld_e[++i], 7);

2005 
	`wrôeLZ77d©a
(
wrôî
, &
lz77_ícoded
, &
åì_Œ
, &
åì_d
);

2007 if(
åì_Œ
.
Àngths
[256] =0Ë
	`ERROR_BREAK
(64);

2010 
	`wrôeBôsRevî£d
(
wrôî
, 
åì_Œ
.
codes
[256],Åªe_Œ.
Àngths
[256]);

2016 
	`uive˘‹_˛ónup
(&
lz77_ícoded
);

2017 
	`Huffm™Tªe_˛ónup
(&
åì_Œ
);

2018 
	`Huffm™Tªe_˛ónup
(&
åì_d
);

2019 
	`Huffm™Tªe_˛ónup
(&
åì_˛
);

2020 
	`lodïng_‰ì
(
‰equícõs_Œ
);

2021 
	`lodïng_‰ì
(
‰equícõs_d
);

2022 
	`lodïng_‰ì
(
‰equícõs_˛
);

2023 
	`lodïng_‰ì
(
bôÀn_Œd
);

2024 
	`lodïng_‰ì
(
bôÀn_Œd_e
);

2026  
îr‹
;

2027 
	}
}

2029 
	$deÊ©eFixed
(
LodePNGBôWrôî
* 
wrôî
, 
Hash
* 
hash
,

2030 c⁄° * 
d©a
,

2031 
size_t
 
d©≠os
, size_à
d©´nd
,

2032 c⁄° 
LodePNGCom¥essSëtögs
* 
£âögs
, 
föÆ
) {

2033 
Huffm™Tªe
 
åì_Œ
;

2034 
Huffm™Tªe
 
åì_d
;

2036 
BFINAL
 = 
föÆ
;

2037 
îr‹
 = 0;

2038 
size_t
 
i
;

2040 
	`Huffm™Tªe_öô
(&
åì_Œ
);

2041 
	`Huffm™Tªe_öô
(&
åì_d
);

2043 
îr‹
 = 
	`gíî©eFixedLôLíTªe
(&
åì_Œ
);

2044 if(!
îr‹
Ëîr‹ = 
	`gíî©eFixedDi°™˚Tªe
(&
åì_d
);

2046 if(!
îr‹
) {

2047 
	`wrôeBôs
(
wrôî
, 
BFINAL
, 1);

2048 
	`wrôeBôs
(
wrôî
, 1, 1);

2049 
	`wrôeBôs
(
wrôî
, 0, 1);

2051 if(
£âögs
->
u£_lz77
) {

2052 
uive˘‹
 
lz77_ícoded
;

2053 
	`uive˘‹_öô
(&
lz77_ícoded
);

2054 
îr‹
 = 
	`ícodeLZ77
(&
lz77_ícoded
, 
hash
, 
d©a
, 
d©≠os
, 
d©´nd
, 
£âögs
->
wödowsize
,

2055 
£âögs
->
möm©ch
, sëtögs->
ni˚m©ch
, sëtögs->
œzym©chög
);

2056 if(!
îr‹
Ë
	`wrôeLZ77d©a
(
wrôî
, &
lz77_ícoded
, &
åì_Œ
, &
åì_d
);

2057 
	`uive˘‹_˛ónup
(&
lz77_ícoded
);

2059 
i
 = 
d©≠os
; i < 
d©´nd
; ++i) {

2060 
	`wrôeBôsRevî£d
(
wrôî
, 
åì_Œ
.
codes
[
d©a
[
i
]],Åªe_Œ.
Àngths
[data[i]]);

2064 if(!
îr‹
Ë
	`wrôeBôsRevî£d
(
wrôî
,
åì_Œ
.
codes
[256],Åªe_Œ.
Àngths
[256]);

2068 
	`Huffm™Tªe_˛ónup
(&
åì_Œ
);

2069 
	`Huffm™Tªe_˛ónup
(&
åì_d
);

2071  
îr‹
;

2072 
	}
}

2074 
	$lodïng_deÊ©ev
(
ucve˘‹
* 
out
, c⁄° * 
ö
, 
size_t
 
ösize
,

2075 c⁄° 
LodePNGCom¥essSëtögs
* 
£âögs
) {

2076 
îr‹
 = 0;

2077 
size_t
 
i
, 
blocksize
, 
numdeÊ©eblocks
;

2078 
Hash
 
hash
;

2079 
LodePNGBôWrôî
 
wrôî
;

2081 
	`LodePNGBôWrôî_öô
(&
wrôî
, 
out
);

2083 if(
£âögs
->
bty≥
 > 2)  61;

2084 if(
£âögs
->
bty≥
 =0Ë 
	`deÊ©eNoCom¥essi⁄
(
out
, 
ö
, 
ösize
);

2085 if(
£âögs
->
bty≥
 =1Ë
blocksize
 = 
ösize
;

2088 
blocksize
 = 
ösize
 / 8u + 8;

2089 if(
blocksize
 < 65536) blocksize = 65536;

2090 if(
blocksize
 > 262144) blocksize = 262144;

2093 
numdeÊ©eblocks
 = (
ösize
 + 
blocksize
 - 1) / blocksize;

2094 if(
numdeÊ©eblocks
 == 0)Çumdeflateblocks = 1;

2096 
îr‹
 = 
	`hash_öô
(&
hash
, 
£âögs
->
wödowsize
);

2098 if(!
îr‹
) {

2099 
i
 = 0; i !
numdeÊ©eblocks
 && !
îr‹
; ++i) {

2100 
föÆ
 = (
i
 =
numdeÊ©eblocks
 - 1);

2101 
size_t
 
°¨t
 = 
i
 * 
blocksize
;

2102 
size_t
 
íd
 = 
°¨t
 + 
blocksize
;

2103 if(
íd
 > 
ösize
)Énd = insize;

2105 if(
£âögs
->
bty≥
 =1Ë
îr‹
 = 
	`deÊ©eFixed
(&
wrôî
, &
hash
, 
ö
, 
°¨t
, 
íd
, sëtögs, 
föÆ
);

2106 if(
£âögs
->
bty≥
 =2Ë
îr‹
 = 
	`deÊ©eDy«mic
(&
wrôî
, &
hash
, 
ö
, 
°¨t
, 
íd
, sëtögs, 
föÆ
);

2110 
	`hash_˛ónup
(&
hash
);

2112  
îr‹
;

2113 
	}
}

2115 
	$lodïng_deÊ©e
(** 
out
, 
size_t
* 
outsize
,

2116 c⁄° * 
ö
, 
size_t
 
ösize
,

2117 c⁄° 
LodePNGCom¥essSëtögs
* 
£âögs
) {

2118 
ucve˘‹
 
v
 = 
	`ucve˘‹_öô
(*
out
, *
outsize
);

2119 
îr‹
 = 
	`lodïng_deÊ©ev
(&
v
, 
ö
, 
ösize
, 
£âögs
);

2120 *
out
 = 
v
.
d©a
;

2121 *
outsize
 = 
v
.
size
;

2122  
îr‹
;

2123 
	}
}

2125 
	$deÊ©e
(** 
out
, 
size_t
* 
outsize
,

2126 c⁄° * 
ö
, 
size_t
 
ösize
,

2127 c⁄° 
LodePNGCom¥essSëtögs
* 
£âögs
) {

2128 if(
£âögs
->
cu°om_deÊ©e
) {

2129 
îr‹
 = 
£âögs
->
	`cu°om_deÊ©e
(
out
, 
outsize
, 
ö
, 
ösize
, settings);

2131  
îr‹
 ? 111 : 0;

2133  
	`lodïng_deÊ©e
(
out
, 
outsize
, 
ö
, 
ösize
, 
£âögs
);

2135 
	}
}

2143 
	$upd©e_adÀr32
(
adÀr
, c⁄° * 
d©a
, 
Àn
) {

2144 
s1
 = 
adÀr
 & 0xffffu;

2145 
s2
 = (
adÀr
 >> 16u) & 0xffffu;

2147 
Àn
 != 0u) {

2148 
i
;

2150 
amou¡
 = 
Àn
 > 5552u ? 5552u :Üen;

2151 
Àn
 -
amou¡
;

2152 
i
 = 0; i !
amou¡
; ++i) {

2153 
s1
 +(*
d©a
++);

2154 
s2
 +
s1
;

2156 
s1
 %= 65521u;

2157 
s2
 %= 65521u;

2160  (
s2
 << 16uË| 
s1
;

2161 
	}
}

2164 
	$adÀr32
(c⁄° * 
d©a
, 
Àn
) {

2165  
	`upd©e_adÀr32
(1u, 
d©a
, 
Àn
);

2166 
	}
}

2172 #ifde‡
LODEPNG_COMPILE_DECODER


2174 
	$lodïng_zlib_decom¥essv
(
ucve˘‹
* 
out
,

2175 c⁄° * 
ö
, 
size_t
 
ösize
,

2176 c⁄° 
LodePNGDecom¥essSëtögs
* 
£âögs
) {

2177 
îr‹
 = 0;

2178 
CM
, 
CINFO
, 
FDICT
;

2180 if(
ösize
 < 2)  53;

2182 if((
ö
[0] * 256 + in[1]) % 31 != 0) {

2187 
CM
 = 
ö
[0] & 15;

2188 
CINFO
 = (
ö
[0] >> 4) & 15;

2190 
FDICT
 = (
ö
[1] >> 5) & 1;

2193 if(
CM
 !8 || 
CINFO
 > 7) {

2197 if(
FDICT
 != 0) {

2203 
îr‹
 = 
	`öÊ©ev
(
out
, 
ö
 + 2, 
ösize
 - 2, 
£âögs
);

2204 if(
îr‹
) Érror;

2206 if(!
£âögs
->
ign‹e_adÀr32
) {

2207 
ADLER32
 = 
	`lodïng_ªad32bôI¡
(&
ö
[
ösize
 - 4]);

2208 
checksum
 = 
	`adÀr32
(
out
->
d©a
, ()(out->
size
));

2209 if(
checksum
 !
ADLER32
)  58;

2213 
	}
}

2216 
	$lodïng_zlib_decom¥ess
(** 
out
, 
size_t
* 
outsize
, c⁄° * 
ö
,

2217 
size_t
 
ösize
, c⁄° 
LodePNGDecom¥essSëtögs
* 
£âögs
) {

2218 
ucve˘‹
 
v
 = 
	`ucve˘‹_öô
(*
out
, *
outsize
);

2219 
îr‹
 = 
	`lodïng_zlib_decom¥essv
(&
v
, 
ö
, 
ösize
, 
£âögs
);

2220 *
out
 = 
v
.
d©a
;

2221 *
outsize
 = 
v
.
size
;

2222  
îr‹
;

2223 
	}
}

2226 
	$zlib_decom¥ess
(** 
out
, 
size_t
* 
outsize
, size_à
ex≥˘ed_size
,

2227 c⁄° * 
ö
, 
size_t
 
ösize
, c⁄° 
LodePNGDecom¥essSëtögs
* 
£âögs
) {

2228 
îr‹
;

2229 if(
£âögs
->
cu°om_zlib
) {

2230 
îr‹
 = 
£âögs
->
	`cu°om_zlib
(
out
, 
outsize
, 
ö
, 
ösize
, settings);

2231 if(
îr‹
) {

2233 
îr‹
 = 110;

2235 if(
£âögs
->
max_ouçut_size
 && *
outsize
 > sëtögs->max_ouçut_sizeË
îr‹
 = 109;

2238 
ucve˘‹
 
v
 = 
	`ucve˘‹_öô
(*
out
, *
outsize
);

2239 if(
ex≥˘ed_size
) {

2241 
	`ucve˘‹_ªsize
(&
v
, *
outsize
 + 
ex≥˘ed_size
);

2242 
v
.
size
 = *
outsize
;

2244 
îr‹
 = 
	`lodïng_zlib_decom¥essv
(&
v
, 
ö
, 
ösize
, 
£âögs
);

2245 *
out
 = 
v
.
d©a
;

2246 *
outsize
 = 
v
.
size
;

2248  
îr‹
;

2249 
	}
}

2253 #ifde‡
LODEPNG_COMPILE_ENCODER


2255 
	$lodïng_zlib_com¥ess
(** 
out
, 
size_t
* 
outsize
, c⁄° * 
ö
,

2256 
size_t
 
ösize
, c⁄° 
LodePNGCom¥essSëtögs
* 
£âögs
) {

2257 
size_t
 
i
;

2258 
îr‹
;

2259 * 
deÊ©ed©a
 = 0;

2260 
size_t
 
deÊ©esize
 = 0;

2262 
îr‹
 = 
	`deÊ©e
(&
deÊ©ed©a
, &
deÊ©esize
, 
ö
, 
ösize
, 
£âögs
);

2264 *
out
 = 
NULL
;

2265 *
outsize
 = 0;

2266 if(!
îr‹
) {

2267 *
outsize
 = 
deÊ©esize
 + 6;

2268 *
out
 = (*)
	`lodïng_mÆloc
(*
outsize
);

2269 if(!*
out
Ë
îr‹
 = 83;

2272 if(!
îr‹
) {

2273 
ADLER32
 = 
	`adÀr32
(
ö
, ()
ösize
);

2275 
CMF
 = 120;

2276 
FLEVEL
 = 0;

2277 
FDICT
 = 0;

2278 
CMFFLG
 = 256 * 
CMF
 + 
FDICT
 * 32 + 
FLEVEL
 * 64;

2279 
FCHECK
 = 31 - 
CMFFLG
 % 31;

2280 
CMFFLG
 +
FCHECK
;

2282 (*
out
)[0] = ()(
CMFFLG
 >> 8);

2283 (*
out
)[1] = ()(
CMFFLG
 & 255);

2284 
i
 = 0; i !
deÊ©esize
; ++iË(*
out
)[ò+ 2] = 
deÊ©ed©a
[i];

2285 
	`lodïng_£t32bôI¡
(&(*
out
)[*
outsize
 - 4], 
ADLER32
);

2288 
	`lodïng_‰ì
(
deÊ©ed©a
);

2289  
îr‹
;

2290 
	}
}

2293 
	$zlib_com¥ess
(** 
out
, 
size_t
* 
outsize
, c⁄° * 
ö
,

2294 
size_t
 
ösize
, c⁄° 
LodePNGCom¥essSëtögs
* 
£âögs
) {

2295 if(
£âögs
->
cu°om_zlib
) {

2296 
îr‹
 = 
£âögs
->
	`cu°om_zlib
(
out
, 
outsize
, 
ö
, 
ösize
, settings);

2298  
îr‹
 ? 111 : 0;

2300  
	`lodïng_zlib_com¥ess
(
out
, 
outsize
, 
ö
, 
ösize
, 
£âögs
);

2302 
	}
}

2308 #ifde‡
LODEPNG_COMPILE_DECODER


2309 
	$zlib_decom¥ess
(** 
out
, 
size_t
* 
outsize
, size_à
ex≥˘ed_size
,

2310 c⁄° * 
ö
, 
size_t
 
ösize
, c⁄° 
LodePNGDecom¥essSëtögs
* 
£âögs
) {

2311 if(!
£âögs
->
cu°om_zlib
)  87;

2312 ()
ex≥˘ed_size
;

2313  
£âögs
->
	`cu°om_zlib
(
out
, 
outsize
, 
ö
, 
ösize
, settings);

2314 
	}
}

2316 #ifde‡
LODEPNG_COMPILE_ENCODER


2317 
	$zlib_com¥ess
(** 
out
, 
size_t
* 
outsize
, c⁄° * 
ö
,

2318 
size_t
 
ösize
, c⁄° 
LodePNGCom¥essSëtögs
* 
£âögs
) {

2319 if(!
£âögs
->
cu°om_zlib
)  87;

2320  
£âögs
->
	`cu°om_zlib
(
out
, 
outsize
, 
ö
, 
ösize
, settings);

2321 
	}
}

2328 #ifde‡
LODEPNG_COMPILE_ENCODER


2331 
	#DEFAULT_WINDOWSIZE
 2048

	)

2333 
	$lodïng_com¥ess_£âögs_öô
(
LodePNGCom¥essSëtögs
* 
£âögs
) {

2335 
£âögs
->
bty≥
 = 2;

2336 
£âögs
->
u£_lz77
 = 1;

2337 
£âögs
->
wödowsize
 = 
DEFAULT_WINDOWSIZE
;

2338 
£âögs
->
möm©ch
 = 3;

2339 
£âögs
->
ni˚m©ch
 = 128;

2340 
£âögs
->
œzym©chög
 = 1;

2342 
£âögs
->
cu°om_zlib
 = 0;

2343 
£âögs
->
cu°om_deÊ©e
 = 0;

2344 
£âögs
->
cu°om_c⁄ãxt
 = 0;

2345 
	}
}

2347 c⁄° 
LodePNGCom¥essSëtögs
 
	glodïng_deÁu…_com¥ess_£âögs
 = {2, 1, 
DEFAULT_WINDOWSIZE
, 3, 128, 1, 0, 0, 0};

2352 #ifde‡
LODEPNG_COMPILE_DECODER


2354 
	$lodïng_decom¥ess_£âögs_öô
(
LodePNGDecom¥essSëtögs
* 
£âögs
) {

2355 
£âögs
->
ign‹e_adÀr32
 = 0;

2356 
£âögs
->
ign‹e_∆í
 = 0;

2357 
£âögs
->
max_ouçut_size
 = 0;

2359 
£âögs
->
cu°om_zlib
 = 0;

2360 
£âögs
->
cu°om_öÊ©e
 = 0;

2361 
£âögs
->
cu°om_c⁄ãxt
 = 0;

2362 
	}
}

2364 c⁄° 
LodePNGDecom¥essSëtögs
 
	glodïng_deÁu…_decom¥ess_£âögs
 = {0, 0, 0, 0, 0, 0};

2374 #ifde‡
LODEPNG_COMPILE_PNG


2381 #i‚de‡
LODEPNG_NO_COMPILE_CRC


2383 
	glodïng_¸c32_èbÀ
[256] = {

2419 
	$lodïng_¸c32
(c⁄° * 
d©a
, 
size_t
 
Àngth
) {

2420 
r
 = 0xffffffffu;

2421 
size_t
 
i
;

2422 
i
 = 0; i < 
Àngth
; ++i) {

2423 
r
 = 
lodïng_¸c32_èbÀ
[‘ ^ 
d©a
[
i
]) & 0xffu] ^ (r >> 8u);

2425  
r
 ^ 0xffffffffu;

2426 
	}
}

2428 
lodïng_¸c32
(c⁄° * 
d©a
, 
size_t
 
Àngth
);

2438 
	$ªadBôFromRevî£dSåóm
(
size_t
* 
bôpoöãr
, c⁄° * 
bô°ªam
) {

2439 
ªsu…
 = ()((
bô°ªam
[(*
bôpoöãr
) >> 3] >> (7 - ((*bitpointer) & 0x7))) & 1);

2440 ++(*
bôpoöãr
);

2441  
ªsu…
;

2442 
	}
}

2445 
	$ªadBôsFromRevî£dSåóm
(
size_t
* 
bôpoöãr
, c⁄° * 
bô°ªam
, size_à
nbôs
) {

2446 
ªsu…
 = 0;

2447 
size_t
 
i
;

2448 
i
 = 0 ; i < 
nbôs
; ++i) {

2449 
ªsu…
 <<= 1u;

2450 
ªsu…
 |()
	`ªadBôFromRevî£dSåóm
(
bôpoöãr
, 
bô°ªam
);

2452  
ªsu…
;

2453 
	}
}

2455 
	$£tBôOfRevî£dSåóm
(
size_t
* 
bôpoöãr
, * 
bô°ªam
, 
bô
) {

2457 if(
bô
 =0Ë
bô°ªam
[(*
bôpoöãr
) >> 3u] &= ()(~(1u << (7u - ((*bitpointer) & 7u))));

2458 
bô°ªam
[(*
bôpoöãr
) >> 3u] |= (1u << (7u - ((*bitpointer) & 7u)));

2459 ++(*
bôpoöãr
);

2460 
	}
}

2466 
	$lodïng_chunk_Àngth
(c⁄° * 
chunk
) {

2467  
	`lodïng_ªad32bôI¡
(&
chunk
[0]);

2468 
	}
}

2470 
	$lodïng_chunk_ty≥
(
ty≥
[5], c⁄° * 
chunk
) {

2471 
i
;

2472 
i
 = 0; i !4; ++iË
ty≥
[i] = ()
chunk
[4 + i];

2473 
ty≥
[4] = 0;

2474 
	}
}

2476 
	$lodïng_chunk_ty≥_equÆs
(c⁄° * 
chunk
, c⁄° * 
ty≥
) {

2477 if(
	`lodïng_°æí
(
ty≥
) != 4)  0;

2478  (
chunk
[4] =
ty≥
[0] && chunk[5] ==Åype[1] && chunk[6] ==Åype[2] && chunk[7] ==Åype[3]);

2479 
	}
}

2481 
	$lodïng_chunk_™cûœry
(c⁄° * 
chunk
) {

2482 ((
chunk
[4] & 32) != 0);

2483 
	}
}

2485 
	$lodïng_chunk_¥iv©e
(c⁄° * 
chunk
) {

2486 ((
chunk
[6] & 32) != 0);

2487 
	}
}

2489 
	$lodïng_chunk_ß„toc›y
(c⁄° * 
chunk
) {

2490 ((
chunk
[7] & 32) != 0);

2491 
	}
}

2493 * 
	$lodïng_chunk_d©a
(* 
chunk
) {

2494  &
chunk
[8];

2495 
	}
}

2497 c⁄° * 
	$lodïng_chunk_d©a_c⁄°
(c⁄° * 
chunk
) {

2498  &
chunk
[8];

2499 
	}
}

2501 
	$lodïng_chunk_check_¸c
(c⁄° * 
chunk
) {

2502 
Àngth
 = 
	`lodïng_chunk_Àngth
(
chunk
);

2503 
CRC
 = 
	`lodïng_ªad32bôI¡
(&
chunk
[
Àngth
 + 8]);

2505 
checksum
 = 
	`lodïng_¸c32
(&
chunk
[4], 
Àngth
 + 4);

2506 if(
CRC
 !
checksum
)  1;

2508 
	}
}

2510 
	$lodïng_chunk_gíî©e_¸c
(* 
chunk
) {

2511 
Àngth
 = 
	`lodïng_chunk_Àngth
(
chunk
);

2512 
CRC
 = 
	`lodïng_¸c32
(&
chunk
[4], 
Àngth
 + 4);

2513 
	`lodïng_£t32bôI¡
(
chunk
 + 8 + 
Àngth
, 
CRC
);

2514 
	}
}

2516 * 
	$lodïng_chunk_√xt
(* 
chunk
, * 
íd
) {

2517 if(
chunk
 >
íd
 ||Énd - chunk < 12) Énd;

2518 if(
chunk
[0] == 0x89 && chunk[1] == 0x50 && chunk[2] == 0x4e && chunk[3] == 0x47

2519 && 
chunk
[4] == 0x0d && chunk[5] == 0x0a && chunk[6] == 0x1a && chunk[7] == 0x0a) {

2521  
chunk
 + 8;

2523 
size_t
 
tŸÆ_chunk_Àngth
;

2524 * 
ªsu…
;

2525 if(
	`lodïng_addoÊ
(
	`lodïng_chunk_Àngth
(
chunk
), 12, &
tŸÆ_chunk_Àngth
)Ë 
íd
;

2526 
ªsu…
 = 
chunk
 + 
tŸÆ_chunk_Àngth
;

2527 if(
ªsu…
 < 
chunk
Ë 
íd
;

2528  
ªsu…
;

2530 
	}
}

2532 c⁄° * 
	$lodïng_chunk_√xt_c⁄°
(c⁄° * 
chunk
, c⁄° * 
íd
) {

2533 if(
chunk
 >
íd
 ||Énd - chunk < 12) Énd;

2534 if(
chunk
[0] == 0x89 && chunk[1] == 0x50 && chunk[2] == 0x4e && chunk[3] == 0x47

2535 && 
chunk
[4] == 0x0d && chunk[5] == 0x0a && chunk[6] == 0x1a && chunk[7] == 0x0a) {

2537  
chunk
 + 8;

2539 
size_t
 
tŸÆ_chunk_Àngth
;

2540 c⁄° * 
ªsu…
;

2541 if(
	`lodïng_addoÊ
(
	`lodïng_chunk_Àngth
(
chunk
), 12, &
tŸÆ_chunk_Àngth
)Ë 
íd
;

2542 
ªsu…
 = 
chunk
 + 
tŸÆ_chunk_Àngth
;

2543 if(
ªsu…
 < 
chunk
Ë 
íd
;

2544  
ªsu…
;

2546 
	}
}

2548 * 
	$lodïng_chunk_föd
(* 
chunk
, * 
íd
, c⁄° 
ty≥
[5]) {

2550 if(
chunk
 >
íd
 ||Énd - chunk < 12)  0;

2551 if(
	`lodïng_chunk_ty≥_equÆs
(
chunk
, 
ty≥
))  chunk;

2552 
chunk
 = 
	`lodïng_chunk_√xt
(chunk, 
íd
);

2554 
	}
}

2556 c⁄° * 
	$lodïng_chunk_föd_c⁄°
(c⁄° * 
chunk
, c⁄° * 
íd
, c⁄° 
ty≥
[5]) {

2558 if(
chunk
 >
íd
 ||Énd - chunk < 12)  0;

2559 if(
	`lodïng_chunk_ty≥_equÆs
(
chunk
, 
ty≥
))  chunk;

2560 
chunk
 = 
	`lodïng_chunk_√xt_c⁄°
(chunk, 
íd
);

2562 
	}
}

2564 
	$lodïng_chunk_≠≥nd
(** 
out
, 
size_t
* 
outsize
, c⁄° * 
chunk
) {

2565 
i
;

2566 
size_t
 
tŸÆ_chunk_Àngth
, 
√w_Àngth
;

2567 *
chunk_°¨t
, *
√w_buf„r
;

2569 if(
	`lodïng_addoÊ
(
	`lodïng_chunk_Àngth
(
chunk
), 12, &
tŸÆ_chunk_Àngth
))  77;

2570 if(
	`lodïng_addoÊ
(*
outsize
, 
tŸÆ_chunk_Àngth
, &
√w_Àngth
))  77;

2572 
√w_buf„r
 = (*)
	`lodïng_ªÆloc
(*
out
, 
√w_Àngth
);

2573 if(!
√w_buf„r
)  83;

2574 (*
out
Ë
√w_buf„r
;

2575 (*
outsize
Ë
√w_Àngth
;

2576 
chunk_°¨t
 = &(*
out
)[
√w_Àngth
 - 
tŸÆ_chunk_Àngth
];

2578 
i
 = 0; i !
tŸÆ_chunk_Àngth
; ++iË
chunk_°¨t
[i] = 
chunk
[i];

2581 
	}
}

2587 
	$lodïng_chunk_öô
(** 
chunk
,

2588 
ucve˘‹
* 
out
,

2589 
Àngth
, c⁄° * 
ty≥
) {

2590 
size_t
 
√w_Àngth
 = 
out
->
size
;

2591 if(
	`lodïng_addoÊ
(
√w_Àngth
, 
Àngth
, &new_length))  77;

2592 if(
	`lodïng_addoÊ
(
√w_Àngth
, 12, &new_length))  77;

2593 if(!
	`ucve˘‹_ªsize
(
out
, 
√w_Àngth
))  83;

2594 *
chunk
 = 
out
->
d©a
 + 
√w_Àngth
 - 
Àngth
 - 12u;

2597 
	`lodïng_£t32bôI¡
(*
chunk
, 
Àngth
);

2600 
	`lodïng_mem˝y
(*
chunk
 + 4, 
ty≥
, 4);

2603 
	}
}

2606 
	$lodïng_chunk_¸óãv
(
ucve˘‹
* 
out
,

2607 
Àngth
, c⁄° * 
ty≥
, c⁄° * 
d©a
) {

2608 * 
chunk
;

2609 
	`CERROR_TRY_RETURN
(
	`lodïng_chunk_öô
(&
chunk
, 
out
, 
Àngth
, 
ty≥
));

2612 
	`lodïng_mem˝y
(
chunk
 + 8, 
d©a
, 
Àngth
);

2615 
	`lodïng_chunk_gíî©e_¸c
(
chunk
);

2618 
	}
}

2620 
	$lodïng_chunk_¸óã
(** 
out
, 
size_t
* 
outsize
,

2621 
Àngth
, c⁄° * 
ty≥
, c⁄° * 
d©a
) {

2622 
ucve˘‹
 
v
 = 
	`ucve˘‹_öô
(*
out
, *
outsize
);

2623 
îr‹
 = 
	`lodïng_chunk_¸óãv
(&
v
, 
Àngth
, 
ty≥
, 
d©a
);

2624 *
out
 = 
v
.
d©a
;

2625 *
outsize
 = 
v
.
size
;

2626  
îr‹
;

2627 
	}
}

2635 
	$checkCﬁ‹VÆidôy
(
LodePNGCﬁ‹Ty≥
 
cﬁ‹ty≥
, 
bd
) {

2636 
cﬁ‹ty≥
) {

2637 
LCT_GREY
: if(!(
bd
 == 1 || bd == 2 || bd == 4 || bd == 8 || bd == 16))  37; ;

2638 
LCT_RGB
: if(!–
bd
 == 8 || bd == 16))  37; ;

2639 
LCT_PALETTE
: if(!(
bd
 == 1 || bd == 2 || bd == 4 || bd == 8 ))  37; ;

2640 
LCT_GREY_ALPHA
: if(!–
bd
 == 8 || bd == 16))  37; ;

2641 
LCT_RGBA
: if(!–
bd
 == 8 || bd == 16))  37; ;

2642 
LCT_MAX_OCTET_VALUE
:  31;

2646 
	}
}

2648 
	$gëNumCﬁ‹Ch™√ls
(
LodePNGCﬁ‹Ty≥
 
cﬁ‹ty≥
) {

2649 
cﬁ‹ty≥
) {

2650 
LCT_GREY
:  1;

2651 
LCT_RGB
:  3;

2652 
LCT_PALETTE
:  1;

2653 
LCT_GREY_ALPHA
:  2;

2654 
LCT_RGBA
:  4;

2655 
LCT_MAX_OCTET_VALUE
:  0;

2658 
	}
}

2660 
	$lodïng_gë_bµ_l˘
(
LodePNGCﬁ‹Ty≥
 
cﬁ‹ty≥
, 
bôdïth
) {

2662  
	`gëNumCﬁ‹Ch™√ls
(
cﬁ‹ty≥
Ë* 
bôdïth
;

2663 
	}
}

2667 
	$lodïng_cﬁ‹_mode_öô
(
LodePNGCﬁ‹Mode
* 
öfo
) {

2668 
öfo
->
key_deföed
 = 0;

2669 
öfo
->
key_r
 = info->
key_g
 = info->
key_b
 = 0;

2670 
öfo
->
cﬁ‹ty≥
 = 
LCT_RGBA
;

2671 
öfo
->
bôdïth
 = 8;

2672 
öfo
->
∑Àâe
 = 0;

2673 
öfo
->
∑Àâesize
 = 0;

2674 
	}
}

2677 
	$lodïng_cﬁ‹_mode_Æloc_∑Àâe
(
LodePNGCﬁ‹Mode
* 
öfo
) {

2678 
size_t
 
i
;

2681 if(!
öfo
->
∑Àâe
Ëöfo->∑Àâê(*)
	`lodïng_mÆloc
(1024);

2682 if(!
öfo
->
∑Àâe
) ;

2683 
i
 = 0; i != 256; ++i) {

2687 
öfo
->
∑Àâe
[
i
 * 4 + 0] = 0;

2688 
öfo
->
∑Àâe
[
i
 * 4 + 1] = 0;

2689 
öfo
->
∑Àâe
[
i
 * 4 + 2] = 0;

2690 
öfo
->
∑Àâe
[
i
 * 4 + 3] = 255;

2692 
	}
}

2694 
	$lodïng_cﬁ‹_mode_˛ónup
(
LodePNGCﬁ‹Mode
* 
öfo
) {

2695 
	`lodïng_∑Àâe_˛ór
(
öfo
);

2696 
	}
}

2698 
	$lodïng_cﬁ‹_mode_c›y
(
LodePNGCﬁ‹Mode
* 
de°
, c⁄° LodePNGCﬁ‹Mode* 
sour˚
) {

2699 
	`lodïng_cﬁ‹_mode_˛ónup
(
de°
);

2700 
	`lodïng_mem˝y
(
de°
, 
sour˚
, (
LodePNGCﬁ‹Mode
));

2701 if(
sour˚
->
∑Àâe
) {

2702 
de°
->
∑Àâe
 = (*)
	`lodïng_mÆloc
(1024);

2703 if(!
de°
->
∑Àâe
 && 
sour˚
->
∑Àâesize
)  83;

2704 
	`lodïng_mem˝y
(
de°
->
∑Àâe
, 
sour˚
->∑Àâe, sour˚->
∑Àâesize
 * 4);

2707 
	}
}

2709 
LodePNGCﬁ‹Mode
 
	$lodïng_cﬁ‹_mode_make
(
LodePNGCﬁ‹Ty≥
 
cﬁ‹ty≥
, 
bôdïth
) {

2710 
LodePNGCﬁ‹Mode
 
ªsu…
;

2711 
	`lodïng_cﬁ‹_mode_öô
(&
ªsu…
);

2712 
ªsu…
.
cﬁ‹ty≥
 = colortype;

2713 
ªsu…
.
bôdïth
 = bitdepth;

2714  
ªsu…
;

2715 
	}
}

2717 
	$lodïng_cﬁ‹_mode_equÆ
(c⁄° 
LodePNGCﬁ‹Mode
* 
a
, c⁄° LodePNGCﬁ‹Mode* 
b
) {

2718 
size_t
 
i
;

2719 if(
a
->
cﬁ‹ty≥
 !
b
->colortype)  0;

2720 if(
a
->
bôdïth
 !
b
->bitdepth)  0;

2721 if(
a
->
key_deföed
 !
b
->key_defined)  0;

2722 if(
a
->
key_deföed
) {

2723 if(
a
->
key_r
 !
b
->key_r)  0;

2724 if(
a
->
key_g
 !
b
->key_g)  0;

2725 if(
a
->
key_b
 !
b
->key_b)  0;

2727 if(
a
->
∑Àâesize
 !
b
->palettesize)  0;

2728 
i
 = 0; i !
a
->
∑Àâesize
 * 4; ++i) {

2729 if(
a
->
∑Àâe
[
i
] !
b
->palette[i])  0;

2732 
	}
}

2734 
	$lodïng_∑Àâe_˛ór
(
LodePNGCﬁ‹Mode
* 
öfo
) {

2735 if(
öfo
->
∑Àâe
Ë
	`lodïng_‰ì
(info->palette);

2736 
öfo
->
∑Àâe
 = 0;

2737 
öfo
->
∑Àâesize
 = 0;

2738 
	}
}

2740 
	$lodïng_∑Àâe_add
(
LodePNGCﬁ‹Mode
* 
öfo
,

2741 
r
, 
g
, 
b
, 
a
) {

2742 if(!
öfo
->
∑Àâe
) {

2743 
	`lodïng_cﬁ‹_mode_Æloc_∑Àâe
(
öfo
);

2744 if(!
öfo
->
∑Àâe
)  83;

2746 if(
öfo
->
∑Àâesize
 >= 256) {

2749 
öfo
->
∑Àâe
[4 * info->
∑Àâesize
 + 0] = 
r
;

2750 
öfo
->
∑Àâe
[4 * info->
∑Àâesize
 + 1] = 
g
;

2751 
öfo
->
∑Àâe
[4 * info->
∑Àâesize
 + 2] = 
b
;

2752 
öfo
->
∑Àâe
[4 * info->
∑Àâesize
 + 3] = 
a
;

2753 ++
öfo
->
∑Àâesize
;

2755 
	}
}

2758 
	$lodïng_gë_bµ
(c⁄° 
LodePNGCﬁ‹Mode
* 
öfo
) {

2759  
	`lodïng_gë_bµ_l˘
(
öfo
->
cﬁ‹ty≥
, info->
bôdïth
);

2760 
	}
}

2762 
	$lodïng_gë_ch™√ls
(c⁄° 
LodePNGCﬁ‹Mode
* 
öfo
) {

2763  
	`gëNumCﬁ‹Ch™√ls
(
öfo
->
cﬁ‹ty≥
);

2764 
	}
}

2766 
	$lodïng_is_gªysˇÀ_ty≥
(c⁄° 
LodePNGCﬁ‹Mode
* 
öfo
) {

2767  
öfo
->
cﬁ‹ty≥
 =
LCT_GREY
 || info->cﬁ‹ty≥ =
LCT_GREY_ALPHA
;

2768 
	}
}

2770 
	$lodïng_is_Æpha_ty≥
(c⁄° 
LodePNGCﬁ‹Mode
* 
öfo
) {

2771  (
öfo
->
cﬁ‹ty≥
 & 4) != 0;

2772 
	}
}

2774 
	$lodïng_is_∑Àâe_ty≥
(c⁄° 
LodePNGCﬁ‹Mode
* 
öfo
) {

2775  
öfo
->
cﬁ‹ty≥
 =
LCT_PALETTE
;

2776 
	}
}

2778 
	$lodïng_has_∑Àâe_Æpha
(c⁄° 
LodePNGCﬁ‹Mode
* 
öfo
) {

2779 
size_t
 
i
;

2780 
i
 = 0; i !
öfo
->
∑Àâesize
; ++i) {

2781 if(
öfo
->
∑Àâe
[
i
 * 4 + 3] < 255)  1;

2784 
	}
}

2786 
	$lodïng_ˇn_have_Æpha
(c⁄° 
LodePNGCﬁ‹Mode
* 
öfo
) {

2787  
öfo
->
key_deföed


2788 || 
	`lodïng_is_Æpha_ty≥
(
öfo
)

2789 || 
	`lodïng_has_∑Àâe_Æpha
(
öfo
);

2790 
	}
}

2792 
size_t
 
	$lodïng_gë_øw_size_l˘
(
w
, 
h
, 
LodePNGCﬁ‹Ty≥
 
cﬁ‹ty≥
, 
bôdïth
) {

2793 
size_t
 
bµ
 = 
	`lodïng_gë_bµ_l˘
(
cﬁ‹ty≥
, 
bôdïth
);

2794 
size_t
 
n
 = (size_t)
w
 * (size_t)
h
;

2795  ((
n
 / 8uË* 
bµ
) + ((n & 7u) * bpp + 7u) / 8u;

2796 
	}
}

2798 
size_t
 
	$lodïng_gë_øw_size
(
w
, 
h
, c⁄° 
LodePNGCﬁ‹Mode
* 
cﬁ‹
) {

2799  
	`lodïng_gë_øw_size_l˘
(
w
, 
h
, 
cﬁ‹
->
cﬁ‹ty≥
, cﬁ‹->
bôdïth
);

2800 
	}
}

2803 #ifde‡
LODEPNG_COMPILE_PNG


2808 
size_t
 
	$lodïng_gë_øw_size_id©
(
w
, 
h
, 
bµ
) {

2811 
size_t
 
löe
 = ((size_t)(
w
 / 8uË* 
bµ
) + 1u + ((w & 7u) * bpp + 7u) / 8u;

2812  (
size_t
)
h
 * 
löe
;

2813 
	}
}

2815 #ifde‡
LODEPNG_COMPILE_DECODER


2824 
	$lodïng_pixñ_ovîÊow
(
w
, 
h
,

2825 c⁄° 
LodePNGCﬁ‹Mode
* 
≤gcﬁ‹
, c⁄° LodePNGCﬁ‹Mode* 
øwcﬁ‹
) {

2826 
size_t
 
bµ
 = 
	`LODEPNG_MAX
(
	`lodïng_gë_bµ
(
≤gcﬁ‹
),Üodïng_gë_bµ(
øwcﬁ‹
));

2827 
size_t
 
numpixñs
, 
tŸÆ
;

2828 
size_t
 
löe
;

2830 if(
	`lodïng_muloÊ
((
size_t
)
w
, (size_t)
h
, &
numpixñs
))  1;

2831 if(
	`lodïng_muloÊ
(
numpixñs
, 8, &
tŸÆ
))  1;

2834 if(
	`lodïng_muloÊ
((
size_t
)(
w
 / 8u), 
bµ
, &
löe
))  1;

2835 if(
	`lodïng_addoÊ
(
löe
, ((
w
 & 7uË* 
bµ
 + 7u) / 8u, &line))  1;

2837 if(
	`lodïng_addoÊ
(
löe
, 5, &line))  1;

2838 if(
	`lodïng_muloÊ
(
löe
, 
h
, &
tŸÆ
))  1;

2841 
	}
}

2845 #ifde‡
LODEPNG_COMPILE_ANCILLARY_CHUNKS


2847 
	$LodePNGUnknownChunks_öô
(
LodePNGInfo
* 
öfo
) {

2848 
i
;

2849 
i
 = 0; i !3; ++iË
öfo
->
unknown_chunks_d©a
[i] = 0;

2850 
i
 = 0; i !3; ++iË
öfo
->
unknown_chunks_size
[i] = 0;

2851 
	}
}

2853 
	$LodePNGUnknownChunks_˛ónup
(
LodePNGInfo
* 
öfo
) {

2854 
i
;

2855 
i
 = 0; i !3; ++iË
	`lodïng_‰ì
(
öfo
->
unknown_chunks_d©a
[i]);

2856 
	}
}

2858 
	$LodePNGUnknownChunks_c›y
(
LodePNGInfo
* 
de°
, c⁄° LodePNGInfo* 
§c
) {

2859 
i
;

2861 
	`LodePNGUnknownChunks_˛ónup
(
de°
);

2863 
i
 = 0; i != 3; ++i) {

2864 
size_t
 
j
;

2865 
de°
->
unknown_chunks_size
[
i
] = 
§c
->unknown_chunks_size[i];

2866 
de°
->
unknown_chunks_d©a
[
i
] = (*)
	`lodïng_mÆloc
(
§c
->
unknown_chunks_size
[i]);

2867 if(!
de°
->
unknown_chunks_d©a
[
i
] && de°->
unknown_chunks_size
[i])  83;

2868 
j
 = 0; j < 
§c
->
unknown_chunks_size
[
i
]; ++j) {

2869 
de°
->
unknown_chunks_d©a
[
i
][
j
] = 
§c
->unknown_chunks_data[i][j];

2874 
	}
}

2878 
	$LodePNGText_öô
(
LodePNGInfo
* 
öfo
) {

2879 
öfo
->
ãxt_num
 = 0;

2880 
öfo
->
ãxt_keys
 = 
NULL
;

2881 
öfo
->
ãxt_°rögs
 = 
NULL
;

2882 
	}
}

2884 
	$LodePNGText_˛ónup
(
LodePNGInfo
* 
öfo
) {

2885 
size_t
 
i
;

2886 
i
 = 0; i !
öfo
->
ãxt_num
; ++i) {

2887 
	`°rög_˛ónup
(&
öfo
->
ãxt_keys
[
i
]);

2888 
	`°rög_˛ónup
(&
öfo
->
ãxt_°rögs
[
i
]);

2890 
	`lodïng_‰ì
(
öfo
->
ãxt_keys
);

2891 
	`lodïng_‰ì
(
öfo
->
ãxt_°rögs
);

2892 
	}
}

2894 
	$LodePNGText_c›y
(
LodePNGInfo
* 
de°
, c⁄° LodePNGInfo* 
sour˚
) {

2895 
size_t
 
i
 = 0;

2896 
de°
->
ãxt_keys
 = 
NULL
;

2897 
de°
->
ãxt_°rögs
 = 
NULL
;

2898 
de°
->
ãxt_num
 = 0;

2899 
i
 = 0; i !
sour˚
->
ãxt_num
; ++i) {

2900 
	`CERROR_TRY_RETURN
(
	`lodïng_add_ãxt
(
de°
, 
sour˚
->
ãxt_keys
[
i
], sour˚->
ãxt_°rögs
[i]));

2903 
	}
}

2905 
	$lodïng_add_ãxt_sized
(
LodePNGInfo
* 
öfo
, c⁄° * 
key
, c⁄° * 
°r
, 
size_t
 
size
) {

2906 ** 
√w_keys
 = (**)(
	`lodïng_ªÆloc
(
öfo
->
ãxt_keys
, (*Ë* (öfo->
ãxt_num
 + 1)));

2907 ** 
√w_°rögs
 = (**)(
	`lodïng_ªÆloc
(
öfo
->
ãxt_°rögs
, (*Ë* (öfo->
ãxt_num
 + 1)));

2909 if(
√w_keys
Ë
öfo
->
ãxt_keys
 =Çew_keys;

2910 if(
√w_°rögs
Ë
öfo
->
ãxt_°rögs
 =Çew_strings;

2912 if(!
√w_keys
 || !
√w_°rögs
)  83;

2914 ++
öfo
->
ãxt_num
;

2915 
öfo
->
ãxt_keys
[öfo->
ãxt_num
 - 1] = 
	`Æloc_°rög
(
key
);

2916 
öfo
->
ãxt_°rögs
[öfo->
ãxt_num
 - 1] = 
	`Æloc_°rög_sized
(
°r
, 
size
);

2917 if(!
öfo
->
ãxt_keys
[öfo->
ãxt_num
 - 1] || !öfo->
ãxt_°rögs
[info->text_num - 1])  83;

2920 
	}
}

2922 
	$lodïng_add_ãxt
(
LodePNGInfo
* 
öfo
, c⁄° * 
key
, c⁄° * 
°r
) {

2923  
	`lodïng_add_ãxt_sized
(
öfo
, 
key
, 
°r
, 
	`lodïng_°æí
(str));

2924 
	}
}

2926 
	$lodïng_˛ór_ãxt
(
LodePNGInfo
* 
öfo
) {

2927 
	`LodePNGText_˛ónup
(
öfo
);

2928 
	}
}

2932 
	$LodePNGIText_öô
(
LodePNGInfo
* 
öfo
) {

2933 
öfo
->
ôext_num
 = 0;

2934 
öfo
->
ôext_keys
 = 
NULL
;

2935 
öfo
->
ôext_œngègs
 = 
NULL
;

2936 
öfo
->
ôext_å™skeys
 = 
NULL
;

2937 
öfo
->
ôext_°rögs
 = 
NULL
;

2938 
	}
}

2940 
	$LodePNGIText_˛ónup
(
LodePNGInfo
* 
öfo
) {

2941 
size_t
 
i
;

2942 
i
 = 0; i !
öfo
->
ôext_num
; ++i) {

2943 
	`°rög_˛ónup
(&
öfo
->
ôext_keys
[
i
]);

2944 
	`°rög_˛ónup
(&
öfo
->
ôext_œngègs
[
i
]);

2945 
	`°rög_˛ónup
(&
öfo
->
ôext_å™skeys
[
i
]);

2946 
	`°rög_˛ónup
(&
öfo
->
ôext_°rögs
[
i
]);

2948 
	`lodïng_‰ì
(
öfo
->
ôext_keys
);

2949 
	`lodïng_‰ì
(
öfo
->
ôext_œngègs
);

2950 
	`lodïng_‰ì
(
öfo
->
ôext_å™skeys
);

2951 
	`lodïng_‰ì
(
öfo
->
ôext_°rögs
);

2952 
	}
}

2954 
	$LodePNGIText_c›y
(
LodePNGInfo
* 
de°
, c⁄° LodePNGInfo* 
sour˚
) {

2955 
size_t
 
i
 = 0;

2956 
de°
->
ôext_keys
 = 
NULL
;

2957 
de°
->
ôext_œngègs
 = 
NULL
;

2958 
de°
->
ôext_å™skeys
 = 
NULL
;

2959 
de°
->
ôext_°rögs
 = 
NULL
;

2960 
de°
->
ôext_num
 = 0;

2961 
i
 = 0; i !
sour˚
->
ôext_num
; ++i) {

2962 
	`CERROR_TRY_RETURN
(
	`lodïng_add_ôext
(
de°
, 
sour˚
->
ôext_keys
[
i
], sour˚->
ôext_œngègs
[i],

2963 
sour˚
->
ôext_å™skeys
[
i
], sour˚->
ôext_°rögs
[i]));

2966 
	}
}

2968 
	$lodïng_˛ór_ôext
(
LodePNGInfo
* 
öfo
) {

2969 
	`LodePNGIText_˛ónup
(
öfo
);

2970 
	}
}

2972 
	$lodïng_add_ôext_sized
(
LodePNGInfo
* 
öfo
, c⁄° * 
key
, c⁄° * 
œngèg
,

2973 c⁄° * 
å™skey
, c⁄° * 
°r
, 
size_t
 
size
) {

2974 ** 
√w_keys
 = (**)(
	`lodïng_ªÆloc
(
öfo
->
ôext_keys
, (*Ë* (öfo->
ôext_num
 + 1)));

2975 ** 
√w_œngègs
 = (**)(
	`lodïng_ªÆloc
(
öfo
->
ôext_œngègs
, (*Ë* (öfo->
ôext_num
 + 1)));

2976 ** 
√w_å™skeys
 = (**)(
	`lodïng_ªÆloc
(
öfo
->
ôext_å™skeys
, (*Ë* (öfo->
ôext_num
 + 1)));

2977 ** 
√w_°rögs
 = (**)(
	`lodïng_ªÆloc
(
öfo
->
ôext_°rögs
, (*Ë* (öfo->
ôext_num
 + 1)));

2979 if(
√w_keys
Ë
öfo
->
ôext_keys
 =Çew_keys;

2980 if(
√w_œngègs
Ë
öfo
->
ôext_œngègs
 =Çew_langtags;

2981 if(
√w_å™skeys
Ë
öfo
->
ôext_å™skeys
 =Çew_transkeys;

2982 if(
√w_°rögs
Ë
öfo
->
ôext_°rögs
 =Çew_strings;

2984 if(!
√w_keys
 || !
√w_œngègs
 || !
√w_å™skeys
 || !
√w_°rögs
)  83;

2986 ++
öfo
->
ôext_num
;

2988 
öfo
->
ôext_keys
[öfo->
ôext_num
 - 1] = 
	`Æloc_°rög
(
key
);

2989 
öfo
->
ôext_œngègs
[öfo->
ôext_num
 - 1] = 
	`Æloc_°rög
(
œngèg
);

2990 
öfo
->
ôext_å™skeys
[öfo->
ôext_num
 - 1] = 
	`Æloc_°rög
(
å™skey
);

2991 
öfo
->
ôext_°rögs
[öfo->
ôext_num
 - 1] = 
	`Æloc_°rög_sized
(
°r
, 
size
);

2994 
	}
}

2996 
	$lodïng_add_ôext
(
LodePNGInfo
* 
öfo
, c⁄° * 
key
, c⁄° * 
œngèg
,

2997 c⁄° * 
å™skey
, c⁄° * 
°r
) {

2998  
	`lodïng_add_ôext_sized
(
öfo
, 
key
, 
œngèg
, 
å™skey
, 
°r
, 
	`lodïng_°æí
(str));

2999 
	}
}

3002 
	$lodïng_assign_icc
(
LodePNGInfo
* 
öfo
, c⁄° * 
«me
, c⁄° * 
¥ofûe
, 
¥ofûe_size
) {

3003 if(
¥ofûe_size
 == 0)  100;

3005 
öfo
->
ic˝_«me
 = 
	`Æloc_°rög
(
«me
);

3006 
öfo
->
ic˝_¥ofûe
 = (*)
	`lodïng_mÆloc
(
¥ofûe_size
);

3008 if(!
öfo
->
ic˝_«me
 || !öfo->
ic˝_¥ofûe
)  83;

3010 
	`lodïng_mem˝y
(
öfo
->
ic˝_¥ofûe
, 
¥ofûe
, 
¥ofûe_size
);

3011 
öfo
->
ic˝_¥ofûe_size
 = 
¥ofûe_size
;

3014 
	}
}

3016 
	$lodïng_£t_icc
(
LodePNGInfo
* 
öfo
, c⁄° * 
«me
, c⁄° * 
¥ofûe
, 
¥ofûe_size
) {

3017 if(
öfo
->
ic˝_«me
Ë
	`lodïng_˛ór_icc
(info);

3018 
öfo
->
ic˝_deföed
 = 1;

3020  
	`lodïng_assign_icc
(
öfo
, 
«me
, 
¥ofûe
, 
¥ofûe_size
);

3021 
	}
}

3023 
	$lodïng_˛ór_icc
(
LodePNGInfo
* 
öfo
) {

3024 
	`°rög_˛ónup
(&
öfo
->
ic˝_«me
);

3025 
	`lodïng_‰ì
(
öfo
->
ic˝_¥ofûe
);

3026 
öfo
->
ic˝_¥ofûe
 = 
NULL
;

3027 
öfo
->
ic˝_¥ofûe_size
 = 0;

3028 
öfo
->
ic˝_deföed
 = 0;

3029 
	}
}

3032 
	$lodïng_öfo_öô
(
LodePNGInfo
* 
öfo
) {

3033 
	`lodïng_cﬁ‹_mode_öô
(&
öfo
->
cﬁ‹
);

3034 
öfo
->
öãæa˚_mëhod
 = 0;

3035 
öfo
->
com¥essi⁄_mëhod
 = 0;

3036 
öfo
->
fûãr_mëhod
 = 0;

3037 #ifde‡
LODEPNG_COMPILE_ANCILLARY_CHUNKS


3038 
öfo
->
background_deföed
 = 0;

3039 
öfo
->
background_r
 = info->
background_g
 = info->
background_b
 = 0;

3041 
	`LodePNGText_öô
(
öfo
);

3042 
	`LodePNGIText_öô
(
öfo
);

3044 
öfo
->
time_deföed
 = 0;

3045 
öfo
->
phys_deföed
 = 0;

3047 
öfo
->
gama_deföed
 = 0;

3048 
öfo
->
chrm_deföed
 = 0;

3049 
öfo
->
§gb_deföed
 = 0;

3050 
öfo
->
ic˝_deföed
 = 0;

3051 
öfo
->
ic˝_«me
 = 
NULL
;

3052 
öfo
->
ic˝_¥ofûe
 = 
NULL
;

3054 
	`LodePNGUnknownChunks_öô
(
öfo
);

3056 
	}
}

3058 
	$lodïng_öfo_˛ónup
(
LodePNGInfo
* 
öfo
) {

3059 
	`lodïng_cﬁ‹_mode_˛ónup
(&
öfo
->
cﬁ‹
);

3060 #ifde‡
LODEPNG_COMPILE_ANCILLARY_CHUNKS


3061 
	`LodePNGText_˛ónup
(
öfo
);

3062 
	`LodePNGIText_˛ónup
(
öfo
);

3064 
	`lodïng_˛ór_icc
(
öfo
);

3066 
	`LodePNGUnknownChunks_˛ónup
(
öfo
);

3068 
	}
}

3070 
	$lodïng_öfo_c›y
(
LodePNGInfo
* 
de°
, c⁄° LodePNGInfo* 
sour˚
) {

3071 
	`lodïng_öfo_˛ónup
(
de°
);

3072 
	`lodïng_mem˝y
(
de°
, 
sour˚
, (
LodePNGInfo
));

3073 
	`lodïng_cﬁ‹_mode_öô
(&
de°
->
cﬁ‹
);

3074 
	`CERROR_TRY_RETURN
(
	`lodïng_cﬁ‹_mode_c›y
(&
de°
->
cﬁ‹
, &
sour˚
->color));

3076 #ifde‡
LODEPNG_COMPILE_ANCILLARY_CHUNKS


3077 
	`CERROR_TRY_RETURN
(
	`LodePNGText_c›y
(
de°
, 
sour˚
));

3078 
	`CERROR_TRY_RETURN
(
	`LodePNGIText_c›y
(
de°
, 
sour˚
));

3079 if(
sour˚
->
ic˝_deföed
) {

3080 
	`CERROR_TRY_RETURN
(
	`lodïng_assign_icc
(
de°
, 
sour˚
->
ic˝_«me
, sour˚->
ic˝_¥ofûe
, sour˚->
ic˝_¥ofûe_size
));

3083 
	`LodePNGUnknownChunks_öô
(
de°
);

3084 
	`CERROR_TRY_RETURN
(
	`LodePNGUnknownChunks_c›y
(
de°
, 
sour˚
));

3087 
	}
}

3092 
	$addCﬁ‹Bôs
(* 
out
, 
size_t
 
ödex
, 
bôs
, 
ö
) {

3093 
m
 = 
bôs
 == 1 ? 7 : bits == 2 ? 3 : 1;

3095 
p
 = 
ödex
 & 
m
;

3096 
ö
 &(1u << 
bôs
) - 1u;

3097 
ö
 = i¿<< (
bôs
 * (
m
 - 
p
));

3098 if(
p
 =0Ë
out
[
ödex
 * 
bôs
 / 8u] = 
ö
;

3099 
out
[
ödex
 * 
bôs
 / 8u] |
ö
;

3100 
	}
}

3102 
Cﬁ‹Tªe
 
	tCﬁ‹Tªe
;

3110 
	sCﬁ‹Tªe
 {

3111 
Cﬁ‹Tªe
* 
	mchûdªn
[16];

3112 
	mödex
;

3115 
	$cﬁ‹_åì_öô
(
Cﬁ‹Tªe
* 
åì
) {

3116 
	`lodïng_mem£t
(
åì
->
chûdªn
, 0, 16 * (*tree->children));

3117 
åì
->
ödex
 = -1;

3118 
	}
}

3120 
	$cﬁ‹_åì_˛ónup
(
Cﬁ‹Tªe
* 
åì
) {

3121 
i
;

3122 
i
 = 0; i != 16; ++i) {

3123 if(
åì
->
chûdªn
[
i
]) {

3124 
	`cﬁ‹_åì_˛ónup
(
åì
->
chûdªn
[
i
]);

3125 
	`lodïng_‰ì
(
åì
->
chûdªn
[
i
]);

3128 
	}
}

3131 
	$cﬁ‹_åì_gë
(
Cﬁ‹Tªe
* 
åì
, 
r
, 
g
, 
b
, 
a
) {

3132 
bô
 = 0;

3133 
bô
 = 0; bit < 8; ++bit) {

3134 
i
 = 8 * ((
r
 >> 
bô
Ë& 1Ë+ 4 * ((
g
 >> bôË& 1Ë+ 2 * ((
b
 >> bôË& 1Ë+ 1 * ((
a
 >> bit) & 1);

3135 if(!
åì
->
chûdªn
[
i
])  -1;

3136 
åì
 =Åªe->
chûdªn
[
i
];

3138  
åì
 ?Åªe->
ödex
 : -1;

3139 
	}
}

3141 #ifde‡
LODEPNG_COMPILE_ENCODER


3142 
	$cﬁ‹_åì_has
(
Cﬁ‹Tªe
* 
åì
, 
r
, 
g
, 
b
, 
a
) {

3143  
	`cﬁ‹_åì_gë
(
åì
, 
r
, 
g
, 
b
, 
a
) >= 0;

3144 
	}
}

3150 
	$cﬁ‹_åì_add
(
Cﬁ‹Tªe
* 
åì
,

3151 
r
, 
g
, 
b
, 
a
, 
ödex
) {

3152 
bô
;

3153 
bô
 = 0; bit < 8; ++bit) {

3154 
i
 = 8 * ((
r
 >> 
bô
Ë& 1Ë+ 4 * ((
g
 >> bôË& 1Ë+ 2 * ((
b
 >> bôË& 1Ë+ 1 * ((
a
 >> bit) & 1);

3155 if(!
åì
->
chûdªn
[
i
]) {

3156 
åì
->
chûdªn
[
i
] = (
Cﬁ‹Tªe
*)
	`lodïng_mÆloc
((ColorTree));

3157 if(!
åì
->
chûdªn
[
i
])  83;

3158 
	`cﬁ‹_åì_öô
(
åì
->
chûdªn
[
i
]);

3160 
åì
 =Åªe->
chûdªn
[
i
];

3162 
åì
->
ödex
 = ()index;

3164 
	}
}

3167 
	$rgba8ToPixñ
(* 
out
, 
size_t
 
i
,

3168 c⁄° 
LodePNGCﬁ‹Mode
* 
mode
, 
Cﬁ‹Tªe
* 
åì
 ,

3169 
r
, 
g
, 
b
, 
a
) {

3170 if(
mode
->
cﬁ‹ty≥
 =
LCT_GREY
) {

3171 
gøy
 = 
r
;

3172 if(
mode
->
bôdïth
 =8Ë
out
[
i
] = 
gøy
;

3173 if(
mode
->
bôdïth
 =16Ë
out
[
i
 * 2 + 0] = out[ò* 2 + 1] = 
gøy
;

3176 
gøy
 = (()gøy >> (8u - 
mode
->
bôdïth
)) & ((1u << mode->bitdepth) - 1u);

3177 
	`addCﬁ‹Bôs
(
out
, 
i
, 
mode
->
bôdïth
, 
gøy
);

3179 } if(
mode
->
cﬁ‹ty≥
 =
LCT_RGB
) {

3180 if(
mode
->
bôdïth
 == 8) {

3181 
out
[
i
 * 3 + 0] = 
r
;

3182 
out
[
i
 * 3 + 1] = 
g
;

3183 
out
[
i
 * 3 + 2] = 
b
;

3185 
out
[
i
 * 6 + 0] = out[ò* 6 + 1] = 
r
;

3186 
out
[
i
 * 6 + 2] = out[ò* 6 + 3] = 
g
;

3187 
out
[
i
 * 6 + 4] = out[ò* 6 + 5] = 
b
;

3189 } if(
mode
->
cﬁ‹ty≥
 =
LCT_PALETTE
) {

3190 
ödex
 = 
	`cﬁ‹_åì_gë
(
åì
, 
r
, 
g
, 
b
, 
a
);

3191 if(
ödex
 < 0)  82;

3192 if(
mode
->
bôdïth
 =8Ë
out
[
i
] = 
ödex
;

3193 
	`addCﬁ‹Bôs
(
out
, 
i
, 
mode
->
bôdïth
, ()
ödex
);

3194 } if(
mode
->
cﬁ‹ty≥
 =
LCT_GREY_ALPHA
) {

3195 
gøy
 = 
r
;

3196 if(
mode
->
bôdïth
 == 8) {

3197 
out
[
i
 * 2 + 0] = 
gøy
;

3198 
out
[
i
 * 2 + 1] = 
a
;

3199 } if(
mode
->
bôdïth
 == 16) {

3200 
out
[
i
 * 4 + 0] = out[ò* 4 + 1] = 
gøy
;

3201 
out
[
i
 * 4 + 2] = out[ò* 4 + 3] = 
a
;

3203 } if(
mode
->
cﬁ‹ty≥
 =
LCT_RGBA
) {

3204 if(
mode
->
bôdïth
 == 8) {

3205 
out
[
i
 * 4 + 0] = 
r
;

3206 
out
[
i
 * 4 + 1] = 
g
;

3207 
out
[
i
 * 4 + 2] = 
b
;

3208 
out
[
i
 * 4 + 3] = 
a
;

3210 
out
[
i
 * 8 + 0] = out[ò* 8 + 1] = 
r
;

3211 
out
[
i
 * 8 + 2] = out[ò* 8 + 3] = 
g
;

3212 
out
[
i
 * 8 + 4] = out[ò* 8 + 5] = 
b
;

3213 
out
[
i
 * 8 + 6] = out[ò* 8 + 7] = 
a
;

3218 
	}
}

3221 
	$rgba16ToPixñ
(* 
out
, 
size_t
 
i
,

3222 c⁄° 
LodePNGCﬁ‹Mode
* 
mode
,

3223 
r
, 
g
, 
b
, 
a
) {

3224 if(
mode
->
cﬁ‹ty≥
 =
LCT_GREY
) {

3225 
gøy
 = 
r
;

3226 
out
[
i
 * 2 + 0] = (
gøy
 >> 8) & 255;

3227 
out
[
i
 * 2 + 1] = 
gøy
 & 255;

3228 } if(
mode
->
cﬁ‹ty≥
 =
LCT_RGB
) {

3229 
out
[
i
 * 6 + 0] = (
r
 >> 8) & 255;

3230 
out
[
i
 * 6 + 1] = 
r
 & 255;

3231 
out
[
i
 * 6 + 2] = (
g
 >> 8) & 255;

3232 
out
[
i
 * 6 + 3] = 
g
 & 255;

3233 
out
[
i
 * 6 + 4] = (
b
 >> 8) & 255;

3234 
out
[
i
 * 6 + 5] = 
b
 & 255;

3235 } if(
mode
->
cﬁ‹ty≥
 =
LCT_GREY_ALPHA
) {

3236 
gøy
 = 
r
;

3237 
out
[
i
 * 4 + 0] = (
gøy
 >> 8) & 255;

3238 
out
[
i
 * 4 + 1] = 
gøy
 & 255;

3239 
out
[
i
 * 4 + 2] = (
a
 >> 8) & 255;

3240 
out
[
i
 * 4 + 3] = 
a
 & 255;

3241 } if(
mode
->
cﬁ‹ty≥
 =
LCT_RGBA
) {

3242 
out
[
i
 * 8 + 0] = (
r
 >> 8) & 255;

3243 
out
[
i
 * 8 + 1] = 
r
 & 255;

3244 
out
[
i
 * 8 + 2] = (
g
 >> 8) & 255;

3245 
out
[
i
 * 8 + 3] = 
g
 & 255;

3246 
out
[
i
 * 8 + 4] = (
b
 >> 8) & 255;

3247 
out
[
i
 * 8 + 5] = 
b
 & 255;

3248 
out
[
i
 * 8 + 6] = (
a
 >> 8) & 255;

3249 
out
[
i
 * 8 + 7] = 
a
 & 255;

3251 
	}
}

3254 
	$gëPixñCﬁ‹RGBA8
(* 
r
, * 
g
,

3255 * 
b
, * 
a
,

3256 c⁄° * 
ö
, 
size_t
 
i
,

3257 c⁄° 
LodePNGCﬁ‹Mode
* 
mode
) {

3258 if(
mode
->
cﬁ‹ty≥
 =
LCT_GREY
) {

3259 if(
mode
->
bôdïth
 == 8) {

3260 *
r
 = *
g
 = *
b
 = 
ö
[
i
];

3261 if(
mode
->
key_deföed
 && *
r
 =mode->
key_r
Ë*
a
 = 0;

3262 *
a
 = 255;

3263 } if(
mode
->
bôdïth
 == 16) {

3264 *
r
 = *
g
 = *
b
 = 
ö
[
i
 * 2 + 0];

3265 if(
mode
->
key_deföed
 && 256U * 
ö
[
i
 * 2 + 0] + in[ò* 2 + 1] =mode->
key_r
Ë*
a
 = 0;

3266 *
a
 = 255;

3268 
highe°
 = ((1U << 
mode
->
bôdïth
) - 1U);

3269 
size_t
 
j
 = 
i
 * 
mode
->
bôdïth
;

3270 
vÆue
 = 
	`ªadBôsFromRevî£dSåóm
(&
j
, 
ö
, 
mode
->
bôdïth
);

3271 *
r
 = *
g
 = *
b
 = (
vÆue
 * 255Ë/ 
highe°
;

3272 if(
mode
->
key_deföed
 && 
vÆue
 =mode->
key_r
Ë*
a
 = 0;

3273 *
a
 = 255;

3275 } if(
mode
->
cﬁ‹ty≥
 =
LCT_RGB
) {

3276 if(
mode
->
bôdïth
 == 8) {

3277 *
r
 = 
ö
[
i
 * 3 + 0]; *
g
 = in[ò* 3 + 1]; *
b
 = in[i * 3 + 2];

3278 if(
mode
->
key_deföed
 && *
r
 =mode->
key_r
 && *
g
 =mode->
key_g
 && *
b
 =mode->
key_b
Ë*
a
 = 0;

3279 *
a
 = 255;

3281 *
r
 = 
ö
[
i
 * 6 + 0];

3282 *
g
 = 
ö
[
i
 * 6 + 2];

3283 *
b
 = 
ö
[
i
 * 6 + 4];

3284 if(
mode
->
key_deföed
 && 256U * 
ö
[
i
 * 6 + 0] + in[ò* 6 + 1] =mode->
key_r


3285 && 256U * 
ö
[
i
 * 6 + 2] + in[ò* 6 + 3] =
mode
->
key_g


3286 && 256U * 
ö
[
i
 * 6 + 4] + in[ò* 6 + 5] =
mode
->
key_b
Ë*
a
 = 0;

3287 *
a
 = 255;

3289 } if(
mode
->
cﬁ‹ty≥
 =
LCT_PALETTE
) {

3290 
ödex
;

3291 if(
mode
->
bôdïth
 =8Ë
ödex
 = 
ö
[
i
];

3293 
size_t
 
j
 = 
i
 * 
mode
->
bôdïth
;

3294 
ödex
 = 
	`ªadBôsFromRevî£dSåóm
(&
j
, 
ö
, 
mode
->
bôdïth
);

3297 *
r
 = 
mode
->
∑Àâe
[
ödex
 * 4 + 0];

3298 *
g
 = 
mode
->
∑Àâe
[
ödex
 * 4 + 1];

3299 *
b
 = 
mode
->
∑Àâe
[
ödex
 * 4 + 2];

3300 *
a
 = 
mode
->
∑Àâe
[
ödex
 * 4 + 3];

3301 } if(
mode
->
cﬁ‹ty≥
 =
LCT_GREY_ALPHA
) {

3302 if(
mode
->
bôdïth
 == 8) {

3303 *
r
 = *
g
 = *
b
 = 
ö
[
i
 * 2 + 0];

3304 *
a
 = 
ö
[
i
 * 2 + 1];

3306 *
r
 = *
g
 = *
b
 = 
ö
[
i
 * 4 + 0];

3307 *
a
 = 
ö
[
i
 * 4 + 2];

3309 } if(
mode
->
cﬁ‹ty≥
 =
LCT_RGBA
) {

3310 if(
mode
->
bôdïth
 == 8) {

3311 *
r
 = 
ö
[
i
 * 4 + 0];

3312 *
g
 = 
ö
[
i
 * 4 + 1];

3313 *
b
 = 
ö
[
i
 * 4 + 2];

3314 *
a
 = 
ö
[
i
 * 4 + 3];

3316 *
r
 = 
ö
[
i
 * 8 + 0];

3317 *
g
 = 
ö
[
i
 * 8 + 2];

3318 *
b
 = 
ö
[
i
 * 8 + 4];

3319 *
a
 = 
ö
[
i
 * 8 + 6];

3322 
	}
}

3328 
	$gëPixñCﬁ‹sRGBA8
(* 
LODEPNG_RESTRICT
 
buf„r
, 
size_t
 
numpixñs
,

3329 c⁄° * 
LODEPNG_RESTRICT
 
ö
,

3330 c⁄° 
LodePNGCﬁ‹Mode
* 
mode
) {

3331 
num_ch™√ls
 = 4;

3332 
size_t
 
i
;

3333 if(
mode
->
cﬁ‹ty≥
 =
LCT_GREY
) {

3334 if(
mode
->
bôdïth
 == 8) {

3335 
i
 = 0; i !
numpixñs
; ++i, 
buf„r
 +
num_ch™√ls
) {

3336 
buf„r
[0] = buf„r[1] = buf„r[2] = 
ö
[
i
];

3337 
buf„r
[3] = 255;

3339 if(
mode
->
key_deföed
) {

3340 
buf„r
 -
numpixñs
 * 
num_ch™√ls
;

3341 
i
 = 0; i !
numpixñs
; ++i, 
buf„r
 +
num_ch™√ls
) {

3342 if(
buf„r
[0] =
mode
->
key_r
) buffer[3] = 0;

3345 } if(
mode
->
bôdïth
 == 16) {

3346 
i
 = 0; i !
numpixñs
; ++i, 
buf„r
 +
num_ch™√ls
) {

3347 
buf„r
[0] = buf„r[1] = buf„r[2] = 
ö
[
i
 * 2];

3348 
buf„r
[3] = 
mode
->
key_deföed
 && 256U * 
ö
[
i
 * 2 + 0] + in[ò* 2 + 1] =mode->
key_r
 ? 0 : 255;

3351 
highe°
 = ((1U << 
mode
->
bôdïth
) - 1U);

3352 
size_t
 
j
 = 0;

3353 
i
 = 0; i !
numpixñs
; ++i, 
buf„r
 +
num_ch™√ls
) {

3354 
vÆue
 = 
	`ªadBôsFromRevî£dSåóm
(&
j
, 
ö
, 
mode
->
bôdïth
);

3355 
buf„r
[0] = buf„r[1] = buf„r[2] = (
vÆue
 * 255Ë/ 
highe°
;

3356 
buf„r
[3] = 
mode
->
key_deföed
 && 
vÆue
 =mode->
key_r
 ? 0 : 255;

3359 } if(
mode
->
cﬁ‹ty≥
 =
LCT_RGB
) {

3360 if(
mode
->
bôdïth
 == 8) {

3361 
i
 = 0; i !
numpixñs
; ++i, 
buf„r
 +
num_ch™√ls
) {

3362 
	`lodïng_mem˝y
(
buf„r
, &
ö
[
i
 * 3], 3);

3363 
buf„r
[3] = 255;

3365 if(
mode
->
key_deföed
) {

3366 
buf„r
 -
numpixñs
 * 
num_ch™√ls
;

3367 
i
 = 0; i !
numpixñs
; ++i, 
buf„r
 +
num_ch™√ls
) {

3368 if(
buf„r
[0] =
mode
->
key_r
 && buf„r[1]=mode->
key_g
 && buf„r[2] =mode->
key_b
) buffer[3] = 0;

3372 
i
 = 0; i !
numpixñs
; ++i, 
buf„r
 +
num_ch™√ls
) {

3373 
buf„r
[0] = 
ö
[
i
 * 6 + 0];

3374 
buf„r
[1] = 
ö
[
i
 * 6 + 2];

3375 
buf„r
[2] = 
ö
[
i
 * 6 + 4];

3376 
buf„r
[3] = 
mode
->
key_deföed


3377 && 256U * 
ö
[
i
 * 6 + 0] + in[ò* 6 + 1] =
mode
->
key_r


3378 && 256U * 
ö
[
i
 * 6 + 2] + in[ò* 6 + 3] =
mode
->
key_g


3379 && 256U * 
ö
[
i
 * 6 + 4] + in[ò* 6 + 5] =
mode
->
key_b
 ? 0 : 255;

3382 } if(
mode
->
cﬁ‹ty≥
 =
LCT_PALETTE
) {

3383 if(
mode
->
bôdïth
 == 8) {

3384 
i
 = 0; i !
numpixñs
; ++i, 
buf„r
 +
num_ch™√ls
) {

3385 
ödex
 = 
ö
[
i
];

3387 
	`lodïng_mem˝y
(
buf„r
, &
mode
->
∑Àâe
[
ödex
 * 4], 4);

3390 
size_t
 
j
 = 0;

3391 
i
 = 0; i !
numpixñs
; ++i, 
buf„r
 +
num_ch™√ls
) {

3392 
ödex
 = 
	`ªadBôsFromRevî£dSåóm
(&
j
, 
ö
, 
mode
->
bôdïth
);

3394 
	`lodïng_mem˝y
(
buf„r
, &
mode
->
∑Àâe
[
ödex
 * 4], 4);

3397 } if(
mode
->
cﬁ‹ty≥
 =
LCT_GREY_ALPHA
) {

3398 if(
mode
->
bôdïth
 == 8) {

3399 
i
 = 0; i !
numpixñs
; ++i, 
buf„r
 +
num_ch™√ls
) {

3400 
buf„r
[0] = buf„r[1] = buf„r[2] = 
ö
[
i
 * 2 + 0];

3401 
buf„r
[3] = 
ö
[
i
 * 2 + 1];

3404 
i
 = 0; i !
numpixñs
; ++i, 
buf„r
 +
num_ch™√ls
) {

3405 
buf„r
[0] = buf„r[1] = buf„r[2] = 
ö
[
i
 * 4 + 0];

3406 
buf„r
[3] = 
ö
[
i
 * 4 + 2];

3409 } if(
mode
->
cﬁ‹ty≥
 =
LCT_RGBA
) {

3410 if(
mode
->
bôdïth
 == 8) {

3411 
	`lodïng_mem˝y
(
buf„r
, 
ö
, 
numpixñs
 * 4);

3413 
i
 = 0; i !
numpixñs
; ++i, 
buf„r
 +
num_ch™√ls
) {

3414 
buf„r
[0] = 
ö
[
i
 * 8 + 0];

3415 
buf„r
[1] = 
ö
[
i
 * 8 + 2];

3416 
buf„r
[2] = 
ö
[
i
 * 8 + 4];

3417 
buf„r
[3] = 
ö
[
i
 * 8 + 6];

3421 
	}
}

3424 
	$gëPixñCﬁ‹sRGB8
(* 
LODEPNG_RESTRICT
 
buf„r
, 
size_t
 
numpixñs
,

3425 c⁄° * 
LODEPNG_RESTRICT
 
ö
,

3426 c⁄° 
LodePNGCﬁ‹Mode
* 
mode
) {

3427 c⁄° 
num_ch™√ls
 = 3;

3428 
size_t
 
i
;

3429 if(
mode
->
cﬁ‹ty≥
 =
LCT_GREY
) {

3430 if(
mode
->
bôdïth
 == 8) {

3431 
i
 = 0; i !
numpixñs
; ++i, 
buf„r
 +
num_ch™√ls
) {

3432 
buf„r
[0] = buf„r[1] = buf„r[2] = 
ö
[
i
];

3434 } if(
mode
->
bôdïth
 == 16) {

3435 
i
 = 0; i !
numpixñs
; ++i, 
buf„r
 +
num_ch™√ls
) {

3436 
buf„r
[0] = buf„r[1] = buf„r[2] = 
ö
[
i
 * 2];

3439 
highe°
 = ((1U << 
mode
->
bôdïth
) - 1U);

3440 
size_t
 
j
 = 0;

3441 
i
 = 0; i !
numpixñs
; ++i, 
buf„r
 +
num_ch™√ls
) {

3442 
vÆue
 = 
	`ªadBôsFromRevî£dSåóm
(&
j
, 
ö
, 
mode
->
bôdïth
);

3443 
buf„r
[0] = buf„r[1] = buf„r[2] = (
vÆue
 * 255Ë/ 
highe°
;

3446 } if(
mode
->
cﬁ‹ty≥
 =
LCT_RGB
) {

3447 if(
mode
->
bôdïth
 == 8) {

3448 
	`lodïng_mem˝y
(
buf„r
, 
ö
, 
numpixñs
 * 3);

3450 
i
 = 0; i !
numpixñs
; ++i, 
buf„r
 +
num_ch™√ls
) {

3451 
buf„r
[0] = 
ö
[
i
 * 6 + 0];

3452 
buf„r
[1] = 
ö
[
i
 * 6 + 2];

3453 
buf„r
[2] = 
ö
[
i
 * 6 + 4];

3456 } if(
mode
->
cﬁ‹ty≥
 =
LCT_PALETTE
) {

3457 if(
mode
->
bôdïth
 == 8) {

3458 
i
 = 0; i !
numpixñs
; ++i, 
buf„r
 +
num_ch™√ls
) {

3459 
ödex
 = 
ö
[
i
];

3461 
	`lodïng_mem˝y
(
buf„r
, &
mode
->
∑Àâe
[
ödex
 * 4], 3);

3464 
size_t
 
j
 = 0;

3465 
i
 = 0; i !
numpixñs
; ++i, 
buf„r
 +
num_ch™√ls
) {

3466 
ödex
 = 
	`ªadBôsFromRevî£dSåóm
(&
j
, 
ö
, 
mode
->
bôdïth
);

3468 
	`lodïng_mem˝y
(
buf„r
, &
mode
->
∑Àâe
[
ödex
 * 4], 3);

3471 } if(
mode
->
cﬁ‹ty≥
 =
LCT_GREY_ALPHA
) {

3472 if(
mode
->
bôdïth
 == 8) {

3473 
i
 = 0; i !
numpixñs
; ++i, 
buf„r
 +
num_ch™√ls
) {

3474 
buf„r
[0] = buf„r[1] = buf„r[2] = 
ö
[
i
 * 2 + 0];

3477 
i
 = 0; i !
numpixñs
; ++i, 
buf„r
 +
num_ch™√ls
) {

3478 
buf„r
[0] = buf„r[1] = buf„r[2] = 
ö
[
i
 * 4 + 0];

3481 } if(
mode
->
cﬁ‹ty≥
 =
LCT_RGBA
) {

3482 if(
mode
->
bôdïth
 == 8) {

3483 
i
 = 0; i !
numpixñs
; ++i, 
buf„r
 +
num_ch™√ls
) {

3484 
	`lodïng_mem˝y
(
buf„r
, &
ö
[
i
 * 4], 3);

3487 
i
 = 0; i !
numpixñs
; ++i, 
buf„r
 +
num_ch™√ls
) {

3488 
buf„r
[0] = 
ö
[
i
 * 8 + 0];

3489 
buf„r
[1] = 
ö
[
i
 * 8 + 2];

3490 
buf„r
[2] = 
ö
[
i
 * 8 + 4];

3494 
	}
}

3498 
	$gëPixñCﬁ‹RGBA16
(* 
r
, * 
g
, * 
b
, * 
a
,

3499 c⁄° * 
ö
, 
size_t
 
i
, c⁄° 
LodePNGCﬁ‹Mode
* 
mode
) {

3500 if(
mode
->
cﬁ‹ty≥
 =
LCT_GREY
) {

3501 *
r
 = *
g
 = *
b
 = 256 * 
ö
[
i
 * 2 + 0] + in[i * 2 + 1];

3502 if(
mode
->
key_deföed
 && 256U * 
ö
[
i
 * 2 + 0] + in[ò* 2 + 1] =mode->
key_r
Ë*
a
 = 0;

3503 *
a
 = 65535;

3504 } if(
mode
->
cﬁ‹ty≥
 =
LCT_RGB
) {

3505 *
r
 = 256u * 
ö
[
i
 * 6 + 0] + in[i * 6 + 1];

3506 *
g
 = 256u * 
ö
[
i
 * 6 + 2] + in[i * 6 + 3];

3507 *
b
 = 256u * 
ö
[
i
 * 6 + 4] + in[i * 6 + 5];

3508 if(
mode
->
key_deföed


3509 && 256u * 
ö
[
i
 * 6 + 0] + in[ò* 6 + 1] =
mode
->
key_r


3510 && 256u * 
ö
[
i
 * 6 + 2] + in[ò* 6 + 3] =
mode
->
key_g


3511 && 256u * 
ö
[
i
 * 6 + 4] + in[ò* 6 + 5] =
mode
->
key_b
Ë*
a
 = 0;

3512 *
a
 = 65535;

3513 } if(
mode
->
cﬁ‹ty≥
 =
LCT_GREY_ALPHA
) {

3514 *
r
 = *
g
 = *
b
 = 256u * 
ö
[
i
 * 4 + 0] + in[i * 4 + 1];

3515 *
a
 = 256u * 
ö
[
i
 * 4 + 2] + in[i * 4 + 3];

3516 } if(
mode
->
cﬁ‹ty≥
 =
LCT_RGBA
) {

3517 *
r
 = 256u * 
ö
[
i
 * 8 + 0] + in[i * 8 + 1];

3518 *
g
 = 256u * 
ö
[
i
 * 8 + 2] + in[i * 8 + 3];

3519 *
b
 = 256u * 
ö
[
i
 * 8 + 4] + in[i * 8 + 5];

3520 *
a
 = 256u * 
ö
[
i
 * 8 + 6] + in[i * 8 + 7];

3522 
	}
}

3524 
	$lodïng_c⁄vît
(* 
out
, c⁄° * 
ö
,

3525 c⁄° 
LodePNGCﬁ‹Mode
* 
mode_out
, c⁄° LodePNGCﬁ‹Mode* 
mode_ö
,

3526 
w
, 
h
) {

3527 
size_t
 
i
;

3528 
Cﬁ‹Tªe
 
åì
;

3529 
size_t
 
numpixñs
 = (size_t)
w
 * (size_t)
h
;

3530 
îr‹
 = 0;

3532 if(
mode_ö
->
cﬁ‹ty≥
 =
LCT_PALETTE
 && !mode_ö->
∑Àâe
) {

3536 if(
	`lodïng_cﬁ‹_mode_equÆ
(
mode_out
, 
mode_ö
)) {

3537 
size_t
 
numbyãs
 = 
	`lodïng_gë_øw_size
(
w
, 
h
, 
mode_ö
);

3538 
	`lodïng_mem˝y
(
out
, 
ö
, 
numbyãs
);

3542 if(
mode_out
->
cﬁ‹ty≥
 =
LCT_PALETTE
) {

3543 
size_t
 
∑Àâesize
 = 
mode_out
->palettesize;

3544 c⁄° * 
∑Àâe
 = 
mode_out
->palette;

3545 
size_t
 
∑lsize
 = (size_t)1u << 
mode_out
->
bôdïth
;

3549 if(
∑Àâesize
 == 0) {

3550 
∑Àâesize
 = 
mode_ö
->palettesize;

3551 
∑Àâe
 = 
mode_ö
->palette;

3555 if(
mode_ö
->
cﬁ‹ty≥
 =
LCT_PALETTE
 && mode_ö->
bôdïth
 =
mode_out
->bitdepth) {

3556 
size_t
 
numbyãs
 = 
	`lodïng_gë_øw_size
(
w
, 
h
, 
mode_ö
);

3557 
	`lodïng_mem˝y
(
out
, 
ö
, 
numbyãs
);

3561 if(
∑Àâesize
 < 
∑lsize
)Öalsize =Öalettesize;

3562 
	`cﬁ‹_åì_öô
(&
åì
);

3563 
i
 = 0; i !
∑lsize
; ++i) {

3564 c⁄° * 
p
 = &
∑Àâe
[
i
 * 4];

3565 
îr‹
 = 
	`cﬁ‹_åì_add
(&
åì
, 
p
[0],Ö[1],Ö[2],Ö[3], ()
i
);

3566 if(
îr‹
) ;

3570 if(!
îr‹
) {

3571 if(
mode_ö
->
bôdïth
 =16 && 
mode_out
->bitdepth == 16) {

3572 
i
 = 0; i !
numpixñs
; ++i) {

3573 
r
 = 0, 
g
 = 0, 
b
 = 0, 
a
 = 0;

3574 
	`gëPixñCﬁ‹RGBA16
(&
r
, &
g
, &
b
, &
a
, 
ö
, 
i
, 
mode_ö
);

3575 
	`rgba16ToPixñ
(
out
, 
i
, 
mode_out
, 
r
, 
g
, 
b
, 
a
);

3577 } if(
mode_out
->
bôdïth
 =8 && mode_out->
cﬁ‹ty≥
 =
LCT_RGBA
) {

3578 
	`gëPixñCﬁ‹sRGBA8
(
out
, 
numpixñs
, 
ö
, 
mode_ö
);

3579 } if(
mode_out
->
bôdïth
 =8 && mode_out->
cﬁ‹ty≥
 =
LCT_RGB
) {

3580 
	`gëPixñCﬁ‹sRGB8
(
out
, 
numpixñs
, 
ö
, 
mode_ö
);

3582 
r
 = 0, 
g
 = 0, 
b
 = 0, 
a
 = 0;

3583 
i
 = 0; i !
numpixñs
; ++i) {

3584 
	`gëPixñCﬁ‹RGBA8
(&
r
, &
g
, &
b
, &
a
, 
ö
, 
i
, 
mode_ö
);

3585 
îr‹
 = 
	`rgba8ToPixñ
(
out
, 
i
, 
mode_out
, &
åì
, 
r
, 
g
, 
b
, 
a
);

3586 if(
îr‹
) ;

3591 if(
mode_out
->
cﬁ‹ty≥
 =
LCT_PALETTE
) {

3592 
	`cﬁ‹_åì_˛ónup
(&
åì
);

3595  
îr‹
;

3596 
	}
}

3605 
	$lodïng_c⁄vît_rgb
(

3606 * 
r_out
, * 
g_out
, * 
b_out
,

3607 
r_ö
, 
g_ö
, 
b_ö
,

3608 c⁄° 
LodePNGCﬁ‹Mode
* 
mode_out
, c⁄° LodePNGCﬁ‹Mode* 
mode_ö
) {

3609 
r
 = 0, 
g
 = 0, 
b
 = 0;

3610 
mul
 = 65535 / ((1u << 
mode_ö
->
bôdïth
) - 1u);

3611 
shi·
 = 16 - 
mode_out
->
bôdïth
;

3613 if(
mode_ö
->
cﬁ‹ty≥
 =
LCT_GREY
 || mode_ö->cﬁ‹ty≥ =
LCT_GREY_ALPHA
) {

3614 
r
 = 
g
 = 
b
 = 
r_ö
 * 
mul
;

3615 } if(
mode_ö
->
cﬁ‹ty≥
 =
LCT_RGB
 || mode_ö->cﬁ‹ty≥ =
LCT_RGBA
) {

3616 
r
 = 
r_ö
 * 
mul
;

3617 
g
 = 
g_ö
 * 
mul
;

3618 
b
 = 
b_ö
 * 
mul
;

3619 } if(
mode_ö
->
cﬁ‹ty≥
 =
LCT_PALETTE
) {

3620 if(
r_ö
 >
mode_ö
->
∑Àâesize
)  82;

3621 
r
 = 
mode_ö
->
∑Àâe
[
r_ö
 * 4 + 0] * 257u;

3622 
g
 = 
mode_ö
->
∑Àâe
[
r_ö
 * 4 + 1] * 257u;

3623 
b
 = 
mode_ö
->
∑Àâe
[
r_ö
 * 4 + 2] * 257u;

3629 if(
mode_out
->
cﬁ‹ty≥
 =
LCT_GREY
 || mode_out->cﬁ‹ty≥ =
LCT_GREY_ALPHA
) {

3630 *
r_out
 = 
r
 >> 
shi·
 ;

3631 } if(
mode_out
->
cﬁ‹ty≥
 =
LCT_RGB
 || mode_out->cﬁ‹ty≥ =
LCT_RGBA
) {

3632 *
r_out
 = 
r
 >> 
shi·
 ;

3633 *
g_out
 = 
g
 >> 
shi·
 ;

3634 *
b_out
 = 
b
 >> 
shi·
 ;

3635 } if(
mode_out
->
cﬁ‹ty≥
 =
LCT_PALETTE
) {

3636 
i
;

3638 if((
r
 >> 8Ë!‘ & 255Ë|| (
g
 >> 8Ë!(g & 255Ë|| (
b
 >> 8) != (b & 255))  82;

3639 
i
 = 0; i < 
mode_out
->
∑Àâesize
; i++) {

3640 
j
 = 
i
 * 4;

3641 if((
r
 >> 8Ë=
mode_out
->
∑Àâe
[
j
 + 0] && (
g
 >> 8) == mode_out->palette[j + 1] &&

3642 (
b
 >> 8Ë=
mode_out
->
∑Àâe
[
j
 + 2]) {

3643 *
r_out
 = 
i
;

3653 
	}
}

3655 #ifde‡
LODEPNG_COMPILE_ENCODER


3657 
	$lodïng_cﬁ‹_°©s_öô
(
LodePNGCﬁ‹Sèts
* 
°©s
) {

3659 
°©s
->
cﬁ‹ed
 = 0;

3660 
°©s
->
key
 = 0;

3661 
°©s
->
key_r
 = sèts->
key_g
 = sèts->
key_b
 = 0;

3662 
°©s
->
Æpha
 = 0;

3663 
°©s
->
numcﬁ‹s
 = 0;

3664 
°©s
->
bôs
 = 1;

3665 
°©s
->
numpixñs
 = 0;

3667 
°©s
->
Ælow_∑Àâe
 = 1;

3668 
°©s
->
Ælow_gªysˇÀ
 = 1;

3669 
	}
}

3684 
	$gëVÆueRequúedBôs
(
vÆue
) {

3685 if(
vÆue
 == 0 || value == 255)  1;

3687 if(
vÆue
 % 17 == 0)  value % 85 == 0 ? 2 : 4;

3689 
	}
}

3692 
	$lodïng_compuã_cﬁ‹_°©s
(
LodePNGCﬁ‹Sèts
* 
°©s
,

3693 c⁄° * 
ö
, 
w
, 
h
,

3694 c⁄° 
LodePNGCﬁ‹Mode
* 
mode_ö
) {

3695 
size_t
 
i
;

3696 
Cﬁ‹Tªe
 
åì
;

3697 
size_t
 
numpixñs
 = (size_t)
w
 * (size_t)
h
;

3698 
îr‹
 = 0;

3701 
cﬁ‹ed_d⁄e
 = 
	`lodïng_is_gªysˇÀ_ty≥
(
mode_ö
) ? 1 : 0;

3702 
Æpha_d⁄e
 = 
	`lodïng_ˇn_have_Æpha
(
mode_ö
) ? 0 : 1;

3703 
numcﬁ‹s_d⁄e
 = 0;

3704 
bµ
 = 
	`lodïng_gë_bµ
(
mode_ö
);

3705 
bôs_d⁄e
 = (
°©s
->
bôs
 =1 && 
bµ
 == 1) ? 1 : 0;

3706 
sixãí
 = 0;

3707 
maxnumcﬁ‹s
 = 257;

3708 if(
bµ
 <8Ë
maxnumcﬁ‹s
 = 
	`LODEPNG_MIN
(257, 
°©s
->
numcﬁ‹s
 + (1u << bpp));

3710 
°©s
->
numpixñs
 +=Çumpixels;

3713 if(!
°©s
->
Ælow_∑Àâe
Ë
numcﬁ‹s_d⁄e
 = 1;

3715 
	`cﬁ‹_åì_öô
(&
åì
);

3719 if(
°©s
->
Æpha
Ë
Æpha_d⁄e
 = 1;

3720 if(
°©s
->
cﬁ‹ed
Ë
cﬁ‹ed_d⁄e
 = 1;

3721 if(
°©s
->
bôs
 =16Ë
numcﬁ‹s_d⁄e
 = 1;

3722 if(
°©s
->
bôs
 >
bµ
Ë
bôs_d⁄e
 = 1;

3723 if(
°©s
->
numcﬁ‹s
 >
maxnumcﬁ‹s
Ë
numcﬁ‹s_d⁄e
 = 1;

3725 if(!
numcﬁ‹s_d⁄e
) {

3726 
i
 = 0; i < 
°©s
->
numcﬁ‹s
; i++) {

3727 c⁄° * 
cﬁ‹
 = &
°©s
->
∑Àâe
[
i
 * 4];

3728 
îr‹
 = 
	`cﬁ‹_åì_add
(&
åì
, 
cﬁ‹
[0], cﬁ‹[1], cﬁ‹[2], cﬁ‹[3], 
i
);

3729 if(
îr‹
Ë
˛ónup
;

3734 if(
mode_ö
->
bôdïth
 =16 && !
sixãí
) {

3735 
r
 = 0, 
g
 = 0, 
b
 = 0, 
a
 = 0;

3736 
i
 = 0; i !
numpixñs
; ++i) {

3737 
	`gëPixñCﬁ‹RGBA16
(&
r
, &
g
, &
b
, &
a
, 
ö
, 
i
, 
mode_ö
);

3738 if((
r
 & 255Ë!(‘ >> 8Ë& 255Ë|| (
g
 & 255) != ((g >> 8) & 255) ||

3739 (
b
 & 255Ë!((b >> 8Ë& 255Ë|| (
a
 & 255) != ((a >> 8) & 255)) {

3740 
°©s
->
bôs
 = 16;

3741 
sixãí
 = 1;

3742 
bôs_d⁄e
 = 1;

3743 
numcﬁ‹s_d⁄e
 = 1;

3749 if(
sixãí
) {

3750 
r
 = 0, 
g
 = 0, 
b
 = 0, 
a
 = 0;

3752 
i
 = 0; i !
numpixñs
; ++i) {

3753 
	`gëPixñCﬁ‹RGBA16
(&
r
, &
g
, &
b
, &
a
, 
ö
, 
i
, 
mode_ö
);

3755 if(!
cﬁ‹ed_d⁄e
 && (
r
 !
g
 ||Ñ !
b
)) {

3756 
°©s
->
cﬁ‹ed
 = 1;

3757 
cﬁ‹ed_d⁄e
 = 1;

3760 if(!
Æpha_d⁄e
) {

3761 
m©chkey
 = (
r
 =
°©s
->
key_r
 && 
g
 =°©s->
key_g
 && 
b
 =°©s->
key_b
);

3762 if(
a
 !65535 && (®!0 || (
°©s
->
key
 && !
m©chkey
))) {

3763 
°©s
->
Æpha
 = 1;

3764 
°©s
->
key
 = 0;

3765 
Æpha_d⁄e
 = 1;

3766 } if(
a
 =0 && !
°©s
->
Æpha
 && !°©s->
key
) {

3767 
°©s
->
key
 = 1;

3768 
°©s
->
key_r
 = 
r
;

3769 
°©s
->
key_g
 = 
g
;

3770 
°©s
->
key_b
 = 
b
;

3771 } if(
a
 =65535 && 
°©s
->
key
 && 
m©chkey
) {

3773 
°©s
->
Æpha
 = 1;

3774 
°©s
->
key
 = 0;

3775 
Æpha_d⁄e
 = 1;

3778 if(
Æpha_d⁄e
 && 
numcﬁ‹s_d⁄e
 && 
cﬁ‹ed_d⁄e
 && 
bôs_d⁄e
) ;

3781 if(
°©s
->
key
 && !°©s->
Æpha
) {

3782 
i
 = 0; i !
numpixñs
; ++i) {

3783 
	`gëPixñCﬁ‹RGBA16
(&
r
, &
g
, &
b
, &
a
, 
ö
, 
i
, 
mode_ö
);

3784 if(
a
 !0 && 
r
 =
°©s
->
key_r
 && 
g
 =°©s->
key_g
 && 
b
 =°©s->
key_b
) {

3786 
°©s
->
Æpha
 = 1;

3787 
°©s
->
key
 = 0;

3788 
Æpha_d⁄e
 = 1;

3793 
r
 = 0, 
g
 = 0, 
b
 = 0, 
a
 = 0;

3794 
i
 = 0; i !
numpixñs
; ++i) {

3795 
	`gëPixñCﬁ‹RGBA8
(&
r
, &
g
, &
b
, &
a
, 
ö
, 
i
, 
mode_ö
);

3797 if(!
bôs_d⁄e
 && 
°©s
->
bôs
 < 8) {

3799 
bôs
 = 
	`gëVÆueRequúedBôs
(
r
);

3800 if(
bôs
 > 
°©s
->bits) stats->bits = bits;

3802 
bôs_d⁄e
 = (
°©s
->
bôs
 >
bµ
);

3804 if(!
cﬁ‹ed_d⁄e
 && (
r
 !
g
 ||Ñ !
b
)) {

3805 
°©s
->
cﬁ‹ed
 = 1;

3806 
cﬁ‹ed_d⁄e
 = 1;

3807 if(
°©s
->
bôs
 < 8) stats->bits = 8;

3810 if(!
Æpha_d⁄e
) {

3811 
m©chkey
 = (
r
 =
°©s
->
key_r
 && 
g
 =°©s->
key_g
 && 
b
 =°©s->
key_b
);

3812 if(
a
 !255 && (®!0 || (
°©s
->
key
 && !
m©chkey
))) {

3813 
°©s
->
Æpha
 = 1;

3814 
°©s
->
key
 = 0;

3815 
Æpha_d⁄e
 = 1;

3816 if(
°©s
->
bôs
 < 8) stats->bits = 8;

3817 } if(
a
 =0 && !
°©s
->
Æpha
 && !°©s->
key
) {

3818 
°©s
->
key
 = 1;

3819 
°©s
->
key_r
 = 
r
;

3820 
°©s
->
key_g
 = 
g
;

3821 
°©s
->
key_b
 = 
b
;

3822 } if(
a
 =255 && 
°©s
->
key
 && 
m©chkey
) {

3824 
°©s
->
Æpha
 = 1;

3825 
°©s
->
key
 = 0;

3826 
Æpha_d⁄e
 = 1;

3827 if(
°©s
->
bôs
 < 8) stats->bits = 8;

3831 if(!
numcﬁ‹s_d⁄e
) {

3832 if(!
	`cﬁ‹_åì_has
(&
åì
, 
r
, 
g
, 
b
, 
a
)) {

3833 
îr‹
 = 
	`cﬁ‹_åì_add
(&
åì
, 
r
, 
g
, 
b
, 
a
, 
°©s
->
numcﬁ‹s
);

3834 if(
îr‹
Ë
˛ónup
;

3835 if(
°©s
->
numcﬁ‹s
 < 256) {

3836 * 
p
 = 
°©s
->
∑Àâe
;

3837 
n
 = 
°©s
->
numcﬁ‹s
;

3838 
p
[
n
 * 4 + 0] = 
r
;

3839 
p
[
n
 * 4 + 1] = 
g
;

3840 
p
[
n
 * 4 + 2] = 
b
;

3841 
p
[
n
 * 4 + 3] = 
a
;

3843 ++
°©s
->
numcﬁ‹s
;

3844 
numcﬁ‹s_d⁄e
 = 
°©s
->
numcﬁ‹s
 >
maxnumcﬁ‹s
;

3848 if(
Æpha_d⁄e
 && 
numcﬁ‹s_d⁄e
 && 
cﬁ‹ed_d⁄e
 && 
bôs_d⁄e
) ;

3851 if(
°©s
->
key
 && !°©s->
Æpha
) {

3852 
i
 = 0; i !
numpixñs
; ++i) {

3853 
	`gëPixñCﬁ‹RGBA8
(&
r
, &
g
, &
b
, &
a
, 
ö
, 
i
, 
mode_ö
);

3854 if(
a
 !0 && 
r
 =
°©s
->
key_r
 && 
g
 =°©s->
key_g
 && 
b
 =°©s->
key_b
) {

3856 
°©s
->
Æpha
 = 1;

3857 
°©s
->
key
 = 0;

3858 
Æpha_d⁄e
 = 1;

3859 if(
°©s
->
bôs
 < 8) stats->bits = 8;

3865 
°©s
->
key_r
 += (stats->key_r << 8);

3866 
°©s
->
key_g
 += (stats->key_g << 8);

3867 
°©s
->
key_b
 += (stats->key_b << 8);

3870 
˛ónup
:

3871 
	`cﬁ‹_åì_˛ónup
(&
åì
);

3872  
îr‹
;

3873 
	}
}

3875 #ifde‡
LODEPNG_COMPILE_ANCILLARY_CHUNKS


3879 
	$lodïng_cﬁ‹_°©s_add
(
LodePNGCﬁ‹Sèts
* 
°©s
,

3880 
r
, 
g
, 
b
, 
a
) {

3881 
îr‹
 = 0;

3882 
image
[8];

3883 
LodePNGCﬁ‹Mode
 
mode
;

3884 
	`lodïng_cﬁ‹_mode_öô
(&
mode
);

3885 
image
[0] = 
r
 >> 8; image[1] =Ñ; image[2] = 
g
 >> 8; image[3] = g;

3886 
image
[4] = 
b
 >> 8; image[5] = b; image[6] = 
a
 >> 8; image[7] =á;

3887 
mode
.
bôdïth
 = 16;

3888 
mode
.
cﬁ‹ty≥
 = 
LCT_RGBA
;

3889 
îr‹
 = 
	`lodïng_compuã_cﬁ‹_°©s
(
°©s
, 
image
, 1, 1, &
mode
);

3890 
	`lodïng_cﬁ‹_mode_˛ónup
(&
mode
);

3891  
îr‹
;

3892 
	}
}

3902 
	$auto_choo£_cﬁ‹
(
LodePNGCﬁ‹Mode
* 
mode_out
,

3903 c⁄° 
LodePNGCﬁ‹Mode
* 
mode_ö
,

3904 c⁄° 
LodePNGCﬁ‹Sèts
* 
°©s
) {

3905 
îr‹
 = 0;

3906 
∑Àâebôs
;

3907 
size_t
 
i
, 
n
;

3908 
size_t
 
numpixñs
 = 
°©s
->numpixels;

3909 
∑Àâe_ok
, 
gøy_ok
;

3911 
Æpha
 = 
°©s
->alpha;

3912 
key
 = 
°©s
->key;

3913 
bôs
 = 
°©s
->bits;

3915 
mode_out
->
key_deföed
 = 0;

3917 if(
key
 && 
numpixñs
 <= 16) {

3918 
Æpha
 = 1;

3919 
key
 = 0;

3920 if(
bôs
 < 8) bits = 8;

3923 
gøy_ok
 = !
°©s
->
cﬁ‹ed
;

3924 if(!
°©s
->
Ælow_gªysˇÀ
Ë
gøy_ok
 = 0;

3925 if(!
gøy_ok
 && 
bôs
 < 8) bits = 8;

3927 
n
 = 
°©s
->
numcﬁ‹s
;

3928 
∑Àâebôs
 = 
n
 <= 2 ? 1 : (n <= 4 ? 2 : (n <= 16 ? 4 : 8));

3929 
∑Àâe_ok
 = 
n
 <256 && 
bôs
 <= 8 &&Ç != 0;

3930 if(
numpixñs
 < 
n
 * 2Ë
∑Àâe_ok
 = 0;

3931 if(
gøy_ok
 && !
Æpha
 && 
bôs
 <
∑Àâebôs
Ë
∑Àâe_ok
 = 0;

3932 if(!
°©s
->
Ælow_∑Àâe
Ë
∑Àâe_ok
 = 0;

3934 if(
∑Àâe_ok
) {

3935 c⁄° * 
p
 = 
°©s
->
∑Àâe
;

3936 
	`lodïng_∑Àâe_˛ór
(
mode_out
);

3937 
i
 = 0; i !
°©s
->
numcﬁ‹s
; ++i) {

3938 
îr‹
 = 
	`lodïng_∑Àâe_add
(
mode_out
, 
p
[
i
 * 4 + 0],Ö[i * 4 + 1],Ö[i * 4 + 2],Ö[i * 4 + 3]);

3939 if(
îr‹
) ;

3942 
mode_out
->
cﬁ‹ty≥
 = 
LCT_PALETTE
;

3943 
mode_out
->
bôdïth
 = 
∑Àâebôs
;

3945 if(
mode_ö
->
cﬁ‹ty≥
 =
LCT_PALETTE
 && mode_ö->
∑Àâesize
 >
mode_out
->palettesize

3946 && 
mode_ö
->
bôdïth
 =
mode_out
->bitdepth) {

3948 
	`lodïng_cﬁ‹_mode_˛ónup
(
mode_out
);

3949 
	`lodïng_cﬁ‹_mode_c›y
(
mode_out
, 
mode_ö
);

3952 
mode_out
->
bôdïth
 = 
bôs
;

3953 
mode_out
->
cﬁ‹ty≥
 = 
Æpha
 ? (
gøy_ok
 ? 
LCT_GREY_ALPHA
 : 
LCT_RGBA
)

3954 : (
gøy_ok
 ? 
LCT_GREY
 : 
LCT_RGB
);

3955 if(
key
) {

3956 
mask
 = (1u << 
mode_out
->
bôdïth
) - 1u;

3957 
mode_out
->
key_r
 = 
°©s
->key_∏& 
mask
;

3958 
mode_out
->
key_g
 = 
°©s
->key_g & 
mask
;

3959 
mode_out
->
key_b
 = 
°©s
->key_b & 
mask
;

3960 
mode_out
->
key_deföed
 = 1;

3964  
îr‹
;

3965 
	}
}

3974 
	$∑ëhPªdi˘‹
(
a
, 
b
, 
c
) {

3975 
∑
 = 
	`LODEPNG_ABS
(
b
 - 
c
);

3976 
pb
 = 
	`LODEPNG_ABS
(
a
 - 
c
);

3977 
pc
 = 
	`LODEPNG_ABS
(
a
 + 
b
 - 
c
 - c);

3979 if(
pb
 < 
∑
Ë{ 
a
 = 
b
;Öa =Öb; }

3980  (
pc
 < 
∑
Ë? 
c
 : 
a
;

3981 
	}
}

3985 c⁄° 
	gADAM7_IX
[7] = { 0, 4, 0, 2, 0, 1, 0 };

3986 c⁄° 
	gADAM7_IY
[7] = { 0, 0, 4, 0, 2, 0, 1 };

3987 c⁄° 
	gADAM7_DX
[7] = { 8, 8, 4, 4, 2, 2, 1 };

3988 c⁄° 
	gADAM7_DY
[7] = { 8, 8, 8, 4, 4, 2, 2 };

4005 
	$Adam7_gë∑ssvÆues
(
∑ssw
[7], 
∑ssh
[7], 
size_t
 
fûãr_∑ss°¨t
[8],

4006 
size_t
 
∑dded_∑ss°¨t
[8], size_à
∑ss°¨t
[8], 
w
, 
h
, 
bµ
) {

4008 
i
;

4011 
i
 = 0; i != 7; ++i) {

4012 
∑ssw
[
i
] = (
w
 + 
ADAM7_DX
[i] - 
ADAM7_IX
[i] - 1) / ADAM7_DX[i];

4013 
∑ssh
[
i
] = (
h
 + 
ADAM7_DY
[i] - 
ADAM7_IY
[i] - 1) / ADAM7_DY[i];

4014 if(
∑ssw
[
i
] =0Ë
∑ssh
[i] = 0;

4015 if(
∑ssh
[
i
] =0Ë
∑ssw
[i] = 0;

4018 
fûãr_∑ss°¨t
[0] = 
∑dded_∑ss°¨t
[0] = 
∑ss°¨t
[0] = 0;

4019 
i
 = 0; i != 7; ++i) {

4021 
fûãr_∑ss°¨t
[
i
 + 1] = filter_passstart[i]

4022 + ((
∑ssw
[
i
] && 
∑ssh
[i]Ë?Öassh[i] * (1u + (∑ssw[i] * 
bµ
 + 7u) / 8u) : 0);

4024 
∑dded_∑ss°¨t
[
i
 + 1] =Öadded_∑ss°¨t[i] + 
∑ssh
[i] * ((
∑ssw
[i] * 
bµ
 + 7u) / 8u);

4026 
∑ss°¨t
[
i
 + 1] =Öass°¨t[i] + (
∑ssh
[i] * 
∑ssw
[i] * 
bµ
 + 7u) / 8u;

4028 
	}
}

4030 #ifde‡
LODEPNG_COMPILE_DECODER


4037 
	$lodïng_ö•e˘
(* 
w
, * 
h
, 
LodePNGSèã
* 
°©e
,

4038 c⁄° * 
ö
, 
size_t
 
ösize
) {

4039 
width
, 
height
;

4040 
LodePNGInfo
* 
öfo
 = &
°©e
->
öfo_≤g
;

4041 if(
ösize
 =0 || 
ö
 == 0) {

4042 
	`CERROR_RETURN_ERROR
(
°©e
->
îr‹
, 48);

4044 if(
ösize
 < 33) {

4045 
	`CERROR_RETURN_ERROR
(
°©e
->
îr‹
, 27);

4050 
	`lodïng_öfo_˛ónup
(
öfo
);

4051 
	`lodïng_öfo_öô
(
öfo
);

4053 if(
ö
[0] != 137 || in[1] != 80 || in[2] != 78 || in[3] != 71

4054 || 
ö
[4] != 13 || in[5] != 10 || in[6] != 26 || in[7] != 10) {

4055 
	`CERROR_RETURN_ERROR
(
°©e
->
îr‹
, 28);

4057 if(
	`lodïng_chunk_Àngth
(
ö
 + 8) != 13) {

4058 
	`CERROR_RETURN_ERROR
(
°©e
->
îr‹
, 94);

4060 if(!
	`lodïng_chunk_ty≥_equÆs
(
ö
 + 8, "IHDR")) {

4061 
	`CERROR_RETURN_ERROR
(
°©e
->
îr‹
, 29);

4065 
width
 = 
	`lodïng_ªad32bôI¡
(&
ö
[16]);

4066 
height
 = 
	`lodïng_ªad32bôI¡
(&
ö
[20]);

4068 if(
w
Ë*w = 
width
;

4069 if(
h
Ë*h = 
height
;

4070 
öfo
->
cﬁ‹
.
bôdïth
 = 
ö
[24];

4071 
öfo
->
cﬁ‹
.
cﬁ‹ty≥
 = (
LodePNGCﬁ‹Ty≥
)
ö
[25];

4072 
öfo
->
com¥essi⁄_mëhod
 = 
ö
[26];

4073 
öfo
->
fûãr_mëhod
 = 
ö
[27];

4074 
öfo
->
öãæa˚_mëhod
 = 
ö
[28];

4079 if(
width
 =0 || 
height
 =0Ë
	`CERROR_RETURN_ERROR
(
°©e
->
îr‹
, 93);

4081 
°©e
->
îr‹
 = 
	`checkCﬁ‹VÆidôy
(
öfo
->
cﬁ‹
.
cﬁ‹ty≥
, info->cﬁ‹.
bôdïth
);

4082 if(
°©e
->
îr‹
)  state->error;

4084 if(
öfo
->
com¥essi⁄_mëhod
 !0Ë
	`CERROR_RETURN_ERROR
(
°©e
->
îr‹
, 32);

4086 if(
öfo
->
fûãr_mëhod
 !0Ë
	`CERROR_RETURN_ERROR
(
°©e
->
îr‹
, 33);

4088 if(
öfo
->
öãæa˚_mëhod
 > 1Ë
	`CERROR_RETURN_ERROR
(
°©e
->
îr‹
, 34);

4090 if(!
°©e
->
decodî
.
ign‹e_¸c
) {

4091 
CRC
 = 
	`lodïng_ªad32bôI¡
(&
ö
[29]);

4092 
checksum
 = 
	`lodïng_¸c32
(&
ö
[12], 17);

4093 if(
CRC
 !
checksum
) {

4094 
	`CERROR_RETURN_ERROR
(
°©e
->
îr‹
, 57);

4098  
°©e
->
îr‹
;

4099 
	}
}

4101 
	$unfûãrSˇ∆öe
(* 
ªc⁄
, c⁄° * 
sˇ∆öe
, c⁄° * 
¥ec⁄
,

4102 
size_t
 
byãwidth
, 
fûãrTy≥
, size_à
Àngth
) {

4112 
size_t
 
i
;

4113 
fûãrTy≥
) {

4115 
i
 = 0; i !
Àngth
; ++iË
ªc⁄
[i] = 
sˇ∆öe
[i];

4118 
size_t
 
j
 = 0;

4119 
i
 = 0; i !
byãwidth
; ++iË
ªc⁄
[i] = 
sˇ∆öe
[i];

4120 
i
 = 
byãwidth
; i !
Àngth
; ++i, ++
j
Ë
ªc⁄
[i] = 
sˇ∆öe
[i] +Ñecon[j];

4124 if(
¥ec⁄
) {

4125 
i
 = 0; i !
Àngth
; ++iË
ªc⁄
[i] = 
sˇ∆öe
[i] + 
¥ec⁄
[i];

4127 
i
 = 0; i !
Àngth
; ++iË
ªc⁄
[i] = 
sˇ∆öe
[i];

4131 if(
¥ec⁄
) {

4132 
size_t
 
j
 = 0;

4133 
i
 = 0; i !
byãwidth
; ++iË
ªc⁄
[i] = 
sˇ∆öe
[i] + (
¥ec⁄
[i] >> 1u);

4136 if(
byãwidth
 >= 4) {

4137 ; 
i
 + 3 < 
Àngth
; i +4, 
j
 += 4) {

4138 
s0
 = 
sˇ∆öe
[
i
 + 0], 
r0
 = 
ªc⁄
[
j
 + 0], 
p0
 = 
¥ec⁄
[i + 0];

4139 
s1
 = 
sˇ∆öe
[
i
 + 1], 
r1
 = 
ªc⁄
[
j
 + 1], 
p1
 = 
¥ec⁄
[i + 1];

4140 
s2
 = 
sˇ∆öe
[
i
 + 2], 
r2
 = 
ªc⁄
[
j
 + 2], 
p2
 = 
¥ec⁄
[i + 2];

4141 
s3
 = 
sˇ∆öe
[
i
 + 3], 
r3
 = 
ªc⁄
[
j
 + 3], 
p3
 = 
¥ec⁄
[i + 3];

4142 
ªc⁄
[
i
 + 0] = 
s0
 + ((
r0
 + 
p0
) >> 1u);

4143 
ªc⁄
[
i
 + 1] = 
s1
 + ((
r1
 + 
p1
) >> 1u);

4144 
ªc⁄
[
i
 + 2] = 
s2
 + ((
r2
 + 
p2
) >> 1u);

4145 
ªc⁄
[
i
 + 3] = 
s3
 + ((
r3
 + 
p3
) >> 1u);

4147 } if(
byãwidth
 >= 3) {

4148 ; 
i
 + 2 < 
Àngth
; i +3, 
j
 += 3) {

4149 
s0
 = 
sˇ∆öe
[
i
 + 0], 
r0
 = 
ªc⁄
[
j
 + 0], 
p0
 = 
¥ec⁄
[i + 0];

4150 
s1
 = 
sˇ∆öe
[
i
 + 1], 
r1
 = 
ªc⁄
[
j
 + 1], 
p1
 = 
¥ec⁄
[i + 1];

4151 
s2
 = 
sˇ∆öe
[
i
 + 2], 
r2
 = 
ªc⁄
[
j
 + 2], 
p2
 = 
¥ec⁄
[i + 2];

4152 
ªc⁄
[
i
 + 0] = 
s0
 + ((
r0
 + 
p0
) >> 1u);

4153 
ªc⁄
[
i
 + 1] = 
s1
 + ((
r1
 + 
p1
) >> 1u);

4154 
ªc⁄
[
i
 + 2] = 
s2
 + ((
r2
 + 
p2
) >> 1u);

4156 } if(
byãwidth
 >= 2) {

4157 ; 
i
 + 1 < 
Àngth
; i +2, 
j
 += 2) {

4158 
s0
 = 
sˇ∆öe
[
i
 + 0], 
r0
 = 
ªc⁄
[
j
 + 0], 
p0
 = 
¥ec⁄
[i + 0];

4159 
s1
 = 
sˇ∆öe
[
i
 + 1], 
r1
 = 
ªc⁄
[
j
 + 1], 
p1
 = 
¥ec⁄
[i + 1];

4160 
ªc⁄
[
i
 + 0] = 
s0
 + ((
r0
 + 
p0
) >> 1u);

4161 
ªc⁄
[
i
 + 1] = 
s1
 + ((
r1
 + 
p1
) >> 1u);

4164 ; 
i
 !
Àngth
; ++i, ++
j
Ë
ªc⁄
[i] = 
sˇ∆öe
[i] + (‘ec⁄[j] + 
¥ec⁄
[i]) >> 1u);

4166 
size_t
 
j
 = 0;

4167 
i
 = 0; i !
byãwidth
; ++iË
ªc⁄
[i] = 
sˇ∆öe
[i];

4168 
i
 = 
byãwidth
; i !
Àngth
; ++i, ++
j
Ë
ªc⁄
[i] = 
sˇ∆öe
[i] + (recon[j] >> 1u);

4172 if(
¥ec⁄
) {

4173 
size_t
 
j
 = 0;

4174 
i
 = 0; i !
byãwidth
; ++i) {

4175 
ªc⁄
[
i
] = (
sˇ∆öe
[i] + 
¥ec⁄
[i]);

4180 if(
byãwidth
 >= 4) {

4181 ; 
i
 + 3 < 
Àngth
; i +4, 
j
 += 4) {

4182 
s0
 = 
sˇ∆öe
[
i
 + 0], 
s1
 = sˇ∆öe[ò+ 1], 
s2
 = sˇ∆öe[ò+ 2], 
s3
 = scanline[i + 3];

4183 
r0
 = 
ªc⁄
[
j
 + 0], 
r1
 =Ñec⁄[j + 1], 
r2
 =Ñec⁄[j + 2], 
r3
 =Ñecon[j + 3];

4184 
p0
 = 
¥ec⁄
[
i
 + 0], 
p1
 =Öªc⁄[ò+ 1], 
p2
 =Öªc⁄[ò+ 2], 
p3
 =Örecon[i + 3];

4185 
q0
 = 
¥ec⁄
[
j
 + 0], 
q1
 =Öªc⁄[j + 1], 
q2
 =Öªc⁄[j + 2], 
q3
 =Örecon[j + 3];

4186 
ªc⁄
[
i
 + 0] = 
s0
 + 
	`∑ëhPªdi˘‹
(
r0
, 
p0
, 
q0
);

4187 
ªc⁄
[
i
 + 1] = 
s1
 + 
	`∑ëhPªdi˘‹
(
r1
, 
p1
, 
q1
);

4188 
ªc⁄
[
i
 + 2] = 
s2
 + 
	`∑ëhPªdi˘‹
(
r2
, 
p2
, 
q2
);

4189 
ªc⁄
[
i
 + 3] = 
s3
 + 
	`∑ëhPªdi˘‹
(
r3
, 
p3
, 
q3
);

4191 } if(
byãwidth
 >= 3) {

4192 ; 
i
 + 2 < 
Àngth
; i +3, 
j
 += 3) {

4193 
s0
 = 
sˇ∆öe
[
i
 + 0], 
s1
 = sˇ∆öe[ò+ 1], 
s2
 = scanline[i + 2];

4194 
r0
 = 
ªc⁄
[
j
 + 0], 
r1
 =Ñec⁄[j + 1], 
r2
 =Ñecon[j + 2];

4195 
p0
 = 
¥ec⁄
[
i
 + 0], 
p1
 =Öªc⁄[ò+ 1], 
p2
 =Örecon[i + 2];

4196 
q0
 = 
¥ec⁄
[
j
 + 0], 
q1
 =Öªc⁄[j + 1], 
q2
 =Örecon[j + 2];

4197 
ªc⁄
[
i
 + 0] = 
s0
 + 
	`∑ëhPªdi˘‹
(
r0
, 
p0
, 
q0
);

4198 
ªc⁄
[
i
 + 1] = 
s1
 + 
	`∑ëhPªdi˘‹
(
r1
, 
p1
, 
q1
);

4199 
ªc⁄
[
i
 + 2] = 
s2
 + 
	`∑ëhPªdi˘‹
(
r2
, 
p2
, 
q2
);

4201 } if(
byãwidth
 >= 2) {

4202 ; 
i
 + 1 < 
Àngth
; i +2, 
j
 += 2) {

4203 
s0
 = 
sˇ∆öe
[
i
 + 0], 
s1
 = scanline[i + 1];

4204 
r0
 = 
ªc⁄
[
j
 + 0], 
r1
 =Ñecon[j + 1];

4205 
p0
 = 
¥ec⁄
[
i
 + 0], 
p1
 =Örecon[i + 1];

4206 
q0
 = 
¥ec⁄
[
j
 + 0], 
q1
 =Örecon[j + 1];

4207 
ªc⁄
[
i
 + 0] = 
s0
 + 
	`∑ëhPªdi˘‹
(
r0
, 
p0
, 
q0
);

4208 
ªc⁄
[
i
 + 1] = 
s1
 + 
	`∑ëhPªdi˘‹
(
r1
, 
p1
, 
q1
);

4212 ; 
i
 !
Àngth
; ++i, ++
j
) {

4213 
ªc⁄
[
i
] = (
sˇ∆öe
[i] + 
	`∑ëhPªdi˘‹
‘ec⁄[ò- 
byãwidth
], 
¥ec⁄
[i],Öªc⁄[
j
]));

4216 
size_t
 
j
 = 0;

4217 
i
 = 0; i !
byãwidth
; ++i) {

4218 
ªc⁄
[
i
] = 
sˇ∆öe
[i];

4220 
i
 = 
byãwidth
; i !
Àngth
; ++i, ++
j
) {

4222 
ªc⁄
[
i
] = (
sˇ∆öe
[i] +Ñec⁄[
j
]);

4229 
	}
}

4231 
	$unfûãr
(* 
out
, c⁄° * 
ö
, 
w
, 
h
, 
bµ
) {

4240 
y
;

4241 * 
¥evlöe
 = 0;

4244 
size_t
 
byãwidth
 = (
bµ
 + 7u) / 8u;

4246 
size_t
 
löebyãs
 = 
	`lodïng_gë_øw_size_id©
(
w
, 1, 
bµ
) - 1u;

4248 
y
 = 0; y < 
h
; ++y) {

4249 
size_t
 
outödex
 = 
löebyãs
 * 
y
;

4250 
size_t
 
öödex
 = (1 + 
löebyãs
Ë* 
y
;

4251 
fûãrTy≥
 = 
ö
[
öödex
];

4253 
	`CERROR_TRY_RETURN
(
	`unfûãrSˇ∆öe
(&
out
[
outödex
], &
ö
[
öödex
 + 1], 
¥evlöe
, 
byãwidth
, 
fûãrTy≥
, 
löebyãs
));

4255 
¥evlöe
 = &
out
[
outödex
];

4259 
	}
}

4272 
	$Adam7_deöãæa˚
(* 
out
, c⁄° * 
ö
, 
w
, 
h
, 
bµ
) {

4273 
∑ssw
[7], 
∑ssh
[7];

4274 
size_t
 
fûãr_∑ss°¨t
[8], 
∑dded_∑ss°¨t
[8], 
∑ss°¨t
[8];

4275 
i
;

4277 
	`Adam7_gë∑ssvÆues
(
∑ssw
, 
∑ssh
, 
fûãr_∑ss°¨t
, 
∑dded_∑ss°¨t
, 
∑ss°¨t
, 
w
, 
h
, 
bµ
);

4279 if(
bµ
 >= 8) {

4280 
i
 = 0; i != 7; ++i) {

4281 
x
, 
y
, 
b
;

4282 
size_t
 
byãwidth
 = 
bµ
 / 8u;

4283 
y
 = 0; y < 
∑ssh
[
i
]; ++y)

4284 
x
 = 0; x < 
∑ssw
[
i
]; ++x) {

4285 
size_t
 
pixñö°¨t
 = 
∑ss°¨t
[
i
] + (
y
 * 
∑ssw
[i] + 
x
Ë* 
byãwidth
;

4286 
size_t
 
pixñout°¨t
 = ((
ADAM7_IY
[
i
] + (size_t)
y
 * 
ADAM7_DY
[i]Ë* (size_t)
w


4287 + 
ADAM7_IX
[
i
] + (
size_t
)
x
 * 
ADAM7_DX
[i]Ë* 
byãwidth
;

4288 
b
 = 0; b < 
byãwidth
; ++b) {

4289 
out
[
pixñout°¨t
 + 
b
] = 
ö
[
pixñö°¨t
 + b];

4294 
i
 = 0; i != 7; ++i) {

4295 
x
, 
y
, 
b
;

4296 
ûöebôs
 = 
bµ
 * 
∑ssw
[
i
];

4297 
ﬁöebôs
 = 
bµ
 * 
w
;

4298 
size_t
 
obp
, 
ibp
;

4299 
y
 = 0; y < 
∑ssh
[
i
]; ++y)

4300 
x
 = 0; x < 
∑ssw
[
i
]; ++x) {

4301 
ibp
 = (8 * 
∑ss°¨t
[
i
]Ë+ (
y
 * 
ûöebôs
 + 
x
 * 
bµ
);

4302 
obp
 = (
ADAM7_IY
[
i
] + (
size_t
)
y
 * 
ADAM7_DY
[i]Ë* 
ﬁöebôs
 + (
ADAM7_IX
[i] + (size_t)
x
 * 
ADAM7_DX
[i]Ë* 
bµ
;

4303 
b
 = 0; b < 
bµ
; ++b) {

4304 
bô
 = 
	`ªadBôFromRevî£dSåóm
(&
ibp
, 
ö
);

4305 
	`£tBôOfRevî£dSåóm
(&
obp
, 
out
, 
bô
);

4310 
	}
}

4312 
	$ªmovePaddögBôs
(* 
out
, c⁄° * 
ö
,

4313 
size_t
 
ﬁöebôs
, size_à
ûöebôs
, 
h
) {

4323 
y
;

4324 
size_t
 
diff
 = 
ûöebôs
 - 
ﬁöebôs
;

4325 
size_t
 
ibp
 = 0, 
obp
 = 0;

4326 
y
 = 0; y < 
h
; ++y) {

4327 
size_t
 
x
;

4328 
x
 = 0; x < 
ﬁöebôs
; ++x) {

4329 
bô
 = 
	`ªadBôFromRevî£dSåóm
(&
ibp
, 
ö
);

4330 
	`£tBôOfRevî£dSåóm
(&
obp
, 
out
, 
bô
);

4332 
ibp
 +
diff
;

4334 
	}
}

4339 
	$po°Pro˚ssSˇ∆öes
(* 
out
, * 
ö
,

4340 
w
, 
h
, c⁄° 
LodePNGInfo
* 
öfo_≤g
) {

4348 
bµ
 = 
	`lodïng_gë_bµ
(&
öfo_≤g
->
cﬁ‹
);

4349 if(
bµ
 == 0)  31;

4351 if(
öfo_≤g
->
öãæa˚_mëhod
 == 0) {

4352 if(
bµ
 < 8 && 
w
 * bpp != ((w * bpp + 7u) / 8u) * 8u) {

4353 
	`CERROR_TRY_RETURN
(
	`unfûãr
(
ö
, in, 
w
, 
h
, 
bµ
));

4354 
	`ªmovePaddögBôs
(
out
, 
ö
, 
w
 * 
bµ
, ((w * bµ + 7uË/ 8uË* 8u, 
h
);

4357 
	`CERROR_TRY_RETURN
(
	`unfûãr
(
out
, 
ö
, 
w
, 
h
, 
bµ
));

4359 
∑ssw
[7], 
∑ssh
[7]; 
size_t
 
fûãr_∑ss°¨t
[8], 
∑dded_∑ss°¨t
[8], 
∑ss°¨t
[8];

4360 
i
;

4362 
	`Adam7_gë∑ssvÆues
(
∑ssw
, 
∑ssh
, 
fûãr_∑ss°¨t
, 
∑dded_∑ss°¨t
, 
∑ss°¨t
, 
w
, 
h
, 
bµ
);

4364 
i
 = 0; i != 7; ++i) {

4365 
	`CERROR_TRY_RETURN
(
	`unfûãr
(&
ö
[
∑dded_∑ss°¨t
[
i
]], &ö[
fûãr_∑ss°¨t
[i]], 
∑ssw
[i], 
∑ssh
[i], 
bµ
));

4368 if(
bµ
 < 8) {

4371 
	`ªmovePaddögBôs
(&
ö
[
∑ss°¨t
[
i
]], &ö[
∑dded_∑ss°¨t
[i]], 
∑ssw
[i] * 
bµ
,

4372 ((
∑ssw
[
i
] * 
bµ
 + 7uË/ 8uË* 8u, 
∑ssh
[i]);

4376 
	`Adam7_deöãæa˚
(
out
, 
ö
, 
w
, 
h
, 
bµ
);

4380 
	}
}

4382 
	$ªadChunk_PLTE
(
LodePNGCﬁ‹Mode
* 
cﬁ‹
, c⁄° * 
d©a
, 
size_t
 
chunkLígth
) {

4383 
pos
 = 0, 
i
;

4384 
cﬁ‹
->
∑Àâesize
 = 
chunkLígth
 / 3u;

4385 if(
cﬁ‹
->
∑Àâesize
 == 0 || color->palettesize > 256)  38;

4386 
	`lodïng_cﬁ‹_mode_Æloc_∑Àâe
(
cﬁ‹
);

4387 if(!
cﬁ‹
->
∑Àâe
 && cﬁ‹->
∑Àâesize
) {

4388 
cﬁ‹
->
∑Àâesize
 = 0;

4392 
i
 = 0; i !
cﬁ‹
->
∑Àâesize
; ++i) {

4393 
cﬁ‹
->
∑Àâe
[4 * 
i
 + 0] = 
d©a
[
pos
++];

4394 
cﬁ‹
->
∑Àâe
[4 * 
i
 + 1] = 
d©a
[
pos
++];

4395 
cﬁ‹
->
∑Àâe
[4 * 
i
 + 2] = 
d©a
[
pos
++];

4396 
cﬁ‹
->
∑Àâe
[4 * 
i
 + 3] = 255;

4400 
	}
}

4402 
	$ªadChunk_tRNS
(
LodePNGCﬁ‹Mode
* 
cﬁ‹
, c⁄° * 
d©a
, 
size_t
 
chunkLígth
) {

4403 
i
;

4404 if(
cﬁ‹
->
cﬁ‹ty≥
 =
LCT_PALETTE
) {

4406 if(
chunkLígth
 > 
cﬁ‹
->
∑Àâesize
)  39;

4408 
i
 = 0; i !
chunkLígth
; ++iË
cﬁ‹
->
∑Àâe
[4 * i + 3] = 
d©a
[i];

4409 } if(
cﬁ‹
->
cﬁ‹ty≥
 =
LCT_GREY
) {

4411 if(
chunkLígth
 != 2)  30;

4413 
cﬁ‹
->
key_deföed
 = 1;

4414 
cﬁ‹
->
key_r
 = cﬁ‹->
key_g
 = cﬁ‹->
key_b
 = 256u * 
d©a
[0] + data[1];

4415 } if(
cﬁ‹
->
cﬁ‹ty≥
 =
LCT_RGB
) {

4417 if(
chunkLígth
 != 6)  41;

4419 
cﬁ‹
->
key_deföed
 = 1;

4420 
cﬁ‹
->
key_r
 = 256u * 
d©a
[0] + data[1];

4421 
cﬁ‹
->
key_g
 = 256u * 
d©a
[2] + data[3];

4422 
cﬁ‹
->
key_b
 = 256u * 
d©a
[4] + data[5];

4427 
	}
}

4430 #ifde‡
LODEPNG_COMPILE_ANCILLARY_CHUNKS


4432 
	$ªadChunk_bKGD
(
LodePNGInfo
* 
öfo
, c⁄° * 
d©a
, 
size_t
 
chunkLígth
) {

4433 if(
öfo
->
cﬁ‹
.
cﬁ‹ty≥
 =
LCT_PALETTE
) {

4435 if(
chunkLígth
 != 1)  43;

4438 if(
d©a
[0] >
öfo
->
cﬁ‹
.
∑Àâesize
)  103;

4440 
öfo
->
background_deföed
 = 1;

4441 
öfo
->
background_r
 = info->
background_g
 = info->
background_b
 = 
d©a
[0];

4442 } if(
öfo
->
cﬁ‹
.
cﬁ‹ty≥
 =
LCT_GREY
 || info->cﬁ‹.cﬁ‹ty≥ =
LCT_GREY_ALPHA
) {

4444 if(
chunkLígth
 != 2)  44;

4447 
öfo
->
background_deföed
 = 1;

4448 
öfo
->
background_r
 = info->
background_g
 = info->
background_b
 = 256u * 
d©a
[0] + data[1];

4449 } if(
öfo
->
cﬁ‹
.
cﬁ‹ty≥
 =
LCT_RGB
 || info->cﬁ‹.cﬁ‹ty≥ =
LCT_RGBA
) {

4451 if(
chunkLígth
 != 6)  45;

4454 
öfo
->
background_deföed
 = 1;

4455 
öfo
->
background_r
 = 256u * 
d©a
[0] + data[1];

4456 
öfo
->
background_g
 = 256u * 
d©a
[2] + data[3];

4457 
öfo
->
background_b
 = 256u * 
d©a
[4] + data[5];

4461 
	}
}

4464 
	$ªadChunk_tEXt
(
LodePNGInfo
* 
öfo
, c⁄° * 
d©a
, 
size_t
 
chunkLígth
) {

4465 
îr‹
 = 0;

4466 *
key
 = 0, *
°r
 = 0;

4468 !
îr‹
) {

4469 
Àngth
, 
°rög2_begö
;

4471 
Àngth
 = 0;

4472 
Àngth
 < 
chunkLígth
 && 
d©a
[length] != 0) ++length;

4475 if(
Àngth
 < 1 ||Üígth > 79Ë
	`CERROR_BREAK
(
îr‹
, 89);

4477 
key
 = (*)
	`lodïng_mÆloc
(
Àngth
 + 1);

4478 if(!
key
Ë
	`CERROR_BREAK
(
îr‹
, 83);

4480 
	`lodïng_mem˝y
(
key
, 
d©a
, 
Àngth
);

4481 
key
[
Àngth
] = 0;

4483 
°rög2_begö
 = 
Àngth
 + 1;

4485 
Àngth
 = ()(
chunkLígth
 < 
°rög2_begö
 ? 0 : chunkLength - string2_begin);

4486 
°r
 = (*)
	`lodïng_mÆloc
(
Àngth
 + 1);

4487 if(!
°r
Ë
	`CERROR_BREAK
(
îr‹
, 83);

4489 
	`lodïng_mem˝y
(
°r
, 
d©a
 + 
°rög2_begö
, 
Àngth
);

4490 
°r
[
Àngth
] = 0;

4492 
îr‹
 = 
	`lodïng_add_ãxt
(
öfo
, 
key
, 
°r
);

4497 
	`lodïng_‰ì
(
key
);

4498 
	`lodïng_‰ì
(
°r
);

4500  
îr‹
;

4501 
	}
}

4504 
	$ªadChunk_zTXt
(
LodePNGInfo
* 
öfo
, c⁄° 
LodePNGDecodîSëtögs
* 
decodî
,

4505 c⁄° * 
d©a
, 
size_t
 
chunkLígth
) {

4506 
îr‹
 = 0;

4509 
LodePNGDecom¥essSëtögs
 
zlib£âögs
 = 
decodî
->zlibsettings;

4511 
Àngth
, 
°rög2_begö
;

4512 *
key
 = 0;

4513 * 
°r
 = 0;

4514 
size_t
 
size
 = 0;

4516 !
îr‹
) {

4517 
Àngth
 = 0;Üígth < 
chunkLígth
 && 
d©a
[length] != 0; ++length) ;

4518 if(
Àngth
 + 2 >
chunkLígth
Ë
	`CERROR_BREAK
(
îr‹
, 75);

4519 if(
Àngth
 < 1 ||Üígth > 79Ë
	`CERROR_BREAK
(
îr‹
, 89);

4521 
key
 = (*)
	`lodïng_mÆloc
(
Àngth
 + 1);

4522 if(!
key
Ë
	`CERROR_BREAK
(
îr‹
, 83);

4524 
	`lodïng_mem˝y
(
key
, 
d©a
, 
Àngth
);

4525 
key
[
Àngth
] = 0;

4527 if(
d©a
[
Àngth
 + 1] !0Ë
	`CERROR_BREAK
(
îr‹
, 72);

4529 
°rög2_begö
 = 
Àngth
 + 2;

4530 if(
°rög2_begö
 > 
chunkLígth
Ë
	`CERROR_BREAK
(
îr‹
, 75);

4532 
Àngth
 = ()
chunkLígth
 - 
°rög2_begö
;

4533 
zlib£âögs
.
max_ouçut_size
 = 
decodî
->
max_ãxt_size
;

4535 
îr‹
 = 
	`zlib_decom¥ess
(&
°r
, &
size
, 0, &
d©a
[
°rög2_begö
],

4536 
Àngth
, &
zlib£âögs
);

4538 if(
îr‹
 && 
size
 > 
zlib£âögs
.
max_ouçut_size
)Érror = 112;

4539 if(
îr‹
) ;

4540 
îr‹
 = 
	`lodïng_add_ãxt_sized
(
öfo
, 
key
, (*)
°r
, 
size
);

4544 
	`lodïng_‰ì
(
key
);

4545 
	`lodïng_‰ì
(
°r
);

4547  
îr‹
;

4548 
	}
}

4551 
	$ªadChunk_iTXt
(
LodePNGInfo
* 
öfo
, c⁄° 
LodePNGDecodîSëtögs
* 
decodî
,

4552 c⁄° * 
d©a
, 
size_t
 
chunkLígth
) {

4553 
îr‹
 = 0;

4554 
i
;

4557 
LodePNGDecom¥essSëtögs
 
zlib£âögs
 = 
decodî
->zlibsettings;

4559 
Àngth
, 
begö
, 
com¥es£d
;

4560 *
key
 = 0, *
œngèg
 = 0, *
å™skey
 = 0;

4562 !
îr‹
) {

4565 if(
chunkLígth
 < 5Ë
	`CERROR_BREAK
(
îr‹
, 30);

4568 
Àngth
 = 0;Üígth < 
chunkLígth
 && 
d©a
[length] != 0; ++length) ;

4569 if(
Àngth
 + 3 >
chunkLígth
Ë
	`CERROR_BREAK
(
îr‹
, 75);

4570 if(
Àngth
 < 1 ||Üígth > 79Ë
	`CERROR_BREAK
(
îr‹
, 89);

4572 
key
 = (*)
	`lodïng_mÆloc
(
Àngth
 + 1);

4573 if(!
key
Ë
	`CERROR_BREAK
(
îr‹
, 83);

4575 
	`lodïng_mem˝y
(
key
, 
d©a
, 
Àngth
);

4576 
key
[
Àngth
] = 0;

4579 
com¥es£d
 = 
d©a
[
Àngth
 + 1];

4580 if(
d©a
[
Àngth
 + 2] !0Ë
	`CERROR_BREAK
(
îr‹
, 72);

4586 
begö
 = 
Àngth
 + 3;

4587 
Àngth
 = 0;

4588 
i
 = 
begö
; i < 
chunkLígth
 && 
d©a
[i] !0; ++iË++
Àngth
;

4590 
œngèg
 = (*)
	`lodïng_mÆloc
(
Àngth
 + 1);

4591 if(!
œngèg
Ë
	`CERROR_BREAK
(
îr‹
, 83);

4593 
	`lodïng_mem˝y
(
œngèg
, 
d©a
 + 
begö
, 
Àngth
);

4594 
œngèg
[
Àngth
] = 0;

4597 
begö
 +
Àngth
 + 1;

4598 
Àngth
 = 0;

4599 
i
 = 
begö
; i < 
chunkLígth
 && 
d©a
[i] !0; ++iË++
Àngth
;

4601 
å™skey
 = (*)
	`lodïng_mÆloc
(
Àngth
 + 1);

4602 if(!
å™skey
Ë
	`CERROR_BREAK
(
îr‹
, 83);

4604 
	`lodïng_mem˝y
(
å™skey
, 
d©a
 + 
begö
, 
Àngth
);

4605 
å™skey
[
Àngth
] = 0;

4608 
begö
 +
Àngth
 + 1;

4610 
Àngth
 = ()
chunkLígth
 < 
begö
 ? 0 : ()chunkLength - begin;

4612 if(
com¥es£d
) {

4613 * 
°r
 = 0;

4614 
size_t
 
size
 = 0;

4615 
zlib£âögs
.
max_ouçut_size
 = 
decodî
->
max_ãxt_size
;

4617 
îr‹
 = 
	`zlib_decom¥ess
(&
°r
, &
size
, 0, &
d©a
[
begö
],

4618 
Àngth
, &
zlib£âögs
);

4620 if(
îr‹
 && 
size
 > 
zlib£âögs
.
max_ouçut_size
)Érror = 112;

4621 if(!
îr‹
Ëîr‹ = 
	`lodïng_add_ôext_sized
(
öfo
, 
key
, 
œngèg
, 
å™skey
, (*)
°r
, 
size
);

4622 
	`lodïng_‰ì
(
°r
);

4624 
îr‹
 = 
	`lodïng_add_ôext_sized
(
öfo
, 
key
, 
œngèg
, 
å™skey
, (*)(
d©a
 + 
begö
), 
Àngth
);

4630 
	`lodïng_‰ì
(
key
);

4631 
	`lodïng_‰ì
(
œngèg
);

4632 
	`lodïng_‰ì
(
å™skey
);

4634  
îr‹
;

4635 
	}
}

4637 
	$ªadChunk_tIME
(
LodePNGInfo
* 
öfo
, c⁄° * 
d©a
, 
size_t
 
chunkLígth
) {

4638 if(
chunkLígth
 != 7)  73;

4640 
öfo
->
time_deföed
 = 1;

4641 
öfo
->
time
.
yór
 = 256u * 
d©a
[0] + data[1];

4642 
öfo
->
time
.
m⁄th
 = 
d©a
[2];

4643 
öfo
->
time
.
day
 = 
d©a
[3];

4644 
öfo
->
time
.
hour
 = 
d©a
[4];

4645 
öfo
->
time
.
möuã
 = 
d©a
[5];

4646 
öfo
->
time
.
£c⁄d
 = 
d©a
[6];

4649 
	}
}

4651 
	$ªadChunk_pHYs
(
LodePNGInfo
* 
öfo
, c⁄° * 
d©a
, 
size_t
 
chunkLígth
) {

4652 if(
chunkLígth
 != 9)  74;

4654 
öfo
->
phys_deföed
 = 1;

4655 
öfo
->
phys_x
 = 16777216u * 
d©a
[0] + 65536u * data[1] + 256u * data[2] + data[3];

4656 
öfo
->
phys_y
 = 16777216u * 
d©a
[4] + 65536u * data[5] + 256u * data[6] + data[7];

4657 
öfo
->
phys_unô
 = 
d©a
[8];

4660 
	}
}

4662 
	$ªadChunk_gAMA
(
LodePNGInfo
* 
öfo
, c⁄° * 
d©a
, 
size_t
 
chunkLígth
) {

4663 if(
chunkLígth
 != 4)  96;

4665 
öfo
->
gama_deföed
 = 1;

4666 
öfo
->
gama_gamma
 = 16777216u * 
d©a
[0] + 65536u * data[1] + 256u * data[2] + data[3];

4669 
	}
}

4671 
	$ªadChunk_cHRM
(
LodePNGInfo
* 
öfo
, c⁄° * 
d©a
, 
size_t
 
chunkLígth
) {

4672 if(
chunkLígth
 != 32)  97;

4674 
öfo
->
chrm_deföed
 = 1;

4675 
öfo
->
chrm_whôe_x
 = 16777216u * 
d©a
[ 0] + 65536u * data[ 1] + 256u * data[ 2] + data[ 3];

4676 
öfo
->
chrm_whôe_y
 = 16777216u * 
d©a
[ 4] + 65536u * data[ 5] + 256u * data[ 6] + data[ 7];

4677 
öfo
->
chrm_ªd_x
 = 16777216u * 
d©a
[ 8] + 65536u * data[ 9] + 256u * data[10] + data[11];

4678 
öfo
->
chrm_ªd_y
 = 16777216u * 
d©a
[12] + 65536u * data[13] + 256u * data[14] + data[15];

4679 
öfo
->
chrm_gªí_x
 = 16777216u * 
d©a
[16] + 65536u * data[17] + 256u * data[18] + data[19];

4680 
öfo
->
chrm_gªí_y
 = 16777216u * 
d©a
[20] + 65536u * data[21] + 256u * data[22] + data[23];

4681 
öfo
->
chrm_blue_x
 = 16777216u * 
d©a
[24] + 65536u * data[25] + 256u * data[26] + data[27];

4682 
öfo
->
chrm_blue_y
 = 16777216u * 
d©a
[28] + 65536u * data[29] + 256u * data[30] + data[31];

4685 
	}
}

4687 
	$ªadChunk_sRGB
(
LodePNGInfo
* 
öfo
, c⁄° * 
d©a
, 
size_t
 
chunkLígth
) {

4688 if(
chunkLígth
 != 1)  98;

4690 
öfo
->
§gb_deföed
 = 1;

4691 
öfo
->
§gb_öã¡
 = 
d©a
[0];

4694 
	}
}

4696 
	$ªadChunk_iCCP
(
LodePNGInfo
* 
öfo
, c⁄° 
LodePNGDecodîSëtögs
* 
decodî
,

4697 c⁄° * 
d©a
, 
size_t
 
chunkLígth
) {

4698 
îr‹
 = 0;

4699 
i
;

4700 
size_t
 
size
 = 0;

4702 
LodePNGDecom¥essSëtögs
 
zlib£âögs
 = 
decodî
->zlibsettings;

4704 
Àngth
, 
°rög2_begö
;

4706 
öfo
->
ic˝_deföed
 = 1;

4707 if(
öfo
->
ic˝_«me
Ë
	`lodïng_˛ór_icc
(info);

4709 
Àngth
 = 0;Üígth < 
chunkLígth
 && 
d©a
[length] != 0; ++length) ;

4710 if(
Àngth
 + 2 >
chunkLígth
)  75;

4711 if(
Àngth
 < 1 ||Üength > 79)  89;

4713 
öfo
->
ic˝_«me
 = (*)
	`lodïng_mÆloc
(
Àngth
 + 1);

4714 if(!
öfo
->
ic˝_«me
)  83;

4716 
öfo
->
ic˝_«me
[
Àngth
] = 0;

4717 
i
 = 0; i !
Àngth
; ++iË
öfo
->
ic˝_«me
[i] = ()
d©a
[i];

4719 if(
d©a
[
Àngth
 + 1] != 0)  72;

4721 
°rög2_begö
 = 
Àngth
 + 2;

4722 if(
°rög2_begö
 > 
chunkLígth
)  75;

4724 
Àngth
 = ()
chunkLígth
 - 
°rög2_begö
;

4725 
zlib£âögs
.
max_ouçut_size
 = 
decodî
->
max_icc_size
;

4726 
îr‹
 = 
	`zlib_decom¥ess
(&
öfo
->
ic˝_¥ofûe
, &
size
, 0,

4727 &
d©a
[
°rög2_begö
],

4728 
Àngth
, &
zlib£âögs
);

4730 if(
îr‹
 && 
size
 > 
zlib£âögs
.
max_ouçut_size
)Érror = 113;

4731 
öfo
->
ic˝_¥ofûe_size
 = 
size
;

4732 if(!
îr‹
 && !
öfo
->
ic˝_¥ofûe_size
)Érror = 100;

4733  
îr‹
;

4734 
	}
}

4737 
	$lodïng_ö•e˘_chunk
(
LodePNGSèã
* 
°©e
, 
size_t
 
pos
,

4738 c⁄° * 
ö
, 
size_t
 
ösize
) {

4739 c⁄° * 
chunk
 = 
ö
 + 
pos
;

4740 
chunkLígth
;

4741 c⁄° * 
d©a
;

4742 
unh™dÀd
 = 0;

4743 
îr‹
 = 0;

4745 if(
pos
 + 4 > 
ösize
)  30;

4746 
chunkLígth
 = 
	`lodïng_chunk_Àngth
(
chunk
);

4747 if(
chunkLígth
 > 2147483647)  63;

4748 
d©a
 = 
	`lodïng_chunk_d©a_c⁄°
(
chunk
);

4749 if(
d©a
 + 
chunkLígth
 + 4 > 
ö
 + 
ösize
)  30;

4751 if(
	`lodïng_chunk_ty≥_equÆs
(
chunk
, "PLTE")) {

4752 
îr‹
 = 
	`ªadChunk_PLTE
(&
°©e
->
öfo_≤g
.
cﬁ‹
, 
d©a
, 
chunkLígth
);

4753 } if(
	`lodïng_chunk_ty≥_equÆs
(
chunk
, "tRNS")) {

4754 
îr‹
 = 
	`ªadChunk_tRNS
(&
°©e
->
öfo_≤g
.
cﬁ‹
, 
d©a
, 
chunkLígth
);

4755 #ifde‡
LODEPNG_COMPILE_ANCILLARY_CHUNKS


4756 } if(
	`lodïng_chunk_ty≥_equÆs
(
chunk
, "bKGD")) {

4757 
îr‹
 = 
	`ªadChunk_bKGD
(&
°©e
->
öfo_≤g
, 
d©a
, 
chunkLígth
);

4758 } if(
	`lodïng_chunk_ty≥_equÆs
(
chunk
, "tEXt")) {

4759 
îr‹
 = 
	`ªadChunk_tEXt
(&
°©e
->
öfo_≤g
, 
d©a
, 
chunkLígth
);

4760 } if(
	`lodïng_chunk_ty≥_equÆs
(
chunk
, "zTXt")) {

4761 
îr‹
 = 
	`ªadChunk_zTXt
(&
°©e
->
öfo_≤g
, &°©e->
decodî
, 
d©a
, 
chunkLígth
);

4762 } if(
	`lodïng_chunk_ty≥_equÆs
(
chunk
, "iTXt")) {

4763 
îr‹
 = 
	`ªadChunk_iTXt
(&
°©e
->
öfo_≤g
, &°©e->
decodî
, 
d©a
, 
chunkLígth
);

4764 } if(
	`lodïng_chunk_ty≥_equÆs
(
chunk
, "tIME")) {

4765 
îr‹
 = 
	`ªadChunk_tIME
(&
°©e
->
öfo_≤g
, 
d©a
, 
chunkLígth
);

4766 } if(
	`lodïng_chunk_ty≥_equÆs
(
chunk
, "pHYs")) {

4767 
îr‹
 = 
	`ªadChunk_pHYs
(&
°©e
->
öfo_≤g
, 
d©a
, 
chunkLígth
);

4768 } if(
	`lodïng_chunk_ty≥_equÆs
(
chunk
, "gAMA")) {

4769 
îr‹
 = 
	`ªadChunk_gAMA
(&
°©e
->
öfo_≤g
, 
d©a
, 
chunkLígth
);

4770 } if(
	`lodïng_chunk_ty≥_equÆs
(
chunk
, "cHRM")) {

4771 
îr‹
 = 
	`ªadChunk_cHRM
(&
°©e
->
öfo_≤g
, 
d©a
, 
chunkLígth
);

4772 } if(
	`lodïng_chunk_ty≥_equÆs
(
chunk
, "sRGB")) {

4773 
îr‹
 = 
	`ªadChunk_sRGB
(&
°©e
->
öfo_≤g
, 
d©a
, 
chunkLígth
);

4774 } if(
	`lodïng_chunk_ty≥_equÆs
(
chunk
, "iCCP")) {

4775 
îr‹
 = 
	`ªadChunk_iCCP
(&
°©e
->
öfo_≤g
, &°©e->
decodî
, 
d©a
, 
chunkLígth
);

4779 
unh™dÀd
 = 1;

4782 if(!
îr‹
 && !
unh™dÀd
 && !
°©e
->
decodî
.
ign‹e_¸c
) {

4783 if(
	`lodïng_chunk_check_¸c
(
chunk
))  57;

4786  
îr‹
;

4787 
	}
}

4790 
	$decodeGíîic
(** 
out
, * 
w
, * 
h
,

4791 
LodePNGSèã
* 
°©e
,

4792 c⁄° * 
ö
, 
size_t
 
ösize
) {

4793 
IEND
 = 0;

4794 c⁄° * 
chunk
;

4795 * 
id©
;

4796 
size_t
 
id©size
 = 0;

4797 * 
sˇ∆öes
 = 0;

4798 
size_t
 
sˇ∆öes_size
 = 0, 
ex≥˘ed_size
 = 0;

4799 
size_t
 
outsize
 = 0;

4802 
unknown
 = 0;

4803 #ifde‡
LODEPNG_COMPILE_ANCILLARY_CHUNKS


4804 
¸ôiˇl_pos
 = 1;

4809 *
out
 = 0;

4810 *
w
 = *
h
 = 0;

4812 
°©e
->
îr‹
 = 
	`lodïng_ö•e˘
(
w
, 
h
, sèã, 
ö
, 
ösize
);

4813 if(
°©e
->
îr‹
) ;

4815 if(
	`lodïng_pixñ_ovîÊow
(*
w
, *
h
, &
°©e
->
öfo_≤g
.
cﬁ‹
, &°©e->
öfo_øw
)) {

4816 
	`CERROR_RETURN
(
°©e
->
îr‹
, 92);

4820 
id©
 = (*)
	`lodïng_mÆloc
(
ösize
);

4821 if(!
id©
Ë
	`CERROR_RETURN
(
°©e
->
îr‹
, 83);

4823 
chunk
 = &
ö
[33];

4827 !
IEND
 && !
°©e
->
îr‹
) {

4828 
chunkLígth
;

4829 c⁄° * 
d©a
;

4832 if((
size_t
)((
chunk
 - 
ö
Ë+ 12Ë> 
ösize
 || chunk < in) {

4833 if(
°©e
->
decodî
.
ign‹e_íd
) ;

4834 
	`CERROR_BREAK
(
°©e
->
îr‹
, 30);

4838 
chunkLígth
 = 
	`lodïng_chunk_Àngth
(
chunk
);

4840 if(
chunkLígth
 > 2147483647) {

4841 if(
°©e
->
decodî
.
ign‹e_íd
) ;

4842 
	`CERROR_BREAK
(
°©e
->
îr‹
, 63);

4845 if((
size_t
)((
chunk
 - 
ö
Ë+ 
chunkLígth
 + 12Ë> 
ösize
 || (chunk + chunkLength + 12) < in) {

4846 
	`CERROR_BREAK
(
°©e
->
îr‹
, 64);

4849 
d©a
 = 
	`lodïng_chunk_d©a_c⁄°
(
chunk
);

4851 
unknown
 = 0;

4854 if(
	`lodïng_chunk_ty≥_equÆs
(
chunk
, "IDAT")) {

4855 
size_t
 
√wsize
;

4856 if(
	`lodïng_addoÊ
(
id©size
, 
chunkLígth
, &
√wsize
)Ë
	`CERROR_BREAK
(
°©e
->
îr‹
, 95);

4857 if(
√wsize
 > 
ösize
Ë
	`CERROR_BREAK
(
°©e
->
îr‹
, 95);

4858 
	`lodïng_mem˝y
(
id©
 + 
id©size
, 
d©a
, 
chunkLígth
);

4859 
id©size
 +
chunkLígth
;

4860 #ifde‡
LODEPNG_COMPILE_ANCILLARY_CHUNKS


4861 
¸ôiˇl_pos
 = 3;

4863 } if(
	`lodïng_chunk_ty≥_equÆs
(
chunk
, "IEND")) {

4865 
IEND
 = 1;

4866 } if(
	`lodïng_chunk_ty≥_equÆs
(
chunk
, "PLTE")) {

4868 
°©e
->
îr‹
 = 
	`ªadChunk_PLTE
(&°©e->
öfo_≤g
.
cﬁ‹
, 
d©a
, 
chunkLígth
);

4869 if(
°©e
->
îr‹
) ;

4870 #ifde‡
LODEPNG_COMPILE_ANCILLARY_CHUNKS


4871 
¸ôiˇl_pos
 = 2;

4873 } if(
	`lodïng_chunk_ty≥_equÆs
(
chunk
, "tRNS")) {

4877 
°©e
->
îr‹
 = 
	`ªadChunk_tRNS
(&°©e->
öfo_≤g
.
cﬁ‹
, 
d©a
, 
chunkLígth
);

4878 if(
°©e
->
îr‹
) ;

4879 #ifde‡
LODEPNG_COMPILE_ANCILLARY_CHUNKS


4881 } if(
	`lodïng_chunk_ty≥_equÆs
(
chunk
, "bKGD")) {

4882 
°©e
->
îr‹
 = 
	`ªadChunk_bKGD
(&°©e->
öfo_≤g
, 
d©a
, 
chunkLígth
);

4883 if(
°©e
->
îr‹
) ;

4884 } if(
	`lodïng_chunk_ty≥_equÆs
(
chunk
, "tEXt")) {

4886 if(
°©e
->
decodî
.
ªad_ãxt_chunks
) {

4887 
°©e
->
îr‹
 = 
	`ªadChunk_tEXt
(&°©e->
öfo_≤g
, 
d©a
, 
chunkLígth
);

4888 if(
°©e
->
îr‹
) ;

4890 } if(
	`lodïng_chunk_ty≥_equÆs
(
chunk
, "zTXt")) {

4892 if(
°©e
->
decodî
.
ªad_ãxt_chunks
) {

4893 
°©e
->
îr‹
 = 
	`ªadChunk_zTXt
(&°©e->
öfo_≤g
, &°©e->
decodî
, 
d©a
, 
chunkLígth
);

4894 if(
°©e
->
îr‹
) ;

4896 } if(
	`lodïng_chunk_ty≥_equÆs
(
chunk
, "iTXt")) {

4898 if(
°©e
->
decodî
.
ªad_ãxt_chunks
) {

4899 
°©e
->
îr‹
 = 
	`ªadChunk_iTXt
(&°©e->
öfo_≤g
, &°©e->
decodî
, 
d©a
, 
chunkLígth
);

4900 if(
°©e
->
îr‹
) ;

4902 } if(
	`lodïng_chunk_ty≥_equÆs
(
chunk
, "tIME")) {

4903 
°©e
->
îr‹
 = 
	`ªadChunk_tIME
(&°©e->
öfo_≤g
, 
d©a
, 
chunkLígth
);

4904 if(
°©e
->
îr‹
) ;

4905 } if(
	`lodïng_chunk_ty≥_equÆs
(
chunk
, "pHYs")) {

4906 
°©e
->
îr‹
 = 
	`ªadChunk_pHYs
(&°©e->
öfo_≤g
, 
d©a
, 
chunkLígth
);

4907 if(
°©e
->
îr‹
) ;

4908 } if(
	`lodïng_chunk_ty≥_equÆs
(
chunk
, "gAMA")) {

4909 
°©e
->
îr‹
 = 
	`ªadChunk_gAMA
(&°©e->
öfo_≤g
, 
d©a
, 
chunkLígth
);

4910 if(
°©e
->
îr‹
) ;

4911 } if(
	`lodïng_chunk_ty≥_equÆs
(
chunk
, "cHRM")) {

4912 
°©e
->
îr‹
 = 
	`ªadChunk_cHRM
(&°©e->
öfo_≤g
, 
d©a
, 
chunkLígth
);

4913 if(
°©e
->
îr‹
) ;

4914 } if(
	`lodïng_chunk_ty≥_equÆs
(
chunk
, "sRGB")) {

4915 
°©e
->
îr‹
 = 
	`ªadChunk_sRGB
(&°©e->
öfo_≤g
, 
d©a
, 
chunkLígth
);

4916 if(
°©e
->
îr‹
) ;

4917 } if(
	`lodïng_chunk_ty≥_equÆs
(
chunk
, "iCCP")) {

4918 
°©e
->
îr‹
 = 
	`ªadChunk_iCCP
(&°©e->
öfo_≤g
, &°©e->
decodî
, 
d©a
, 
chunkLígth
);

4919 if(
°©e
->
îr‹
) ;

4923 if(!
°©e
->
decodî
.
ign‹e_¸ôiˇl
 && !
	`lodïng_chunk_™cûœry
(
chunk
)) {

4924 
	`CERROR_BREAK
(
°©e
->
îr‹
, 69);

4927 
unknown
 = 1;

4928 #ifde‡
LODEPNG_COMPILE_ANCILLARY_CHUNKS


4929 if(
°©e
->
decodî
.
ªmembî_unknown_chunks
) {

4930 
°©e
->
îr‹
 = 
	`lodïng_chunk_≠≥nd
(&°©e->
öfo_≤g
.
unknown_chunks_d©a
[
¸ôiˇl_pos
 - 1],

4931 &
°©e
->
öfo_≤g
.
unknown_chunks_size
[
¸ôiˇl_pos
 - 1], 
chunk
);

4932 if(
°©e
->
îr‹
) ;

4937 if(!
°©e
->
decodî
.
ign‹e_¸c
 && !
unknown
) {

4938 if(
	`lodïng_chunk_check_¸c
(
chunk
)Ë
	`CERROR_BREAK
(
°©e
->
îr‹
, 57);

4941 if(!
IEND
Ë
chunk
 = 
	`lodïng_chunk_√xt_c⁄°
(chunk, 
ö
 + 
ösize
);

4944 if(!
°©e
->
îr‹
 && sèã->
öfo_≤g
.
cﬁ‹
.
cﬁ‹ty≥
 =
LCT_PALETTE
 && !°©e->öfo_≤g.cﬁ‹.
∑Àâe
) {

4945 
°©e
->
îr‹
 = 106;

4948 if(!
°©e
->
îr‹
) {

4951 if(
°©e
->
öfo_≤g
.
öãæa˚_mëhod
 == 0) {

4952 
size_t
 
bµ
 = 
	`lodïng_gë_bµ
(&
°©e
->
öfo_≤g
.
cﬁ‹
);

4953 
ex≥˘ed_size
 = 
	`lodïng_gë_øw_size_id©
(*
w
, *
h
, 
bµ
);

4955 
size_t
 
bµ
 = 
	`lodïng_gë_bµ
(&
°©e
->
öfo_≤g
.
cﬁ‹
);

4957 
ex≥˘ed_size
 = 0;

4958 
ex≥˘ed_size
 +
	`lodïng_gë_øw_size_id©
((*
w
 + 7Ë>> 3, (*
h
 + 7Ë>> 3, 
bµ
);

4959 if(*
w
 > 4Ë
ex≥˘ed_size
 +
	`lodïng_gë_øw_size_id©
((*w + 3Ë>> 3, (*
h
 + 7Ë>> 3, 
bµ
);

4960 
ex≥˘ed_size
 +
	`lodïng_gë_øw_size_id©
((*
w
 + 3Ë>> 2, (*
h
 + 3Ë>> 3, 
bµ
);

4961 if(*
w
 > 2Ë
ex≥˘ed_size
 +
	`lodïng_gë_øw_size_id©
((*w + 1Ë>> 2, (*
h
 + 3Ë>> 2, 
bµ
);

4962 
ex≥˘ed_size
 +
	`lodïng_gë_øw_size_id©
((*
w
 + 1Ë>> 1, (*
h
 + 1Ë>> 2, 
bµ
);

4963 if(*
w
 > 1Ë
ex≥˘ed_size
 +
	`lodïng_gë_øw_size_id©
((*w + 0Ë>> 1, (*
h
 + 1Ë>> 1, 
bµ
);

4964 
ex≥˘ed_size
 +
	`lodïng_gë_øw_size_id©
((*
w
 + 0), (*
h
 + 0Ë>> 1, 
bµ
);

4967 
°©e
->
îr‹
 = 
	`zlib_decom¥ess
(&
sˇ∆öes
, &
sˇ∆öes_size
, 
ex≥˘ed_size
, 
id©
, 
id©size
, &°©e->
decodî
.
zlib£âögs
);

4969 if(!
°©e
->
îr‹
 && 
sˇ∆öes_size
 !
ex≥˘ed_size
) state->error = 91;

4970 
	`lodïng_‰ì
(
id©
);

4972 if(!
°©e
->
îr‹
) {

4973 
outsize
 = 
	`lodïng_gë_øw_size
(*
w
, *
h
, &
°©e
->
öfo_≤g
.
cﬁ‹
);

4974 *
out
 = (*)
	`lodïng_mÆloc
(
outsize
);

4975 if(!*
out
Ë
°©e
->
îr‹
 = 83;

4977 if(!
°©e
->
îr‹
) {

4978 
	`lodïng_mem£t
(*
out
, 0, 
outsize
);

4979 
°©e
->
îr‹
 = 
	`po°Pro˚ssSˇ∆öes
(*
out
, 
sˇ∆öes
, *
w
, *
h
, &°©e->
öfo_≤g
);

4981 
	`lodïng_‰ì
(
sˇ∆öes
);

4982 
	}
}

4984 
	$lodïng_decode
(** 
out
, * 
w
, * 
h
,

4985 
LodePNGSèã
* 
°©e
,

4986 c⁄° * 
ö
, 
size_t
 
ösize
) {

4987 *
out
 = 0;

4988 
	`decodeGíîic
(
out
, 
w
, 
h
, 
°©e
, 
ö
, 
ösize
);

4989 if(
°©e
->
îr‹
)  state->error;

4990 if(!
°©e
->
decodî
.
cﬁ‹_c⁄vît
 || 
	`lodïng_cﬁ‹_mode_equÆ
(&°©e->
öfo_øw
, &°©e->
öfo_≤g
.
cﬁ‹
)) {

4994 if(!
°©e
->
decodî
.
cﬁ‹_c⁄vît
) {

4995 
°©e
->
îr‹
 = 
	`lodïng_cﬁ‹_mode_c›y
(&°©e->
öfo_øw
, &°©e->
öfo_≤g
.
cﬁ‹
);

4996 if(
°©e
->
îr‹
)  state->error;

4999 * 
d©a
 = *
out
;

5000 
size_t
 
outsize
;

5004 if(!(
°©e
->
öfo_øw
.
cﬁ‹ty≥
 =
LCT_RGB
 || sèã->öfo_øw.cﬁ‹ty≥ =
LCT_RGBA
)

5005 && !(
°©e
->
öfo_øw
.
bôdïth
 == 8)) {

5009 
outsize
 = 
	`lodïng_gë_øw_size
(*
w
, *
h
, &
°©e
->
öfo_øw
);

5010 *
out
 = (*)
	`lodïng_mÆloc
(
outsize
);

5011 if(!(*
out
)) {

5012 
°©e
->
îr‹
 = 83;

5014 
°©e
->
îr‹
 = 
	`lodïng_c⁄vît
(*
out
, 
d©a
, &°©e->
öfo_øw
,

5015 &
°©e
->
öfo_≤g
.
cﬁ‹
, *
w
, *
h
);

5016 
	`lodïng_‰ì
(
d©a
);

5018  
°©e
->
îr‹
;

5019 
	}
}

5021 
	$lodïng_decode_mem‹y
(** 
out
, * 
w
, * 
h
, c⁄° * 
ö
,

5022 
size_t
 
ösize
, 
LodePNGCﬁ‹Ty≥
 
cﬁ‹ty≥
, 
bôdïth
) {

5023 
îr‹
;

5024 
LodePNGSèã
 
°©e
;

5025 
	`lodïng_°©e_öô
(&
°©e
);

5026 
°©e
.
öfo_øw
.
cﬁ‹ty≥
 = colortype;

5027 
°©e
.
öfo_øw
.
bôdïth
 = bitdepth;

5028 #ifde‡
LODEPNG_COMPILE_ANCILLARY_CHUNKS


5030 
°©e
.
decodî
.
ªad_ãxt_chunks
 = 0;

5031 
°©e
.
decodî
.
ªmembî_unknown_chunks
 = 0;

5033 
îr‹
 = 
	`lodïng_decode
(
out
, 
w
, 
h
, &
°©e
, 
ö
, 
ösize
);

5034 
	`lodïng_°©e_˛ónup
(&
°©e
);

5035  
îr‹
;

5036 
	}
}

5038 
	$lodïng_decode32
(** 
out
, * 
w
, * 
h
, c⁄° * 
ö
, 
size_t
 
ösize
) {

5039  
	`lodïng_decode_mem‹y
(
out
, 
w
, 
h
, 
ö
, 
ösize
, 
LCT_RGBA
, 8);

5040 
	}
}

5042 
	$lodïng_decode24
(** 
out
, * 
w
, * 
h
, c⁄° * 
ö
, 
size_t
 
ösize
) {

5043  
	`lodïng_decode_mem‹y
(
out
, 
w
, 
h
, 
ö
, 
ösize
, 
LCT_RGB
, 8);

5044 
	}
}

5046 #ifde‡
LODEPNG_COMPILE_DISK


5047 
	$lodïng_decode_fûe
(** 
out
, * 
w
, * 
h
, c⁄° * 
fûíame
,

5048 
LodePNGCﬁ‹Ty≥
 
cﬁ‹ty≥
, 
bôdïth
) {

5049 * 
buf„r
 = 0;

5050 
size_t
 
buf„rsize
;

5051 
îr‹
;

5053 *
out
 = 0;

5054 *
w
 = *
h
 = 0;

5055 
îr‹
 = 
	`lodïng_lﬂd_fûe
(&
buf„r
, &
buf„rsize
, 
fûíame
);

5056 if(!
îr‹
Ëîr‹ = 
	`lodïng_decode_mem‹y
(
out
, 
w
, 
h
, 
buf„r
, 
buf„rsize
, 
cﬁ‹ty≥
, 
bôdïth
);

5057 
	`lodïng_‰ì
(
buf„r
);

5058  
îr‹
;

5059 
	}
}

5061 
	$lodïng_decode32_fûe
(** 
out
, * 
w
, * 
h
, c⁄° * 
fûíame
) {

5062  
	`lodïng_decode_fûe
(
out
, 
w
, 
h
, 
fûíame
, 
LCT_RGBA
, 8);

5063 
	}
}

5065 
	$lodïng_decode24_fûe
(** 
out
, * 
w
, * 
h
, c⁄° * 
fûíame
) {

5066  
	`lodïng_decode_fûe
(
out
, 
w
, 
h
, 
fûíame
, 
LCT_RGB
, 8);

5067 
	}
}

5070 
	$lodïng_decodî_£âögs_öô
(
LodePNGDecodîSëtögs
* 
£âögs
) {

5071 
£âögs
->
cﬁ‹_c⁄vît
 = 1;

5072 #ifde‡
LODEPNG_COMPILE_ANCILLARY_CHUNKS


5073 
£âögs
->
ªad_ãxt_chunks
 = 1;

5074 
£âögs
->
ªmembî_unknown_chunks
 = 0;

5075 
£âögs
->
max_ãxt_size
 = 16777216;

5076 
£âögs
->
max_icc_size
 = 16777216;

5078 
£âögs
->
ign‹e_¸c
 = 0;

5079 
£âögs
->
ign‹e_¸ôiˇl
 = 0;

5080 
£âögs
->
ign‹e_íd
 = 0;

5081 
	`lodïng_decom¥ess_£âögs_öô
(&
£âögs
->
zlib£âögs
);

5082 
	}
}

5086 #i‡
deföed
(
LODEPNG_COMPILE_DECODER
Ë|| deföed(
LODEPNG_COMPILE_ENCODER
)

5088 
	$lodïng_°©e_öô
(
LodePNGSèã
* 
°©e
) {

5089 #ifde‡
LODEPNG_COMPILE_DECODER


5090 
	`lodïng_decodî_£âögs_öô
(&
°©e
->
decodî
);

5092 #ifde‡
LODEPNG_COMPILE_ENCODER


5093 
	`lodïng_ícodî_£âögs_öô
(&
°©e
->
ícodî
);

5095 
	`lodïng_cﬁ‹_mode_öô
(&
°©e
->
öfo_øw
);

5096 
	`lodïng_öfo_öô
(&
°©e
->
öfo_≤g
);

5097 
°©e
->
îr‹
 = 1;

5098 
	}
}

5100 
	$lodïng_°©e_˛ónup
(
LodePNGSèã
* 
°©e
) {

5101 
	`lodïng_cﬁ‹_mode_˛ónup
(&
°©e
->
öfo_øw
);

5102 
	`lodïng_öfo_˛ónup
(&
°©e
->
öfo_≤g
);

5103 
	}
}

5105 
	$lodïng_°©e_c›y
(
LodePNGSèã
* 
de°
, c⁄° LodePNGSèã* 
sour˚
) {

5106 
	`lodïng_°©e_˛ónup
(
de°
);

5107 *
de°
 = *
sour˚
;

5108 
	`lodïng_cﬁ‹_mode_öô
(&
de°
->
öfo_øw
);

5109 
	`lodïng_öfo_öô
(&
de°
->
öfo_≤g
);

5110 
de°
->
îr‹
 = 
	`lodïng_cﬁ‹_mode_c›y
(&de°->
öfo_øw
, &
sour˚
->info_raw); if(dest->error) ;

5111 
de°
->
îr‹
 = 
	`lodïng_öfo_c›y
(&de°->
öfo_≤g
, &
sour˚
->info_png); if(dest->error) ;

5112 
	}
}

5116 #ifde‡
LODEPNG_COMPILE_ENCODER


5123 
	$wrôeSig«tuª
(
ucve˘‹
* 
out
) {

5124 
size_t
 
pos
 = 
out
->
size
;

5125 c⁄° 
sig«tuª
[] = {137, 80, 78, 71, 13, 10, 26, 10};

5127 if(!
	`ucve˘‹_ªsize
(
out
, out->
size
 + 8))  83;

5128 
	`lodïng_mem˝y
(
out
->
d©a
 + 
pos
, 
sig«tuª
, 8);

5130 
	}
}

5132 
	$addChunk_IHDR
(
ucve˘‹
* 
out
, 
w
, 
h
,

5133 
LodePNGCﬁ‹Ty≥
 
cﬁ‹ty≥
, 
bôdïth
, 
öãæa˚_mëhod
) {

5134 *
chunk
, *
d©a
;

5135 
	`CERROR_TRY_RETURN
(
	`lodïng_chunk_öô
(&
chunk
, 
out
, 13, "IHDR"));

5136 
d©a
 = 
chunk
 + 8;

5138 
	`lodïng_£t32bôI¡
(
d©a
 + 0, 
w
);

5139 
	`lodïng_£t32bôI¡
(
d©a
 + 4, 
h
);

5140 
d©a
[8] = ()
bôdïth
;

5141 
d©a
[9] = ()
cﬁ‹ty≥
;

5142 
d©a
[10] = 0;

5143 
d©a
[11] = 0;

5144 
d©a
[12] = 
öãæa˚_mëhod
;

5146 
	`lodïng_chunk_gíî©e_¸c
(
chunk
);

5148 
	}
}

5151 
	$addChunk_PLTE
(
ucve˘‹
* 
out
, c⁄° 
LodePNGCﬁ‹Mode
* 
öfo
) {

5152 * 
chunk
;

5153 
size_t
 
i
, 
j
 = 8;

5155 
	`CERROR_TRY_RETURN
(
	`lodïng_chunk_öô
(&
chunk
, 
out
, 
öfo
->
∑Àâesize
 * 3, "PLTE"));

5157 
i
 = 0; i !
öfo
->
∑Àâesize
; ++i) {

5159 
chunk
[
j
++] = 
öfo
->
∑Àâe
[
i
 * 4 + 0];

5160 
chunk
[
j
++] = 
öfo
->
∑Àâe
[
i
 * 4 + 1];

5161 
chunk
[
j
++] = 
öfo
->
∑Àâe
[
i
 * 4 + 2];

5164 
	`lodïng_chunk_gíî©e_¸c
(
chunk
);

5166 
	}
}

5168 
	$addChunk_tRNS
(
ucve˘‹
* 
out
, c⁄° 
LodePNGCﬁ‹Mode
* 
öfo
) {

5169 * 
chunk
 = 0;

5171 if(
öfo
->
cﬁ‹ty≥
 =
LCT_PALETTE
) {

5172 
size_t
 
i
, 
amou¡
 = 
öfo
->
∑Àâesize
;

5174 
i
 = 
öfo
->
∑Àâesize
; i != 0; --i) {

5175 if(
öfo
->
∑Àâe
[4 * (
i
 - 1) + 3] != 255) ;

5176 --
amou¡
;

5178 if(
amou¡
) {

5179 
	`CERROR_TRY_RETURN
(
	`lodïng_chunk_öô
(&
chunk
, 
out
, 
amou¡
, "tRNS"));

5181 
i
 = 0; i !
amou¡
; ++iË
chunk
[8 + i] = 
öfo
->
∑Àâe
[4 * i + 3];

5183 } if(
öfo
->
cﬁ‹ty≥
 =
LCT_GREY
) {

5184 if(
öfo
->
key_deföed
) {

5185 
	`CERROR_TRY_RETURN
(
	`lodïng_chunk_öô
(&
chunk
, 
out
, 2, "tRNS"));

5186 
chunk
[8] = ()(
öfo
->
key_r
 >> 8);

5187 
chunk
[9] = ()(
öfo
->
key_r
 & 255);

5189 } if(
öfo
->
cﬁ‹ty≥
 =
LCT_RGB
) {

5190 if(
öfo
->
key_deföed
) {

5191 
	`CERROR_TRY_RETURN
(
	`lodïng_chunk_öô
(&
chunk
, 
out
, 6, "tRNS"));

5192 
chunk
[8] = ()(
öfo
->
key_r
 >> 8);

5193 
chunk
[9] = ()(
öfo
->
key_r
 & 255);

5194 
chunk
[10] = ()(
öfo
->
key_g
 >> 8);

5195 
chunk
[11] = ()(
öfo
->
key_g
 & 255);

5196 
chunk
[12] = ()(
öfo
->
key_b
 >> 8);

5197 
chunk
[13] = ()(
öfo
->
key_b
 & 255);

5201 if(
chunk
Ë
	`lodïng_chunk_gíî©e_¸c
(chunk);

5203 
	}
}

5205 
	$addChunk_IDAT
(
ucve˘‹
* 
out
, c⁄° * 
d©a
, 
size_t
 
d©asize
,

5206 
LodePNGCom¥essSëtögs
* 
zlib£âögs
) {

5207 
îr‹
 = 0;

5208 * 
zlib
 = 0;

5209 
size_t
 
zlibsize
 = 0;

5211 
îr‹
 = 
	`zlib_com¥ess
(&
zlib
, &
zlibsize
, 
d©a
, 
d©asize
, 
zlib£âögs
);

5212 if(!
îr‹
) {

5213 
îr‹
 = 
	`lodïng_chunk_¸óãv
(
out
, 
zlibsize
, "IDAT", 
zlib
);

5215 
	`lodïng_‰ì
(
zlib
);

5216  
îr‹
;

5217 
	}
}

5219 
	$addChunk_IEND
(
ucve˘‹
* 
out
) {

5220  
	`lodïng_chunk_¸óãv
(
out
, 0, "IEND", 0);

5221 
	}
}

5223 #ifde‡
LODEPNG_COMPILE_ANCILLARY_CHUNKS


5225 
	$addChunk_tEXt
(
ucve˘‹
* 
out
, c⁄° * 
keyw‹d
, c⁄° * 
ãxt°rög
) {

5226 * 
chunk
 = 0;

5227 
size_t
 
keysize
 = 
	`lodïng_°æí
(
keyw‹d
), 
ãxtsize
 =Üodïng_°æí(
ãxt°rög
);

5228 
size_t
 
size
 = 
keysize
 + 1 + 
ãxtsize
;

5229 if(
keysize
 < 1 || keysize > 79)  89;

5230 
	`CERROR_TRY_RETURN
(
	`lodïng_chunk_öô
(&
chunk
, 
out
, 
size
, "tEXt"));

5231 
	`lodïng_mem˝y
(
chunk
 + 8, 
keyw‹d
, 
keysize
);

5232 
chunk
[8 + 
keysize
] = 0;

5233 
	`lodïng_mem˝y
(
chunk
 + 9 + 
keysize
, 
ãxt°rög
, 
ãxtsize
);

5234 
	`lodïng_chunk_gíî©e_¸c
(
chunk
);

5236 
	}
}

5238 
	$addChunk_zTXt
(
ucve˘‹
* 
out
, c⁄° * 
keyw‹d
, c⁄° * 
ãxt°rög
,

5239 
LodePNGCom¥essSëtögs
* 
zlib£âögs
) {

5240 
îr‹
 = 0;

5241 * 
chunk
 = 0;

5242 * 
com¥es£d
 = 0;

5243 
size_t
 
com¥es£dsize
 = 0;

5244 
size_t
 
ãxtsize
 = 
	`lodïng_°æí
(
ãxt°rög
);

5245 
size_t
 
keysize
 = 
	`lodïng_°æí
(
keyw‹d
);

5246 if(
keysize
 < 1 || keysize > 79)  89;

5248 
îr‹
 = 
	`zlib_com¥ess
(&
com¥es£d
, &
com¥es£dsize
,

5249 (c⁄° *)
ãxt°rög
, 
ãxtsize
, 
zlib£âögs
);

5250 if(!
îr‹
) {

5251 
size_t
 
size
 = 
keysize
 + 2 + 
com¥es£dsize
;

5252 
îr‹
 = 
	`lodïng_chunk_öô
(&
chunk
, 
out
, 
size
, "zTXt");

5254 if(!
îr‹
) {

5255 
	`lodïng_mem˝y
(
chunk
 + 8, 
keyw‹d
, 
keysize
);

5256 
chunk
[8 + 
keysize
] = 0;

5257 
chunk
[9 + 
keysize
] = 0;

5258 
	`lodïng_mem˝y
(
chunk
 + 10 + 
keysize
, 
com¥es£d
, 
com¥es£dsize
);

5259 
	`lodïng_chunk_gíî©e_¸c
(
chunk
);

5262 
	`lodïng_‰ì
(
com¥es£d
);

5263  
îr‹
;

5264 
	}
}

5266 
	$addChunk_iTXt
(
ucve˘‹
* 
out
, 
com¥ess
, c⁄° * 
keyw‹d
, c⁄° * 
œngèg
,

5267 c⁄° * 
å™skey
, c⁄° * 
ãxt°rög
, 
LodePNGCom¥essSëtögs
* 
zlib£âögs
) {

5268 
îr‹
 = 0;

5269 * 
chunk
 = 0;

5270 * 
com¥es£d
 = 0;

5271 
size_t
 
com¥es£dsize
 = 0;

5272 
size_t
 
ãxtsize
 = 
	`lodïng_°æí
(
ãxt°rög
);

5273 
size_t
 
keysize
 = 
	`lodïng_°æí
(
keyw‹d
), 
œngsize
 =Üodïng_°æí(
œngèg
), 
å™ssize
 =Üodïng_°æí(
å™skey
);

5275 if(
keysize
 < 1 || keysize > 79)  89;

5277 if(
com¥ess
) {

5278 
îr‹
 = 
	`zlib_com¥ess
(&
com¥es£d
, &
com¥es£dsize
,

5279 (c⁄° *)
ãxt°rög
, 
ãxtsize
, 
zlib£âögs
);

5281 if(!
îr‹
) {

5282 
size_t
 
size
 = 
keysize
 + 3 + 
œngsize
 + 1 + 
å™ssize
 + 1 + (
com¥ess
 ? 
com¥es£dsize
 : 
ãxtsize
);

5283 
îr‹
 = 
	`lodïng_chunk_öô
(&
chunk
, 
out
, 
size
, "iTXt");

5285 if(!
îr‹
) {

5286 
size_t
 
pos
 = 8;

5287 
	`lodïng_mem˝y
(
chunk
 + 
pos
, 
keyw‹d
, 
keysize
);

5288 
pos
 +
keysize
;

5289 
chunk
[
pos
++] = 0;

5290 
chunk
[
pos
++] = (
com¥ess
 ? 1 : 0);

5291 
chunk
[
pos
++] = 0;

5292 
	`lodïng_mem˝y
(
chunk
 + 
pos
, 
œngèg
, 
œngsize
);

5293 
pos
 +
œngsize
;

5294 
chunk
[
pos
++] = 0;

5295 
	`lodïng_mem˝y
(
chunk
 + 
pos
, 
å™skey
, 
å™ssize
);

5296 
pos
 +
å™ssize
;

5297 
chunk
[
pos
++] = 0;

5298 if(
com¥ess
) {

5299 
	`lodïng_mem˝y
(
chunk
 + 
pos
, 
com¥es£d
, 
com¥es£dsize
);

5301 
	`lodïng_mem˝y
(
chunk
 + 
pos
, 
ãxt°rög
, 
ãxtsize
);

5303 
	`lodïng_chunk_gíî©e_¸c
(
chunk
);

5306 
	`lodïng_‰ì
(
com¥es£d
);

5307  
îr‹
;

5308 
	}
}

5310 
	$addChunk_bKGD
(
ucve˘‹
* 
out
, c⁄° 
LodePNGInfo
* 
öfo
) {

5311 * 
chunk
 = 0;

5312 if(
öfo
->
cﬁ‹
.
cﬁ‹ty≥
 =
LCT_GREY
 || info->cﬁ‹.cﬁ‹ty≥ =
LCT_GREY_ALPHA
) {

5313 
	`CERROR_TRY_RETURN
(
	`lodïng_chunk_öô
(&
chunk
, 
out
, 2, "bKGD"));

5314 
chunk
[8] = ()(
öfo
->
background_r
 >> 8);

5315 
chunk
[9] = ()(
öfo
->
background_r
 & 255);

5316 } if(
öfo
->
cﬁ‹
.
cﬁ‹ty≥
 =
LCT_RGB
 || info->cﬁ‹.cﬁ‹ty≥ =
LCT_RGBA
) {

5317 
	`CERROR_TRY_RETURN
(
	`lodïng_chunk_öô
(&
chunk
, 
out
, 6, "bKGD"));

5318 
chunk
[8] = ()(
öfo
->
background_r
 >> 8);

5319 
chunk
[9] = ()(
öfo
->
background_r
 & 255);

5320 
chunk
[10] = ()(
öfo
->
background_g
 >> 8);

5321 
chunk
[11] = ()(
öfo
->
background_g
 & 255);

5322 
chunk
[12] = ()(
öfo
->
background_b
 >> 8);

5323 
chunk
[13] = ()(
öfo
->
background_b
 & 255);

5324 } if(
öfo
->
cﬁ‹
.
cﬁ‹ty≥
 =
LCT_PALETTE
) {

5325 
	`CERROR_TRY_RETURN
(
	`lodïng_chunk_öô
(&
chunk
, 
out
, 1, "bKGD"));

5326 
chunk
[8] = ()(
öfo
->
background_r
 & 255);

5328 if(
chunk
Ë
	`lodïng_chunk_gíî©e_¸c
(chunk);

5330 
	}
}

5332 
	$addChunk_tIME
(
ucve˘‹
* 
out
, c⁄° 
LodePNGTime
* 
time
) {

5333 * 
chunk
;

5334 
	`CERROR_TRY_RETURN
(
	`lodïng_chunk_öô
(&
chunk
, 
out
, 7, "tIME"));

5335 
chunk
[8] = ()(
time
->
yór
 >> 8);

5336 
chunk
[9] = ()(
time
->
yór
 & 255);

5337 
chunk
[10] = ()
time
->
m⁄th
;

5338 
chunk
[11] = ()
time
->
day
;

5339 
chunk
[12] = ()
time
->
hour
;

5340 
chunk
[13] = ()
time
->
möuã
;

5341 
chunk
[14] = ()
time
->
£c⁄d
;

5342 
	`lodïng_chunk_gíî©e_¸c
(
chunk
);

5344 
	}
}

5346 
	$addChunk_pHYs
(
ucve˘‹
* 
out
, c⁄° 
LodePNGInfo
* 
öfo
) {

5347 * 
chunk
;

5348 
	`CERROR_TRY_RETURN
(
	`lodïng_chunk_öô
(&
chunk
, 
out
, 9, "pHYs"));

5349 
	`lodïng_£t32bôI¡
(
chunk
 + 8, 
öfo
->
phys_x
);

5350 
	`lodïng_£t32bôI¡
(
chunk
 + 12, 
öfo
->
phys_y
);

5351 
chunk
[16] = 
öfo
->
phys_unô
;

5352 
	`lodïng_chunk_gíî©e_¸c
(
chunk
);

5354 
	}
}

5356 
	$addChunk_gAMA
(
ucve˘‹
* 
out
, c⁄° 
LodePNGInfo
* 
öfo
) {

5357 * 
chunk
;

5358 
	`CERROR_TRY_RETURN
(
	`lodïng_chunk_öô
(&
chunk
, 
out
, 4, "gAMA"));

5359 
	`lodïng_£t32bôI¡
(
chunk
 + 8, 
öfo
->
gama_gamma
);

5360 
	`lodïng_chunk_gíî©e_¸c
(
chunk
);

5362 
	}
}

5364 
	$addChunk_cHRM
(
ucve˘‹
* 
out
, c⁄° 
LodePNGInfo
* 
öfo
) {

5365 * 
chunk
;

5366 
	`CERROR_TRY_RETURN
(
	`lodïng_chunk_öô
(&
chunk
, 
out
, 32, "cHRM"));

5367 
	`lodïng_£t32bôI¡
(
chunk
 + 8, 
öfo
->
chrm_whôe_x
);

5368 
	`lodïng_£t32bôI¡
(
chunk
 + 12, 
öfo
->
chrm_whôe_y
);

5369 
	`lodïng_£t32bôI¡
(
chunk
 + 16, 
öfo
->
chrm_ªd_x
);

5370 
	`lodïng_£t32bôI¡
(
chunk
 + 20, 
öfo
->
chrm_ªd_y
);

5371 
	`lodïng_£t32bôI¡
(
chunk
 + 24, 
öfo
->
chrm_gªí_x
);

5372 
	`lodïng_£t32bôI¡
(
chunk
 + 28, 
öfo
->
chrm_gªí_y
);

5373 
	`lodïng_£t32bôI¡
(
chunk
 + 32, 
öfo
->
chrm_blue_x
);

5374 
	`lodïng_£t32bôI¡
(
chunk
 + 36, 
öfo
->
chrm_blue_y
);

5375 
	`lodïng_chunk_gíî©e_¸c
(
chunk
);

5377 
	}
}

5379 
	$addChunk_sRGB
(
ucve˘‹
* 
out
, c⁄° 
LodePNGInfo
* 
öfo
) {

5380 
d©a
 = 
öfo
->
§gb_öã¡
;

5381  
	`lodïng_chunk_¸óãv
(
out
, 1, "sRGB", &
d©a
);

5382 
	}
}

5384 
	$addChunk_iCCP
(
ucve˘‹
* 
out
, c⁄° 
LodePNGInfo
* 
öfo
, 
LodePNGCom¥essSëtögs
* 
zlib£âögs
) {

5385 
îr‹
 = 0;

5386 * 
chunk
 = 0;

5387 * 
com¥es£d
 = 0;

5388 
size_t
 
com¥es£dsize
 = 0;

5389 
size_t
 
keysize
 = 
	`lodïng_°æí
(
öfo
->
ic˝_«me
);

5391 if(
keysize
 < 1 || keysize > 79)  89;

5392 
îr‹
 = 
	`zlib_com¥ess
(&
com¥es£d
, &
com¥es£dsize
,

5393 
öfo
->
ic˝_¥ofûe
, info->
ic˝_¥ofûe_size
, 
zlib£âögs
);

5394 if(!
îr‹
) {

5395 
size_t
 
size
 = 
keysize
 + 2 + 
com¥es£dsize
;

5396 
îr‹
 = 
	`lodïng_chunk_öô
(&
chunk
, 
out
, 
size
, "iCCP");

5398 if(!
îr‹
) {

5399 
	`lodïng_mem˝y
(
chunk
 + 8, 
öfo
->
ic˝_«me
, 
keysize
);

5400 
chunk
[8 + 
keysize
] = 0;

5401 
chunk
[9 + 
keysize
] = 0;

5402 
	`lodïng_mem˝y
(
chunk
 + 10 + 
keysize
, 
com¥es£d
, 
com¥es£dsize
);

5403 
	`lodïng_chunk_gíî©e_¸c
(
chunk
);

5406 
	`lodïng_‰ì
(
com¥es£d
);

5407  
îr‹
;

5408 
	}
}

5412 
	$fûãrSˇ∆öe
(* 
out
, c⁄° * 
sˇ∆öe
, c⁄° * 
¥evlöe
,

5413 
size_t
 
Àngth
, size_à
byãwidth
, 
fûãrTy≥
) {

5414 
size_t
 
i
;

5415 
fûãrTy≥
) {

5417 
i
 = 0; i !
Àngth
; ++iË
out
[i] = 
sˇ∆öe
[i];

5420 
i
 = 0; i !
byãwidth
; ++iË
out
[i] = 
sˇ∆öe
[i];

5421 
i
 = 
byãwidth
; i < 
Àngth
; ++iË
out
[i] = 
sˇ∆öe
[i] - scanline[i - bytewidth];

5424 if(
¥evlöe
) {

5425 
i
 = 0; i !
Àngth
; ++iË
out
[i] = 
sˇ∆öe
[i] - 
¥evlöe
[i];

5427 
i
 = 0; i !
Àngth
; ++iË
out
[i] = 
sˇ∆öe
[i];

5431 if(
¥evlöe
) {

5432 
i
 = 0; i !
byãwidth
; ++iË
out
[i] = 
sˇ∆öe
[i] - (
¥evlöe
[i] >> 1);

5433 
i
 = 
byãwidth
; i < 
Àngth
; ++iË
out
[i] = 
sˇ∆öe
[i] - ((sˇ∆öe[ò- byãwidth] + 
¥evlöe
[i]) >> 1);

5435 
i
 = 0; i !
byãwidth
; ++iË
out
[i] = 
sˇ∆öe
[i];

5436 
i
 = 
byãwidth
; i < 
Àngth
; ++iË
out
[i] = 
sˇ∆öe
[i] - (scanline[i - bytewidth] >> 1);

5440 if(
¥evlöe
) {

5442 
i
 = 0; i !
byãwidth
; ++iË
out
[i] = (
sˇ∆öe
[i] - 
¥evlöe
[i]);

5443 
i
 = 
byãwidth
; i < 
Àngth
; ++i) {

5444 
out
[
i
] = (
sˇ∆öe
[i] - 
	`∑ëhPªdi˘‹
(sˇ∆öe[ò- 
byãwidth
], 
¥evlöe
[i],Örevline[i - bytewidth]));

5447 
i
 = 0; i !
byãwidth
; ++iË
out
[i] = 
sˇ∆öe
[i];

5449 
i
 = 
byãwidth
; i < 
Àngth
; ++iË
out
[i] = (
sˇ∆öe
[i] - scanline[i - bytewidth]);

5454 
	}
}

5457 
size_t
 
	$ûog2
(
size_t
 
i
) {

5458 
size_t
 
ªsu…
 = 0;

5459 if(
i
 >65536Ë{ 
ªsu…
 += 16; i >>= 16; }

5460 if(
i
 >256Ë{ 
ªsu…
 += 8; i >>= 8; }

5461 if(
i
 >16Ë{ 
ªsu…
 += 4; i >>= 4; }

5462 if(
i
 >4Ë{ 
ªsu…
 += 2; i >>= 2; }

5463 if(
i
 >2Ë{ 
ªsu…
 += 1; }

5464  
ªsu…
;

5465 
	}
}

5468 
size_t
 
	$ûog2i
(
size_t
 
i
) {

5469 
size_t
 
l
;

5470 if(
i
 == 0)  0;

5471 
l
 = 
	`ûog2
(
i
);

5474  
i
 * 
l
 + ((i - (1u <<Ü)) << 1u);

5475 
	}
}

5477 
	$fûãr
(* 
out
, c⁄° * 
ö
, 
w
, 
h
,

5478 c⁄° 
LodePNGCﬁ‹Mode
* 
cﬁ‹
, c⁄° 
LodePNGEncodîSëtögs
* 
£âögs
) {

5485 
bµ
 = 
	`lodïng_gë_bµ
(
cﬁ‹
);

5487 
size_t
 
löebyãs
 = 
	`lodïng_gë_øw_size_id©
(
w
, 1, 
bµ
) - 1u;

5490 
size_t
 
byãwidth
 = (
bµ
 + 7u) / 8u;

5491 c⁄° * 
¥evlöe
 = 0;

5492 
x
, 
y
;

5493 
îr‹
 = 0;

5494 
LodePNGFûãrSå©egy
 
°øãgy
 = 
£âögs
->
fûãr_°øãgy
;

5509 if(
£âögs
->
fûãr_∑Àâe_zîo
 &&

5510 (
cﬁ‹
->
cﬁ‹ty≥
 =
LCT_PALETTE
 || cﬁ‹->
bôdïth
 < 8)Ë
°øãgy
 = 
LFS_ZERO
;

5512 if(
bµ
 == 0)  31;

5514 if(
°øãgy
 >
LFS_ZERO
 && så©egy <
LFS_FOUR
) {

5515 
ty≥
 = ()
°øãgy
;

5516 
y
 = 0; y !
h
; ++y) {

5517 
size_t
 
outödex
 = (1 + 
löebyãs
Ë* 
y
;

5518 
size_t
 
öödex
 = 
löebyãs
 * 
y
;

5519 
out
[
outödex
] = 
ty≥
;

5520 
	`fûãrSˇ∆öe
(&
out
[
outödex
 + 1], &
ö
[
öödex
], 
¥evlöe
, 
löebyãs
, 
byãwidth
, 
ty≥
);

5521 
¥evlöe
 = &
ö
[
öödex
];

5523 } if(
°øãgy
 =
LFS_MINSUM
) {

5525 * 
©ãm±
[5];

5526 
size_t
 
smÆÀ°
 = 0;

5527 
ty≥
, 
be°Ty≥
 = 0;

5529 
ty≥
 = 0;Åype != 5; ++type) {

5530 
©ãm±
[
ty≥
] = (*)
	`lodïng_mÆloc
(
löebyãs
);

5531 if(!
©ãm±
[
ty≥
]Ë
îr‹
 = 83;

5534 if(!
îr‹
) {

5535 
y
 = 0; y !
h
; ++y) {

5537 
ty≥
 = 0;Åype != 5; ++type) {

5538 
size_t
 
sum
 = 0;

5539 
	`fûãrSˇ∆öe
(
©ãm±
[
ty≥
], &
ö
[
y
 * 
löebyãs
], 
¥evlöe
,Üöebyãs, 
byãwidth
,Åype);

5542 if(
ty≥
 == 0) {

5543 
x
 = 0; x !
löebyãs
; ++xË
sum
 +()(
©ãm±
[
ty≥
][x]);

5545 
x
 = 0; x !
löebyãs
; ++x) {

5549 
s
 = 
©ãm±
[
ty≥
][
x
];

5550 
sum
 +
s
 < 128 ? s : (255U - s);

5555 if(
ty≥
 =0 || 
sum
 < 
smÆÀ°
) {

5556 
be°Ty≥
 = 
ty≥
;

5557 
smÆÀ°
 = 
sum
;

5561 
¥evlöe
 = &
ö
[
y
 * 
löebyãs
];

5564 
out
[
y
 * (
löebyãs
 + 1)] = 
be°Ty≥
;

5565 
x
 = 0; x !
löebyãs
; ++xË
out
[
y
 * (löebyã†+ 1Ë+ 1 + x] = 
©ãm±
[
be°Ty≥
][x];

5569 
ty≥
 = 0;Åy≥ !5; ++ty≥Ë
	`lodïng_‰ì
(
©ãm±
[type]);

5570 } if(
°øãgy
 =
LFS_ENTROPY
) {

5571 * 
©ãm±
[5];

5572 
size_t
 
be°Sum
 = 0;

5573 
ty≥
, 
be°Ty≥
 = 0;

5574 
cou¡
[256];

5576 
ty≥
 = 0;Åype != 5; ++type) {

5577 
©ãm±
[
ty≥
] = (*)
	`lodïng_mÆloc
(
löebyãs
);

5578 if(!
©ãm±
[
ty≥
]Ë
îr‹
 = 83;

5581 if(!
îr‹
) {

5582 
y
 = 0; y !
h
; ++y) {

5584 
ty≥
 = 0;Åype != 5; ++type) {

5585 
size_t
 
sum
 = 0;

5586 
	`fûãrSˇ∆öe
(
©ãm±
[
ty≥
], &
ö
[
y
 * 
löebyãs
], 
¥evlöe
,Üöebyãs, 
byãwidth
,Åype);

5587 
	`lodïng_mem£t
(
cou¡
, 0, 256 * (*count));

5588 
x
 = 0; x !
löebyãs
; ++xË++
cou¡
[
©ãm±
[
ty≥
][x]];

5589 ++
cou¡
[
ty≥
];

5590 
x
 = 0; x != 256; ++x) {

5591 
sum
 +
	`ûog2i
(
cou¡
[
x
]);

5594 if(
ty≥
 =0 || 
sum
 > 
be°Sum
) {

5595 
be°Ty≥
 = 
ty≥
;

5596 
be°Sum
 = 
sum
;

5600 
¥evlöe
 = &
ö
[
y
 * 
löebyãs
];

5603 
out
[
y
 * (
löebyãs
 + 1)] = 
be°Ty≥
;

5604 
x
 = 0; x !
löebyãs
; ++xË
out
[
y
 * (löebyã†+ 1Ë+ 1 + x] = 
©ãm±
[
be°Ty≥
][x];

5608 
ty≥
 = 0;Åy≥ !5; ++ty≥Ë
	`lodïng_‰ì
(
©ãm±
[type]);

5609 } if(
°øãgy
 =
LFS_PREDEFINED
) {

5610 
y
 = 0; y !
h
; ++y) {

5611 
size_t
 
outödex
 = (1 + 
löebyãs
Ë* 
y
;

5612 
size_t
 
öödex
 = 
löebyãs
 * 
y
;

5613 
ty≥
 = 
£âögs
->
¥edeföed_fûãrs
[
y
];

5614 
out
[
outödex
] = 
ty≥
;

5615 
	`fûãrSˇ∆öe
(&
out
[
outödex
 + 1], &
ö
[
öödex
], 
¥evlöe
, 
löebyãs
, 
byãwidth
, 
ty≥
);

5616 
¥evlöe
 = &
ö
[
öödex
];

5618 } if(
°øãgy
 =
LFS_BRUTE_FORCE
) {

5622 
size_t
 
size
[5];

5623 * 
©ãm±
[5];

5624 
size_t
 
smÆÀ°
 = 0;

5625 
ty≥
 = 0, 
be°Ty≥
 = 0;

5626 * 
dummy
;

5627 
LodePNGCom¥essSëtögs
 
zlib£âögs
;

5628 
	`lodïng_mem˝y
(&
zlib£âögs
, &
£âögs
->zlib£âögs, (
LodePNGCom¥essSëtögs
));

5633 
zlib£âögs
.
bty≥
 = 1;

5636 
zlib£âögs
.
cu°om_zlib
 = 0;

5637 
zlib£âögs
.
cu°om_deÊ©e
 = 0;

5638 
ty≥
 = 0;Åype != 5; ++type) {

5639 
©ãm±
[
ty≥
] = (*)
	`lodïng_mÆloc
(
löebyãs
);

5640 if(!
©ãm±
[
ty≥
]Ë
îr‹
 = 83;

5642 if(!
îr‹
) {

5643 
y
 = 0; y !
h
; ++y) {

5644 
ty≥
 = 0;Åype != 5; ++type) {

5645 
ã°size
 = ()
löebyãs
;

5648 
	`fûãrSˇ∆öe
(
©ãm±
[
ty≥
], &
ö
[
y
 * 
löebyãs
], 
¥evlöe
,Üöebyãs, 
byãwidth
,Åype);

5649 
size
[
ty≥
] = 0;

5650 
dummy
 = 0;

5651 
	`zlib_com¥ess
(&
dummy
, &
size
[
ty≥
], 
©ãm±
[ty≥], 
ã°size
, &
zlib£âögs
);

5652 
	`lodïng_‰ì
(
dummy
);

5654 if(
ty≥
 =0 || 
size
[ty≥] < 
smÆÀ°
) {

5655 
be°Ty≥
 = 
ty≥
;

5656 
smÆÀ°
 = 
size
[
ty≥
];

5659 
¥evlöe
 = &
ö
[
y
 * 
löebyãs
];

5660 
out
[
y
 * (
löebyãs
 + 1)] = 
be°Ty≥
;

5661 
x
 = 0; x !
löebyãs
; ++xË
out
[
y
 * (löebyã†+ 1Ë+ 1 + x] = 
©ãm±
[
be°Ty≥
][x];

5664 
ty≥
 = 0;Åy≥ !5; ++ty≥Ë
	`lodïng_‰ì
(
©ãm±
[type]);

5668  
îr‹
;

5669 
	}
}

5671 
	$addPaddögBôs
(* 
out
, c⁄° * 
ö
,

5672 
size_t
 
ﬁöebôs
, size_à
ûöebôs
, 
h
) {

5675 
y
;

5676 
size_t
 
diff
 = 
ﬁöebôs
 - 
ûöebôs
;

5677 
size_t
 
obp
 = 0, 
ibp
 = 0;

5678 
y
 = 0; y !
h
; ++y) {

5679 
size_t
 
x
;

5680 
x
 = 0; x < 
ûöebôs
; ++x) {

5681 
bô
 = 
	`ªadBôFromRevî£dSåóm
(&
ibp
, 
ö
);

5682 
	`£tBôOfRevî£dSåóm
(&
obp
, 
out
, 
bô
);

5686 
x
 = 0; x !
diff
; ++xË
	`£tBôOfRevî£dSåóm
(&
obp
, 
out
, 0);

5688 
	}
}

5701 
	$Adam7_öãæa˚
(* 
out
, c⁄° * 
ö
, 
w
, 
h
, 
bµ
) {

5702 
∑ssw
[7], 
∑ssh
[7];

5703 
size_t
 
fûãr_∑ss°¨t
[8], 
∑dded_∑ss°¨t
[8], 
∑ss°¨t
[8];

5704 
i
;

5706 
	`Adam7_gë∑ssvÆues
(
∑ssw
, 
∑ssh
, 
fûãr_∑ss°¨t
, 
∑dded_∑ss°¨t
, 
∑ss°¨t
, 
w
, 
h
, 
bµ
);

5708 if(
bµ
 >= 8) {

5709 
i
 = 0; i != 7; ++i) {

5710 
x
, 
y
, 
b
;

5711 
size_t
 
byãwidth
 = 
bµ
 / 8u;

5712 
y
 = 0; y < 
∑ssh
[
i
]; ++y)

5713 
x
 = 0; x < 
∑ssw
[
i
]; ++x) {

5714 
size_t
 
pixñö°¨t
 = ((
ADAM7_IY
[
i
] + 
y
 * 
ADAM7_DY
[i]Ë* 
w
 + 
ADAM7_IX
[i] + 
x
 * 
ADAM7_DX
[i]Ë* 
byãwidth
;

5715 
size_t
 
pixñout°¨t
 = 
∑ss°¨t
[
i
] + (
y
 * 
∑ssw
[i] + 
x
Ë* 
byãwidth
;

5716 
b
 = 0; b < 
byãwidth
; ++b) {

5717 
out
[
pixñout°¨t
 + 
b
] = 
ö
[
pixñö°¨t
 + b];

5722 
i
 = 0; i != 7; ++i) {

5723 
x
, 
y
, 
b
;

5724 
ûöebôs
 = 
bµ
 * 
∑ssw
[
i
];

5725 
ﬁöebôs
 = 
bµ
 * 
w
;

5726 
size_t
 
obp
, 
ibp
;

5727 
y
 = 0; y < 
∑ssh
[
i
]; ++y)

5728 
x
 = 0; x < 
∑ssw
[
i
]; ++x) {

5729 
ibp
 = (
ADAM7_IY
[
i
] + 
y
 * 
ADAM7_DY
[i]Ë* 
ﬁöebôs
 + (
ADAM7_IX
[i] + 
x
 * 
ADAM7_DX
[i]Ë* 
bµ
;

5730 
obp
 = (8 * 
∑ss°¨t
[
i
]Ë+ (
y
 * 
ûöebôs
 + 
x
 * 
bµ
);

5731 
b
 = 0; b < 
bµ
; ++b) {

5732 
bô
 = 
	`ªadBôFromRevî£dSåóm
(&
ibp
, 
ö
);

5733 
	`£tBôOfRevî£dSåóm
(&
obp
, 
out
, 
bô
);

5738 
	}
}

5742 
	$¥ePro˚ssSˇ∆öes
(** 
out
, 
size_t
* 
outsize
, c⁄° * 
ö
,

5743 
w
, 
h
,

5744 c⁄° 
LodePNGInfo
* 
öfo_≤g
, c⁄° 
LodePNGEncodîSëtögs
* 
£âögs
) {

5750 
bµ
 = 
	`lodïng_gë_bµ
(&
öfo_≤g
->
cﬁ‹
);

5751 
îr‹
 = 0;

5753 if(
öfo_≤g
->
öãæa˚_mëhod
 == 0) {

5754 *
outsize
 = 
h
 + (h * ((
w
 * 
bµ
 + 7u) / 8u));

5755 *
out
 = (*)
	`lodïng_mÆloc
(*
outsize
);

5756 if(!(*
out
Ë&& (*
outsize
)Ë
îr‹
 = 83;

5758 if(!
îr‹
) {

5760 if(
bµ
 < 8 && 
w
 * bpp != ((w * bpp + 7u) / 8u) * 8u) {

5761 * 
∑dded
 = (*)
	`lodïng_mÆloc
(
h
 * ((
w
 * 
bµ
 + 7u) / 8u));

5762 if(!
∑dded
Ë
îr‹
 = 83;

5763 if(!
îr‹
) {

5764 
	`addPaddögBôs
(
∑dded
, 
ö
, ((
w
 * 
bµ
 + 7uË/ 8uË* 8u, w * bµ, 
h
);

5765 
îr‹
 = 
	`fûãr
(*
out
, 
∑dded
, 
w
, 
h
, &
öfo_≤g
->
cﬁ‹
, 
£âögs
);

5767 
	`lodïng_‰ì
(
∑dded
);

5770 
îr‹
 = 
	`fûãr
(*
out
, 
ö
, 
w
, 
h
, &
öfo_≤g
->
cﬁ‹
, 
£âögs
);

5774 
∑ssw
[7], 
∑ssh
[7];

5775 
size_t
 
fûãr_∑ss°¨t
[8], 
∑dded_∑ss°¨t
[8], 
∑ss°¨t
[8];

5776 * 
adam7
;

5778 
	`Adam7_gë∑ssvÆues
(
∑ssw
, 
∑ssh
, 
fûãr_∑ss°¨t
, 
∑dded_∑ss°¨t
, 
∑ss°¨t
, 
w
, 
h
, 
bµ
);

5780 *
outsize
 = 
fûãr_∑ss°¨t
[7];

5781 *
out
 = (*)
	`lodïng_mÆloc
(*
outsize
);

5782 if(!(*
out
)Ë
îr‹
 = 83;

5784 
adam7
 = (*)
	`lodïng_mÆloc
(
∑ss°¨t
[7]);

5785 if(!
adam7
 && 
∑ss°¨t
[7]Ë
îr‹
 = 83;

5787 if(!
îr‹
) {

5788 
i
;

5790 
	`Adam7_öãæa˚
(
adam7
, 
ö
, 
w
, 
h
, 
bµ
);

5791 
i
 = 0; i != 7; ++i) {

5792 if(
bµ
 < 8) {

5793 * 
∑dded
 = (*)
	`lodïng_mÆloc
(
∑dded_∑ss°¨t
[
i
 + 1] -Öadded_passstart[i]);

5794 if(!
∑dded
Ë
	`ERROR_BREAK
(83);

5795 
	`addPaddögBôs
(
∑dded
, &
adam7
[
∑ss°¨t
[
i
]],

5796 ((
∑ssw
[
i
] * 
bµ
 + 7uË/ 8uË* 8u,Öassw[i] * bµ, 
∑ssh
[i]);

5797 
îr‹
 = 
	`fûãr
(&(*
out
)[
fûãr_∑ss°¨t
[
i
]], 
∑dded
,

5798 
∑ssw
[
i
], 
∑ssh
[i], &
öfo_≤g
->
cﬁ‹
, 
£âögs
);

5799 
	`lodïng_‰ì
(
∑dded
);

5801 
îr‹
 = 
	`fûãr
(&(*
out
)[
fûãr_∑ss°¨t
[
i
]], &
adam7
[
∑dded_∑ss°¨t
[i]],

5802 
∑ssw
[
i
], 
∑ssh
[i], &
öfo_≤g
->
cﬁ‹
, 
£âögs
);

5805 if(
îr‹
) ;

5809 
	`lodïng_‰ì
(
adam7
);

5812  
îr‹
;

5813 
	}
}

5815 #ifde‡
LODEPNG_COMPILE_ANCILLARY_CHUNKS


5816 
	$addUnknownChunks
(
ucve˘‹
* 
out
, * 
d©a
, 
size_t
 
d©asize
) {

5817 * 
öchunk
 = 
d©a
;

5818 (
size_t
)(
öchunk
 - 
d©a
Ë< 
d©asize
) {

5819 
	`CERROR_TRY_RETURN
(
	`lodïng_chunk_≠≥nd
(&
out
->
d©a
, &out->
size
, 
öchunk
));

5820 
out
->
Ælocsize
 = out->
size
;

5821 
öchunk
 = 
	`lodïng_chunk_√xt
(öchunk, 
d©a
 + 
d©asize
);

5824 
	}
}

5826 
	$isGøyICCProfûe
(c⁄° * 
¥ofûe
, 
size
) {

5836 if(
size
 < 20)  0;

5837  
¥ofûe
[16] == 'G' &&Örofile[17] == 'R' &&Örofile[18] == 'A' &&Örofile[19] == 'Y';

5838 
	}
}

5840 
	$isRGBICCProfûe
(c⁄° * 
¥ofûe
, 
size
) {

5842 if(
size
 < 20)  0;

5843  
¥ofûe
[16] == 'R' &&Örofile[17] == 'G' &&Örofile[18] == 'B' &&Örofile[19] == ' ';

5844 
	}
}

5847 
	$lodïng_ícode
(** 
out
, 
size_t
* 
outsize
,

5848 c⁄° * 
image
, 
w
, 
h
,

5849 
LodePNGSèã
* 
°©e
) {

5850 * 
d©a
 = 0;

5851 
size_t
 
d©asize
 = 0;

5852 
ucve˘‹
 
outv
 = 
	`ucve˘‹_öô
(
NULL
, 0);

5853 
LodePNGInfo
 
öfo
;

5854 c⁄° 
LodePNGInfo
* 
öfo_≤g
 = &
°©e
->info_png;

5856 
	`lodïng_öfo_öô
(&
öfo
);

5859 *
out
 = 0;

5860 *
outsize
 = 0;

5861 
°©e
->
îr‹
 = 0;

5864 if((
öfo_≤g
->
cﬁ‹
.
cﬁ‹ty≥
 =
LCT_PALETTE
 || 
°©e
->
ícodî
.
f‹˚_∑Àâe
)

5865 && (
öfo_≤g
->
cﬁ‹
.
∑Àâesize
 == 0 || info_png->color.palettesize > 256)) {

5866 
°©e
->
îr‹
 = 68;

5867 
˛ónup
;

5869 if(
°©e
->
ícodî
.
zlib£âögs
.
bty≥
 > 2) {

5870 
°©e
->
îr‹
 = 61;

5871 
˛ónup
;

5873 if(
öfo_≤g
->
öãæa˚_mëhod
 > 1) {

5874 
°©e
->
îr‹
 = 71;

5875 
˛ónup
;

5877 
°©e
->
îr‹
 = 
	`checkCﬁ‹VÆidôy
(
öfo_≤g
->
cﬁ‹
.
cﬁ‹ty≥
, info_≤g->cﬁ‹.
bôdïth
);

5878 if(
°©e
->
îr‹
Ë
˛ónup
;

5879 
°©e
->
îr‹
 = 
	`checkCﬁ‹VÆidôy
(°©e->
öfo_øw
.
cﬁ‹ty≥
, sèã->öfo_øw.
bôdïth
);

5880 if(
°©e
->
îr‹
Ë
˛ónup
;

5883 
	`lodïng_öfo_c›y
(&
öfo
, &
°©e
->
öfo_≤g
);

5884 if(
°©e
->
ícodî
.
auto_c⁄vît
) {

5885 
LodePNGCﬁ‹Sèts
 
°©s
;

5886 
	`lodïng_cﬁ‹_°©s_öô
(&
°©s
);

5887 #ifde‡
LODEPNG_COMPILE_ANCILLARY_CHUNKS


5888 if(
öfo_≤g
->
ic˝_deföed
 &&

5889 
	`isGøyICCProfûe
(
öfo_≤g
->
ic˝_¥ofûe
, info_≤g->
ic˝_¥ofûe_size
)) {

5892 
°©s
.
Ælow_∑Àâe
 = 0;

5894 if(
öfo_≤g
->
ic˝_deföed
 &&

5895 
	`isRGBICCProfûe
(
öfo_≤g
->
ic˝_¥ofûe
, info_≤g->
ic˝_¥ofûe_size
)) {

5897 
°©s
.
Ælow_gªysˇÀ
 = 0;

5900 
°©e
->
îr‹
 = 
	`lodïng_compuã_cﬁ‹_°©s
(&
°©s
, 
image
, 
w
, 
h
, &°©e->
öfo_øw
);

5901 if(
°©e
->
îr‹
Ë
˛ónup
;

5902 #ifde‡
LODEPNG_COMPILE_ANCILLARY_CHUNKS


5903 if(
öfo_≤g
->
background_deföed
) {

5905 
r
 = 0, 
g
 = 0, 
b
 = 0;

5906 
LodePNGCﬁ‹Mode
 
mode16
 = 
	`lodïng_cﬁ‹_mode_make
(
LCT_RGB
, 16);

5907 
	`lodïng_c⁄vît_rgb
(&
r
, &
g
, &
b
, 
öfo_≤g
->
background_r
, info_≤g->
background_g
, info_≤g->
background_b
, &
mode16
, &öfo_≤g->
cﬁ‹
);

5908 
°©e
->
îr‹
 = 
	`lodïng_cﬁ‹_°©s_add
(&
°©s
, 
r
, 
g
, 
b
, 65535);

5909 if(
°©e
->
îr‹
Ë
˛ónup
;

5912 
°©e
->
îr‹
 = 
	`auto_choo£_cﬁ‹
(&
öfo
.
cﬁ‹
, &°©e->
öfo_øw
, &
°©s
);

5913 if(
°©e
->
îr‹
Ë
˛ónup
;

5914 #ifde‡
LODEPNG_COMPILE_ANCILLARY_CHUNKS


5916 if(
öfo_≤g
->
background_deföed
) {

5917 if(
	`lodïng_c⁄vît_rgb
(&
öfo
.
background_r
, &öfo.
background_g
, &öfo.
background_b
,

5918 
öfo_≤g
->
background_r
, info_≤g->
background_g
, info_≤g->
background_b
, &
öfo
.
cﬁ‹
, &info_png->color)) {

5919 
°©e
->
îr‹
 = 104;

5920 
˛ónup
;

5925 #ifde‡
LODEPNG_COMPILE_ANCILLARY_CHUNKS


5926 if(
öfo_≤g
->
ic˝_deföed
) {

5927 
gøy_icc
 = 
	`isGøyICCProfûe
(
öfo_≤g
->
ic˝_¥ofûe
, info_≤g->
ic˝_¥ofûe_size
);

5928 
rgb_icc
 = 
	`isRGBICCProfûe
(
öfo_≤g
->
ic˝_¥ofûe
, info_≤g->
ic˝_¥ofûe_size
);

5929 
gøy_≤g
 = 
öfo
.
cﬁ‹
.
cﬁ‹ty≥
 =
LCT_GREY
 || info.cﬁ‹.cﬁ‹ty≥ =
LCT_GREY_ALPHA
;

5930 if(!
gøy_icc
 && !
rgb_icc
) {

5931 
°©e
->
îr‹
 = 100;

5932 
˛ónup
;

5934 if(
gøy_icc
 !
gøy_≤g
) {

5937 
°©e
->
îr‹
 = sèã->
ícodî
.
auto_c⁄vît
 ? 102 : 101;

5938 
˛ónup
;

5942 if(!
	`lodïng_cﬁ‹_mode_equÆ
(&
°©e
->
öfo_øw
, &
öfo
.
cﬁ‹
)) {

5943 * 
c⁄vîãd
;

5944 
size_t
 
size
 = ((size_t)
w
 * (size_t)
h
 * (size_t)
	`lodïng_gë_bµ
(&
öfo
.
cﬁ‹
) + 7u) / 8u;

5946 
c⁄vîãd
 = (*)
	`lodïng_mÆloc
(
size
);

5947 if(!
c⁄vîãd
 && 
size
Ë
°©e
->
îr‹
 = 83;

5948 if(!
°©e
->
îr‹
) {

5949 
°©e
->
îr‹
 = 
	`lodïng_c⁄vît
(
c⁄vîãd
, 
image
, &
öfo
.
cﬁ‹
, &°©e->
öfo_øw
, 
w
, 
h
);

5951 if(!
°©e
->
îr‹
) {

5952 
°©e
->
îr‹
 = 
	`¥ePro˚ssSˇ∆öes
(&
d©a
, &
d©asize
, 
c⁄vîãd
, 
w
, 
h
, &
öfo
, &°©e->
ícodî
);

5954 
	`lodïng_‰ì
(
c⁄vîãd
);

5955 if(
°©e
->
îr‹
Ë
˛ónup
;

5957 
°©e
->
îr‹
 = 
	`¥ePro˚ssSˇ∆öes
(&
d©a
, &
d©asize
, 
image
, 
w
, 
h
, &
öfo
, &°©e->
ícodî
);

5958 if(
°©e
->
îr‹
Ë
˛ónup
;

5962 #ifde‡
LODEPNG_COMPILE_ANCILLARY_CHUNKS


5963 
size_t
 
i
;

5966 
°©e
->
îr‹
 = 
	`wrôeSig«tuª
(&
outv
);

5967 if(
°©e
->
îr‹
Ë
˛ónup
;

5969 
°©e
->
îr‹
 = 
	`addChunk_IHDR
(&
outv
, 
w
, 
h
, 
öfo
.
cﬁ‹
.
cﬁ‹ty≥
, info.cﬁ‹.
bôdïth
, info.
öãæa˚_mëhod
);

5970 if(
°©e
->
îr‹
Ë
˛ónup
;

5971 #ifde‡
LODEPNG_COMPILE_ANCILLARY_CHUNKS


5973 if(
öfo
.
unknown_chunks_d©a
[0]) {

5974 
°©e
->
îr‹
 = 
	`addUnknownChunks
(&
outv
, 
öfo
.
unknown_chunks_d©a
[0], info.
unknown_chunks_size
[0]);

5975 if(
°©e
->
îr‹
Ë
˛ónup
;

5978 if(
öfo
.
ic˝_deföed
) {

5979 
°©e
->
îr‹
 = 
	`addChunk_iCCP
(&
outv
, &
öfo
, &°©e->
ícodî
.
zlib£âögs
);

5980 if(
°©e
->
îr‹
Ë
˛ónup
;

5982 if(
öfo
.
§gb_deföed
) {

5983 
°©e
->
îr‹
 = 
	`addChunk_sRGB
(&
outv
, &
öfo
);

5984 if(
°©e
->
îr‹
Ë
˛ónup
;

5986 if(
öfo
.
gama_deföed
) {

5987 
°©e
->
îr‹
 = 
	`addChunk_gAMA
(&
outv
, &
öfo
);

5988 if(
°©e
->
îr‹
Ë
˛ónup
;

5990 if(
öfo
.
chrm_deföed
) {

5991 
°©e
->
îr‹
 = 
	`addChunk_cHRM
(&
outv
, &
öfo
);

5992 if(
°©e
->
îr‹
Ë
˛ónup
;

5996 if(
öfo
.
cﬁ‹
.
cﬁ‹ty≥
 =
LCT_PALETTE
) {

5997 
°©e
->
îr‹
 = 
	`addChunk_PLTE
(&
outv
, &
öfo
.
cﬁ‹
);

5998 if(
°©e
->
îr‹
Ë
˛ónup
;

6000 if(
°©e
->
ícodî
.
f‹˚_∑Àâe
 && (
öfo
.
cﬁ‹
.
cﬁ‹ty≥
 =
LCT_RGB
 || info.cﬁ‹.cﬁ‹ty≥ =
LCT_RGBA
)) {

6002 
°©e
->
îr‹
 = 
	`addChunk_PLTE
(&
outv
, &
öfo
.
cﬁ‹
);

6003 if(
°©e
->
îr‹
Ë
˛ónup
;

6006 
°©e
->
îr‹
 = 
	`addChunk_tRNS
(&
outv
, &
öfo
.
cﬁ‹
);

6007 if(
°©e
->
îr‹
Ë
˛ónup
;

6008 #ifde‡
LODEPNG_COMPILE_ANCILLARY_CHUNKS


6010 if(
öfo
.
background_deföed
) {

6011 
°©e
->
îr‹
 = 
	`addChunk_bKGD
(&
outv
, &
öfo
);

6012 if(
°©e
->
îr‹
Ë
˛ónup
;

6015 if(
öfo
.
phys_deföed
) {

6016 
°©e
->
îr‹
 = 
	`addChunk_pHYs
(&
outv
, &
öfo
);

6017 if(
°©e
->
îr‹
Ë
˛ónup
;

6021 if(
öfo
.
unknown_chunks_d©a
[1]) {

6022 
°©e
->
îr‹
 = 
	`addUnknownChunks
(&
outv
, 
öfo
.
unknown_chunks_d©a
[1], info.
unknown_chunks_size
[1]);

6023 if(
°©e
->
îr‹
Ë
˛ónup
;

6027 
°©e
->
îr‹
 = 
	`addChunk_IDAT
(&
outv
, 
d©a
, 
d©asize
, &°©e->
ícodî
.
zlib£âögs
);

6028 if(
°©e
->
îr‹
Ë
˛ónup
;

6029 #ifde‡
LODEPNG_COMPILE_ANCILLARY_CHUNKS


6031 if(
öfo
.
time_deföed
) {

6032 
°©e
->
îr‹
 = 
	`addChunk_tIME
(&
outv
, &
öfo
.
time
);

6033 if(
°©e
->
îr‹
Ë
˛ónup
;

6036 
i
 = 0; i !
öfo
.
ãxt_num
; ++i) {

6037 if(
	`lodïng_°æí
(
öfo
.
ãxt_keys
[
i
]) > 79) {

6038 
°©e
->
îr‹
 = 66;

6039 
˛ónup
;

6041 if(
	`lodïng_°æí
(
öfo
.
ãxt_keys
[
i
]) < 1) {

6042 
°©e
->
îr‹
 = 67;

6043 
˛ónup
;

6045 if(
°©e
->
ícodî
.
ãxt_com¥essi⁄
) {

6046 
°©e
->
îr‹
 = 
	`addChunk_zTXt
(&
outv
, 
öfo
.
ãxt_keys
[
i
], info.
ãxt_°rögs
[i], &°©e->
ícodî
.
zlib£âögs
);

6047 if(
°©e
->
îr‹
Ë
˛ónup
;

6049 
°©e
->
îr‹
 = 
	`addChunk_tEXt
(&
outv
, 
öfo
.
ãxt_keys
[
i
], info.
ãxt_°rögs
[i]);

6050 if(
°©e
->
îr‹
Ë
˛ónup
;

6054 if(
°©e
->
ícodî
.
add_id
) {

6055 
Æªady_added_id_ãxt
 = 0;

6056 
i
 = 0; i !
öfo
.
ãxt_num
; ++i) {

6057 c⁄° * 
k
 = 
öfo
.
ãxt_keys
[
i
];

6059 if(
k
[0] == 'L' && k[1] == 'o' && k[2] == 'd' && k[3] == 'e' &&

6060 
k
[4] == 'P' && k[5] == 'N' && k[6] == 'G' && k[7] == '\0') {

6061 
Æªady_added_id_ãxt
 = 1;

6065 if(
Æªady_added_id_ãxt
 == 0) {

6066 
°©e
->
îr‹
 = 
	`addChunk_tEXt
(&
outv
, "LodePNG", 
LODEPNG_VERSION_STRING
);

6067 if(
°©e
->
îr‹
Ë
˛ónup
;

6071 
i
 = 0; i !
öfo
.
ôext_num
; ++i) {

6072 if(
	`lodïng_°æí
(
öfo
.
ôext_keys
[
i
]) > 79) {

6073 
°©e
->
îr‹
 = 66;

6074 
˛ónup
;

6076 if(
	`lodïng_°æí
(
öfo
.
ôext_keys
[
i
]) < 1) {

6077 
°©e
->
îr‹
 = 67;

6078 
˛ónup
;

6080 
°©e
->
îr‹
 = 
	`addChunk_iTXt
(

6081 &
outv
, 
°©e
->
ícodî
.
ãxt_com¥essi⁄
,

6082 
öfo
.
ôext_keys
[
i
], info.
ôext_œngègs
[i], info.
ôext_å™skeys
[i], info.
ôext_°rögs
[i],

6083 &
°©e
->
ícodî
.
zlib£âögs
);

6084 if(
°©e
->
îr‹
Ë
˛ónup
;

6088 if(
öfo
.
unknown_chunks_d©a
[2]) {

6089 
°©e
->
îr‹
 = 
	`addUnknownChunks
(&
outv
, 
öfo
.
unknown_chunks_d©a
[2], info.
unknown_chunks_size
[2]);

6090 if(
°©e
->
îr‹
Ë
˛ónup
;

6093 
°©e
->
îr‹
 = 
	`addChunk_IEND
(&
outv
);

6094 if(
°©e
->
îr‹
Ë
˛ónup
;

6097 
˛ónup
:

6098 
	`lodïng_öfo_˛ónup
(&
öfo
);

6099 
	`lodïng_‰ì
(
d©a
);

6102 *
out
 = 
outv
.
d©a
;

6103 *
outsize
 = 
outv
.
size
;

6105  
°©e
->
îr‹
;

6106 
	}
}

6108 
	$lodïng_ícode_mem‹y
(** 
out
, 
size_t
* 
outsize
, c⁄° * 
image
,

6109 
w
, 
h
, 
LodePNGCﬁ‹Ty≥
 
cﬁ‹ty≥
, 
bôdïth
) {

6110 
îr‹
;

6111 
LodePNGSèã
 
°©e
;

6112 
	`lodïng_°©e_öô
(&
°©e
);

6113 
°©e
.
öfo_øw
.
cﬁ‹ty≥
 = colortype;

6114 
°©e
.
öfo_øw
.
bôdïth
 = bitdepth;

6115 
°©e
.
öfo_≤g
.
cﬁ‹
.
cﬁ‹ty≥
 = colortype;

6116 
°©e
.
öfo_≤g
.
cﬁ‹
.
bôdïth
 = bitdepth;

6117 
	`lodïng_ícode
(
out
, 
outsize
, 
image
, 
w
, 
h
, &
°©e
);

6118 
îr‹
 = 
°©e
.error;

6119 
	`lodïng_°©e_˛ónup
(&
°©e
);

6120  
îr‹
;

6121 
	}
}

6123 
	$lodïng_ícode32
(** 
out
, 
size_t
* 
outsize
, c⁄° * 
image
, 
w
, 
h
) {

6124  
	`lodïng_ícode_mem‹y
(
out
, 
outsize
, 
image
, 
w
, 
h
, 
LCT_RGBA
, 8);

6125 
	}
}

6127 
	$lodïng_ícode24
(** 
out
, 
size_t
* 
outsize
, c⁄° * 
image
, 
w
, 
h
) {

6128  
	`lodïng_ícode_mem‹y
(
out
, 
outsize
, 
image
, 
w
, 
h
, 
LCT_RGB
, 8);

6129 
	}
}

6131 #ifde‡
LODEPNG_COMPILE_DISK


6132 
	$lodïng_ícode_fûe
(c⁄° * 
fûíame
, c⁄° * 
image
, 
w
, 
h
,

6133 
LodePNGCﬁ‹Ty≥
 
cﬁ‹ty≥
, 
bôdïth
) {

6134 * 
buf„r
;

6135 
size_t
 
buf„rsize
;

6136 
îr‹
 = 
	`lodïng_ícode_mem‹y
(&
buf„r
, &
buf„rsize
, 
image
, 
w
, 
h
, 
cﬁ‹ty≥
, 
bôdïth
);

6137 if(!
îr‹
Ëîr‹ = 
	`lodïng_ßve_fûe
(
buf„r
, 
buf„rsize
, 
fûíame
);

6138 
	`lodïng_‰ì
(
buf„r
);

6139  
îr‹
;

6140 
	}
}

6142 
	$lodïng_ícode32_fûe
(c⁄° * 
fûíame
, c⁄° * 
image
, 
w
, 
h
) {

6143  
	`lodïng_ícode_fûe
(
fûíame
, 
image
, 
w
, 
h
, 
LCT_RGBA
, 8);

6144 
	}
}

6146 
	$lodïng_ícode24_fûe
(c⁄° * 
fûíame
, c⁄° * 
image
, 
w
, 
h
) {

6147  
	`lodïng_ícode_fûe
(
fûíame
, 
image
, 
w
, 
h
, 
LCT_RGB
, 8);

6148 
	}
}

6151 
	$lodïng_ícodî_£âögs_öô
(
LodePNGEncodîSëtögs
* 
£âögs
) {

6152 
	`lodïng_com¥ess_£âögs_öô
(&
£âögs
->
zlib£âögs
);

6153 
£âögs
->
fûãr_∑Àâe_zîo
 = 1;

6154 
£âögs
->
fûãr_°øãgy
 = 
LFS_MINSUM
;

6155 
£âögs
->
auto_c⁄vît
 = 1;

6156 
£âögs
->
f‹˚_∑Àâe
 = 0;

6157 
£âögs
->
¥edeföed_fûãrs
 = 0;

6158 #ifde‡
LODEPNG_COMPILE_ANCILLARY_CHUNKS


6159 
£âögs
->
add_id
 = 0;

6160 
£âögs
->
ãxt_com¥essi⁄
 = 1;

6162 
	}
}

6167 #ifde‡
LODEPNG_COMPILE_ERROR_TEXT


6172 c⁄° * 
	$lodïng_îr‹_ãxt
(
code
) {

6173 
code
) {

6296 
	}
}

6305 #ifde‡
LODEPNG_COMPILE_CPP


6306 
«me•a˚
 
	glodïng
 {

6308 #ifde‡
LODEPNG_COMPILE_DISK


6309 
lﬂd_fûe
(
°d
::
ve˘‹
<>& 
buf„r
, c⁄° std::
°rög
& 
fûíame
) {

6310 
size
 = 
lodïng_fûesize
(
fûíame
.
c_°r
());

6311 if(
	gsize
 < 0)  78;

6312 
	gbuf„r
.
ªsize
((
size_t
)
size
);

6313  
	gsize
 =0 ? 0 : 
lodïng_buf„r_fûe
(&
buf„r
[0], (
size_t
)
size
, 
fûíame
.
c_°r
());

6317 
ßve_fûe
(c⁄° 
°d
::
ve˘‹
<>& 
buf„r
, c⁄° std::
°rög
& 
fûíame
) {

6318  
lodïng_ßve_fûe
(
buf„r
.
em±y
(Ë? 0 : &buf„r[0], buf„r.
size
(), 
fûíame
.
c_°r
());

6322 #ifde‡
LODEPNG_COMPILE_ZLIB


6323 #ifde‡
LODEPNG_COMPILE_DECODER


6324 
decom¥ess
(
°d
::
ve˘‹
<>& 
out
, c⁄° * 
ö
, 
size_t
 
ösize
,

6325 c⁄° 
LodePNGDecom¥essSëtögs
& 
£âögs
) {

6326 * 
	gbuf„r
 = 0;

6327 
size_t
 
	gbuf„rsize
 = 0;

6328 
	gîr‹
 = 
zlib_decom¥ess
(&
buf„r
, &
buf„rsize
, 0, 
ö
, 
ösize
, &
£âögs
);

6329 if(
	gbuf„r
) {

6330 
	gout
.
ö£π
(
out
.
íd
(), &
buf„r
[0], &buf„r[
buf„rsize
]);

6331 
lodïng_‰ì
(
buf„r
);

6333  
	gîr‹
;

6336 
decom¥ess
(
°d
::
ve˘‹
<>& 
out
, c⁄° std::ve˘‹<>& 
ö
,

6337 c⁄° 
LodePNGDecom¥essSëtögs
& 
£âögs
) {

6338  
decom¥ess
(
out
, 
ö
.
em±y
(Ë? 0 : &ö[0], in.
size
(), 
£âögs
);

6342 #ifde‡
LODEPNG_COMPILE_ENCODER


6343 
com¥ess
(
°d
::
ve˘‹
<>& 
out
, c⁄° * 
ö
, 
size_t
 
ösize
,

6344 c⁄° 
LodePNGCom¥essSëtögs
& 
£âögs
) {

6345 * 
	gbuf„r
 = 0;

6346 
size_t
 
	gbuf„rsize
 = 0;

6347 
	gîr‹
 = 
zlib_com¥ess
(&
buf„r
, &
buf„rsize
, 
ö
, 
ösize
, &
£âögs
);

6348 if(
	gbuf„r
) {

6349 
	gout
.
ö£π
(
out
.
íd
(), &
buf„r
[0], &buf„r[
buf„rsize
]);

6350 
lodïng_‰ì
(
buf„r
);

6352  
	gîr‹
;

6355 
com¥ess
(
°d
::
ve˘‹
<>& 
out
, c⁄° std::ve˘‹<>& 
ö
,

6356 c⁄° 
LodePNGCom¥essSëtögs
& 
£âögs
) {

6357  
com¥ess
(
out
, 
ö
.
em±y
(Ë? 0 : &ö[0], in.
size
(), 
£âögs
);

6363 #ifde‡
LODEPNG_COMPILE_PNG


6365 
	gSèã
::
Sèã
() {

6366 
lodïng_°©e_öô
(
this
);

6369 
	gSèã
::
Sèã
(c⁄° Sèã& 
Ÿhî
) {

6370 
lodïng_°©e_öô
(
this
);

6371 
lodïng_°©e_c›y
(
this
, &
Ÿhî
);

6374 
	gSèã
::~
Sèã
() {

6375 
lodïng_°©e_˛ónup
(
this
);

6378 
	gSèã
& Sèã::
›î©‹
=(c⁄° 
Sèã
& 
Ÿhî
) {

6379 
lodïng_°©e_c›y
(
this
, &
Ÿhî
);

6380  *
	gthis
;

6383 #ifde‡
LODEPNG_COMPILE_DECODER


6385 
decode
(
°d
::
ve˘‹
<>& 
out
, & 
w
, & 
h
, c⁄° * 
ö
,

6386 
size_t
 
ösize
, 
LodePNGCﬁ‹Ty≥
 
cﬁ‹ty≥
, 
bôdïth
) {

6387 * 
	gbuf„r
 = 0;

6388 
	gîr‹
 = 
lodïng_decode_mem‹y
(&
buf„r
, &
w
, &
h
, 
ö
, 
ösize
, 
cﬁ‹ty≥
, 
bôdïth
);

6389 if(
	gbuf„r
 && !
	gîr‹
) {

6390 
Sèã
 
	g°©e
;

6391 
	g°©e
.
	göfo_øw
.
	gcﬁ‹ty≥
 = 
cﬁ‹ty≥
;

6392 
	g°©e
.
	göfo_øw
.
	gbôdïth
 = 
bôdïth
;

6393 
size_t
 
	gbuf„rsize
 = 
lodïng_gë_øw_size
(
w
, 
h
, &
°©e
.
öfo_øw
);

6394 
	gout
.
ö£π
(
out
.
íd
(), &
buf„r
[0], &buf„r[
buf„rsize
]);

6396 
lodïng_‰ì
(
buf„r
);

6397  
	gîr‹
;

6400 
decode
(
°d
::
ve˘‹
<>& 
out
, & 
w
, & 
h
,

6401 c⁄° 
°d
::
ve˘‹
<>& 
ö
, 
LodePNGCﬁ‹Ty≥
 
cﬁ‹ty≥
, 
bôdïth
) {

6402  
decode
(
out
, 
w
, 
h
, 
ö
.
em±y
(Ë? 0 : &ö[0], ()ö.
size
(), 
cﬁ‹ty≥
, 
bôdïth
);

6405 
decode
(
°d
::
ve˘‹
<>& 
out
, & 
w
, & 
h
,

6406 
Sèã
& 
°©e
,

6407 c⁄° * 
ö
, 
size_t
 
ösize
) {

6408 * 
	gbuf„r
 = 
NULL
;

6409 
	gîr‹
 = 
lodïng_decode
(&
buf„r
, &
w
, &
h
, &
°©e
, 
ö
, 
ösize
);

6410 if(
	gbuf„r
 && !
	gîr‹
) {

6411 
size_t
 
	gbuf„rsize
 = 
lodïng_gë_øw_size
(
w
, 
h
, &
°©e
.
öfo_øw
);

6412 
	gout
.
ö£π
(
out
.
íd
(), &
buf„r
[0], &buf„r[
buf„rsize
]);

6414 
lodïng_‰ì
(
buf„r
);

6415  
	gîr‹
;

6418 
decode
(
°d
::
ve˘‹
<>& 
out
, & 
w
, & 
h
,

6419 
Sèã
& 
°©e
,

6420 c⁄° 
°d
::
ve˘‹
<>& 
ö
) {

6421  
decode
(
out
, 
w
, 
h
, 
°©e
, 
ö
.
em±y
(Ë? 0 : &ö[0], in.
size
());

6424 #ifde‡
LODEPNG_COMPILE_DISK


6425 
decode
(
°d
::
ve˘‹
<>& 
out
, & 
w
, & 
h
, c⁄° std::
°rög
& 
fûíame
,

6426 
LodePNGCﬁ‹Ty≥
 
cﬁ‹ty≥
, 
bôdïth
) {

6427 
	g°d
::
ve˘‹
<> 
buf„r
;

6429 
	gw
 = 
h
 = 0;

6430 
	gîr‹
 = 
lﬂd_fûe
(
buf„r
, 
fûíame
);

6431 if(
	gîr‹
) Érror;

6432  
decode
(
out
, 
w
, 
h
, 
buf„r
, 
cﬁ‹ty≥
, 
bôdïth
);

6437 #ifde‡
LODEPNG_COMPILE_ENCODER


6438 
ícode
(
°d
::
ve˘‹
<>& 
out
, c⁄° * 
ö
, 
w
, 
h
,

6439 
LodePNGCﬁ‹Ty≥
 
cﬁ‹ty≥
, 
bôdïth
) {

6440 * 
	gbuf„r
;

6441 
size_t
 
	gbuf„rsize
;

6442 
	gîr‹
 = 
lodïng_ícode_mem‹y
(&
buf„r
, &
buf„rsize
, 
ö
, 
w
, 
h
, 
cﬁ‹ty≥
, 
bôdïth
);

6443 if(
	gbuf„r
) {

6444 
	gout
.
ö£π
(
out
.
íd
(), &
buf„r
[0], &buf„r[
buf„rsize
]);

6445 
lodïng_‰ì
(
buf„r
);

6447  
	gîr‹
;

6450 
ícode
(
°d
::
ve˘‹
<>& 
out
,

6451 c⁄° 
°d
::
ve˘‹
<>& 
ö
, 
w
, 
h
,

6452 
LodePNGCﬁ‹Ty≥
 
cﬁ‹ty≥
, 
bôdïth
) {

6453 if(
lodïng_gë_øw_size_l˘
(
w
, 
h
, 
cﬁ‹ty≥
, 
bôdïth
Ë> 
	gö
.
size
())  84;

6454  
ícode
(
out
, 
ö
.
em±y
(Ë? 0 : &ö[0], 
w
, 
h
, 
cﬁ‹ty≥
, 
bôdïth
);

6457 
ícode
(
°d
::
ve˘‹
<>& 
out
,

6458 c⁄° * 
ö
, 
w
, 
h
,

6459 
Sèã
& 
°©e
) {

6460 * 
	gbuf„r
;

6461 
size_t
 
	gbuf„rsize
;

6462 
	gîr‹
 = 
lodïng_ícode
(&
buf„r
, &
buf„rsize
, 
ö
, 
w
, 
h
, &
°©e
);

6463 if(
	gbuf„r
) {

6464 
	gout
.
ö£π
(
out
.
íd
(), &
buf„r
[0], &buf„r[
buf„rsize
]);

6465 
lodïng_‰ì
(
buf„r
);

6467  
	gîr‹
;

6470 
ícode
(
°d
::
ve˘‹
<>& 
out
,

6471 c⁄° 
°d
::
ve˘‹
<>& 
ö
, 
w
, 
h
,

6472 
Sèã
& 
°©e
) {

6473 if(
lodïng_gë_øw_size
(
w
, 
h
, &
°©e
.
öfo_øw
Ë> 
	gö
.
size
())  84;

6474  
ícode
(
out
, 
ö
.
em±y
(Ë? 0 : &ö[0], 
w
, 
h
, 
°©e
);

6477 #ifde‡
LODEPNG_COMPILE_DISK


6478 
ícode
(c⁄° 
°d
::
°rög
& 
fûíame
,

6479 c⁄° * 
ö
, 
w
, 
h
,

6480 
LodePNGCﬁ‹Ty≥
 
cﬁ‹ty≥
, 
bôdïth
) {

6481 
	g°d
::
ve˘‹
<> 
buf„r
;

6482 
	gîr‹
 = 
ícode
(
buf„r
, 
ö
, 
w
, 
h
, 
cﬁ‹ty≥
, 
bôdïth
);

6483 if(!
	gîr‹
Ëîr‹ = 
ßve_fûe
(
buf„r
, 
fûíame
);

6484  
	gîr‹
;

6487 
ícode
(c⁄° 
°d
::
°rög
& 
fûíame
,

6488 c⁄° 
°d
::
ve˘‹
<>& 
ö
, 
w
, 
h
,

6489 
LodePNGCﬁ‹Ty≥
 
cﬁ‹ty≥
, 
bôdïth
) {

6490 if(
lodïng_gë_øw_size_l˘
(
w
, 
h
, 
cﬁ‹ty≥
, 
bôdïth
Ë> 
	gö
.
size
())  84;

6491  
ícode
(
fûíame
, 
ö
.
em±y
(Ë? 0 : &ö[0], 
w
, 
h
, 
cﬁ‹ty≥
, 
bôdïth
);

	@C:\Users\leoou\OneDrive\Desktop\LodePNG\lodepng\lodepng.h

26 #i‚de‡
LODEPNG_H


27 
	#LODEPNG_H


	)

29 
	~<°rög.h
>

31 c⁄° * 
LODEPNG_VERSION_STRING
;

44 #i‚de‡
LODEPNG_NO_COMPILE_ZLIB


45 
	#LODEPNG_COMPILE_ZLIB


	)

49 #i‚de‡
LODEPNG_NO_COMPILE_PNG


50 
	#LODEPNG_COMPILE_PNG


	)

54 #i‚de‡
LODEPNG_NO_COMPILE_DECODER


55 
	#LODEPNG_COMPILE_DECODER


	)

59 #i‚de‡
LODEPNG_NO_COMPILE_ENCODER


60 
	#LODEPNG_COMPILE_ENCODER


	)

64 #i‚de‡
LODEPNG_NO_COMPILE_DISK


65 
	#LODEPNG_COMPILE_DISK


	)

69 #i‚de‡
LODEPNG_NO_COMPILE_ANCILLARY_CHUNKS


70 
	#LODEPNG_COMPILE_ANCILLARY_CHUNKS


	)

74 #i‚de‡
LODEPNG_NO_COMPILE_ERROR_TEXT


75 
	#LODEPNG_COMPILE_ERROR_TEXT


	)

81 #i‚de‡
LODEPNG_NO_COMPILE_ALLOCATORS


82 
	#LODEPNG_COMPILE_ALLOCATORS


	)

86 #ifde‡
__˝lu•lus


87 #i‚de‡
LODEPNG_NO_COMPILE_CPP


88 
	#LODEPNG_COMPILE_CPP


	)

92 #ifde‡
LODEPNG_COMPILE_CPP


93 
	~<ve˘‹
>

94 
	~<°rög
>

97 #ifde‡
LODEPNG_COMPILE_PNG


99 
	eLodePNGCﬁ‹Ty≥
 {

100 
	mLCT_GREY
 = 0,

101 
	mLCT_RGB
 = 2,

102 
	mLCT_PALETTE
 = 3,

103 
	mLCT_GREY_ALPHA
 = 4,

104 
	mLCT_RGBA
 = 6,

110 
	mLCT_MAX_OCTET_VALUE
 = 255

111 } 
	tLodePNGCﬁ‹Ty≥
;

113 #ifde‡
LODEPNG_COMPILE_DECODER


129 
lodïng_decode_mem‹y
(** 
out
, * 
w
, * 
h
,

130 c⁄° * 
ö
, 
size_t
 
ösize
,

131 
LodePNGCﬁ‹Ty≥
 
cﬁ‹ty≥
, 
bôdïth
);

134 
lodïng_decode32
(** 
out
, * 
w
, * 
h
,

135 c⁄° * 
ö
, 
size_t
 
ösize
);

138 
lodïng_decode24
(** 
out
, * 
w
, * 
h
,

139 c⁄° * 
ö
, 
size_t
 
ösize
);

141 #ifde‡
LODEPNG_COMPILE_DISK


148 
lodïng_decode_fûe
(** 
out
, * 
w
, * 
h
,

149 c⁄° * 
fûíame
,

150 
LodePNGCﬁ‹Ty≥
 
cﬁ‹ty≥
, 
bôdïth
);

156 
lodïng_decode32_fûe
(** 
out
, * 
w
, * 
h
,

157 c⁄° * 
fûíame
);

163 
lodïng_decode24_fûe
(** 
out
, * 
w
, * 
h
,

164 c⁄° * 
fûíame
);

169 #ifde‡
LODEPNG_COMPILE_ENCODER


186 
lodïng_ícode_mem‹y
(** 
out
, 
size_t
* 
outsize
,

187 c⁄° * 
image
, 
w
, 
h
,

188 
LodePNGCﬁ‹Ty≥
 
cﬁ‹ty≥
, 
bôdïth
);

191 
lodïng_ícode32
(** 
out
, 
size_t
* 
outsize
,

192 c⁄° * 
image
, 
w
, 
h
);

195 
lodïng_ícode24
(** 
out
, 
size_t
* 
outsize
,

196 c⁄° * 
image
, 
w
, 
h
);

198 #ifde‡
LODEPNG_COMPILE_DISK


207 
lodïng_ícode_fûe
(c⁄° * 
fûíame
,

208 c⁄° * 
image
, 
w
, 
h
,

209 
LodePNGCﬁ‹Ty≥
 
cﬁ‹ty≥
, 
bôdïth
);

215 
lodïng_ícode32_fûe
(c⁄° * 
fûíame
,

216 c⁄° * 
image
, 
w
, 
h
);

222 
lodïng_ícode24_fûe
(c⁄° * 
fûíame
,

223 c⁄° * 
image
, 
w
, 
h
);

228 #ifde‡
LODEPNG_COMPILE_CPP


229 
«me•a˚
 
	glodïng
 {

230 #ifde‡
LODEPNG_COMPILE_DECODER


233 
decode
(
°d
::
ve˘‹
<>& 
out
, & 
w
, & 
h
,

234 c⁄° * 
ö
, 
size_t
 
ösize
,

235 
LodePNGCﬁ‹Ty≥
 
cﬁ‹ty≥
 = 
LCT_RGBA
, 
bôdïth
 = 8);

236 
decode
(
°d
::
ve˘‹
<>& 
out
, & 
w
, & 
h
,

237 c⁄° 
°d
::
ve˘‹
<>& 
ö
,

238 
LodePNGCﬁ‹Ty≥
 
cﬁ‹ty≥
 = 
LCT_RGBA
, 
bôdïth
 = 8);

239 #ifde‡
LODEPNG_COMPILE_DISK


247 
decode
(
°d
::
ve˘‹
<>& 
out
, & 
w
, & 
h
,

248 c⁄° 
°d
::
°rög
& 
fûíame
,

249 
LodePNGCﬁ‹Ty≥
 
cﬁ‹ty≥
 = 
LCT_RGBA
, 
bôdïth
 = 8);

253 #ifde‡
LODEPNG_COMPILE_ENCODER


256 
ícode
(
°d
::
ve˘‹
<>& 
out
,

257 c⁄° * 
ö
, 
w
, 
h
,

258 
LodePNGCﬁ‹Ty≥
 
cﬁ‹ty≥
 = 
LCT_RGBA
, 
bôdïth
 = 8);

259 
ícode
(
°d
::
ve˘‹
<>& 
out
,

260 c⁄° 
°d
::
ve˘‹
<>& 
ö
, 
w
, 
h
,

261 
LodePNGCﬁ‹Ty≥
 
cﬁ‹ty≥
 = 
LCT_RGBA
, 
bôdïth
 = 8);

262 #ifde‡
LODEPNG_COMPILE_DISK


272 
ícode
(c⁄° 
°d
::
°rög
& 
fûíame
,

273 c⁄° * 
ö
, 
w
, 
h
,

274 
LodePNGCﬁ‹Ty≥
 
cﬁ‹ty≥
 = 
LCT_RGBA
, 
bôdïth
 = 8);

275 
ícode
(c⁄° 
°d
::
°rög
& 
fûíame
,

276 c⁄° 
°d
::
ve˘‹
<>& 
ö
, 
w
, 
h
,

277 
LodePNGCﬁ‹Ty≥
 
cﬁ‹ty≥
 = 
LCT_RGBA
, 
bôdïth
 = 8);

284 #ifde‡
LODEPNG_COMPILE_ERROR_TEXT


286 c⁄° * 
lodïng_îr‹_ãxt
(
code
);

289 #ifde‡
LODEPNG_COMPILE_DECODER


291 
LodePNGDecom¥essSëtögs
 
	tLodePNGDecom¥essSëtögs
;

292 
	sLodePNGDecom¥essSëtögs
 {

294 
	mign‹e_adÀr32
;

295 
	mign‹e_∆í
;

302 
size_t
 
	mmax_ouçut_size
;

306 (*
	mcu°om_zlib
)(**, 
	msize_t
*,

307 c⁄° *, 
	msize_t
,

308 c⁄° 
	mLodePNGDecom¥essSëtögs
*);

312 (*
	mcu°om_öÊ©e
)(**, 
	msize_t
*,

313 c⁄° *, 
	msize_t
,

314 c⁄° 
	mLodePNGDecom¥essSëtögs
*);

316 c⁄° * 
	mcu°om_c⁄ãxt
;

319 c⁄° 
LodePNGDecom¥essSëtögs
 
lodïng_deÁu…_decom¥ess_£âögs
;

320 
lodïng_decom¥ess_£âögs_öô
(
LodePNGDecom¥essSëtögs
* 
£âögs
);

323 #ifde‡
LODEPNG_COMPILE_ENCODER


328 
LodePNGCom¥essSëtögs
 
	tLodePNGCom¥essSëtögs
;

329 
	sLodePNGCom¥essSëtögs
 {

331 
	mbty≥
;

332 
	mu£_lz77
;

333 
	mwödowsize
;

334 
	mmöm©ch
;

335 
	mni˚m©ch
;

336 
	mœzym©chög
;

339 (*
	mcu°om_zlib
)(**, 
	msize_t
*,

340 c⁄° *, 
	msize_t
,

341 c⁄° 
	mLodePNGCom¥essSëtögs
*);

345 (*
	mcu°om_deÊ©e
)(**, 
	msize_t
*,

346 c⁄° *, 
	msize_t
,

347 c⁄° 
	mLodePNGCom¥essSëtögs
*);

349 c⁄° * 
	mcu°om_c⁄ãxt
;

352 c⁄° 
LodePNGCom¥essSëtögs
 
lodïng_deÁu…_com¥ess_£âögs
;

353 
lodïng_com¥ess_£âögs_öô
(
LodePNGCom¥essSëtögs
* 
£âögs
);

356 #ifde‡
LODEPNG_COMPILE_PNG


362 
	sLodePNGCﬁ‹Mode
 {

364 
LodePNGCﬁ‹Ty≥
 
	mcﬁ‹ty≥
;

365 
	mbôdïth
;

382 * 
	m∑Àâe
;

383 
size_t
 
	m∑Àâesize
;

396 
	mkey_deföed
;

397 
	mkey_r
;

398 
	mkey_g
;

399 
	mkey_b
;

400 } 
	tLodePNGCﬁ‹Mode
;

403 
lodïng_cﬁ‹_mode_öô
(
LodePNGCﬁ‹Mode
* 
öfo
);

404 
lodïng_cﬁ‹_mode_˛ónup
(
LodePNGCﬁ‹Mode
* 
öfo
);

406 
lodïng_cﬁ‹_mode_c›y
(
LodePNGCﬁ‹Mode
* 
de°
, c⁄° LodePNGCﬁ‹Mode* 
sour˚
);

408 
LodePNGCﬁ‹Mode
 
lodïng_cﬁ‹_mode_make
(
LodePNGCﬁ‹Ty≥
 
cﬁ‹ty≥
, 
bôdïth
);

410 
lodïng_∑Àâe_˛ór
(
LodePNGCﬁ‹Mode
* 
öfo
);

412 
lodïng_∑Àâe_add
(
LodePNGCﬁ‹Mode
* 
öfo
,

413 
r
, 
g
, 
b
, 
a
);

416 
lodïng_gë_bµ
(c⁄° 
LodePNGCﬁ‹Mode
* 
öfo
);

419 
lodïng_gë_ch™√ls
(c⁄° 
LodePNGCﬁ‹Mode
* 
öfo
);

421 
lodïng_is_gªysˇÀ_ty≥
(c⁄° 
LodePNGCﬁ‹Mode
* 
öfo
);

423 
lodïng_is_Æpha_ty≥
(c⁄° 
LodePNGCﬁ‹Mode
* 
öfo
);

425 
lodïng_is_∑Àâe_ty≥
(c⁄° 
LodePNGCﬁ‹Mode
* 
öfo
);

428 
lodïng_has_∑Àâe_Æpha
(c⁄° 
LodePNGCﬁ‹Mode
* 
öfo
);

436 
lodïng_ˇn_have_Æpha
(c⁄° 
LodePNGCﬁ‹Mode
* 
öfo
);

438 
size_t
 
lodïng_gë_øw_size
(
w
, 
h
, c⁄° 
LodePNGCﬁ‹Mode
* 
cﬁ‹
);

440 #ifde‡
LODEPNG_COMPILE_ANCILLARY_CHUNKS


442 
	sLodePNGTime
 {

443 
	myór
;

444 
	mm⁄th
;

445 
	mday
;

446 
	mhour
;

447 
	mmöuã
;

448 
	m£c⁄d
;

449 } 
	tLodePNGTime
;

453 
	sLodePNGInfo
 {

455 
	mcom¥essi⁄_mëhod
;

456 
	mfûãr_mëhod
;

457 
	möãæa˚_mëhod
;

458 
LodePNGCﬁ‹Mode
 
	mcﬁ‹
;

460 #ifde‡
LODEPNG_COMPILE_ANCILLARY_CHUNKS


484 
	mbackground_deföed
;

485 
	mbackground_r
;

486 
	mbackground_g
;

487 
	mbackground_b
;

509 
size_t
 
	mãxt_num
;

510 ** 
	mãxt_keys
;

511 ** 
	mãxt_°rögs
;

521 
size_t
 
	môext_num
;

522 ** 
	môext_keys
;

523 ** 
	môext_œngègs
;

524 ** 
	môext_å™skeys
;

525 ** 
	môext_°rögs
;

528 
	mtime_deföed
;

529 
LodePNGTime
 
	mtime
;

532 
	mphys_deföed
;

533 
	mphys_x
;

534 
	mphys_y
;

535 
	mphys_unô
;

548 
	mgama_deföed
;

549 
	mgama_gamma
;

552 
	mchrm_deföed
;

553 
	mchrm_whôe_x
;

554 
	mchrm_whôe_y
;

555 
	mchrm_ªd_x
;

556 
	mchrm_ªd_y
;

557 
	mchrm_gªí_x
;

558 
	mchrm_gªí_y
;

559 
	mchrm_blue_x
;

560 
	mchrm_blue_y
;

567 
	m§gb_deföed
;

568 
	m§gb_öã¡
;

591 
	mic˝_deföed
;

592 * 
	mic˝_«me
;

598 * 
	mic˝_¥ofûe
;

599 
	mic˝_¥ofûe_size
;

621 * 
	munknown_chunks_d©a
[3];

622 
size_t
 
	munknown_chunks_size
[3];

624 } 
	tLodePNGInfo
;

627 
lodïng_öfo_öô
(
LodePNGInfo
* 
öfo
);

628 
lodïng_öfo_˛ónup
(
LodePNGInfo
* 
öfo
);

630 
lodïng_öfo_c›y
(
LodePNGInfo
* 
de°
, c⁄° LodePNGInfo* 
sour˚
);

632 #ifde‡
LODEPNG_COMPILE_ANCILLARY_CHUNKS


633 
lodïng_add_ãxt
(
LodePNGInfo
* 
öfo
, c⁄° * 
key
, c⁄° * 
°r
);

634 
lodïng_˛ór_ãxt
(
LodePNGInfo
* 
öfo
);

636 
lodïng_add_ôext
(
LodePNGInfo
* 
öfo
, c⁄° * 
key
, c⁄° * 
œngèg
,

637 c⁄° * 
å™skey
, c⁄° * 
°r
);

638 
lodïng_˛ór_ôext
(
LodePNGInfo
* 
öfo
);

641 
lodïng_£t_icc
(
LodePNGInfo
* 
öfo
, c⁄° * 
«me
, c⁄° * 
¥ofûe
, 
¥ofûe_size
);

642 
lodïng_˛ór_icc
(
LodePNGInfo
* 
öfo
);

656 
lodïng_c⁄vît
(* 
out
, c⁄° * 
ö
,

657 c⁄° 
LodePNGCﬁ‹Mode
* 
mode_out
, c⁄° LodePNGCﬁ‹Mode* 
mode_ö
,

658 
w
, 
h
);

660 #ifde‡
LODEPNG_COMPILE_DECODER


665 
	sLodePNGDecodîSëtögs
 {

666 
LodePNGDecom¥essSëtögs
 
	mzlib£âögs
;

669 
	mign‹e_¸c
;

670 
	mign‹e_¸ôiˇl
;

671 
	mign‹e_íd
;

677 
	mcﬁ‹_c⁄vît
;

679 #ifde‡
LODEPNG_COMPILE_ANCILLARY_CHUNKS


680 
	mªad_ãxt_chunks
;

683 
	mªmembî_unknown_chunks
;

688 
size_t
 
	mmax_ãxt_size
;

693 
size_t
 
	mmax_icc_size
;

695 } 
	tLodePNGDecodîSëtögs
;

697 
lodïng_decodî_£âögs_öô
(
LodePNGDecodîSëtögs
* 
£âögs
);

700 #ifde‡
LODEPNG_COMPILE_ENCODER


702 
	eLodePNGFûãrSå©egy
 {

704 
	mLFS_ZERO
 = 0,

706 
	mLFS_ONE
 = 1,

707 
	mLFS_TWO
 = 2,

708 
	mLFS_THREE
 = 3,

709 
	mLFS_FOUR
 = 4,

711 
	mLFS_MINSUM
,

714 
	mLFS_ENTROPY
,

719 
	mLFS_BRUTE_FORCE
,

721 
	mLFS_PREDEFINED


722 } 
	tLodePNGFûãrSå©egy
;

727 
	sLodePNGCﬁ‹Sèts
 {

728 
	mcﬁ‹ed
;

729 
	mkey
;

730 
	mkey_r
;

731 
	mkey_g
;

732 
	mkey_b
;

733 
	mÆpha
;

734 
	mnumcﬁ‹s
;

735 
	m∑Àâe
[1024];

736 
	mbôs
;

737 
size_t
 
	mnumpixñs
;

740 
	mÆlow_∑Àâe
;

741 
	mÆlow_gªysˇÀ
;

742 } 
	tLodePNGCﬁ‹Sèts
;

744 
lodïng_cﬁ‹_°©s_öô
(
LodePNGCﬁ‹Sèts
* 
°©s
);

748 
lodïng_compuã_cﬁ‹_°©s
(
LodePNGCﬁ‹Sèts
* 
°©s
,

749 c⁄° * 
image
, 
w
, 
h
,

750 c⁄° 
LodePNGCﬁ‹Mode
* 
mode_ö
);

753 
	sLodePNGEncodîSëtögs
 {

754 
LodePNGCom¥essSëtögs
 
	mzlib£âögs
;

756 
	mauto_c⁄vît
;

762 
	mfûãr_∑Àâe_zîo
;

765 
LodePNGFûãrSå©egy
 
	mfûãr_°øãgy
;

770 c⁄° * 
	m¥edeföed_fûãrs
;

774 
	mf‹˚_∑Àâe
;

775 #ifde‡
LODEPNG_COMPILE_ANCILLARY_CHUNKS


777 
	madd_id
;

779 
	mãxt_com¥essi⁄
;

781 } 
	tLodePNGEncodîSëtögs
;

783 
lodïng_ícodî_£âögs_öô
(
LodePNGEncodîSëtögs
* 
£âögs
);

787 #i‡
deföed
(
LODEPNG_COMPILE_DECODER
Ë|| deföed(
LODEPNG_COMPILE_ENCODER
)

789 
	sLodePNGSèã
 {

790 #ifde‡
LODEPNG_COMPILE_DECODER


791 
LodePNGDecodîSëtögs
 
	mdecodî
;

793 #ifde‡
LODEPNG_COMPILE_ENCODER


794 
LodePNGEncodîSëtögs
 
	mícodî
;

796 
LodePNGCﬁ‹Mode
 
	möfo_øw
;

797 
LodePNGInfo
 
	möfo_≤g
;

798 
	mîr‹
;

799 } 
	tLodePNGSèã
;

802 
lodïng_°©e_öô
(
LodePNGSèã
* 
°©e
);

803 
lodïng_°©e_˛ónup
(
LodePNGSèã
* 
°©e
);

804 
lodïng_°©e_c›y
(
LodePNGSèã
* 
de°
, c⁄° LodePNGSèã* 
sour˚
);

807 #ifde‡
LODEPNG_COMPILE_DECODER


812 
lodïng_decode
(** 
out
, * 
w
, * 
h
,

813 
LodePNGSèã
* 
°©e
,

814 c⁄° * 
ö
, 
size_t
 
ösize
);

821 
lodïng_ö•e˘
(* 
w
, * 
h
,

822 
LodePNGSèã
* 
°©e
,

823 c⁄° * 
ö
, 
size_t
 
ösize
);

838 
lodïng_ö•e˘_chunk
(
LodePNGSèã
* 
°©e
, 
size_t
 
pos
,

839 c⁄° * 
ö
, 
size_t
 
ösize
);

841 #ifde‡
LODEPNG_COMPILE_ENCODER


843 
lodïng_ícode
(** 
out
, 
size_t
* 
outsize
,

844 c⁄° * 
image
, 
w
, 
h
,

845 
LodePNGSèã
* 
°©e
);

877 
lodïng_chunk_Àngth
(c⁄° * 
chunk
);

880 
lodïng_chunk_ty≥
(
ty≥
[5], c⁄° * 
chunk
);

883 
lodïng_chunk_ty≥_equÆs
(c⁄° * 
chunk
, c⁄° * 
ty≥
);

886 
lodïng_chunk_™cûœry
(c⁄° * 
chunk
);

889 
lodïng_chunk_¥iv©e
(c⁄° * 
chunk
);

892 
lodïng_chunk_ß„toc›y
(c⁄° * 
chunk
);

895 * 
lodïng_chunk_d©a
(* 
chunk
);

896 c⁄° * 
lodïng_chunk_d©a_c⁄°
(c⁄° * 
chunk
);

899 
lodïng_chunk_check_¸c
(c⁄° * 
chunk
);

902 
lodïng_chunk_gíî©e_¸c
(* 
chunk
);

915 * 
lodïng_chunk_√xt
(* 
chunk
, * 
íd
);

916 c⁄° * 
lodïng_chunk_√xt_c⁄°
(c⁄° * 
chunk
, c⁄° * 
íd
);

919 * 
lodïng_chunk_föd
(* 
chunk
, * 
íd
, c⁄° 
ty≥
[5]);

920 c⁄° * 
lodïng_chunk_föd_c⁄°
(c⁄° * 
chunk
, c⁄° * 
íd
, c⁄° 
ty≥
[5]);

927 
lodïng_chunk_≠≥nd
(** 
out
, 
size_t
* 
outsize
, c⁄° * 
chunk
);

935 
lodïng_chunk_¸óã
(** 
out
, 
size_t
* 
outsize
, 
Àngth
,

936 c⁄° * 
ty≥
, c⁄° * 
d©a
);

940 
lodïng_¸c32
(c⁄° * 
buf
, 
size_t
 
Àn
);

944 #ifde‡
LODEPNG_COMPILE_ZLIB


951 #ifde‡
LODEPNG_COMPILE_DECODER


953 
lodïng_öÊ©e
(** 
out
, 
size_t
* 
outsize
,

954 c⁄° * 
ö
, 
size_t
 
ösize
,

955 c⁄° 
LodePNGDecom¥essSëtögs
* 
£âögs
);

963 
lodïng_zlib_decom¥ess
(** 
out
, 
size_t
* 
outsize
,

964 c⁄° * 
ö
, 
size_t
 
ösize
,

965 c⁄° 
LodePNGDecom¥essSëtögs
* 
£âögs
);

968 #ifde‡
LODEPNG_COMPILE_ENCODER


976 
lodïng_zlib_com¥ess
(** 
out
, 
size_t
* 
outsize
,

977 c⁄° * 
ö
, 
size_t
 
ösize
,

978 c⁄° 
LodePNGCom¥essSëtögs
* 
£âögs
);

984 
lodïng_huffm™_code_Àngths
(* 
Àngths
, c⁄° * 
‰equícõs
,

985 
size_t
 
numcodes
, 
maxbôÀn
);

988 
lodïng_deÊ©e
(** 
out
, 
size_t
* 
outsize
,

989 c⁄° * 
ö
, 
size_t
 
ösize
,

990 c⁄° 
LodePNGCom¥essSëtögs
* 
£âögs
);

995 #ifde‡
LODEPNG_COMPILE_DISK


1007 
lodïng_lﬂd_fûe
(** 
out
, 
size_t
* 
outsize
, c⁄° * 
fûíame
);

1020 
lodïng_ßve_fûe
(c⁄° * 
buf„r
, 
size_t
 
buf„rsize
, c⁄° * 
fûíame
);

1023 #ifde‡
LODEPNG_COMPILE_CPP


1025 
«me•a˚
 
	glodïng
 {

1026 #ifde‡
LODEPNG_COMPILE_PNG


1027 ˛as†
	cSèã
 : 
public
 
LodePNGSèã
 {

1028 
public
:

1029 
Sèã
();

1030 
Sèã
(c⁄° Sèã& 
Ÿhî
);

1031 ~
Sèã
();

1032 
	gSèã
& 
	g›î©‹
=(c⁄° 
Sèã
& 
Ÿhî
);

1035 #ifde‡
LODEPNG_COMPILE_DECODER


1037 
decode
(
°d
::
ve˘‹
<>& 
out
, & 
w
, & 
h
,

1038 
Sèã
& 
°©e
,

1039 c⁄° * 
ö
, 
size_t
 
ösize
);

1040 
decode
(
°d
::
ve˘‹
<>& 
out
, & 
w
, & 
h
,

1041 
Sèã
& 
°©e
,

1042 c⁄° 
°d
::
ve˘‹
<>& 
ö
);

1045 #ifde‡
LODEPNG_COMPILE_ENCODER


1047 
ícode
(
°d
::
ve˘‹
<>& 
out
,

1048 c⁄° * 
ö
, 
w
, 
h
,

1049 
Sèã
& 
°©e
);

1050 
ícode
(
°d
::
ve˘‹
<>& 
out
,

1051 c⁄° 
°d
::
ve˘‹
<>& 
ö
, 
w
, 
h
,

1052 
Sèã
& 
°©e
);

1055 #ifde‡
LODEPNG_COMPILE_DISK


1063 
lﬂd_fûe
(
°d
::
ve˘‹
<>& 
buf„r
, c⁄° std::
°rög
& 
fûíame
);

1072 
ßve_fûe
(c⁄° 
°d
::
ve˘‹
<>& 
buf„r
, c⁄° std::
°rög
& 
fûíame
);

1076 #ifde‡
LODEPNG_COMPILE_ZLIB


1077 #ifde‡
LODEPNG_COMPILE_DECODER


1079 
decom¥ess
(
°d
::
ve˘‹
<>& 
out
, c⁄° * 
ö
, 
size_t
 
ösize
,

1080 c⁄° 
LodePNGDecom¥essSëtögs
& 
£âögs
 = 
lodïng_deÁu…_decom¥ess_£âögs
);

1083 
decom¥ess
(
°d
::
ve˘‹
<>& 
out
, c⁄° std::ve˘‹<>& 
ö
,

1084 c⁄° 
LodePNGDecom¥essSëtögs
& 
£âögs
 = 
lodïng_deÁu…_decom¥ess_£âögs
);

1087 #ifde‡
LODEPNG_COMPILE_ENCODER


1089 
com¥ess
(
°d
::
ve˘‹
<>& 
out
, c⁄° * 
ö
, 
size_t
 
ösize
,

1090 c⁄° 
LodePNGCom¥essSëtögs
& 
£âögs
 = 
lodïng_deÁu…_com¥ess_£âögs
);

1093 
com¥ess
(
°d
::
ve˘‹
<>& 
out
, c⁄° std::ve˘‹<>& 
ö
,

1094 c⁄° 
LodePNGCom¥essSëtögs
& 
£âögs
 = 
lodïng_deÁu…_com¥ess_£âögs
);

	@C:\Users\leoou\OneDrive\Desktop\projects\ResourcesTest\bacteria.h

1 #i‚de‡
BACTERIA_H_INCLUDED


2 
	#BACTERIA_H_INCLUDED


	)

4 
	~"ªndî.h
"

5 
	~"comp⁄íts.h
"

9 
	gBa˘îüCﬁ‹
 : 
public
 
RídîComp⁄ít
, 
	gComp⁄ítC⁄èöî
<BacteriaColor>

11 
	gglm
::
vec4
 
cﬁ‹
;

12 
øndNum
()

14  
	g°d
::
mö
(
ønd
()%1000/1000.0,.5);

16 
Ba˘îüCﬁ‹
(
E¡ôy
& 
ítôy
Ë: 
RídîComp⁄ít
”¡ôy,
nuŒ±r
), 
	gComp⁄ítC⁄èöî
<
	gBa˘îüCﬁ‹
>(
	gítôy
), 
cﬁ‹
(
øndNum
(),randNum(),randNum(),1)

20 
upd©e
()

22 
	gcﬁ‹
 = {0,0,0,1};

23 i‡(
Re˘Comp⁄ít
* 
	gª˘
 = 
ítôy
->
gëComp⁄ít
<RectComponent>())

25 
PﬁyRídî
::
ªque°Re˘
(
ª˘
->
gëRe˘
(),
cﬁ‹
,
Ál£
,ª˘->
gëTût
(),0);

29 
cﬁlide
(
E¡ôy
& 
Ÿhî
)

31 
	gcﬁ‹
 = {1,0,0,1};

42 
	gBa˘îüMove
 : 
public
 
MoveComp⁄ít
, 
	gComp⁄ítC⁄èöî
<BacteriaMove>

44 
c⁄°ex¥
 
	gdimí
 = 10;

45 
boﬁ
 
	gdoMove
;

46 
	gglm
::
vec4
 
øndRe˘
()

48 
glm
::
vec2
 
s¸ìnDimí
 = 
RídîProgøm
::
gëS¸ìnDimí
();

49  
	gglm
::
vec4
(
ønd
()%(()
s¸ìnDimí
.
x
),ønd()%(()s¸ìnDimí.
y
),
dimí
,dimen);

51 
Ba˘îüMove
(
E¡ôy
& 
ítôy
Ë: 
MoveComp⁄ít
(.1,
øndRe˘
(),ítôy), 
	gComp⁄ítC⁄èöî
<
	gBa˘îüMove
>(
	gítôy
)

53 
	gtût
 = 0;

55 
Ba˘îüMove
(
x
, 
y
, 
tût
, 
E¡ôy
& 
ítôy
Ë: 
MoveComp⁄ít
(.1,{x,y,
dimí
,dimí},ítôy), 
	gComp⁄ítC⁄èöî
<
	gBa˘îüMove
>(
	gítôy
)

57 
	gthis
->
	gtût
 = 
tût
;

59 
upd©e
()

61 i‡(
	gdoMove
)

63 i‡(
©T¨gë
())

65 
	gglm
::
vec2
 
s¸ìnDimí
 = 
RídîProgøm
::
gëS¸ìnDimí
();

66 
£tT¨gë
({
ønd
()%(()
s¸ìnDimí
.
x
),ønd()%(()s¸ìnDimí.
y
)});

68 
	gMoveComp⁄ít
::
upd©e
();

73 
boﬁ
 
	gBa˘îüMove
::
doMove
 = 
åue
;

75 
E¡ôy
* 
	$ba˘îüAs£mbÀ
()

77 
E¡ôy
* 
ít
 = 
√w
 
	`E¡ôy
();

78 
ít
->
	`addComp⁄ít
(*(
√w
 
	`Ba˘îüMove
(*ent)));

79 
ít
->
	`addComp⁄ít
(*(
√w
 
	`Ba˘îüCﬁ‹
(*ent)));

80  
ít
;

81 
	}
}

83 
E¡ôy
* 
	$ba˘îüAs£mbÀ
(
x
, 
y
, 
tût
)

85 
E¡ôy
* 
ít
 = 
√w
 
	`E¡ôy
();

86 
ít
->
	`addComp⁄ít
(*(
√w
 
	`Ba˘îüMove
(
x
,
y
,
tût
,*ent)));

87 
ít
->
	`addComp⁄ít
(*(
√w
 
	`Ba˘îüCﬁ‹
(*ent)));

88  
ít
;

89 
	}
}

	@C:\Users\leoou\OneDrive\Desktop\projects\ResourcesTest\main.cpp

1 
	~<io°ªam
>

2 
	~<time.h
>

3 
	~<SDL.h
>

5 
	~"v™ûœ.h
"

6 
	~"ªndî.h
"

7 
	~"FªeTy≥Hñ≥r.h
"

8 
	~"SDLHñ≥r.h
"

9 
	~"comp⁄íts.h
"

11 
	~"ba˘îü.h
"

14 
	$maö
(
¨gs
, * 
¨gsc
[])

16 c⁄° 
s¸ìnWidth
 = 640;

17 c⁄° 
s¸ìnHeight
 = 640;

18 
	`§™d
(
	`time
(
NULL
));

19 
	`SDL_Inô
(
SDL_INIT_VIDEO
);

20 
	`SDL_GL_SëAâribuã
(
SDL_GL_MULTISAMPLEBUFFERS
,1);

21 
	`SDL_GL_SëAâribuã
(
SDL_GL_MULTISAMPLESAMPLES
,8);

22 
	`SDL_GL_SëAâribuã
(
SDL_GL_ACCELERATED_VISUAL
, 1);

24 
SDL_Wödow
* 
wödow
 = 
	`SDL_Cª©eWödow
("Proje˘",
SDL_WINDOWPOS_CENTERED
, SDL_WINDOWPOS_CENTERED,
s¸ìnWidth
, 
s¸ìnHeight
, 
SDL_WINDOW_OPENGL
);

28 
	`SDL_St›TextI≈ut
();

29 
	`SDL_GL_Cª©eC⁄ãxt
(
wödow
);

31 
RídîProgøm
::
	`öô
(
s¸ìnWidth
,
s¸ìnHeight
);

38 
F⁄t
::
	`öô
(
s¸ìnWidth
, 
s¸ìnHeight
);

39 
PﬁyRídî
::
	`öô
(
s¸ìnWidth
,
s¸ìnHeight
);

40 
SDL_Evít
 
e
;

41 
boﬁ
 
quô
 = 
Ál£
;

42 
	`glCÀ¨Cﬁ‹
(0,.5,1,1);

43 
boﬁ
 
evítsEm±y
 = 
åue
;

46 
DñèTime
 
Æ¨m
;

47 
Æ¨m
.
	`£t
();

49 
amou¡
 = 10000;

51 
E¡ôyPosM™agî
 
m™agî
;

52 
m™agî
.
	`öô
({0,0,
s¸ìnWidth
,
s¸ìnHeight
});

54 
i
 = 0; i < 
amou¡
; ++i)

56 
m™agî
.
	`addE¡ôy
(*(
	`ba˘îüAs£mbÀ
()));

59 
°d
::
ve˘‹
<
E¡ôy
*> 
ítôõs
;

60 
BiTªe
 
	`åì
({0,0,
s¸ìnWidth
,
s¸ìnHeight
});

61 
i
 =0; i < 
amou¡
; ++i)

63 autÿ
ba˘îü
 = 
	`ba˘îüAs£mbÀ
();

64 
ítôõs
.
	`push_back
(
ba˘îü
);

66 
åì
.
	`ö£π
(*
ba˘îü
->
gëComp⁄ít
<
Re˘Comp⁄ít
>());

68 
boﬁ
 
m‹e
 = 
åue
;

69 !
quô
)

71 
	`SDL_PﬁlEvít
(&
e
))

73 
evítsEm±y
 = 
Ál£
;

74 
KeyM™agî
::
	`gëKeys
(
e
);

75 
Mou£M™agî
::
	`upd©e
(
e
);

76 i‡(
e
.
ty≥
 =
SDL_QUIT
)

78 
quô
 = 
åue
;

81 i‡(
evítsEm±y
)

83 
KeyM™agî
::
	`gëKeys
(
e
);

84 
Mou£M™agî
::
	`upd©e
(
e
);

86 
	`glCÀ¨
(
GL_COLOR_BUFFER_BIT
 | 
GL_DEPTH_BUFFER_BIT
);

93 
åì
.
	`cou¡Nodes
();

94 
now
 = 
	`SDL_GëTicks
();

95 
i
 = 0; i < 
ítôõs
.
	`size
(); ++i)

97 
Re˘Comp⁄ít
* 
ª˘
 = 
ítôõs
[
i
]->
gëComp⁄ít
<RectComponent>();

98 
åì
.
	`ªmove
(*
ª˘
);

101 
°d
::
cout
 << "RemovÆ: " << 
	`SDL_GëTicks
(Ë- 
now
 << "\n";

102 
now
 = 
	`SDL_GëTicks
();

103 
i
 = 0; i < 
ítôõs
.
	`size
(); ++i)

105 
åì
.
	`ö£π
(*
ítôõs
[
i
]->
gëComp⁄ít
<
Re˘Comp⁄ít
>());

107 
°d
::
cout
 << "In£π: " << 
	`SDL_GëTicks
(Ë- 
now
 <<"\n";

111 
cﬁlisi⁄s
 = 0;

113 
åì
.
	`¥o˚ssCﬁlisi⁄s
([&
cﬁlisi⁄s
](
Re˘Posôi⁄Æ
& 
r1
, Re˘Posôi⁄Æ& 
r2
){

116 
cﬁlisi⁄s
++;

119 
PﬁyRídî
::
	`ªndî
();

120 
S¥ôeM™agî
::
	`ªndî
();

122 
	`SDL_GL_Sw≠Wödow
(
wödow
);

123 
DñèTime
::
	`upd©e
();

124 
evítsEm±y
 = 
åue
;

125 
F⁄t
::
är
.
	`ªque°Wrôe
({
	`c⁄vît
(
DñèTime
::
dñèTime
),{0,0,100,100},0,{0,0,0,1},1});

130 
	}
}

	@C:\Users\leoou\OneDrive\Desktop\resources\FreeTypeHelper.cpp

1 
	~<io°ªam
>

3 
	~"FªeTy≥Hñ≥r.h
"

4 
	~"geomëry.h
"

6 
RídîProgøm
 
	gF⁄t
::
w‹dProgøm
;

7 
F⁄t
 
	gF⁄t
::
är
;

10 
	gF⁄t
::
Ch¨a˘î
::
	$Ch¨a˘î
(
c
, 
FT_Fa˚
& 
Á˚
Ë: 
	$S¥ôe
()

12 
	`glGíVîãxAºays
(1, &
VAO
);

13 
	`glGíBuf„rs
(1,&
VBO
);

14 
	`glGíBuf„rs
(1,&
modVBO
);

16 
	`glBödVîãxAºay
(
VAO
);

18 
	`glGíTextuªs
(1, &
ãxtuª
);

19 
	`glBödTextuª
(
GL_TEXTURE_2D
,
ãxtuª
);

21 
	`glTexP¨amëîi
(
GL_TEXTURE_2D
, 
GL_TEXTURE_WRAP_S
, 
GL_CLAMP_TO_EDGE
);

22 
	`glTexP¨amëîi
(
GL_TEXTURE_2D
, 
GL_TEXTURE_WRAP_T
, 
GL_CLAMP_TO_EDGE
);

23 
	`glTexP¨amëîi
(
GL_TEXTURE_2D
, 
GL_TEXTURE_MIN_FILTER
, 
GL_LINEAR
);

24 
	`glTexP¨amëîi
(
GL_TEXTURE_2D
, 
GL_TEXTURE_MAG_FILTER
, 
GL_LINEAR
);

25 
	`glPixñSt‹ei
(
GL_UNPACK_ALIGNMENT
,1);

27 i‡–
	`FT_Lﬂd_Ch¨
(
Á˚
,
c
,
FT_LOAD_RENDER
))

29 
throw
 
°d
::
	`logic_îr‹
 ("ERROR::FREETYTPE: FaûedÅÿlﬂd Glyph" + 
c
);

31 
	`glTexImage2D
(

32 
GL_TEXTURE_2D
,

34 
GL_RGBA
,

35 
Á˚
->
glyph
->
bôm≠
.
width
,

36 
Á˚
->
glyph
->
bôm≠
.
rows
,

38 
GL_RED
,

39 
GL_UNSIGNED_BYTE
,

40 
Á˚
->
glyph
->
bôm≠
.
buf„r


47 
Àâî
 = 
c
;

48 
size
 = 
glm
::
	`vec2
(
Á˚
->
glyph
->
bôm≠
.
width
, fa˚->glyph->bôm≠.
rows
);

49 
bórög
 = 
glm
::
	`ivec2
(
Á˚
->
glyph
->
bôm≠_À·
, fa˚->glyph->
bôm≠_t›
);

50 
adv™˚
 = 
Á˚
->
glyph
->adv™˚.
x
;

52 
	`lﬂdVîti˚s
();

54 
	`glBödVîãxAºay
(0);

55 
	`glBödBuf„r
(
GL_ARRAY_BUFFER
,0);

57 
	}
}

59 c⁄° 
	gglm
::
vec2
& 
F⁄t
::
Ch¨a˘î
::
	$gëBórög
()

61  
bórög
;

62 
	}
}

63 c⁄° 
	gglm
::
vec2
& 
F⁄t
::
Ch¨a˘î
::
	$gëSize
()

65  
size
;

66 
	}
}

67 
GLuöt
 
	gF⁄t
::
Ch¨a˘î
::
	$gëAdv™˚
()

69  
adv™˚
;

70 
	}
}

72 
	gF⁄t
::
F⁄tWøµî
::
	$F⁄tWøµî
(
Ch¨a˘î
& 
•rôe
)

74 
•r
 = &
•rôe
;

75 
	}
}

77 
	gF⁄t
::
Ch¨a˘î
& 
F⁄t
::
F⁄tWøµî
::
	$gëCh¨a˘î
()

79  *
°©ic_ˇ°
<
Ch¨a˘î
*>(
•r
);

80 
	}
}

82 
	gF⁄t
::
	$wrôeLígth
(
°d
::
°rög
 
°r
)

84 
Àngth
 = 0;

85 
size
 = 
°r
.
	`size
();

86 
i
 = 0; i < 
size
; ++i)

88 
Àngth
 +
ch¨a˘îs
[
°r
[
i
]]->
	`gëCh¨a˘î
().
	`gëAdv™˚
() >> 6;

90  
Àngth
;

91 
	}
}

93 
	gF⁄t
::
	$öô
(
s¸ìnWidth
, 
s¸ìnHeight
)

95 
w‹dProgøm
.
	`öô
("../../resources/shaders/vertex/vertexShader.h","../../resources/shaders/fragment/wordFragment.h");

96 
w‹dProgøm
.
	`£tM©rix4fv
("¥oje˘i⁄", 
glm
::
	`vÆue_±r
(
RídîProgøm
::
	`gëOπho
()));

98 
är
.
	`öô
("../../resources/tnr.ttf");

99 
	}
}

100 
	gF⁄t
::
	$F⁄t
(
°d
::
°rög
 
sour˚
)

102 
	`öô
(
sour˚
);

103 
	}
}

104 
	gF⁄t
::
	$öô
(
°d
::
°rög
 
sour˚
)

107 
f⁄t
 = 
sour˚
;

108 
FT_Libøry
 
libøry
;

109 i‡(
	`FT_Inô_FªeTy≥
(&
libøry
))

111 
°d
::
cout
 << "ERROR::FREETYPE: CouldÇŸ inô FªeTy≥ Libøry" << std::
ídl
;

113 
FT_Fa˚
 
Á˚
;

114 i‡(
	`FT_New_Fa˚
(
libøry
, 
sour˚
.
	`c_°r
(),0,&
Á˚
))

116 
°d
::
cout
 << "Eº‹Üﬂdög f⁄t: " << 
sour˚
 << std::
ídl
;

118 
	`FT_Së_Pixñ_Sizes
(
Á˚
,0,32);

120 
GLubyã
 
c
 = 0; c < 128; c++)

124 
Ch¨a˘î
* 
ch¨a˘î
 = 
√w
 
	`Ch¨a˘î
(
c
,
Á˚
);

125 autÿ
bórög
 = &(
ch¨a˘î
->
	`gëBórög
());

126 i‡(
bórög
->
y
 > 
maxVît
.
x
)

128 
maxVît
.
x
 = 
bórög
->
y
;

130 autÿ
size
 = &(
ch¨a˘î
->
	`gëSize
());

131 i‡(
size
->
y
 - 
bórög
->y > 
maxVît
.y)

133 
maxVît
.
y
 = 
size
->y - 
bórög
->y;

137 
F⁄tWøµî
* 
f⁄tWøµî
 = 
√w
 
	`F⁄tWøµî
(*
ch¨a˘î
);

138 
S¥ôeM™agî
::
	`addS¥ôe
(*
f⁄tWøµî
);

139 
ch¨a˘îs
[
c
] = 
°d
::
unique_±r
<
F⁄tWøµî
>(
f⁄tWøµî
);

143 
	`FT_D⁄e_Fa˚
(
Á˚
);

144 
	`FT_D⁄e_FªeTy≥
(
libøry
);

145 
	`glGíVîãxAºays
(1, &
VAO
);

146 
	`glBödVîãxAºay
(
VAO
);

147 
	`glGíBuf„rs
(1,&
VBO
);

148 
	`glBödBuf„r
(
GL_ARRAY_BUFFER
, 0);

149 
	`glBödVîãxAºay
(0);

151 
	}
}

152 
	gglm
::
vec2
 
F⁄t
::
	$gëDimí
(
°d
::
°rög
 
ãxt
, 
GLÊﬂt
 
hSˇÀ
, GLÊﬂà
vSˇÀ
)

154 
°d
::
°rög
::
c⁄°_ôî©‹
 
c
;

155 
tŸÆWidth
 = 0, 
maxHeight
 = 0;

156 autÿ
íd
 = 
ãxt
.
	`íd
();

158 
c
 = 
ãxt
.
	`begö
(); c !
íd
; ++c)

160 
Ch¨a˘î
* 
ch
 = &(
ch¨a˘îs
[*
c
].
	`gë
()->
	`gëCh¨a˘î
());

161 
GLÊﬂt
 
h
 = 
ch
->
	`gëSize
().
y
 * 
vSˇÀ
;

162 
tŸÆWidth
 +(
ch
->
	`gëAdv™˚
())*
hSˇÀ
/64;

163 
maxHeight
 +(
h
 > maxHeight)*(h-maxHeight);

165  {
tŸÆWidth
,
maxHeight
};

166 
	}
}

168 
	gF⁄t
::
	$ªque°Wrôe
(
F⁄tP¨amëî
&& 
∑øm
)

170 
sˇÀ
;

171 
glm
::
vec4
 
absRe˘
 = 
	`absﬁuãVÆueRe˘
(
∑øm
.
ª˘
);

172 
glm
::
vec2
 
dimí
 = 
	`gëDimí
(
∑øm
.
ãxt
,1,1);

173 i‡(
∑øm
.
ª˘
.
z
 < 0 )

175 
sˇÀ
 = 
∑øm
.
ª˘
.
a
;

176 
absRe˘
.
z
 = 
dimí
.
x
*
sˇÀ
;

177 
absRe˘
.
a
 = 
dimí
.
y
*
sˇÀ
;

182 
sˇÀ
 = 
°d
::
	`mö
((
absRe˘
.
z
/
dimí
.
x
),absRe˘.
a
/(
maxVît
.
y
 + maxVert.x));

184 
glm
::
vec2
 
˚¡î
 = {
absRe˘
.
x
 +ábsRe˘.
z
/2,ábsRe˘.
y
 +ábsRe˘.
a
/2};

186 autÿ
s¸ìnDimí
 = (
RídîProgøm
::
	`gëS¸ìnDimí
());

188 
x
 = 
absRe˘
.x;

189 
∑øm
.
Æign
)

191 
RIGHT
:

192 
x
 -
	`gëDimí
(
∑øm
.
ãxt
,
sˇÀ
,1).x;

194 
CENTER
:

195 
x
 -
	`gëDimí
(
∑øm
.
ãxt
,
sˇÀ
,1).x/2;

201 
size
 = 
∑øm
.
ãxt
.
	`size
();

202 
i
 = 0; i < 
size
; ++i)

204 
c
 = 
∑øm
.
ãxt
[
i
];

205 
Ch¨a˘î
* 
ch
 = &(
ch¨a˘îs
[
c
].
	`gë
()->
	`gëCh¨a˘î
());

206 c⁄° 
glm
::
vec2
* 
bórög
 = &
ch
->
	`gëBórög
();

207 c⁄° 
glm
::
vec2
* 
chSize
 = &
ch
->
	`gëSize
();

208 
GLÊﬂt
 
xpos
 = 
x
 +
bórög
->x*
sˇÀ
;

209 
GLÊﬂt
 
ypos
 = (
absRe˘
.
y
)+ (
maxVît
.
x
 - 
bórög
->y)*
sˇÀ
;

211 
glm
::
vec2
 
pos
 = 
	`rŸ©ePoöt
({
xpos
,
ypos
},
˚¡î
,
∑øm
.
™gÀ
);

212 
GLÊﬂt
 
w
 = 
chSize
->
x
*
sˇÀ
;

213 
GLÊﬂt
 
h
 = (
chSize
->
y
)*
sˇÀ
;

216 
ch¨a˘îs
[
c
]->
	`ªque°
({{
pos
.
x
,pos.
y
,
w
,
h
},0,
NONE
,
∑øm
.
cﬁ‹
,&
w‹dProgøm
,∑øm.
z
});

217 
x
 +(
ch
->
	`gëAdv™˚
(Ë>> 6 )*
sˇÀ
;

221 
	}
}

222 
	gF⁄t
::
	$wrôe
()

231 
	}
}

233 
F⁄t
::~
	$F⁄t
()

236 
ch¨a˘îs
.
	`˛ór
();

237 
	}
}

239 
	g°d
::
ve˘‹
<
F⁄t
*> 
F⁄tM™agî
::
f⁄ts
;

241 
	gF⁄tM™agî
::
	$addF⁄t
(
F⁄t
& 
f⁄t
)

243 
f⁄ts
.
	`push_back
(&
f⁄t
);

244 
	}
}

246 
	gF⁄tM™agî
::
	$upd©e
()

248 
size
 = 
f⁄ts
.
	`size
();

249 
i
 = 0; i < 
size
; ++i)

251 
f⁄ts
[
i
]->
	`wrôe
();

254 
	}
}

	@C:\Users\leoou\OneDrive\Desktop\resources\FreeTypeHelper.h

1 #i‚de‡
FREETYPEHELPER_H_INCLUDED


2 
	#FREETYPEHELPER_H_INCLUDED


	)

4 
	~<·2buûd.h
>

5 #ö˛udê
FT_FREETYPE_H


7 
	~<un‹dîed_m≠
>

8 
	~<mem‹y
>

10 
	~"geomëry.h
"

11 
	~"ªndî.h
"

13 
	eAlign


15 
	mLEFT
,

16 
	mCENTER
,

17 
	mRIGHT


21 
	sF⁄tP¨amëî


23 
	m°d
::
°rög
 
ãxt
 = "";

24 
	mglm
::
vec4
 
ª˘
 = {0,0,0,0};

25 
	m™gÀ
 = 0;

26 
	mglm
::
vec4
 
cﬁ‹
 = {0,0,0,1};

27 
	mz
 = 0;

28 
Align
 
	mÆign
 = 
LEFT
;

31 ˛as†
	cF⁄t


33 ˛as†
	cCh¨a˘î
 : 
public
 
S¥ôe


35 
Àâî
;

37 
	mglm
::
vec2
 
size
;

38 
	mglm
::
vec2
 
bórög
;

39 
GLuöt
 
	madv™˚
;

40 
	mpublic
:

41 
Ch¨a˘î
(
c
, 
FT_Fa˚
& 
Á˚
);

42 c⁄° 
	mglm
::
vec2
& 
gëBórög
();

43 c⁄° 
	mglm
::
vec2
& 
gëSize
();

44 
GLuöt
 
gëAdv™˚
();

48 ˛as†
	cF⁄tWøµî
 : 
public
 
S¥ôeWøµî


50 
public
:

51 
F⁄tWøµî
(
Ch¨a˘î
& 
•rôe
);

52 
	gCh¨a˘î
& 
gëCh¨a˘î
();

55 
	g°d
::
un‹dîed_m≠
<
GLch¨
,°d::
unique_±r
<
F⁄tWøµî
>> 
ch¨a˘îs
;

56 
	gglm
::
vec2
 
maxVît
;

57 
	g°d
::
°rög
 
f⁄t
 = "";

58 
GLuöt
 
	gVBO
,
	gVAO
;

59 
	gödi˚s
[6] = {

62 
wrôeLígth
(
°d
::
°rög
 
°r
);

63 
	gpublic
:

64 
öô
(
s¸ìnWidth
,
s¸ìnHeight
);

65 
F⁄t
 
	gär
;

66 
RídîProgøm
 
	gw‹dProgøm
;

67 
F⁄t
(
°d
::
°rög
 
sour˚
);

68 
	$F⁄t
()

71 
	}
}

72 
öô
(
°d
::
°rög
 
sour˚
);

73 
	gglm
::
vec2
 
gëDimí
(
°d
::
°rög
 
ãxt
, 
GLÊﬂt
 
hSˇÀ
, GLÊﬂà
vSˇÀ
);

74 
ªque°Wrôe
(
F⁄tP¨amëî
&& 
∑øm
);

75 
wrôe
();

76 
˛ór
();

77 ~
F⁄t
();

81 ˛as†
	cF⁄tM™agî


83 
	m°d
::
ve˘‹
<
F⁄t
*> 
f⁄ts
;

84 
	mpublic
:

85 
addF⁄t
(
F⁄t
& 
f⁄t
);

86 
upd©e
();

	@C:\Users\leoou\OneDrive\Desktop\resources\SDLhelper.cpp

1 
	~"SDLhñ≥r.h
"

2 
	~<io°ªam
>

4 
	gDñèTime
::
dñèTime
;

5 
	gDñèTime
::
œ°Time
 = 0;

6 
gameFøme
 
	gDñèTime
::
cuºítFøme
 = 0;

8 
	gDñèTime
::
	$upd©e
()

10 
dñèTime
 = (
	`SDL_GëTicks
(Ë- 
œ°Time
);

11 
œ°Time
 = 
	`SDL_GëTicks
();

12 
cuºítFøme
 ++;

13 
	}
}

15 
gameFøme
 
	gDñèTime
::
	$gëCuºítFøme
()

17  
cuºítFøme
;

18 
	}
}

20 
	gDñèTime
::
	$£t
()

22 
£tTime
 = 
	`SDL_GëTicks
();

23 
£tFøme
 = 
cuºítFøme
;

24 
	}
}

26 
	gDñèTime
::
	$ª£t
()

28 
£tTime
 = -1;

29 
	}
}

30 
boﬁ
 
	gDñèTime
::
	$isSë
()

32  
£tTime
 != -1;

33 
	}
}

35 
boﬁ
 
	gDñèTime
::
	$‰amesPas£d
(
gameFøme
 
∑s£d
)

38  
	`isSë
(Ë&& 
cuºítFøme
 - 
£tFøme
 >
∑s£d
;

39 
	}
}

41 
boﬁ
 
	gDñèTime
::
	$timePas£d
(
∑s£d
)

43  
	`isSë
(Ë&& 
	`SDL_GëTicks
(Ë- 
£tTime
 >
∑s£d
;

44 
	}
}

45 
	gDñèTime
::
	$gëTime
()

47  
£tTime
;

48 
	}
}

49 
	gDñèTime
::
	$gëTimePas£d
()

51  
£tTime
 =-1 ? -1 : 
	`SDL_GëTicks
() - setTime;

52 
	}
}

55 
SDL_Keycode
 
	gKeyM™agî
::
ju°Pªs£d
 = -1;

56 
	g°d
::
li°
<
SDL_Keycode
> 
KeyM™agî
::
numbîs
;

57 
Uöt32
 
	gKeyM™agî
::
œ°Evít
 = 0;

58 
SDL_Keycode
 
	gKeyM™agî
::
œ°Key
 = -1;

59 
	gKeyM™agî
::
œ°Ch¨
 = 0;

60 
	gKeyM™agî
::
œ°Lëãr
 = 0;

61 
	gKeyM™agî
::
	$gëL©e°
()

63 i‡(
numbîs
.
	`size
() > 0)

66  *(
°d
::
	`¥ev
(
numbîs
.
	`íd
()));

72 
	}
}

73 
SDL_Keycode
 
	gKeyM™agî
::
	$gëL©î
(
m
, 
n
)

75 
size
 = 
numbîs
.
	`size
();

76 i‡(
size
 > 0)

78 
°d
::
li°
<
SDL_Keycode
>::
ôî©‹
 
i
 = std::
	`¥ev
(
numbîs
.
	`íd
()); i !numbîs.
	`begö
(); i --)

80 i‡((*
i
Ë=
m
 || (*iË=
n
)

82  (*
i
);

87 
	}
}

88 
	gKeyM™agî
::
	$addNumbî
(
key
)

90 
numbîs
.
	`push_back
(
key
);

91 
	}
}

92 
	gKeyM™agî
::
	$födNumbî
(
n
)

94 
num
 = 0;

95 
°d
::
li°
<
SDL_Keycode
>::
ôî©‹
 
i
 = 
numbîs
.
	`begö
(); i !numbîs.
	`íd
(); i ++)

97 i‡((*
i
Ë=
n
 )

99  
num
;

101 
num
 ++;

104 
	}
}

106 
	gKeyM™agî
::
	$gëKeys
(
SDL_Evít
& 
e
)

108 
ju°Pªs£d
 = -1;

109 
œ°Ch¨
 = 0;

110 
sym
 = 
e
.
key
.
keysym
.sym;

111 i‡(
e
.
ty≥
 !
œ°Evít
 || 
sym
 !
œ°Key
 || 
œ°Lëãr
 !e.
ãxt
.text[0])

113 i‡(
e
.
ty≥
 =
SDL_KEYDOWN
)

115 i‡(
	`födNumbî
(
sym
) == -1)

117 
	`addNumbî
(
sym
);

118 
ju°Pªs£d
 = 
sym
;

121 i‡(
e
.
ty≥
 =
SDL_KEYUP
)

123 
	`ªmoveNumbî
(
sym
);

125 i‡(
e
.
ty≥
 =
SDL_TEXTINPUT
)

127 
œ°Ch¨
 = 
e
.
ãxt
.text[0];

130 
œ°Lëãr
 = 
e
.
ãxt
.text[0];

131 
œ°Key
 = 
sym
;

132 
œ°Evít
 = 
e
.
ty≥
;

134 
	}
}

135 
	gKeyM™agî
::
	$ªmoveNumbî
(
numbî
)

137 
ödex
 = 
	`födNumbî
(
numbî
);

138 i‡(
ödex
 != -1)

140 
numbîs
.
	`îa£
(
°d
::
	`√xt
“umbîs.
	`begö
(), 
ödex
));

142 
	}
}

144 
SDL_Keycode
 
	gKeyM™agî
::
	$gëJu°Pªs£d
()

146  
ju°Pªs£d
;

147 
	}
}

149 
	gKeyM™agî
::
	$gëLa°Ch¨
()

151  
œ°Ch¨
;

152 
	}
}

154 
boﬁ
 
	gMou£M™agî
::
À·
 = 
Ál£
;

155 
boﬁ
 
	gMou£M™agî
::
right
 = 
Ál£
;

156 
boﬁ
 
	gMou£M™agî
::
middÀ
 = 
Ál£
;

157 
	gMou£M™agî
::
ju°Clicked
 = -1;

158 
	gMou£M™agî
::
ju°Rñó£d
 = -1;

159 
Uöt32
 
	gMou£M™agî
::
œ°Evít
 = 0;

160 
	g°d
::
∑ú
<,> 
	gMou£M™agî
::
mou£Whìl
;

161 
boﬁ
* 
	gMou£M™agî
::
	$gëBuâ⁄
(
key
)

163 
key
)

165 
SDL_BUTTON_LEFT
:

166  &
À·
;

168 
SDL_BUTTON_RIGHT
:

169  &
right
;

171 
SDL_BUTTON_MIDDLE
:

172  &
middÀ
;

175 
throw
 "Wanted mouse button doesn'tÉxist!";

177 
	}
}

178 
	gMou£M™agî
::
	$upd©e
(
SDL_Evít
& 
e
)

180 
ju°Rñó£d
 = -1;

181 
ju°Clicked
 = -1;

182 i‡(
e
.
ty≥
 =
SDL_MOUSEWHEEL
)

184 
mou£Whìl
 = {
e
.
whìl
.
x
,e.whìl.
y
};

188 
mou£Whìl
 = {0,0};

189 i‡(
œ°Evít
 !
e
.
ty≥
)

191 i‡(
e
.
ty≥
 =
SDL_MOUSEBUTTONDOWN
)

193 
boﬁ
* 
±r
 = 
	`gëBuâ⁄
(
e
.
buâ⁄
.button);

194 i‡(*
±r
 =
Ál£
)

196 
ju°Clicked
 = 
e
.
buâ⁄
.button;

197 *
±r
 = 
åue
;

203 i‡(
e
.
ty≥
 =
SDL_MOUSEBUTTONUP
)

205 *
	`gëBuâ⁄
(
e
.
buâ⁄
.buâ⁄Ë
Ál£
;

206 
ju°Rñó£d
 = 
e
.
buâ⁄
.button;

212 
œ°Evít
 = 
e
.
ty≥
;

213 
	}
}

215 
	g°d
::
∑ú
<,> 
	gMou£M™agî
::
	$gëMou£Pos
()

217 
x
, 
y
;

218 
	`SDL_GëMou£Sèã
(&
x
,&
y
);

220  {
x
,
y
};

221 
	}
}

223 c⁄° 
boﬁ
 
	gMou£M™agî
::
	$isPªs£d
(
key
)

225  *
	`gëBuâ⁄
(
key
);

226 
	}
}

228 
	gMou£M™agî
::
	$gëJu°Clicked
()

230  
ju°Clicked
;

231 
	}
}

233 
	gMou£M™agî
::
	$gëJu°Rñó£d
()

235  
ju°Rñó£d
;

236 
	}
}

238 c⁄° 
	g°d
::
∑ú
<,>& 
	gMou£M™agî
::
	$gëMou£Whìl
()

240  
mou£Whìl
;

241 
	}
}

	@C:\Users\leoou\OneDrive\Desktop\resources\SDLhelper.h

1 #i‚de‡
SDLHELPER_H_INCLUDED


2 
	#SDLHELPER_H_INCLUDED


	)

4 
	~<li°
>

6 
	~"SDL.h
"

8 
	tgameFøme
;

10 ˛as†
	cDñèTime


12 
	mœ°Time
;

13 
	m£tTime
= -1;

14 
gameFøme
 
	m£tFøme
 = 0;

15 
gameFøme
 
	mcuºítFøme
;

16 
	mpublic
:

17 
dñèTime
;

18 
upd©e
();

19 
gameFøme
 
gëCuºítFøme
();

20 
£t
();

21 
vútuÆ
 
ª£t
();

22 
boﬁ
 
isSë
();

23 
boﬁ
 
timePas£d
(
∑s£d
);

24 
boﬁ
 
‰amesPas£d
(
gameFøme
 
∑s£d
);

25 
gëTime
();

26 
gëTimePas£d
();

29 ˛as†
	cKeyM™agî


31 
	mœ°Lëãr
;

32 
	mœ°Ch¨
;

33 
SDL_Keycode
 
	mju°Pªs£d
;

34 
	m°d
::
li°
<
SDL_Keycode
> 
numbîs
;

35 
Uöt32
 
	mœ°Evít
;

36 
SDL_Keycode
 
	mœ°Key
;

37 
	mpublic
:

38 
gëL©e°
();

39 
SDL_Keycode
 
gëL©î
(
m
, 
n
);

40 
addNumbî
(
key
);

41 
födNumbî
(
n
);

42 
gëKeys
(
SDL_Evít
& 
e
);

43 
SDL_Keycode
 
gëJu°Pªs£d
();

44 
ªmoveNumbî
(
numbî
);

45 
gëLa°Ch¨
();

54 ˛as†
	cMou£M™agî


56 
	mju°Clicked
;

57 
	mju°Rñó£d
;

58 
boﬁ
 
	mÀ·
;

59 
boﬁ
 
	mright
;

60 
boﬁ
 
	mmiddÀ
;

61 
Uöt32
 
	mœ°Evít
;

62 
	m°d
::
∑ú
<,> 
	mmou£Whìl
;

63 
boﬁ
* 
gëBuâ⁄
(
key
);

64 
	mpublic
:

65 
upd©e
(
SDL_Evít
& 
e
);

66 
gëJu°Clicked
();

67 
gëJu°Rñó£d
();

68 c⁄° 
boﬁ
 
isPªs£d
(
key
);

69 
	m°d
::
∑ú
<,> 
gëMou£Pos
();

70 c⁄° 
	m°d
::
∑ú
<,>& 
gëMou£Whìl
();

	@C:\Users\leoou\OneDrive\Desktop\resources\components.cpp

1 
	~<io°ªam
>

3 
	~"v™ûœ.h
"

4 
	~"SDLHñ≥r.h
"

5 
	~"ªndî.h
"

7 
	~"comp⁄íts.h
"

9 
	gComp⁄ít
::
	$Comp⁄ít
(
E¡ôy
& 
ítôy
Ë: 
Comp⁄ítC⁄èöî
<
Comp⁄ít
>(
nuŒ±r
), 
	$ítôy
(&
ítôy
)

12 
	}
}

14 
	gComp⁄ít
::
	$upd©e
()

17 
	}
}

18 
Comp⁄ít
::
	$cﬁlide
(
E¡ôy
& 
Ÿhî
)

21 
	}
}

22 
Comp⁄ít
::
	$⁄Dóth
()

25 
	}
}

27 
E¡ôy
& 
Comp⁄ít
::
	$gëE¡ôy
()

29  *
ítôy
;

30 
	}
}

32 
	gComp⁄ít
::~
	$Comp⁄ít
()

35 
	}
}

37 
Re˘Comp⁄ít
::
	$Re˘Comp⁄ít
(c⁄° 
glm
::
vec4
& 
ª˘
, 
E¡ôy
& 
ítôy
Ë: 
	`Comp⁄ít
”¡ôy), 
Comp⁄ítC⁄èöî
<
Re˘Comp⁄ít
>(&ítôy), 
	$Re˘Posôi⁄Æ
(
ª˘
)

40 
	}
}

43 
boﬁ
 
	gRe˘Comp⁄ít
::
	$cﬁlides
(c⁄° 
glm
::
vec4
& 
èrgë
)

45  
	`vecI¡î£˘
(
èrgë
,
ª˘
,0,
tût
);

46 
	}
}

48 
	gRe˘Comp⁄ít
::
	$£tRe˘
(c⁄° 
glm
::
vec4
& 
ª˘
)

50 
this
->
ª˘
 =Ñect;

51 
	}
}

53 
	gRe˘Comp⁄ít
::
	$£tPos
(c⁄° 
glm
::
vec2
& 
pos
)

55 
this
->
ª˘
.
x
 = 
pos
.x;

56 
this
->
ª˘
.
y
 = 
pos
.y;

57 
	}
}

59 
	gRe˘Comp⁄ít
::
	$£tCíãr
(c⁄° 
glm
::
vec2
& 
˚¡î
)

61 
this
->
ª˘
.
x
 = 
˚¡î
.x -Ñe˘.
z
/2;

62 
this
->
ª˘
.
y
 = 
˚¡î
.y -Ñe˘.
a
/2;

63 
	}
}

65 
	gglm
::
vec2
 
Re˘Comp⁄ít
::
	$gëPos
()

67  {
ª˘
.
x
,ª˘.
y
};

68 
	}
}

70 
	gglm
::
vec2
 
Re˘Comp⁄ít
::
	$gëCíãr
()

72  {
ª˘
.
x
 +Ñe˘.
z
/2,Ñe˘.
y
 +Ñe˘.
a
/2};

73 
	}
}

75 
	gRe˘Comp⁄ít
::~
	$Re˘Comp⁄ít
()

78 
	}
}

80 
MoveComp⁄ít
::
	$MoveComp⁄ít
(
•ìd
, c⁄° 
glm
::
vec4
& 
ª˘
, 
E¡ôy
& 
ítôy
Ë: 
	`Re˘Comp⁄ít
‘e˘,É¡ôy), 
Comp⁄ítC⁄èöî
<
MoveComp⁄ít
>(&entity),

81 
	`ba£S≥ed
(
•ìd
),
	$•ìd
(
•ìd
)

83 
èrgë
 = {
ª˘
.
x
 +Ñe˘.
z
/2,Ñe˘.
y
 +Ñe˘.
a
/2};

84 
	}
}

86 
	gMoveComp⁄ít
::
	$ãÀp‹t
(c⁄° 
glm
::
vec2
& 
poöt
)

88 
ª˘
.
x
 = 
poöt
.x -Ñe˘.
z
/2;

89 
ª˘
.
y
 = 
poöt
.y -Ñe˘.
a
/2;

90 
	`£tT¨gë
(
poöt
);

91 
	}
}

93 
	gglm
::
vec2
 
MoveComp⁄ít
::
	$gëNextPoöt
()

95 
glm
::
vec2
 
˚¡î
 = {
ª˘
.
x
 +Ñe˘.
z
/2,Ñe˘.
y
 +Ñe˘.
a
/2};

96 i‡(!
ign‹eT¨gë
)

98 
™gÀ
 = 
	`©™2
((
èrgë
.
y
 - (
˚¡î
.y)),—¨gë.
x
 - (center.x)));

100 
glm
::
vec2
 
ö¸emít
 = {
	`cos
(
™gÀ
)*
•ìd
*
DñèTime
::
dñèTime
,
	`sö
(angle)*speed*DeltaTime::deltaTime};

102 i‡(
ign‹eT¨gë
)

104  
glm
::
	`vec2
(
ª˘
.
x
,Ñe˘.
y
Ë+ 
ö¸emít
;

106  
glm
::
	`vec2
(
ª˘
.
x
 + 
	`absMö
(
ö¸emít
.x,
èrgë
.x - 
˚¡î
.x),ª˘.
y
 +ábsMin(increment.y,Åarget.y - center.y));

107 
	}
}

109 
	gMoveComp⁄ít
::
	$upd©e
()

111 
glm
::
vec2
 
˚¡î
 = 
	`gëCíãr
();

112 i‡(!
	`©T¨gë
(Ë|| 
ign‹eT¨gë
)

114 
glm
::
vec2
 
√xtPoöt
 = 
	`gëNextPoöt
();

116 
ª˘
.
x
 = 
√xtPoöt
.x;

117 
ª˘
.
y
 = 
√xtPoöt
.y;

119 
vñocôy
 = 
	`poötDi°™˚
({
ª˘
.
x
 +Ñe˘.
z
/2,Ñe˘.
y
 +Ñe˘.
a
/2}, 
˚¡î
);

120 
•ìd
 = 
ba£S≥ed
;

121 
	}
}

123 
boﬁ
 
	gMoveComp⁄ít
::
	$©Poöt
(c⁄° 
glm
::
vec2
& 
poöt
)

125  
	`poötDi°™˚
(
	`gëCíãr
(),
poöt
Ë<
di°Thªshﬁd
;

126 
	}
}

128 
boﬁ
 
	gMoveComp⁄ít
::
	$©T¨gë
()

130  
	`©Poöt
(
èrgë
);

131 
	}
}

133 
	gMoveComp⁄ít
::
	$£tT¨gë
(c⁄° 
glm
::
vec2
& 
poöt
)

135 
èrgë
 = 
poöt
;

136 
	}
}

138 c⁄° 
	gglm
::
vec2
& 
MoveComp⁄ít
::
	$gëT¨gë
()

140  
èrgë
;

141 
	}
}

143 
	gMoveComp⁄ít
::
	$£tTûtTow¨dsT¨gë
()

145 
glm
::
vec2
 
˚¡î
 = 
	`gëCíãr
();

146 
tût
 = 
	`©™2
(
èrgë
.
y
 - 
˚¡î
.y ,èrgë.
x
 - center.x);

147 
	}
}

149 
	gMoveComp⁄ít
::
	$£tPos
(c⁄° 
glm
::
vec2
& 
pos
)

151 
ª˘
.
x
 =
pos
.x;

152 
ª˘
.
y
 = 
pos
.y;

153 
èrgë
.
x
 = 
pos
.x - 
ª˘
.
z
/2;

154 
èrgë
.
y
 = 
pos
.y - 
ª˘
.
a
/2;

155 
	}
}

157 
	gMoveComp⁄ít
::
	$£tAngÀ
(
vÆ
)

159 
™gÀ
 = 
vÆ
;

160 
	}
}

163 
	gMoveComp⁄ít
::
	$gëAngÀ
()

165  
™gÀ
;

166 
	}
}

168 
	gMoveComp⁄ít
::
	$gëVñocôy
()

170  
vñocôy
;

171 
	}
}

173 
	gMoveComp⁄ít
::
	$gëBa£S≥ed
()

175  
ba£S≥ed
;

176 
	}
}

178 
	gMoveComp⁄ít
::
	$gëCurS≥ed
()

180  
•ìd
;

181 
	}
}

183 
	gMoveComp⁄ít
::
	$£tS≥ed
(
√w•ìd
)

185 
•ìd
 = 
√w•ìd
;

186 
	}
}

188 
	gMoveComp⁄ít
::
	$£tIgn‹eT¨gë
(
boﬁ
 
vÆ
)

190 
ign‹eT¨gë
 = 
vÆ
;

191 
	}
}

193 
	gMoveComp⁄ít
::~
	$MoveComp⁄ít
()

196 
	}
}

198 
RólMoveComp⁄ít
::
	$ac˚Àøã
()

200 
•ìd
 = 
°d
::
	`max
(0.0f,°d::
	`mö
(•ìd + 
ac˚l
*
DñèTime
::
dñèTime
,
ba£S≥ed
));

201 
	}
}

203 
	gRólMoveComp⁄ít
::
	$de˚Àøã
()

205 
•ìd
 = 
°d
::
	`max
(0.0f,°d::
	`mö
(•ìd - 
de˚l
*
DñèTime
::
dñèTime
,
ba£S≥ed
));

206 
	}
}

208 
	gRólMoveComp⁄ít
::
	$RólMoveComp⁄ít
(
ac˚l_
, 
dec˚l_
, 
•ìd
, c⁄° 
glm
::
vec4
& 
ª˘
, 
E¡ôy
& 
ítôy
Ë: 
	`MoveComp⁄ít
(speed,Ñect,Éntity),

209 
Comp⁄ítC⁄èöî
<
RólMoveComp⁄ít
>(
ítôy
),

210 
	`ac˚l
(
ac˚l_
 =0 ? 
•ìd
 :áccel_),

211 
	`de˚l
(
dec˚l_
 =0 ? 
•ìd
 : deccel_)

213 
•ìd
 = 0;

214 
	}
}

216 
	gRólMoveComp⁄ít
::
	$£tT¨gë
(c⁄° 
glm
::
vec2
& 
poöt
)

218 i‡(
poöt
 !
èrgë
)

220 
glm
::
vec2
 
˚¡î

	`gëCíãr
();

221 
•ìd
 =0;

222 
maxS≥ed
 = 
°d
::
	`mö
(
ba£S≥ed
,()
	`sqπ
(2*
	`poötDi°™˚
(
poöt
,
˚¡î
)*
ac˚l
*
de˚l
/(accel + decel)));

223 
tût
 = 
	`©™2
(
poöt
.
y
 - 
˚¡î
.y ,poöt.
x
 - center.x);

225 
MoveComp⁄ít
::
	`£tT¨gë
(
poöt
);

226 
	}
}

228 
	gRólMoveComp⁄ít
::
	$gëAc˚l
()

230  
ac˚l
;

231 
	}
}

233 
	gRólMoveComp⁄ít
::
	$gëDe˚l
()

235  
de˚l
;

236 
	}
}

238 
	gRólMoveComp⁄ít
::
	$upd©e
()

240 i‡(!
	`©T¨gë
())

243 
de˚lDi°
 = 
maxS≥ed
/
de˚l
*maxSpeed/2.0;

244 i‡(
	`poötDi°™˚
(
	`gëCíãr
(),
èrgë
Ë> 
de˚lDi°
)

246 
	`ac˚Àøã
();

250 
	`de˚Àøã
();

251 
•ìd
 = 
°d
::
	`max
(
MoveComp⁄ít
::
di°Thªshﬁd
,speed);

253 
	`£tTûtTow¨dsT¨gë
();

257 
ﬁdS≥ed
 = 
•ìd
;

258 
MoveComp⁄ít
::
	`upd©e
();

259 
•ìd
 = 
ﬁdS≥ed
;

260 
	}
}

262 
	gRídîComp⁄ít
::
	$RídîComp⁄ít
(
E¡ôy
& 
ítôy
, 
RídîCamîa
* 
ˇmîa
Ë: 
	`Comp⁄ít
”¡ôy), 
Comp⁄ítC⁄èöî
<
RídîComp⁄ít
>(&ítôy), 
	$ˇmîa
(
ˇmîa
)

265 
	}
}

267 
	gRídîComp⁄ít
::
	$ªndî
(c⁄° 
S¥ôeP¨amëî
& 
∑øm
)

270 
	}
}

272 
RídîCamîa
* 
RídîComp⁄ít
::
	$gëCamîa
()

274  
ˇmîa
;

275 
	}
}

277 
	gRídîComp⁄ít
::~
	$RídîComp⁄ít
()

280 
	}
}

282 
S¥ôeP¨amëî
 
S¥ôeComp⁄ít
::
	$deÁu…Rídî
()

284 
S¥ôeP¨amëî
 
∑øm
;

285 
Re˘Comp⁄ít
* 
ª˘
 = 
ítôy
->
gëComp⁄ít
<RectComponent>();

286 i‡(
ª˘
)

288 i‡(
ˇmîa
)

290 
∑øm
.
ª˘
 = 
ˇmîa
->
	`toS¸ìn
‘e˘->
	`gëRe˘
());

294 
∑øm
.
ª˘
 =Ñe˘->
	`gëRe˘
();

296 
∑øm
.
ødüns
 = 
ª˘
->
	`gëTût
();

298  
∑øm
;

299 
	}
}

301 
	gS¥ôeComp⁄ít
::
	$S¥ôeComp⁄ít
(
S¥ôeWøµî
& 
•rôe_
, 
boﬁ
 
™im©ed_
, 
E¡ôy
& 
ítôy
, 
RídîCamîa
* 
ˇmîa
Ë: 
	`RídîComp⁄ít
(entity, camera),

302 
Comp⁄ítC⁄èöî
<
S¥ôeComp⁄ít
>(
ítôy
),

303 
	`•rôe
(&
•rôe_
),

304 
	$™im©ed
(
™im©ed_
)

307 
	}
}

309 
	gS¥ôeComp⁄ít
::
	$ªndî
(c⁄° 
S¥ôeP¨amëî
& 
∑øm
)

311 i‡(
•rôe
)

313 
•rôe
->
	`ªque°
(
∑øm
);

315 
	}
}

317 
	gS¥ôeComp⁄ít
::
	$£tP¨am
(c⁄° 
S¥ôeP¨amëî
& 
∑øm
, c⁄° 
Anim©i⁄P¨amëî
& 
™imeP¨am
, 
boﬁ
 
modifõd_
)

319 
this
->
sP¨am
 = 
∑øm
;

320 
this
->
aP¨am
 = 
™imeP¨am
;

321 
modifõd
 = 
modifõd_
;

322 
	}
}

324 
	gS¥ôeComp⁄ít
::
	$upd©e
()

326 i‡(
•rôe
)

328 i‡(!
modifõd
)

330 
sP¨am
 = 
	`deÁu…Rídî
();

332 i‡(
™im©ed
)

334 
°©ic_ˇ°
<
Anim©i⁄Wøµî
*>(
•rôe
)->
	`ªque°
(
sP¨am
,
aP¨am
);

338 
•rôe
->
	`ªque°
(
sP¨am
);

340 
	`£tP¨am
(
	`S¥ôeP¨amëî
(),
	`Anim©i⁄P¨amëî
());

341 
modifõd
 = 
Ál£
;

343 
	}
}

345 
	gBa£Hó…hComp⁄ít
::
	$Ba£Hó…hComp⁄ít
(
övu Time_
, 
hó…h_
,
maxHó…h_
, 
E¡ôy
& 
ítôy
) :

346 
	`Comp⁄ít
(
ítôy
), 
Comp⁄ítC⁄èöî
<
Ba£Hó…hComp⁄ít
>(entity),

347 
	`övu Time
(
övu Time_
), 
	`hó…h
(
hó…h_
), 
	$maxHó…h
(
maxHó…h_
)

350 
	}
}

352 
	gBa£Hó…hComp⁄ít
::
	$addHó…h
(
damage
)

354 i‡(
maxHó…h
 == -1)

356 
hó…h
 = 
°d
::
	`max
(0.0f, hó…h + 
damage
);

360 
hó…h
 = 
°d
::
	`max
(0.0f, std::
	`mö
(
maxHó…h
, hó…h + 
damage
));

362 i‡(
damage
 < 0)

364 
övu 
.
	`£t
();

366 
	}
}

368 
	gBa£Hó…hComp⁄ít
::
	$gëHó…h
()

370  
hó…h
;

371 
	}
}

373 
boﬁ
 
	gBa£Hó…hComp⁄ít
::
	$gëInvu 
()

375  
övu 
.
	`timePas£d
(
övu Time
);

376 
	}
}

378 
	gE¡ôy
::
	$E¡ôy
()

381 
	}
}

384 
E¡ôy
::
	$addComp⁄ít
(
Comp⁄ít
& 
comp
)

386 i‡(
comp⁄íts
.
	`föd
(&
comp
Ë=comp⁄íts.
	`íd
())

388 
comp⁄íts
[&
comp
] = 
°d
::
sh¨ed_±r
<
Comp⁄ít
>(&comp);

391 
	}
}

393 
	gE¡ôy
::
	$upd©e
()

395 autÿ
íd
 = 
comp⁄íts
.
	`íd
();

396 autÿ
i
 = 
comp⁄íts
.
	`begö
(); i !
íd
; ++i)

398 
i
->
fú°
->
	`upd©e
();

400 
	}
}

402 
	gE¡ôy
::
	$cﬁlide
(
E¡ôy
& 
ítôy
)

404 autÿ
íd
 = 
comp⁄íts
.
	`íd
();

405 autÿ
i
 = 
comp⁄íts
.
	`begö
();ò!
íd
; ++i)

407 
i
->
fú°
->
	`cﬁlide
(
ítôy
);

409 
	}
}

411 
	gE¡ôy
::
	$⁄Dóth
()

413 autÿ
íd
 = 
comp⁄íts
.
	`íd
();

414 autÿ
i
 = 
comp⁄íts
.
	`begö
();ò!
íd
; ++i)

416 
i
->
fú°
->
	`⁄Dóth
();

418 
	}
}

420 
	gE¡ôy
::~
	$E¡ôy
()

422 
comp⁄íts
.
	`˛ór
();

423 
	}
}

425 
E¡ôy
* 
	gE¡ôyAs£mbÀr
::
	$as£mbÀ
()

427  
nuŒ±r
;

428 
	}
}

430 
	gIDComp⁄ít
::
IDComp⁄ít
(
E¡ôy
& 
ítôy
, c⁄° 
°d
::
sh¨ed_±r
<
E¡ôyAs£mbÀr
>& 
as£mbÀr_
, std::
°rög
 
«me_
, 
id_
) :

431 
Comp⁄ít
(
ítôy
),

432 
	gComp⁄ítC⁄èöî
<
	gIDComp⁄ít
>(
	gítôy
),

433 
as£mbÀr
(
as£mbÀr_
),

434 
«me
(
«me_
),

435 
	$id
(
id_
)

438 
	}
}

440 
	gIDComp⁄ít
::
	$IDComp⁄ít
(
E¡ôy
& 
ítôy
, 
°d
::
°rög
 
«me_
, 
id_
Ë: 
	`Comp⁄ít
(entity),

441 
Comp⁄ítC⁄èöî
<
IDComp⁄ít
>(
ítôy
),

442 
	`«me
(
«me_
),

443 
	$id
(
id_
)

446 
	}
}

448 
boﬁ
 
	gE¡ôyM™agî
::
	$f‹EachE¡ôy
(
E¡ôy
& 
ítôy
)

450 
ítôy
.
	`upd©e
();

451  
Ál£
;

452 
	}
}

454 
	gE¡ôyM™agî
::
	$addE¡ôy
(
E¡ôy
& 
ítôy
)

456 
°d
::
sh¨ed_±r
<
E¡ôy
> 
	`±r
(&
ítôy
);

457 
	`addE¡ôy
(
±r
);

458 
	}
}

460 
	gE¡ôyM™agî
::
addE¡ôy
(c⁄° 
°d
::
sh¨ed_±r
<
E¡ôy
>& 
ítôy
)

462 i‡(
ítôõs
.
föd
(
ítôy
.
gë
()Ë=ítôõs.
íd
() &&Éntity.get())

464 
ítôõs
[
ítôy
.
gë
()] =Éntity;

468 
	gE¡ôyM™agî
::
E¡ôyIt
 
E¡ôyM™agî
::
	$ªmoveE¡ôy
(
E¡ôy
* 
ítôy
)

470 
E¡ôyIt
 
ô
 = 
ítôõs
.
	`föd
(
ítôy
);

471 i‡(
ô
 !
ítôõs
.
	`íd
())

473  
ítôõs
.
	`îa£
(
ô
);

475 
	}
}

477 
	g°d
::
sh¨ed_±r
<
E¡ôy
> 
E¡ôyM™agî
::
	$gëE¡ôy
(
E¡ôy
* 
±r
)

479 autÿ
found
 = 
ítôõs
.
	`föd
(
±r
);

480 i‡(
found
 !
ítôõs
.
	`íd
())

482  
found
->
£c⁄d
;

486  
°d
::
sh¨ed_±r
<
E¡ôy
>();

488 
	}
}

490 
	gE¡ôyM™agî
::
	$upd©e
()

492 autÿ
íd
 = 
ítôõs
.
	`íd
();

493 autÿ
ô
 = 
ítôõs
.
	`begö
(); ià!
íd
;)

495 i‡(
	`f‹EachE¡ôy
(*
ô
->
fú°
))

497 
ô
 = 
	`ªmoveE¡ôy
(ô->
fú°
);

501 ++
ô
;

504 
	}
}

506 
boﬁ
 
	gE¡ôyPosM™agî
::
	$f‹EachE¡ôy
(
E¡ôy
& 
ítôy
)

508 i‡(
Re˘Comp⁄ít
* 
ª˘
 = 
ítôy
.
gëComp⁄ít
<RectComponent>())

510 
QuadTªe
* 
ﬁd
 = 
quadåì
->
	`föd
(*
ª˘
);

511 i‡(
ﬁd
)

513 autÿ
√¨e°
 = 
ﬁd
->
	`gëNóª°
(*
ª˘
);

514 autÿ
íd
 =
√¨e°
.
	`íd
();

515 autÿ
ô
 = 
√¨e°
.
	`begö
(); ià!
íd
; ++it)

517 i‡((*
ô
)->
	`cﬁlides
(
ª˘
->
	`gëRe˘
()))

519 
ítôy
.
	`cﬁlide
(
°©ic_ˇ°
<
Re˘Comp⁄ít
*>(*
ô
)->
	`gëE¡ôy
());

523 
ítôy
.
	`upd©e
();

524 i‡(
ﬁd
)

526 
quadåì
->
	`upd©e
(*
ª˘
,*
ﬁd
);

531 
ítôy
.
	`upd©e
();

533  
Ál£
;

534 
	}
}

536 
	gE¡ôyPosM™agî
::
	$öô
(c⁄° 
glm
::
vec4
& 
ª˘
)

538 
quadåì
.
	`ª£t
(
√w
 
	`QuadTªe
(
ª˘
));

539 
	}
}

541 
QuadTªe
* 
	gE¡ôyPosM™agî
::
	$gëQuadTªe
()

543  
quadåì
.
	`gë
();

544 
	}
}

546 
	gE¡ôyPosM™agî
::
addE¡ôy
(c⁄° 
°d
::
sh¨ed_±r
<
E¡ôy
>& 
ítôy
)

548 
°d
::
sh¨ed_±r
<
Re˘Comp⁄ít
> 
ª˘
 = 
ítôy
->
gëComp⁄ítPå
<RectComponent>();

549 i‡(
	gª˘
.
gë
())

551 
	gquadåì
->
add
(*(
√w
 
WókWøµî
(
ª˘
)));

553 
	gE¡ôyM™agî
::
addE¡ôy
(
ítôy
);

556 
	gE¡ôyPosM™agî
::
	$addE¡ôy
(
E¡ôy
& 
ítôy
, 
x
, 
y
, 
boﬁ
 
˚¡îed
)

558 i‡(
Re˘Comp⁄ít
* 
ª˘
 = 
ítôy
.
gëComp⁄ít
<RectComponent>())

560 
ª˘
->
	`£tPos
({
x
 - 
˚¡îed
*ª˘->
	`gëRe˘
().
z
/2, 
y
 - cíãªd*ª˘->gëRe˘().
a
/2});

561 
	`addE¡ôy
(
°d
::
sh¨ed_±r
<
E¡ôy
>(&
ítôy
));

563 
	}
}

565 
	gE¡ôyPosM™agî
::
E¡ôyIt
 
E¡ôyPosM™agî
::
	$ªmoveE¡ôy
(
E¡ôy
* 
ítôy
)

567 i‡(
ítôõs
.
	`föd
(
ítôy
Ë!ítôõs.
	`íd
() &&Éntity)

569 i‡(
Re˘Comp⁄ít
* 
ª˘
 = 
ítôy
->
gëComp⁄ít
<RectComponent>())

571 
quadåì
->
	`ªmove
(*
ª˘
);

573  
E¡ôyM™agî
::
	`ªmoveE¡ôy
(
ítôy
);

575 
	}
}

577 
	gE¡ôyPosM™agî
::
	$ª£t
()

579 
ítôõs
.
	`˛ór
();

580 
quadåì
->
	`˛ór
();

581 
	}
}

	@C:\Users\leoou\OneDrive\Desktop\resources\components.h

1 #i‚de‡
COMPONENTS_H_INCLUDED


2 
	#COMPONENTS_H_INCLUDED


	)

4 
	~<mem‹y.h
>

5 
	~<un‹dîed_m≠
>

6 
	~<un‹dîed_£t
>

7 
	~<ty≥öfo
>

8 
	~<li°
>

10 
	~"glGame.h
"

11 
	~"ªndî.h
"

12 
	~"SDLhñ≥r.h
"

14 
˛ass
 
	gE¡ôy
;

15 
˛ass
 
	gComp⁄ít
;

19 
	gãm∂©e
<
˛ass
 
	gC
>

20 ˛as†
	cComp⁄ítC⁄èöî


22 
	m¥iv©e
:

23 
°d
::
un‹dîed_m≠
<
E¡ôy
*,
	mC
*> 
	mcomp⁄íts
;

24 
	m°d
::
un‹dîed_m≠
<
Comp⁄ítC⁄èöî
*, 
	mE¡ôy
*> 
	mítôõs
;

26 
	$ö£π
(
E¡ôy
* 
ítôy
)

29 i‡(
ítôy
)

33 
C
* 
±r
 = 
°©ic_ˇ°
<C*>(
this
);

35 
comp⁄íts
[
ítôy
] = 
±r
;

36 
ítôõs
[
this
] = 
ítôy
;

42 
	$ªmove
()

45 i‡(
ítôõs
.
	`cou¡
(
this
) > 0)

47 
comp⁄íts
.
	`îa£
(comp⁄íts.
	`föd
(
ítôõs
[
this
]));

48 
ítôõs
.
	`îa£
”¡ôõs.
	`föd
(
this
));

52 
	}
}

54 
	gpublic
:

55 
Comp⁄ítC⁄èöî
<
C
>(
E¡ôy
* 
ítôy
)

57 
ö£π
(
ítôy
);

59 
	gComp⁄ítC⁄èöî
<
	gC
>(
	gE¡ôy
& 
	gítôy
)

61 
ö£π
(&
ítôy
);

63 
	gvútuÆ
 ~
	$Comp⁄ítC⁄èöî
()

67 
	`ªmove
();

70 
	}
}

71 
C
* 
	$gëComp⁄ít
(
E¡ôy
* 
e
)

73 i‡(
comp⁄íts
.
	`cou¡
(
e
) > 0)

75  
comp⁄íts
[
e
];

79  
nuŒ±r
;

81 
	}
}

85 
	gãm∂©e
<
˛ass
 
	gC
>

86 
	g°d
::
un‹dîed_m≠
<
E¡ôy
*,
	gC
*> 
	gComp⁄ítC⁄èöî
<C>::
comp⁄íts
;

88 
	gãm∂©e
<
˛ass
 
	gC
>

89 
	g°d
::
un‹dîed_m≠
<
Comp⁄ítC⁄èöî
<
C
>*, 
	gE¡ôy
*> 
	gComp⁄ítC⁄èöî
<
	gC
>::
ítôõs
;

92 
˛ass
 
	gComp⁄ít
 : 
public
 
Comp⁄ítC⁄èöî
<
Comp⁄ít
>

94 
¥Ÿe˘ed
:

95 
E¡ôy
* 
ítôy
;

97 
	gpublic
:

98 
Comp⁄ít
(
E¡ôy
& 
ow√r
);

99 
vútuÆ
 
upd©e
();

100 
vútuÆ
 
cﬁlide
(
E¡ôy
& 
Ÿhî
);

101 
vútuÆ
 
⁄Dóth
();

102 
	gE¡ôy
& 
gëE¡ôy
();

103 
	gvútuÆ
 ~
Comp⁄ít
();

106 
˛ass
 
	gRe˘Comp⁄ít
 : 
public
 
Comp⁄ít
,Öubli¯
	gComp⁄ítC⁄èöî
<Re˘Comp⁄ít>,Öubli¯
	gRe˘Posôi⁄Æ


108 
	gpublic
:

109 
Re˘Comp⁄ít
(c⁄° 
glm
::
vec4
& 
ª˘
, 
E¡ôy
& 
ítôy
);

110 
boﬁ
 
cﬁlides
(c⁄° 
glm
::
vec4
& 
ª˘
);

111 
£tRe˘
(c⁄° 
glm
::
vec4
& 
ª˘
);

112 
vútuÆ
 
£tPos
(c⁄° 
glm
::
vec2
& 
pos
);

113 
£tCíãr
(c⁄° 
glm
::
vec2
& 
˚¡î
);

114 
	gglm
::
vec2
 
gëPos
();

115 
	gglm
::
vec2
 
gëCíãr
();

117 
	gvútuÆ
 ~
Re˘Comp⁄ít
();

120 
˛ass
 
	gMoveComp⁄ít
 : 
public
 
Re˘Comp⁄ít
,Öubli¯
	gComp⁄ítC⁄èöî
<MoveComponent>

122 
	g™gÀ
 = 0;

123 
	g¥Ÿe˘ed
:

124 
c⁄°ex¥
 
di°Thªshﬁd
 = .001;

125 
	gba£S≥ed
 = 0;

126 
	g•ìd
 = 0;

127 
	gvñocôy
 = 0;

128 
boﬁ
 
	gign‹eT¨gë
 = 0;

130 
	gglm
::
vec2
 
èrgë
;

131 
	gpublic
:

132 
MoveComp⁄ít
(
•ìd
, c⁄° 
glm
::
vec4
& 
ª˘
, 
E¡ôy
& 
ítôy
);

133 
ãÀp‹t
(c⁄° 
glm
::
vec2
& 
poöt
);

134 
vútuÆ
 
	gglm
::
vec2
 
gëNextPoöt
();

135 
vútuÆ
 
upd©e
();

136 
vútuÆ
 
boﬁ
 
©Poöt
(c⁄° 
glm
::
vec2
& 
poöt
);

137 
vútuÆ
 
boﬁ
 
©T¨gë
();

138 
vútuÆ
 
£tT¨gë
(c⁄° 
glm
::
vec2
& 
poöt
);

139 
vútuÆ
 c⁄° 
	gglm
::
vec2
& 
gëT¨gë
();

140 
£tTûtTow¨dsT¨gë
();

141 
vútuÆ
 
£tPos
(c⁄° 
glm
::
vec2
& 
pos
);

142 
£tAngÀ
(
vÆ
);

143 
gëAngÀ
();

144 
gëVñocôy
();

145 
gëBa£S≥ed
();

146 
gëCurS≥ed
();

147 
£tS≥ed
(
√wS≥ed
);

148 
£tIgn‹eT¨gë
(
boﬁ
 
vÆ
);

149 
	gvútuÆ
 ~
MoveComp⁄ít
();

153 
˛ass
 
	gRólMoveComp⁄ít
 : 
public
 
MoveComp⁄ít
,Öubli¯
	gComp⁄ítC⁄èöî
<RealMoveComponent>

156 
	gac˚l
 = 0, 
	gde˚l
 = 0;

157 
	gmaxS≥ed
 = 0;

158 
	g¥Ÿe˘ed
:

159 
ac˚Àøã
();

160 
de˚Àøã
();

161 
	gpublic
:

162 
RólMoveComp⁄ít
(
ac˚l_
, 
dec˚l_
, 
•ìd
, c⁄° 
glm
::
vec4
& 
ª˘
, 
E¡ôy
& 
ítôy
);

163 
£tT¨gë
(c⁄° 
glm
::
vec2
& 
poöt
);

164 
gëAc˚l
();

165 
gëDe˚l
();

166 
vútuÆ
 
upd©e
();

167 
	gvútuÆ
 ~
RólMoveComp⁄ít
()

173 
˛ass
 
	gRídîComp⁄ít
 : 
public
 
Comp⁄ít
,Öubli¯
	gComp⁄ítC⁄èöî
<RenderComponent>

175 
	g¥Ÿe˘ed
:

176 
RídîCamîa
* 
ˇmîa
 = 
nuŒ±r
;

177 
	gpublic
:

178 
RídîComp⁄ít
(
E¡ôy
& 
ítôy
, 
RídîCamîa
* 
ˇmîa
);

179 
vútuÆ
 
ªndî
(c⁄° 
S¥ôeP¨amëî
& 
∑øm
);

180 
RídîCamîa
* 
gëCamîa
();

181 
	gvútuÆ
 ~
RídîComp⁄ít
();

184 
˛ass
 
	gS¥ôeComp⁄ít
 : 
public
 
RídîComp⁄ít
,Öubli¯
	gComp⁄ítC⁄èöî
<SpriteComponent>

186 
S¥ôeWøµî
* 
	g•rôe
 = 
nuŒ±r
;

187 
S¥ôeP¨amëî
 
	gsP¨am
;

188 
Anim©i⁄P¨amëî
 
	gaP¨am
;

189 
boﬁ
 
	g™im©ed
 = 
Ál£
;

190 
boﬁ
 
	gmodifõd
 = 
Ál£
;

192 
	g¥Ÿe˘ed
:

193 
vútuÆ
 
S¥ôeP¨amëî
 
deÁu…Rídî
();

194 
	gpublic
:

195 
S¥ôeComp⁄ít
(
S¥ôeWøµî
& 
•rôe_
, 
boﬁ
 
™im©ed_
, 
E¡ôy
& 
ítôy
, 
RídîCamîa
* 
ˇmîa
 = RídîCamîa::
cuºítCamîa
);

196 
vútuÆ
 
ªndî
(c⁄° 
S¥ôeP¨amëî
& 
∑øm
);

197 
£tP¨am
(c⁄° 
S¥ôeP¨amëî
& 
∑øm
, c⁄° 
Anim©i⁄P¨amëî
& 
™imeP¨am
 = Anim©i⁄P¨amëî(), 
boﬁ
 
modifõd_

åue
);

198 
upd©e
();

199 
	gvútuÆ
 ~
S¥ôeComp⁄ít
()

205 
˛ass
 
	gBa£Hó…hComp⁄ít
 : 
public
 
Comp⁄ít
,Öubli¯
	gComp⁄ítC⁄èöî
<BaseHealthComponent>

207 
	g¥Ÿe˘ed
:

208 
DñèTime
 
övu 
;

209 
	gövu Time
;

210 
	gmaxHó…h
 = 0;

211 
	ghó…h
 = 0;

212 
	gpublic
:

213 
Ba£Hó…hComp⁄ít
(
övu Time_
,
hó…h_
, 
maxHó…h_
, 
E¡ôy
& 
ítôy
);

214 
vútuÆ
 
addHó…h
(
damage
);

215 
gëHó…h
();

216 
boﬁ
 
gëInvu 
();

217 
	gvútuÆ
 ~
Ba£Hó…hComp⁄ít
()

223 ˛as†
	cE¡ôy


225 
	m¥Ÿe˘ed
:

226 
°d
::
un‹dîed_m≠
<
Comp⁄ít
*,
	m°d
::
sh¨ed_±r
<Comp⁄ít>> 
comp⁄íts
;

227 
	mpublic
:

228 
E¡ôy
();

229 
upd©e
();

230 
cﬁlide
(
E¡ôy
& 
ítôy
);

231 
	mãm∂©e
<
ty≥«me
 
	mT
>

232 
T
* 
	$gëComp⁄ít
()

234  (
°©ic_ˇ°
<
T
*>(
Comp⁄ítC⁄èöî
<T>::
	`gëComp⁄ít
(
this
)));

236 
°d
::
sh¨ed_±r
<
Comp⁄ít
> 
	$gëComp⁄ít
(
Comp⁄ít
* 
comp
)

238  
comp⁄íts
[
comp
];

239 
	}
}

240 
	gãm∂©e
<
ty≥«me
 
	gT
>

241 
	g°d
::
sh¨ed_±r
<
T
> 
	$gëComp⁄ítPå
()

243  
°d
::
°©ic_poöãr_ˇ°
<
T
>(
	`gëComp⁄ít
(
gëComp⁄ít
<T>()));

244 
	}
}

245 
addComp⁄ít
(
Comp⁄ít
& 
comp
);

246 
	gãm∂©e
<
ty≥«me
 
	gT
>

247 
	$ªmoveComp⁄ít
()

249 
T
* 
±r
 = 
gëComp⁄ít
<T>();

250 i‡(
±r
)

252 autÿ
íd
 = 
comp⁄íts
.
	`íd
();

253 autÿ
i
 = 
comp⁄íts
.
	`begö
(); i !
íd
; ++i)

255 i‡(
i
->
£c⁄d
.
	`gë
(Ë=
±r
)

257 
comp⁄íts
.
	`îa£
(
i
);

262 
	}
}

263 
⁄Dóth
();

264 
	gvútuÆ
 ~
E¡ôy
();

268 ˛as†
	cE¡ôyAs£mbÀr


270 
	mpublic
:

271 
vútuÆ
 
E¡ôy
* 
as£mbÀ
();

274 
˛ass
 
	gIDComp⁄ít
 : 
public
 
Comp⁄ít
,Öubli¯
	gComp⁄ítC⁄èöî
<IDComponent>

276 
	gpublic
:

277 c⁄° 
°d
::
wók_±r
<
E¡ôyAs£mbÀr
> 
as£mbÀr
;

278 c⁄° 
	g°d
::
°rög
 
«me
;

279 c⁄° 
	gid
;

280 
IDComp⁄ít
(
E¡ôy
& 
ítôy
, c⁄° 
°d
::
sh¨ed_±r
<
E¡ôyAs£mbÀr
>& 
as£mbÀr_
, std::
°rög
 
«me_
 = "", 
id_
 = -1);

281 
IDComp⁄ít
(
E¡ôy
& 
ítôy
, 
°d
::
°rög
 
«me_
 = "", 
id_
 = -1);

284 ˛as†
	cE¡ôyM™agî


286 
	m¥Ÿe˘ed
:

287 
°d
::
un‹dîed_m≠
<
E¡ôy
*,
	m°d
::
sh¨ed_±r
<E¡ôy>> 
ítôõs
;

288 
	m°d
::
	tun‹dîed_m≠
<
	tE¡ôy
*,
	t°d
::
	tsh¨ed_±r
<E¡ôy>>::
	tôî©‹
 
	tE¡ôyIt
;

289 
vútuÆ
 
boﬁ
 
f‹EachE¡ôy
(
E¡ôy
& 
ô
);

291 
	mpublic
:

292 
vútuÆ
 
addE¡ôy
(
E¡ôy
& 
ítôy
);

293 
vútuÆ
 
addE¡ôy
(c⁄° 
°d
::
sh¨ed_±r
<
E¡ôy
>& 
ítôy
);

294 
vútuÆ
 
E¡ôyIt
 
ªmoveE¡ôy
(
E¡ôy
* 
ítôy
);

295 
	m°d
::
sh¨ed_±r
<
E¡ôy
> 
gëE¡ôy
(E¡ôy* 
±r
);

296 
vútuÆ
 
upd©e
();

299 ˛as†
	cE¡ôyPosM™agî
 : 
public
 
E¡ôyM™agî


301 
°d
::
unique_±r
<
QuadTªe
> 
quadåì
;

302 
	m¥Ÿe˘ed
:

303 
vútuÆ
 
boﬁ
 
f‹EachE¡ôy
(
E¡ôy
& 
ítôy
);

304 
	mpublic
:

305 
vútuÆ
 
öô
(c⁄° 
glm
::
vec4
& 
ª˘
);

306 
QuadTªe
* 
gëQuadTªe
();

307 
usög
 
	mE¡ôyM™agî
::
addE¡ôy
;

308 
vútuÆ
 
addE¡ôy
(c⁄° 
°d
::
sh¨ed_±r
<
E¡ôy
>& 
±r
);

309 
vútuÆ
 
addE¡ôy
(
E¡ôy
& 
ítôy
, 
x
, 
y
, 
boﬁ
 
˚¡îed
 = 
åue
);

310 
E¡ôyIt
 
ªmoveE¡ôy
(
E¡ôy
* 
ítôy
);

311 
ª£t
();

	@C:\Users\leoou\OneDrive\Desktop\resources\geometry.cpp

1 
	#_USE_MATH_DEFINES


	)

2 
	~<m©h.h
>

3 
	~<io°ªam
>

5 
	~"geomëry.h
"

8 
	$¥ötRe˘
(c⁄° 
glm
::
vec4
& 
ª˘
)

10 
°d
::
cout
 << 
ª˘
.
x
 << " " <<Ñe˘.
y
 << " " <<Ñe˘.
z
 << " " <<Ñe˘.
a
 << std::
ídl
;

11 
	}
}

14 
	$poötDi°™˚
(c⁄° 
glm
::
vec2
& 
v1
, c⁄° glm::vec2& 
v2
)

16  
	`sqπ
(
	`pow
(
v1
.
x
 - 
v2
.x,2Ë+Öow(v1.
y
 - v2.y,2));

17 
	}
}

19 
	gglm
::
vec2
 
	$födMidpoöt
(c⁄° 
glm
::
vec4
& 
v1
)

21  {(
v1
.
x
 + v1.
z
)/2, (v1.
y
 + v1.
a
)/2};

22 
	}
}

24 
boﬁ
 
	$vecI¡î£˘
(c⁄° 
glm
::
vec4
& 
vec1
,c⁄° glm::vec4& 
vec2
)

26 i‡(
vec1
.
z
 < 0 || vec1.
a
 < 0 || 
vec2
.z < 0 || vec2.a < 0)

28 
glm
::
vec4
 
ª˘1
 = 
vec1
, 
ª˘2
 = 
vec2
;

29 i‡(
vec1
.
z
 < 0)

31 
ª˘1
.
x
 +
vec1
.
z
;

32 
ª˘1
.
z
 *= -1;

34 i‡(
vec1
.
a
 < 0)

36 
ª˘1
.
y
 +
vec1
.
a
;

37 
ª˘1
.
a
 *= -1;

39 i‡(
vec2
.
z
 < 0)

41 
ª˘2
.
x
 +
vec2
.
z
;

42 
ª˘2
.
z
 *= -1;

44 i‡(
vec2
.
a
 < 0)

46 
ª˘2
.
y
 +
vec2
.
a
;

47 
ª˘2
.
a
 *= -1;

49  
	`vecI¡î£˘
(
ª˘1
,
ª˘2
);

51  (
vec1
.
x
 <
vec2
.x + vec2.
z
 && vec1.x + vec1.z>vec2.x && vec1.
y
 <vec2.y + vec2.
a
 && vec1.y + vec1.a >= vec2.y);

52 
	}
}

54 
boﬁ
 
	$vecI¡î£˘
(c⁄° 
glm
::
vec4
& 
vec1
,c⁄° glm::vec4& 
vec2
, 
™gÀ1
, 
™gÀ2
)

56 i‡(
™gÀ1
 =0 && 
™gÀ2
 == 0)

58  
	`vecI¡î£˘
(
vec1
,
vec2
);

60 
glm
::
vec2
 
˚¡î
 = {vec2.
x
 + vec2.
z
/2, vec2.
y
 + vec2.
a
/2};

61 
glm
::
vec2
 
t›Le·
 = 
	`rŸ©ePoöt
({vec2.
x
, vec2.
y
}, 
˚¡î
, 
™gÀ2
);

62 
glm
::
vec2
 
t›Right
 = 
	`rŸ©ePoöt
({vec2.
x
 + vec2.
z
, vec2.
y
}, 
˚¡î
, 
™gÀ2
);

63 
glm
::
vec2
 
bŸLe·
 = 
	`rŸ©ePoöt
({vec2.
x
, vec2.
y
 + vec2.
a
}, 
˚¡î
, 
™gÀ2
);

64 
glm
::
vec2
 
bŸRight
 = 
	`rŸ©ePoöt
({vec2.
x
 + vec2.
z
, vec2.
y
 + vec2.
a
}, 
˚¡î
,
™gÀ2
);

69  (
	`löeInVec
(
t›Le·
, 
t›Right
, 
vec1
, 
™gÀ1
) ||

70 
	`löeInVec
(
t›Le·
, 
bŸLe·
, 
vec1
, 
™gÀ1
) ||

71 
	`löeInVec
(
bŸLe·
, 
bŸRight
, 
vec1
, 
™gÀ1
) ||

72 
	`löeInVec
(
t›Right
, 
bŸRight
, 
vec1
, 
™gÀ1
));

73 
	}
}

75 
	gglm
::
vec4
 
	$vecI¡î£˘Regi⁄
(c⁄° 
glm
::
vec4
& 
vec1
, c⁄° glm::vec4& 
vec2
)

77 
glm
::
vec4
 
™swî
= {0,0,0,0};

79 i‡(
vec1
.
y
 + vec1.
a
 >
vec2
.y && vec1.y <= vec2.y + vec2.a)

81 
™swî
.
y
 = 
°d
::
	`max
(
vec1
.y, 
vec2
.y);

82 
™swî
.
a
 = 
°d
::
	`mö
(
vec2
.
y
 + vec2.a, 
vec1
.y + vec1.a) -ánswer.y;

84 i‡(
vec1
.
x
 + vec1.
z
 >
vec2
.x && vec1.x <= vec2.x + vec2.z)

86 
™swî
.
x
 = 
°d
::
	`max
(
vec1
.x, 
vec2
.x);

87 
™swî
.
z
 = 
°d
::
	`mö
(
vec2
.
x
 + vec2.z, 
vec1
.x + vec1.z) -ánswer.x;

89  
™swî
;

90 
	}
}

92 
boﬁ
 
	$vecInside
(c⁄° 
glm
::
vec4
& 
vec1
, c⁄° glm::vec4& 
vec2
)

94 
glm
::
vec4
 
ªgi⁄
 = 
	`vecI¡î£˘Regi⁄
(
vec1
,
vec2
);

95  
ªgi⁄
.
z
 > 0 &&Ñegi⁄.
a
 > 0;

96 
	}
}

98 
	$vecDi°™˚
(c⁄° 
glm
::
vec4
& 
ª˘1
, c⁄° glm::vec4& 
ª˘2
)

100 
glm
::
vec2
 
comp
 = {0,0};

101 
glm
::
vec4
 
ªgi⁄
 = 
	`vecI¡î£˘Regi⁄
(
ª˘1
,
ª˘2
);

102 i‡(
ªgi⁄
.
z
 == 0)

104 
right
 = 
°d
::
	`mö
(
ª˘1
.
x
 +Ñe˘1.
z
, 
ª˘2
.x +Ñect2.z);

105 
À·
 = 
°d
::
	`max
(
ª˘1
.
x
, 
ª˘2
.x);

106 
comp
.
x
 = 
°d
::
	`max
(
right
,
À·
Ë- std::
	`mö
(right,left);

108 i‡(
ªgi⁄
.
a
 == 0)

110 
down
 = 
°d
::
	`mö
(
ª˘1
.
y
 +Ñe˘1.
a
, 
ª˘2
.y +Ñect2.a);

111 
up
 = 
°d
::
	`max
(
ª˘1
.
y
, 
ª˘2
.y);

112 
comp
.
y
 = 
°d
::
	`max
(
up
,
down
Ë- std::
	`mö
(up,down);

114  
	`sqπ
(
	`pow
(
comp
.
x
,2Ë+Öow(comp.
y
,2));

115 
	}
}

117 
boﬁ
 
	$vecC⁄èös
(
glm
::
vec4
 
r1
, glm::vec4 
r2
)

119  (
r1
.
x
 >
r2
.x &&Ñ1.x +Ñ1.
z
 <r2.x +Ñ2.z &&Ñ1.
y
 >r2.y &&Ñ1.y +Ñ1.
a
 <=Ñ2.y +Ñ2.a);

120 
	}
}

122 
boﬁ
 
	$poötInVec
(c⁄° 
glm
::
vec4
& 
vec1
, 
x
, 
y
, 
™gÀ
)

124 
glm
::
vec2
 
˚¡î
 = {
vec1
.
x
 + vec1.
z
/2, vec1.
y
+vec1.
a
/2};

125 
glm
::
vec2
 
rŸ©ed
 = 
	`rŸ©ePoöt
({
x
,
y
},
˚¡î
,-
™gÀ
);

126  
rŸ©ed
.
x
 >
vec1
.x &&ÑŸ©ed.x <vec1.x + vec1.
z
 &&ÑŸ©ed.
y
 >vec1.y &&ÑŸ©ed.y <vec1.y +vec1.
a
;

127 
	}
}

129 
boﬁ
 
	$poötInVec
(c⁄° 
glm
::
vec4
& 
vec1
, c⁄° glm::
vec2
& 
poöt
, 
™gÀ
)

131  
	`poötInVec
(
vec1
,
poöt
.
x
,poöt.
y
,
™gÀ
);

132 
	}
}

134 
	$poötVecDi°™˚
(c⁄° 
glm
::
vec4
& 
vec
, 
x
, 
y
)

136  
	`sqπ
(
	`pow
(
°d
::
	`mö
(
vec
.
x
 + vec.
z
,°d::
	`max
(vec.x, x)Ë- x,2Ë+Öow(°d::mö(vec.
y
 + vec.
a
,std::max(vec.y, y)) - y,2));

137 
	}
}

139 
	gglm
::
vec2
 
	$˛o£°PoötOnVec
(c⁄° 
glm
::
vec4
& 
vec
, c⁄° glm::
vec2
& 
poöt
)

141  {
°d
::
	`mö
(
vec
.
x
 + vec.
z
,°d::
	`max
(vec.x, 
poöt
.x)),°d::mö(vec.
y
 + vec.
a
,std::max(vec.y,Öoint.y))};

142 
	}
}

145 
boﬁ
 
	$öLöe
(c⁄° 
glm
::
vec2
& 
poöt
, c⁄° glm::vec2& 
poöt1
, c⁄° glm::vec2& 
poöt2
)

147 i‡(
poöt1
.
x
 =
poöt2
.x)

149  
poöt1
.
x
 =
poöt
.x &&Öoöt.
y
 >
°d
::
	`mö
’oöt1.y,
poöt2
.yË&&Öoöt.y <°d::
	`max
(point1.y,point2.y);

151 
¶›e
 = (
poöt2
.
y
 - 
poöt1
.y)/’oöt2.
x
 -Öoint1.x);

152 
yI¡
 = 
poöt1
.
y
 - 
¶›e
*poöt1.
x
;

153  
¶›e
*
poöt
.
x
 + 
yI¡
 =poöt.
y
 &&Öoöt.x >
°d
::
	`mö
(
poöt1
.x,
poöt2
.xË&&Öoöt.x <°d::
	`max
(point1.x,point2.x);

154 
	}
}

156 
	$poötLöeDi°™˚
(c⁄° 
glm
::
vec4
& 
löe
, c⁄° glm::
vec2
& 
poöt
)

158 
glm
::
vec2
 
a
 = {
löe
.
x
,löe.
y
};

159 
glm
::
vec2
 
b
 = {
löe
.
z
,löe.
a
};

160 
abDi°
 = (
	`poötDi°™˚
(
a
,
b
));

161 
bpDi°
 = (
	`poötDi°™˚
(
b
,
poöt
));

162 
≠Di°
 = 
	`poötDi°™˚
(
a
,
poöt
);

163 
bAngÀ
 = 
	`acos
((
	`pow
(
≠Di°
,2Ë- (Öow(
abDi°
,2)+pow(
bpDi°
,2) ))/(-2*abDist*bpDist));

164 
aAngÀ
 = 
	`acos
((
	`pow
(
bpDi°
,2Ë- (Öow(
abDi°
,2)+pow(
≠Di°
,2) ))/(-2*abDist*apDist));

165 i‡(
aAngÀ
 > 
M_PI
/2 || 
bAngÀ
 > M_PI/2)

167  
°d
::
	`mö
(
bpDi°
,
≠Di°
);

169  
	`sö
(
bAngÀ
)*
bpDi°
;

171 
	}
}

173 
boﬁ
 
	$löeInLöe
(c⁄° 
glm
::
vec2
& 
a1
, c⁄° glm::vec2& 
a2
, c⁄° glm::vec2& 
b1
, c⁄° glm::vec2& 
b2
)

175 
glm
::
vec2
 
öãr£˘
 = {0,0};

176 
glm
::
vec2
 
n⁄Vît
 = {0,0};

177 i‡(
a1
.
x
 - 
a2
.x =0 && 
b1
.x - 
b2
.x == 0)

179 
highe°
 = 
°d
::
	`mö
(
a1
.
y
,
a2
.y);

180  
a1
.
x
 =
b1
.x && 
	`abs
(
highe°
 - 
°d
::
	`mö
(b1.
y
,
b2
.y)Ë>abs((highe° - (a1.y + 
a2
.y - highest)));

184 
¶›e1
 = 0;

185 
yI¡1
 = 0;

186 i‡(
a1
.
x
 - 
a2
.x != 0)

188 
¶›e1
 = (
a1
.
y
 - 
a2
.y)/◊1.
x
-a2.x);

189 
yI¡1
 = 
a1
.
y
 - 
¶›e1
*a1.
x
;

190 
n⁄Vît
.
x
 = 
¶›e1
;

191 
n⁄Vît
.
y
 = 
yI¡1
;

195 
öãr£˘
.
x
 = 
a1
.x;

197 
¶›e2
 = 0;

198 
yI¡2
 = 0;

199 i‡(
b1
.
x
 - 
b2
.x != 0)

201 
¶›e2
 = (
b1
.
y
 - 
b2
.y)/(b1.
x
 - b2.x);

202 
yI¡2
 = 
b1
.
y
 - 
¶›e2
*b1.
x
;

203 
n⁄Vît
.
x
 = 
¶›e2
;

204 
n⁄Vît
.
y
 = 
yI¡2
;

208 
öãr£˘
.
x
 = 
b1
.x;

210 i‡(
b1
.
x
 !
b2
.x && 
a1
.x !
a2
.x)

212 i‡(
¶›e1
 =
¶›e2
)

214 i‡(
yI¡1
 =
yI¡2
)

216 
À·
 = 
°d
::
	`mö
(
a1
.
x
, 
a2
.x);

217 
right
 = 
°d
::
	`max
(
a1
.
x
, 
a2
.x);

218  (
b1
.
x
 <
right
 && b1.x >
À·
Ë|| (
b2
.x <=Ñight && b2.x >=Üeft);

220  
Ál£
;

222 
öãr£˘
.
x
 = (
yI¡1
 - 
yI¡2
)/(
¶›e2
 - 
¶›e1
);

225 
öãr£˘
.
y
 = 
n⁄Vît
.
x
*intersect.x +ÇonVert.y;

226 
roundög
 = 0.03;

227 
boﬁ
 
vÆ
 = 
öãr£˘
.
x
 >
°d
::
	`mö
(
a1
.x, 
a2
.xË- 
roundög
 && i¡î£˘.x <°d::
	`max
(a1.x,á2.x) +Ñounding &&

228 
öãr£˘
.
x
 >
°d
::
	`mö
(
b1
.x, 
b2
.xË- 
roundög
 && i¡î£˘.x <°d::
	`max
(b1.x,b2.x) +Ñounding &&

229 
öãr£˘
.
y
 >
°d
::
	`mö
(
a1
.y, 
a2
.yË- 
roundög
 && i¡î£˘.y <°d::
	`max
(a1.y,á2.y) +Ñounding &&

230 
öãr£˘
.
y
 >
°d
::
	`mö
(
b1
.y, 
b2
.yË- 
roundög
 && i¡î£˘.y <°d::
	`max
(b1.y, b2.y) +Ñounding;

231  
vÆ
;

232 
	}
}

234 
boﬁ
 
	$löeInLöeExãnd
(c⁄° 
glm
::
vec2
& 
a1
, c⁄° glm::vec2& 
a2
, c⁄° glm::vec2& 
b1
, c⁄° glm::vec2& 
b2
)

236 i‡(
a1
.
x
 =
a2
.x && 
b1
.x ==
b2
.x)

238  
b1
.
x
 =
a1
.x;

240 
¶›e1
 = (
a1
.
y
 - 
a2
.y)/◊1.
x
 -á2.x);

241 
¶›e2
 = (
b1
.
y
 - 
b2
.y)/(b1.
x
 - b2.x);

242 i‡(
¶›e1
 =
¶›e2
)

244  (
a1
.
y
 - 
¶›e1
*a1.
x
Ë=(
a2
.y - slope1*a2.x);

246  
åue
;

247 
	}
}

249 
	gglm
::
vec2
 
	$löeLöeI¡î£˘
(c⁄° 
glm
::
vec2
& 
a1
, c⁄° glm::vec2& 
a2
, c⁄° glm::vec2& 
b1
, c⁄° glm::vec2& 
b2
)

251 
glm
::
vec2
 
öãr£˘
 = {0,0};

253 i‡(
	`löeInLöe
(
a1
,
a2
,
b1
,
b2
))

255 i‡(
a1
.
x
 =
a2
.x && 
b1
.x =
b2
.x)

257 
öãr£˘
 = 
a1
;

261 
¶›e1
 = 0;

262 i‡(
b1
.
x
 =
b2
.x)

264 
¶›e1
 = (
a1
.
y
 - 
a2
.y)/◊1.
x
 -á2.x);

265 
öãr£˘
.
x
 = 
b1
.x;

266 
öãr£˘
.
y
 = 
¶›e1
*
b1
.
x
 + 
a1
.y - slope1*a1.x;

268 i‡(
a1
.
x
 =
a2
.x)

270 
¶›e1
 = (
b1
.
y
 - 
b2
.y)/(b1.
x
 - b2.x);

271 
öãr£˘
.
x
 = 
a1
.x;

272 
öãr£˘
.
y
 = 
¶›e1
*
a1
.
x
 + 
b1
.y - slope1*b1.x;

276 
¶›e1
 = (
a1
.
y
 - 
a2
.y)/◊1.
x
 -á2.x);

277 
¶›e2
 = (
b1
.
y
 - 
b2
.y)/(b1.
x
 - b2.x);

278 
yI¡1
 = 
a1
.
y
 - 
¶›e1
*a1.
x
;

279 
yI¡2
 = 
b1
.
y
 - 
¶›e2
*b1.
x
;

280 
öãr£˘
.
x
 = (
yI¡1
 - 
yI¡2
)/(
¶›e2
 - 
¶›e1
);

281 
öãr£˘
.
y
 = i¡î£˘.
x
*
¶›e1
 + 
yI¡1
;

285  
öãr£˘
;

286 
	}
}

288 
	gglm
::
vec2
 
	$löeLöeI¡î£˘Exãnd
(c⁄° 
glm
::
vec2
& 
a1
, c⁄° glm::vec2& 
a2
, c⁄° glm::vec2& 
b1
, c⁄° glm::vec2& 
b2
)

290 i‡(
a1
.
x
 =
a2
.x && 
b1
.x =
b2
.x)

292 i‡(
a1
.
x
 !
b1
.x)

298  
a1
;

303 i‡(
a1
.
x
 =
a2
.x)

305 
¶›e
 = (
b1
.
y
 - 
b2
.y)/(b1.
x
 - b2.x);

306  {
a1
.
x
,
b1
.
y
 + 
¶›e
*(a1.x - b1.x)};

308 i‡(
b1
.
x
 =
b2
.x)

310 
¶›e
 = (
a1
.
y
 - 
a2
.y)/◊1.
x
 -á2.x);

311  {
b1
.
x
,
a1
.
y
 + 
¶›e
*(b1.x -á1.x)};

315 
¶›e1
 = (
a1
.
y
 - 
a2
.y)/◊1.
x
 -á2.x);

316 
¶›e2
 = (
b1
.
y
 - 
b2
.y)/(b1.
x
 - b2.x);

318 i‡(
¶›e1
 =
¶›e2
)

323 
yI¡1
 = 
a1
.
y
 - 
¶›e1
*a1.
x
;

324 
yI¡2
 = 
b1
.
y
 - 
¶›e2
*b1.
x
;

326 
x
(
yI¡1
 - 
yI¡2
)/(
¶›e2
 - 
¶›e1
);

327  {
x
, 
¶›e2
*x + 
yI¡2
};

330 
	}
}

332 
boﬁ
 
	$löeInVec
(c⁄° 
glm
::
vec2
& 
poöt1
,c⁄° glm::vec2& 
poöt2
, c⁄° glm::
vec4
& 
r1
, 
™gÀ
)

335 
glm
::
vec2
 
˚¡î
 = {
r1
.
x
 +Ñ1.
z
/2,Ñ1.
y
 +Ñ1.
a
/2};

337 
glm
::
vec2
 
p1
 = 
	`rŸ©ePoöt
(
poöt1
,
˚¡î
,-
™gÀ
);

338 
glm
::
vec2
 
p2
 = 
	`rŸ©ePoöt
(
poöt2
,
˚¡î
,-
™gÀ
);

340 
glm
::
vec2
 
t›Le·
 = {
r1
.
x
,Ñ1.
y
};

341 
glm
::
vec2
 
t›Right
 = {
r1
.
x
 +Ñ1.
z
,Ñ1.
y
};

342 
glm
::
vec2
 
bŸLe·
 = {
r1
.
x
,Ñ1.
y
 +Ñ1.
a
};

343 
glm
::
vec2
 
bŸRight
 = {
r1
.
x
 +Ñ1.
z
,Ñ1.
y
 +Ñ1.
a
};

345  
	`löeInLöe
(
t›Le·
,
t›Right
,
p1
,
p2
) ||

346 
	`löeInLöe
(
t›Le·
,
bŸLe·
,
p1
,
p2
) ||

347 
	`löeInLöe
(
t›Right
,
bŸRight
,
p1
,
p2
) ||

348 
	`löeInLöe
(
bŸLe·
,
bŸRight
,
p1
,
p2
) ||

349 
	`poötInVec
(
r1
,
p1
,0);

350 
	}
}

352 
boﬁ
 
	$poötInTrüngÀ
 (c⁄° 
glm
::
vec2
 
a
, c⁄° glm::vec2& 
b
, c⁄° glm::vec2& 
c
, c⁄° glm::vec2& 
p
)

354 
díomö©‹
 = ((
b
.
y
 - 
c
.y)*(
a
.
x
 - c.x) + (c.x - b.x)*(a.y - c.y));

355 
num1
 = ((
b
.
y
 - 
c
.y)*(
p
.
x
 - c.xË+ (c.x - b.x)*’.y - c.y)Ë/ 
díomö©‹
;

356 
num2
 = ((
c
.
y
 - 
a
.y)*(
p
.
x
 - c.xË+ (a.x - c.x)*’.y - c.y)Ë/ 
díomö©‹
;

357 
num3
 = 1 - 
num1
 - 
num2
;

359  (0 <
num1
 &&Çum1 <1 && 0 <
num2
 &&Çum2 <1 && 0 <
num3
 &&Çum3 <= 1) ||

360 (
	`öLöe
(
p
,
a
,
b
Ë|| inLöe’,b,
c
) || inLine(p,a,c));

361 
	}
}

363 
	gglm
::
vec4
 
	$absﬁuãVÆueRe˘
(c⁄° 
glm
::
vec4
& 
ª˘
)

365 
glm
::
vec4
 
fixed
 = 
ª˘
;

366 i‡(
ª˘
.
z
 < 0 &&Ñe˘.
x
 >Ñect.x +Ñect.z)

368 
fixed
.
x
 = 
ª˘
.x +Ñe˘.
z
;

369 
fixed
.
z
 = 
	`abs
(
ª˘
.z);

371 i‡(
ª˘
.
a
 < 0 &&Ñe˘.
y
 >Ñect.y +Ñect.a)

373 
fixed
.
y
 = 
ª˘
.y +Ñe˘.
a
;

374 
fixed
.
a
 = -1*
ª˘
.a;

376  
fixed
;

377 
	}
}

379 
	gglm
::
vec2
 
∑útoVec
(c⁄° 
°d
::
∑ú
<,>& 
≥¨
)

381  {
	g≥¨
.
	gfú°
,Öór.
	g£c⁄d
};

384 
	gglm
::
vec2
 
	$rŸ©ePoöt
(c⁄° 
glm
::
vec2
& 
p
, c⁄° glm::vec2& 
rŸ©eAround
, 
™gÀ
)

386 
glm
::
vec2
 
poöt
 = {
p
.
x
 - 
rŸ©eAround
.x,p.
y
-rotateAround.y};

387  {
poöt
.
x
*
	`cos
(
™gÀ
)-poöt.
y
*
	`sö
◊ngÀ)+
rŸ©eAround
.x,Öoint.x*sin(angle) +Öoint.y*cos(angle)+rotateAround.y};

388 
	}
}

390 
	gglm
::
vec4
 
	$moveRe˘
(c⁄° 
glm
::
vec4
& 
ª˘
, c⁄° glm::vec4& 
wÆl
, c⁄° glm::
vec2
& 
move
, 
rŸ©i⁄
, 
wÆlRŸ©i⁄
)

392 
glm
::
vec4
 
föÆRe˘
 = 
ª˘
 + glm::
	`vec4
(
move
.
x
,move.
y
,0,0);

393 
glm
::
vec4
 
vîtRe˘
 = {
ª˘
.
x
,Ñe˘.
y
 + 
move
.y,Ñe˘.
z
,Ñe˘.
a
};

394 i‡(
	`vecI¡î£˘
(
vîtRe˘
, 
wÆl
,
rŸ©i⁄
,
wÆlRŸ©i⁄
))

396 i‡(
ª˘
.
y
 +Ñe˘.
a
 < 
wÆl
.y)

398 
föÆRe˘
.
y
 = 
wÆl
.y - 
ª˘
.
a
 - 1;

402 
föÆRe˘
.
y
 = 
wÆl
.y + wÆl.
a
+ 1;

405 
glm
::
vec4
 
h‹izRe˘
 = {
ª˘
.
x
 + 
move
.x,Ñe˘.
y
,Ñe˘.
z
,ª˘.
a
};

406 i‡(
	`vecI¡î£˘
(
h‹izRe˘
,
wÆl
,
rŸ©i⁄
,
wÆlRŸ©i⁄
))

408 i‡(
ª˘
.
x
 +Ñe˘.
z
 < 
wÆl
.x)

410 
föÆRe˘
.
x
 = 
wÆl
.x - 
ª˘
.
z
 - 1;

414 
föÆRe˘
.
x
 = 
wÆl
.x + wÆl.
z
 + 1;

417  
föÆRe˘
;

418 
	}
}

	@C:\Users\leoou\OneDrive\Desktop\resources\geometry.h

1 #i‚de‡
GEOMETRY_H_INCLUDED


2 
	#GEOMETRY_H_INCLUDED


	)

4 
	~<ve˘‹
>

5 
	~<m≠
>

6 
	~"gÀw.h
"

8 
	~"glm.hµ
"

9 
	~"gtc/m©rix_å™sf‹m.hµ
"

10 
	~"gtc/ty≥_±r.hµ
"

13 
¥ötRe˘
(c⁄° 
glm
::
vec4
& 
ª˘
);

14 
lﬂdShadîs
(c⁄° 
GLch¨
* 
sour˚
, 
GLíum
 
shadîTy≥
 );

15 
poötDi°™˚
(c⁄° 
glm
::
vec2
& 
v1
, c⁄° glm::vec2& 
v2
);

16 
	gglm
::
vec2
 
födMidpoöt
(c⁄° 
glm
::
vec4
& 
v1
);

17 
boﬁ
 
vecI¡î£˘
(c⁄° 
glm
::
vec4
& 
vec1
,c⁄° glm::vec4& 
vec2
);

18 
boﬁ
 
vecI¡î£˘
(c⁄° 
glm
::
vec4
& 
vec1
,c⁄° glm::vec4& 
vec2
, 
™gÀ1
, 
™gÀ2
);

19 
	gglm
::
vec4
 
vecI¡î£˘Regi⁄
(c⁄° 
glm
::vec4& 
vec1
, c⁄° glm::vec4& 
vec2
);

20 
boﬁ
 
vecInside
(c⁄° 
glm
::
vec4
& 
vec1
, c⁄° glm::vec4& 
vec2
);

21 
vecDi°™˚
(c⁄° 
glm
::
vec4
& 
vec1
, c⁄° glm::vec4& 
vec2
);

22 
boﬁ
 
vecC⁄èös
(
glm
::
vec4
 
smÆÀrRe˘
, glm::vec4 
biggîRe˘
);

23 
boﬁ
 
poötInVec
(c⁄° 
glm
::
vec4
& 
vec1
, 
x
, 
y
, 
™gÀ
 = 0);

24 
boﬁ
 
poötInVec
(c⁄° 
glm
::
vec4
& 
vec1
, c⁄° glm::
vec2
& 
poöt
, 
™gÀ
 = 0);

25 
poötVecDi°™˚
(c⁄° 
glm
::
vec4
& 
vec
, 
x
, 
y
);

26 
	gglm
::
vec2
 
˛o£°PoötOnVec
(c⁄° 
glm
::
vec4
& 
vec
, c⁄° glm::vec2& 
poöt
);

27 
poötLöeDi°™˚
(c⁄° 
glm
::
vec4
& 
löe
, c⁄° glm::
vec2
& 
poöt
);

28 
boﬁ
 
löeInLöe
(c⁄° 
glm
::
vec2
& 
a1
, c⁄° glm::vec2& 
a2
, c⁄° glm::vec2& 
b1
, c⁄° glm::vec2& 
b2
);

29 
boﬁ
 
löeInLöe
(c⁄° 
glm
::
vec4
& 
l1
, c⁄° glm::vec4& 
l2
);

30 
boﬁ
 
löeInLöeExãnd
(c⁄° 
glm
::
vec2
& 
a1
, c⁄° glm::vec2& 
a2
, c⁄° glm::vec2& 
b1
, c⁄° glm::vec2& 
b2
);

31 
	gglm
::
vec2
 
löeLöeI¡î£˘
(c⁄° 
glm
::vec2& 
a1
, c⁄° glm::vec2& 
a2
, c⁄° glm::vec2& 
b1
, c⁄° glm::vec2& 
b2
);

32 
	gglm
::
vec2
 
löeLöeI¡î£˘Exãnd
(c⁄° 
glm
::vec2& 
a1
, c⁄° glm::vec2& 
a2
, c⁄° glm::vec2& 
b1
, c⁄° glm::vec2& 
b2
);

33 
boﬁ
 
löeInVec
(c⁄° 
glm
::
vec2
& 
p1
, c⁄° glm::vec2& 
p2
, c⁄° glm::
vec4
& 
r1
, 
™gÀ
 = 0);

34 
boﬁ
 
poötInTrüngÀ
 (c⁄° 
glm
::
vec2
 
a
, c⁄° glm::vec2& 
b
, c⁄° glm::vec2& 
c
, c⁄° glm::vec2& 
p
);

35 
	gglm
::
vec4
 
absﬁuãVÆueRe˘
(c⁄° 
glm
::vec4& 
ª˘
);

36 
	gglm
::
vec2
 
∑útoVec
(c⁄° 
°d
::
∑ú
<,>& 
≥¨
);

37 
	gglm
::
vec2
 
rŸ©ePoöt
(c⁄° 
glm
::vec2& 
p
, c⁄° glm::vec2& 
rŸ©eAround
, 
™gÀ
);

38 
	gglm
::
vec4
 
moveRe˘
(c⁄° 
glm
::vec4& 
ª˘
, c⁄° glm::vec4& 
wÆl
, c⁄° glm::
vec2
& 
move
, 
rŸ©i⁄
 = 0, 
wÆlRŸ©i⁄
 = 0);

	@C:\Users\leoou\OneDrive\Desktop\resources\glGame.cpp

1 
	~"SDL.h
"

3 
	~"glGame.h
"

4 
	~"ªndî.h
"

6 
boﬁ
 
	$ª˘P©hI¡î£˘
(c⁄° 
glm
::
vec4
& 
ﬁdRe˘
, c⁄° glm::vec4& 
√wRe˘
, c⁄° glm::vec4& 
cﬁlide
)

8  
	`vecI¡î£˘
(
√wRe˘
,
cﬁlide
) ||

9 
	`löeInVec
({
ﬁdRe˘
.
x
 + oldRe˘.
z
,ﬁdRe˘.
y
},{
√wRe˘
.x +ÇewRe˘.z,ÇewRe˘.y},
cﬁlide
) ||

10 
	`löeInVec
({
√wRe˘
.
x
 +ÇewRe˘.
z
,√wRe˘.
y
},{
ﬁdRe˘
.x, oldRe˘.y + oldRe˘.
a
},
cﬁlide
)||

11 
	`löeInVec
({
ﬁdRe˘
.
x
,ﬁdRe˘.
y
},{
√wRe˘
.x,ÇewRe˘.y}, 
cﬁlide
) ||

12 
	`löeInVec
({
ﬁdRe˘
.
x
 + oldRe˘.
z
, oldRe˘.
y
 + oldRe˘.
a
},{
√wRe˘
.x +ÇewRe˘.z,ÇewRe˘.y +ÇewRe˘.a},
cﬁlide
);

13 
	}
}

15 
	gPosôi⁄Æ
::
	$Posôi⁄Æ
(c⁄° 
glm
::
vec2
& 
poöt
Ë: 
	$pos
(
poöt
)

18 
	}
}

20 
boﬁ
 
Posôi⁄Æ
::
	$cﬁlides
(c⁄° 
glm
::
vec4
& 
box
)

22  
	`poötInVec
(
box
,
pos
.
x
,pos.
y
,0);

23 
	}
}

25 
boﬁ
 
	gPosôi⁄Æ
::
	$cﬁlidesLöe
(c⁄° 
glm
::
vec4
& 
löe
)

27  
	`poötLöeDi°™˚
(
löe
,
pos
)==0;

28 
	}
}

30 
	gglm
::
vec4
 
Posôi⁄Æ
::
	$gëBoundögRe˘
() const

32  {
pos
.
x
,pos.
y
,0,0};

33 
	}
}

35 
	gglm
::
vec2
 
Posôi⁄Æ
::
	$gëPos
() const

37  
pos
;

38 
	}
}

40 
	gRe˘Posôi⁄Æ
::
	$Re˘Posôi⁄Æ
(c⁄° 
glm
::
vec4
& 
box
, 
√wTût
Ë: 
	`Posôi⁄Æ
({box.
x
,box.
y
}),Ñe˘(box)

42 
	`£tTût
(
√wTût
);

43 
	}
}

45 
	gglm
::
vec4
 
Re˘Posôi⁄Æ
::
	$gëBoundögRe˘
() const

47  
ª˘
;

48 
	}
}

50 
	gglm
::
vec2
 
Re˘Posôi⁄Æ
::
	$gëPos
() const

52  {
ª˘
.
x
,ª˘.
y
};

53 
	}
}

55 c⁄° 
	gglm
::
vec4
& 
Re˘Posôi⁄Æ
::
	$gëRe˘
() const

57  
ª˘
;

58 
	}
}

60 
	gRe˘Posôi⁄Æ
::
	$gëTût
() const

62  
tût
;

63 
	}
}

65 
	gRe˘Posôi⁄Æ
::
	$£tTût
(
√wTût
)

67 
tût
 = 
	`fmod
(
√wTût
,2*
M_PI
) + 2*M_PI*(newTilt < 0);

68 i‡(
tût
 >
M_PI
)

70 
tût
 -2*
M_PI
;

72 
	}
}

74 
boﬁ
 
	gRe˘Posôi⁄Æ
::
	$cﬁlidesLöe
(c⁄° 
glm
::
vec4
& 
löe
)

76  
	`löeInVec
({
löe
.
x
,löe.
y
},{löe.
z
,löe.
a
},
ª˘
,
tût
);

77 
	}
}

79 
boﬁ
 
	gRe˘Posôi⁄Æ
::
	$cﬁlides
(c⁄° 
glm
::
vec4
& 
box
)

81  
	`vecI¡î£˘
(
box
,
ª˘
,
tût
,0);

82 
	}
}

84 
	gglm
::
vec2
 
Re˘Posôi⁄Æ
::
	$gëCíãr
() const

86  {
ª˘
.
x
 +Ñe˘.
z
/2,Ñe˘.
y
 +Ñe˘.
a
/2};

87 
	}
}

89 
	gRe˘PosCamîa
::
öô
(c⁄° 
°d
::
sh¨ed_±r
<
Re˘Posôi⁄Æ
>& 
fﬁlowì_
, 
w
, 
h
)

91 
	gRídîCamîa
::
öô
(
w
,
h
);

92 
£tFﬁlowì
(
fﬁlowì_
);

95 
	gRe˘PosCamîa
::
£tFﬁlowì
(c⁄° 
°d
::
sh¨ed_±r
<
Re˘Posôi⁄Æ
>& 
fﬁlowì_
)

97 
fﬁlowì
 = 
fﬁlowì_
;

100 
	gRe˘PosCamîa
::
	$upd©e
()

102 i‡(
fﬁlowì
.
	`lock
().
	`gë
())

104 
	`ª˚¡î
(
fﬁlowì
.
	`lock
().
	`gë
()->
	`gëCíãr
());

106 
	}
}

108 
	gQuadTªe
::
	$QuadTªe
(c⁄° 
glm
::
vec4
& 
ª˘
)

110 
ªgi⁄
 = 
ª˘
;

111  
i
 = 0; i < 4; i ++)

113 
nodes
[
i
] = 
nuŒ±r
;

115 
	}
}

117 
	gQuadTªe
::
	$˛ór
()

119 i‡(
nodes
[0])

121 
i
 = 0; i < 4; i ++)

123 
dñëe
 
nodes
[
i
];

124 
nodes
[
i
] = 
nuŒ±r
;

128 
vec
.
	`˛ór
();

129 
	}
}

131 
	gQuadTªe
::~
	$QuadTªe
()

133 
	`˛ór
();

134 
	}
}

136 
	gQuadTªe
::
	$ªndî
(c⁄° 
glm
::
vec2
& 
di•œ˚mít
)

139 i‡(
nodes
[0])

141 
PﬁyRídî
::
	`ªque°Löe
({
ªgi⁄
.
x
-
di•œ˚mít
.x,ªgi⁄.
y
 +Ñegi⁄.
a
/2-di•œ˚mít.y,ªgi⁄.x +Ñegi⁄.
z
-displacement.x,Ñegion.y +Ñegion.a/2-displacement.y},{0,0,0,1});

142 
PﬁyRídî
::
	`ªque°Löe
({
ªgi⁄
.
x
 +Ñegi⁄.
z
/2-
di•œ˚mít
.x,Ñegi⁄.
y
-di•œ˚mít.y,Ñegi⁄.x+ªgi⁄.z/2-di•œ˚mít.x,Ñegi⁄.y +Ñegi⁄.
a
-displacement.y},{0,0,0,1} );

143 
i
 = 0; i < 4; i ++)

145 
nodes
[
i
]->
	`ªndî
(
di•œ˚mít
);

148 
	}
}

150 
	gQuadTªe
::
	$ªndî
(
RídîCamîa
& 
ˇmîa
)

152 i‡(
nodes
[0])

154 
i
 = 0; i < 4; i ++)

156 
nodes
[
i
]->
	`ªndî
(
ˇmîa
);

161 
PﬁyRídî
::
	`ªque°Re˘
(
ˇmîa
.
	`toS¸ìn
(
ªgi⁄
),{0,0,0,1},
Ál£
,0,1);

163 
	}
}

166 
	gQuadTªe
::
	$add
(
PosWøµî
& 
obj
)

168 i‡(
nodes
[0])

170 
QuadTªe
* 
found
 = 
	`föd
(*(
obj
.
	`gë
()));

171 i‡(
found
 =
this
)

173 
vec
.
	`em∂a˚_back
(&
obj
);

177 i‡(
found
)

179 
found
->
	`add
(
obj
);

183 
throw
 
°d
::
	`logic_îr‹
("QuadTree::add: Couldn'táddÅhe objánywhere!");

190 
vec
.
	`em∂a˚_back
(&
obj
);

192 i‡(
vec
.
	`size
(Ë> 
maxC≠acôy
)

195 
	`•lô
();

196 
i
 = 
vec
.
	`size
()-1; i >= 0; i --)

198 
Posôi⁄Æ
* 
±r
 = 
vec
[
i
]->
	`gë
();

199 
QuadTªe
* 
found
 = 
	`föd
(*
±r
);

201 i‡(
found
 && found !
this
)

203 
	`move
(*
this
,*
found
,*
±r
);

209 
	}
}

211 
	g°d
::
sh¨ed_±r
<
Posôi⁄Æ
>& 
QuadTªe
::
	$add
(
Posôi⁄Æ
& 
pos
)

213 
Sh¨edWøµî
* 
±r
=
√w
 
	`Sh¨edWøµî
(&
pos
);

214 
	`add
(*(
±r
));

215  
±r
->ptr;

216 
	}
}

218 
	gQuadTªe
::
	$gëNóª°Hñ≥r
(
posôi⁄ÆVec
& 
vec
, 
Posôi⁄Æ
& 
obj
)

220 i‡(
obj
.
	`cﬁlides
(
ªgi⁄
))

222 
size
 = 
this
->
vec
.
	`size
();

223 
i
 = 0; i < 
size
;i ++)

225 
vec
.
	`push_back
(
this
->vec[
i
]->
	`gë
());

227 i‡(
nodes
[0])

229 
i
 = 0; i < 4; i ++)

231 
nodes
[
i
]->
	`gëNóª°Hñ≥r
(
vec
, 
obj
);

235 
	}
}

237 
posôi⁄ÆVec
 
	gQuadTªe
::
	$gëNóª°
(
Posôi⁄Æ
& 
obj
)

239 
posôi⁄ÆVec
 
vec
;

240 
	`gëNóª°Hñ≥r
(
vec
,
obj
);

241  
vec
;

242 
	}
}

244 
	gQuadTªe
::
	$gëNóª°Hñ≥r
(
posôi⁄ÆVec
& 
vec
, c⁄° 
glm
::
vec4
& 
¨ó
)

246 i‡(
	`vecI¡î£˘
(
¨ó
,
ªgi⁄
))

248 
size
 = 
this
->
vec
.
	`size
();

250 
i
 = 0; i < 
size
;i ++)

252 
Posôi⁄Æ
* 
±r
 = 
this
->
vec
[
i
]->
	`gë
();

253 i‡(
±r
->
	`cﬁlides
(
¨ó
))

255 
vec
.
	`push_back
(
±r
);

258 i‡(
nodes
[0])

260 
i
 = 0; i < 4; i ++)

262 
nodes
[
i
]->
	`gëNóª°Hñ≥r
(
vec
, 
¨ó
);

266 
	}
}

268 
posôi⁄ÆVec
 
	gQuadTªe
::
	$gëNóª°
(c⁄° 
glm
::
vec4
& 
¨ó
)

270 
posôi⁄ÆVec
 
vec
;

271 
	`gëNóª°Hñ≥r
(
vec
,
¨ó
);

272  
vec
;

273 
	}
}

275 
	gQuadTªe
::
	$gëNóª°Hñ≥r
(
posôi⁄ÆVec
& 
vec
, c⁄° 
glm
::
vec2
& 
˚¡î
, 
ødius
)

277 i‡(
	`poötInVec
(
ªgi⁄
, 
˚¡î
.
x
, cíãr.
y
Ë|| 
	`poötVecDi°™˚
‘egi⁄,˚¡î.x,˚¡î.yË<
ødius
)

279 
size
 = 
this
->
vec
.
	`size
();

280 
i
 = 0; i < 
size
;i ++)

282 
Posôi⁄Æ
* 
±r
 = 
this
->
vec
[
i
]->
	`gë
();

283 i‡(
±r
 &&Öå->
	`di°™˚
(
˚¡î
Ë<
ødius
)

285 
vec
.
	`push_back
(
±r
);

288 i‡(
nodes
[0])

290 
i
 = 0; i < 4; i ++)

292 
nodes
[
i
]->
	`gëNóª°Hñ≥r
(
vec
, 
˚¡î
,
ødius
);

296 
	}
}

298 
posôi⁄ÆVec
 
	gQuadTªe
::
	$gëNóª°
(c⁄° 
glm
::
vec2
& 
˚¡î
, 
ødius
)

300 
posôi⁄ÆVec
 
vec
;

301 
	`gëNóª°Hñ≥r
(
vec
,
˚¡î
, 
ødius
);

302  
vec
;

303 
	}
}

305 
	gQuadTªe
::
	$•lô
()

307 
nodes
[0] = 
√w
 
	`QuadTªe
({
ªgi⁄
.
x
,ªgi⁄.
y
,ªgi⁄.
z
/2,ªgi⁄.
a
/2});

308 
nodes
[1] = 
√w
 
	`QuadTªe
({
ªgi⁄
.
x
 +Ñegi⁄.
z
/2,Ñegi⁄.
y
,Ñegi⁄.z/2,Ñegi⁄.
a
/2});

309 
nodes
[2] = 
√w
 
	`QuadTªe
({
ªgi⁄
.
x
,Ñegi⁄.
y
 +Ñegi⁄.
a
/2,Ñegi⁄.
z
/2,Ñegion.a/2});

310 
nodes
[3] = 
√w
 
	`QuadTªe
({
ªgi⁄
.
x
 +Ñegi⁄.
z
/2,Ñegi⁄.
y
 +Ñegi⁄.
a
/2,Ñegion.z/2,Ñegion.a/2});

311 
	}
}

313 
	gQuadTªe
::
	$cou¡
()

315 
™swî
 = 
	`size
();

316 i‡(
nodes
[0])

318 
i
 = 0; i < 4; i ++)

320 
™swî
 +
nodes
[
i
]->
	`cou¡
();

323  
™swî
;

324 
	}
}

326 
	gQuadTªe
::
	$size
()

328  
vec
.
	`size
();

329 
	}
}

331 
QuadTªe
* 
	gQuadTªe
::
	$föd
(
Posôi⁄Æ
& 
obj
)

333 
QuadTªe
* 
™swî
 = 
nuŒ±r
;

334 i‡(
obj
.
	`cﬁlides
(
ªgi⁄
))

336 i‡(
nodes
[0])

338 
i
 = 0; i < 4; i ++)

340 i‡(
obj
.
	`cﬁlides
(
nodes
[
i
]->
ªgi⁄
))

342 i‡(
™swî
)

344 
™swî
 = 
this
;

349 
™swî
 = 
nodes
[
i
];

353 i‡(
™swî
 !
this
)

355 
™swî
 =ánswî->
	`föd
(
obj
);

360 
™swî
 = 
this
;

363  
™swî
;

364 
	}
}

366 
boﬁ
 
	gQuadTªe
::
	$c⁄èös
(
Posôi⁄Æ
& 
posôi⁄Æ
)

368 
size
 = 
vec
.
	`size
();

369 
i
 = 0; i < 
size
; i ++)

371 i‡(
vec
[
i
]->
	`gë
(Ë=&
posôi⁄Æ
)

373  
åue
;

376  
Ál£
;

377 
	}
}

379 
	gQuadTªe
::
	$move
(
QuadTªe
& 
t1
, QuadTªe& 
t2
, 
Posôi⁄Æ
& 
obj
)

381 
size
 = 
t1
.
vec
.
	`size
();

382 
i
 = 0; i < 
size
; i ++)

384 i‡(
t1
.
vec
[
i
]->
	`gë
(Ë=&
obj
)

386 
t2
.
	`add
((*
t1
.
vec
[
i
].
	`ªÀa£
()));

387 
t1
.
vec
.
	`îa£
—1.vec.
	`begö
(Ë+ 
i
);

391 
	}
}

393 
boﬁ
 
	gQuadTªe
::
	$ªmove
(
Posôi⁄Æ
& 
obj
, 
Posôi⁄ÆCom∑ª
 
func
)

395 i‡(!
obj
.
	`cﬁlides
(
ªgi⁄
))

397  
Ál£
 ;

399 
size
 = 
vec
.
	`size
();

400 
i
 = 0; i < 
size
; i ++)

402 i‡((
func
 && 
	`func
(
obj
,*
vec
[
i
]->
	`gë
())) || vec[i]->get() == &obj)

404 
vec
.
	`îa£
(vec.
	`begö
(Ë+ 
i
);

405  
åue
;

408 i‡(
nodes
[0])

410 
i
 = 0; i < 4; i ++)

412 i‡(
nodes
[
i
]->
	`ªmove
(
obj
, 
func
))

414  
åue
;

418  
Ál£
;

419 
	}
}

421 
	gQuadTªe
::
m≠
((*
fun
)(c⁄° 
Posôi⁄Æ
& 
pos
))

423 i‡(
fun
)

425 
size
 = 
vec
.
	`size
();

426 
i
 = 0; i < 
size
; ++i)

428 
	`fun
(*(
vec
[
i
]->
	`gë
()));

430 i‡(
nodes
[0])

432 
i
 = 0; i < 4; ++i)

435 
nodes
[
i
]->
	`m≠
(
fun
);

440 
	}
}

442 
QuadTªe
* 
	gQuadTªe
::
	$upd©e
(
Posôi⁄Æ
& 
posôi⁄Æ
, 
QuadTªe
& 
ex≥˘ed
)

444 
QuadTªe
* 
√wTªe
 = 
	`föd
(
posôi⁄Æ
);

445 i‡(
√wTªe
 !
nuŒ±r
)

447 i‡(&
ex≥˘ed
 !
√wTªe
)

449 
	`move
(
ex≥˘ed
,*
√wTªe
,
posôi⁄Æ
);

454 
°d
::
˚º
 << "Posôi⁄Æ ouào‡bounds: " << 
posôi⁄Æ
.
	`gëPos
().
x
 << " " <<Öosôi⁄Æ.gëPos().
y
 << " " << 
ªgi⁄
.x << " " <<Ñegi⁄.y << " " <<Ñegi⁄.
z
 << " " <<Ñegi⁄.
a
 << "\n";

457  
√wTªe
;

459 
	}
}

461 
	gBiTªe
::
BiTªeSc‹e
 
BiTªe
::
	$ˇlcuœãSc‹e
(c⁄° 
BiTªeEÀmít
& 
ñemít
, 
BiTªeNode
& 
node
)

463  {
node
.
vîtDimí
.
x
,
ñemít
.
ª˘
.x};

464 
	}
}

466 
	gBiTªe
::
	$BiTªe
(c⁄° 
glm
::
vec4
& 
ª˘
Ë: 
	`ªgi⁄
‘e˘), 
	`hód
({{0,ª˘.
a
}
	}
})

471 
	gBiTªe
::
BiTªeSt‹age
::
ôî©‹
 
BiTªe
::
	$ö£π
(c⁄° 
BiTªeEÀmít
& 
ñemít
, 
BiTªeNode
& 
node
)

473 
BiTªeSc‹e
 
sc‹e
 = 
this
->
	`ˇlcuœãSc‹e
(
ñemít
,
node
);

474 i‡(
node
.
size
 =0 || 
sc‹e
 <Çode.
°¨t
->
fú°
)

476 
node
.
°¨t
 = (
this
->
ñemíts
.
	`ö£π
({
sc‹e
,
ñemít
}));

477 
	`upd©eNode
(
node
.
°¨t
,node);

478  
node
.
°¨t
;

482 
	`upd©eNode
(
node
.
°¨t
,node);

483  
this
->
ñemíts
.
	`ö£π
({
sc‹e
,
ñemít
});

485 
	}
}

487 
	gBiTªe
::
	$upd©eNode
(
BiTªeSt‹age
::
ôî©‹
& 
ô
, 
BiTªeNode
& 
node
)

489 i‡(
node
.
size
 =0 || 
ô
->
fú°
 <Çode.
°¨t
->first)

491 
node
.
°¨t
 = 
ô
;

494 i‡(
ô
->
£c⁄d
.
ª˘
.
a
 >
node
.
vîtDimí
.
y
/2)

496 
node
.
bigSize
++;

498 
node
.
size
++;

499 
dñè1
 = 
ô
->
£c⁄d
.
ª˘
.
y
 - 
node
.
món
;

500 
node
.
món
 +
dñè1
 /Çode.
size
;

501 
dñè2
 = 
ô
->
£c⁄d
.
ª˘
.
y
 - 
node
.
món
;

502 
node
.
M2
 +
dñè1
*
dñè2
;

503 
	}
}

505 
	gBiTªe
::
	$ö£π
(
Posôi⁄Æ
& 
wøp
)

507 i‡(
	`vecI¡î£˘
(
wøp
.
	`gëBoundögRe˘
(),
ªgi⁄
))

509 
	`¥o˚ssEÀmít
([
this
](c⁄° 
BiTªeEÀmít
& 
ñemít
, 
BiTªeNode
& 
node
){

510 
	`ö£π
(
ñemít
,
node
);

511 i‡(
node
.
size
 > 
maxNodeSize
 &&Çode.
vîtDimí
.
y
 >2 &&Çode.
bigSize
 < .5*maxNodeSize)

514 
•lô
 = 
node
.
vîtDimí
.
x
 +Çode.vîtDimí.
y
/2;

515 
node
.
nodes
[0] = 
√w
 
	`BiTªeNode
({{node.
vîtDimí
.
x
,node.vîtDimí.
y
/2},0,node.
°¨t
});

516 
node
.
nodes
[1] = 
√w
 
	`BiTªeNode
({{
•lô
,node.
vîtDimí
.
y
/2},0,
this
->
ñemíts
.
	`íd
()});

518 
cou¡
 = 0;

519 autÿ
ô

node
.
°¨t
;

520 
cou¡
 < 
node
.
size
)

522 i‡(
ô
->
£c⁄d
.
ª˘
.
y
 < 
•lô
 && it->£c⁄d.ª˘.y + it->£c⁄d.ª˘.
a
 > split)

525 
bŸHeight
 = 
ô
->
£c⁄d
.
ª˘
.
y
 + it->£c⁄d.ª˘.
a
 - 
•lô
;

526 
	`ö£π
({
ô
->
£c⁄d
.
posôi⁄Æ
,
glm
::
	`vec4
(ô->£c⁄d.
ª˘
.
x
,
•lô
,ô->£c⁄d.ª˘.
z
,
bŸHeight
)},*
node
.
nodes
[1]);

527 
ô
->
£c⁄d
.
ª˘
.
a
 -
bŸHeight
;

528 
	`upd©eNode
(
ô
,*
node
.
nodes
[0]);

529 ++
ô
;

533 i‡(
ô
->
£c⁄d
.
ª˘
.
y
 >
•lô
)

535 
	`ö£π
(
ô
->
£c⁄d
,*
node
.
nodes
[1]);

536 
ô
 = 
this
->
ñemíts
.
	`îa£
(it);

540 
	`upd©eNode
(
ô
,*
node
.
nodes
[0]);

541 ++
ô
;

545 
cou¡
 ++;

549 },
wøp
,wøp.
	`gëBoundögRe˘
());

551 
	}
}

552 
	gBiTªe
::
	$ªmove
(
Posôi⁄Æ
& 
wøp
)

554 
	`¥o˚ssEÀmít
([
this
](c⁄° 
BiTªeEÀmít
& 
ñemít
, 
BiTªeNode
& 
node
){

555 
BiTªeSc‹e
 
sc‹e
 = 
	`ˇlcuœãSc‹e
(
ñemít
,
node
);

556 autÿ
ønge
 = 
this
->
ñemíts
.
	`equÆ_ønge
(
sc‹e
);

557 autÿ
ô
 = 
ønge
.
fú°
; ià!ønge.
£c⁄d
; ++it)

559 i‡(
ô
->
£c⁄d
.
posôi⁄Æ
 =
ñemít
.positional)

561 
node
.
size
--;

562 
boﬁ
 
wasSèπ
 = (
ô
 =
node
.
°¨t
);

563 autÿ
ªt
 = 
this
->
ñemíts
.
	`îa£
(
ô
);

564 i‡(
wasSèπ
)

566 
node
.
°¨t
 = 
ªt
;

573 
°d
::
cout
 <<"failed\n";

575 },
wøp
,wøp.
	`gëBoundögRe˘
(),
hód
);

577 
	}
}

579 
	gRawQuadTªe
::
	$RawQuadTªe
(c⁄° 
glm
::
vec4
& 
ª˘
)

581 
ªgi⁄
 = 
ª˘
;

582  
i
 = 0; i < 4; i ++)

584 
nodes
[
i
] = 
nuŒ±r
;

586 
	}
}

588 
	gRawQuadTªe
::
	$˛ór
()

590 i‡(
nodes
[0])

592 
i
 = 0; i < 4; i ++)

594 
dñëe
 
nodes
[
i
];

595 
nodes
[
i
] = 
nuŒ±r
;

599 
vec
.
	`˛ór
();

600 
	}
}

602 
	gRawQuadTªe
::~
	$RawQuadTªe
()

604 
	`˛ór
();

605 
	}
}

607 
	gRawQuadTªe
::
	$ªndî
(c⁄° 
glm
::
vec2
& 
di•œ˚mít
)

610 i‡(
nodes
[0])

612 
PﬁyRídî
::
	`ªque°Löe
({
ªgi⁄
.
x
-
di•œ˚mít
.x,ªgi⁄.
y
 +Ñegi⁄.
a
/2-di•œ˚mít.y,ªgi⁄.x +Ñegi⁄.
z
-displacement.x,Ñegion.y +Ñegion.a/2-displacement.y},{0,0,0,1});

613 
PﬁyRídî
::
	`ªque°Löe
({
ªgi⁄
.
x
 +Ñegi⁄.
z
/2-
di•œ˚mít
.x,Ñegi⁄.
y
-di•œ˚mít.y,Ñegi⁄.x+ªgi⁄.z/2-di•œ˚mít.x,Ñegi⁄.y +Ñegi⁄.
a
-displacement.y},{0,0,0,1} );

614 
i
 = 0; i < 4; i ++)

617 
nodes
[
i
]->
	`ªndî
(
di•œ˚mít
);

620 
	}
}

622 c⁄° 
	gRawQuadTªe
::
maxC≠acôy
 = 100;

624 
	gRawQuadTªe
::
	$add
(
Posôi⁄Æ
& 
obj
)

626 i‡(
nodes
[0])

628 
RawQuadTªe
* 
found
 = 
	`föd
(
obj
);

629 i‡(
found
 =
this
)

631 
vec
.
	`push_back
(&
obj
);

635 i‡(
found
)

637 
found
->
	`add
(
obj
);

641 
throw
 
°d
::
	`logic_îr‹
("Couldn'táddÅhe objánywhere!");

647 
vec
.
	`push_back
(&
obj
);

648 i‡(
vec
.
	`size
(Ë> 
maxC≠acôy
)

650 
	`•lô
();

651 
i
 = 
vec
.
	`size
()-1; i >= 0; i --)

653 
Posôi⁄Æ
* 
±r
 = 
vec
[
i
];

654 
RawQuadTªe
* 
found
 = 
	`föd
(*
±r
);

656 i‡(
found
 && found !
this
)

658 
	`move
(*
this
,*
found
,*
±r
);

663 
	}
}

665 
	gRawQuadTªe
::
gëNóª°Hñ≥r
(
°d
::
ve˘‹
<
Posôi⁄Æ
*>& 
vec
, Posôi⁄Æ& 
obj
)

667 i‡(
	gobj
.
cﬁlides
(
ªgi⁄
))

669 
	gsize
 = 
this
->
vec
.
size
();

670 
	gi
 = 0; i < 
	gsize
;i ++)

672 
	gvec
.
push_back
(
this
->
vec
[
i
]);

674 i‡(
	gnodes
[0])

676 
	gi
 = 0; i < 4; i ++)

678 
	gnodes
[
i
]->
gëNóª°Hñ≥r
(
vec
, 
obj
);

684 
posôi⁄ÆVec
 
	gRawQuadTªe
::
	$gëNóª°
(
Posôi⁄Æ
& 
obj
)

686 
posôi⁄ÆVec
 
vec
;

687 
	`gëNóª°Hñ≥r
(
vec
,
obj
);

688  
vec
;

689 
	}
}

691 
	gRawQuadTªe
::
	$gëNóª°Hñ≥r
(
posôi⁄ÆVec
& 
vec
, c⁄° 
glm
::
vec4
& 
¨ó
)

693 i‡(
	`vecI¡î£˘
(
¨ó
,
ªgi⁄
))

695 
size
 = 
this
->
vec
.
	`size
();

697 
i
 = 0; i < 
size
;i ++)

699 
Posôi⁄Æ
* 
±r
 = 
this
->
vec
[
i
];

700 i‡(
±r
->
	`cﬁlides
(
¨ó
))

702 
vec
.
	`push_back
(
±r
);

705 i‡(
nodes
[0])

707 
i
 = 0; i < 4; i ++)

709 
nodes
[
i
]->
	`gëNóª°Hñ≥r
(
vec
, 
¨ó
);

713 
	}
}

715 
posôi⁄ÆVec
 
	gRawQuadTªe
::
	$gëNóª°
(c⁄° 
glm
::
vec4
& 
¨ó
)

717 
posôi⁄ÆVec
 
vec
;

718 
	`gëNóª°Hñ≥r
(
vec
,
¨ó
);

719  
vec
;

720 
	}
}

722 
	gRawQuadTªe
::
gëNóª°Hñ≥r
(
°d
::
ve˘‹
<
Posôi⁄Æ
*>& 
vec
, c⁄° 
glm
::
vec2
& 
˚¡î
, 
ødius
)

724 i‡(
poötInVec
(
ªgi⁄
, 
˚¡î
.
x
, cíãr.
y
Ë|| 
poötVecDi°™˚
‘egi⁄,˚¡î.x,˚¡î.yË<
ødius
)

726 
size
 = 
this
->
vec
.size();

727 
	gi
 = 0; i < 
	gsize
;i ++)

729 
Posôi⁄Æ
* 
	g±r
 = 
this
->
vec
[
i
];

730 i‡(
	g±r
->
di°™˚
(
˚¡î
Ë<
ødius
)

732 
vec
.
push_back
(
±r
);

735 i‡(
	gnodes
[0])

737 
	gi
 = 0; i < 4; i ++)

739 
	gnodes
[
i
]->
gëNóª°Hñ≥r
(
vec
, 
˚¡î
,
ødius
);

745 
	g°d
::
ve˘‹
<
Posôi⁄Æ
*> 
RawQuadTªe
::
	$gëNóª°
(c⁄° 
glm
::
vec2
& 
˚¡î
, 
ødius
)

747 
°d
::
ve˘‹
<
Posôi⁄Æ
*> 
vec
;

748 
	`gëNóª°Hñ≥r
(
vec
,
˚¡î
, 
ødius
);

749  
vec
;

750 
	}
}

752 
	gRawQuadTªe
::
	$•lô
()

754 
nodes
[0] = 
√w
 
	`RawQuadTªe
({
ªgi⁄
.
x
,ªgi⁄.
y
,ªgi⁄.
z
/2,ªgi⁄.
a
/2});

755 
nodes
[1] = 
√w
 
	`RawQuadTªe
({
ªgi⁄
.
x
 +Ñegi⁄.
z
/2,Ñegi⁄.
y
,Ñegi⁄.z/2,Ñegi⁄.
a
/2});

756 
nodes
[2] = 
√w
 
	`RawQuadTªe
({
ªgi⁄
.
x
,Ñegi⁄.
y
 +Ñegi⁄.
a
/2,Ñegi⁄.
z
/2,Ñegion.a/2});

757 
nodes
[3] = 
√w
 
	`RawQuadTªe
({
ªgi⁄
.
x
 +Ñegi⁄.
z
/2,Ñegi⁄.
y
 +Ñegi⁄.
a
/2,Ñegion.z/2,Ñegion.a/2});

758 
	}
}

760 
	gRawQuadTªe
::
	$cou¡
()

762 
™swî
 = 
vec
.
	`size
();

763 i‡(
nodes
[0])

765 
i
 = 0; i < 4; i ++)

767 
™swî
 +
nodes
[
i
]->
	`cou¡
();

770  
™swî
;

771 
	}
}

773 
	gRawQuadTªe
::
	$size
()

775  
vec
.
	`size
();

776 
	}
}

778 
RawQuadTªe
* 
	gRawQuadTªe
::
	$föd
(
Posôi⁄Æ
& 
obj
)

780 
RawQuadTªe
* 
™swî
 = 
nuŒ±r
;

781 i‡(
obj
.
	`cﬁlides
(
ªgi⁄
))

783 i‡(
nodes
[0])

785 
i
 = 0; i < 4; i ++)

787 i‡(
obj
.
	`cﬁlides
(
nodes
[
i
]->
ªgi⁄
))

789 i‡(
™swî
)

791 
™swî
 = 
this
;

796 
™swî
 = 
nodes
[
i
];

800 i‡(
™swî
 !
this
)

802 
™swî
 =ánswî->
	`föd
(
obj
);

807 
™swî
 = 
this
;

810 i‡(
™swî
 =
nuŒ±r
)

814  
™swî
;

815 
	}
}

817 
boﬁ
 
	gRawQuadTªe
::
	$c⁄èös
(
Posôi⁄Æ
& 
posôi⁄Æ
)

819 
size
 = 
vec
.
	`size
();

820 
i
 = 0; i < 
size
; i ++)

822 i‡(
vec
[
i
] =&
posôi⁄Æ
)

824  
åue
;

827  
Ál£
;

828 
	}
}

830 
	gRawQuadTªe
::
	$move
(
RawQuadTªe
& 
t1
, RawQuadTªe& 
t2
, 
Posôi⁄Æ
& 
obj
)

832 
size
 = 
t1
.
vec
.
	`size
();

833 
i
 = 0; i < 
size
; i ++)

835 i‡(
t1
.
vec
[
i
] =&
obj
)

837 
t2
.
	`add
(*(
t1
.
vec
[
i
]));

838 
t1
.
vec
.
	`îa£
—1.vec.
	`begö
(Ë+ 
i
);

842 
	}
}

844 
	gRawQuadTªe
::
	$ªmove
(
Posôi⁄Æ
& 
obj
, 
Posôi⁄ÆCom∑ª
 
func
)

846 i‡(!
obj
.
	`cﬁlides
(
ªgi⁄
))

850 
size
 = 
vec
.
	`size
();

851 
i
 = 0; i < 
size
; i ++)

853 i‡((
func
 && 
	`func
(*
vec
[
i
],
obj
)) || vec[i] == &obj)

855 
vec
.
	`îa£
(vec.
	`begö
(Ë+ 
i
);

859 i‡(
nodes
[0])

861 
i
 = 0; i < 4; i ++)

863 
nodes
[
i
]->
	`ªmove
(
obj
,
func
);

867 
	}
}

869 
RawQuadTªe
* 
	gRawQuadTªe
::
	$upd©e
(
Posôi⁄Æ
& 
posôi⁄Æ
, 
RawQuadTªe
& 
ex≥˘ed
)

871 
RawQuadTªe
* 
√wTªe
 = 
	`föd
(
posôi⁄Æ
);

872 i‡(
√wTªe
 !
nuŒ±r
)

874 i‡(&
ex≥˘ed
 !
√wTªe
)

876 
	`move
(
ex≥˘ed
,*
√wTªe
,
posôi⁄Æ
);

881 
°d
::
˚º
 << 
posôi⁄Æ
.
	`gëPos
().
x
 << " " <<Öosôi⁄Æ.gëPos().
y
 << " " << 
ªgi⁄
.x << " " <<Ñegi⁄.y << " " <<Ñegi⁄.
z
 << " " <<Ñegi⁄.
a
 << "\n";

882 
throw
 
√w
 
°d
::
	`övÆid_¨gumít
("Can't findÖositional!");

884  
√wTªe
;

886 
	}
}

	@C:\Users\leoou\OneDrive\Desktop\resources\glGame.h

1 #i‚de‡
GLGAME_H_INCLUDED


2 
	#GLGAME_H_INCLUDED


	)

4 
	~<gÀw.h
>

6 
	~<glm.hµ
>

7 
	~<gtc/m©rix_å™sf‹m.hµ
>

8 
	~<gtc/ty≥_±r.hµ
>

10 
	~<ve˘‹
>

11 
	~<mem‹y
>

13 
	~"geomëry.h
"

14 
	~"ªndî.h
"

15 
	~"SDLhñ≥r.h
"

17 
boﬁ
 
ª˘P©hI¡î£˘
(c⁄° 
glm
::
vec4
& 
ﬁdRe˘
, c⁄° glm::vec4& 
√wRe˘
, c⁄° glm::vec4& 
cﬁlide
);

19 ˛as†
	cPosôi⁄Æ


21 
	m¥Ÿe˘ed
:

22 
glm
::
vec2
 
pos
;

23 
	mpublic
:

24 
Posôi⁄Æ
(c⁄° 
glm
::
vec2
& 
poöt
);

25 
vútuÆ
 
boﬁ
 
cﬁlides
(c⁄° 
glm
::
vec4
& 
box
);

26 
vútuÆ
 
boﬁ
 
cﬁlidesLöe
(c⁄° 
glm
::
vec4
& 
löe
);

27 
vútuÆ
 
	$di°™˚
(c⁄° 
glm
::
vec2
& 
poöt
)

29  
	`poötDi°™˚
(
poöt
, 
pos
);

31 
vútuÆ
 
glm
::
vec4
 
	$gëBoundögRe˘
() const;

32 
vútuÆ
 
glm
::
vec2
 
	$gëPos
() const;

33 
vútuÆ
 ~
	$Posôi⁄Æ
()

35 
	}
}

37 ˛as†
	cRe˘Posôi⁄Æ
 : 
public
 
Posôi⁄Æ


39 
¥Ÿe˘ed
:

40 
glm
::
vec4
 
ª˘
;

41 
	mtût
 = 0;

42 
	mpublic
:

43 
Re˘Posôi⁄Æ
(c⁄° 
glm
::
vec4
& 
box
, 
tût
 = 0);

44 
vútuÆ
 
boﬁ
 
cﬁlides
(c⁄° 
glm
::
vec4
& 
box
);

45 
vútuÆ
 
boﬁ
 
cﬁlidesLöe
(c⁄° 
glm
::
vec4
& 
löe
);

46 
vútuÆ
 
	$di°™˚
(c⁄° 
glm
::
vec2
& 
poöt
)

48  
	`poötVecDi°™˚
(
ª˘
, 
poöt
.
x
,Öoöt.
y
);

50 
glm
::
vec4
 
	$gëBoundögRe˘
() const;

51 
vútuÆ
 
glm
::
vec2
 
	$gëPos
() const;

52 c⁄° 
glm
::
vec4
& 
	$gëRe˘
() const;

53 
	$gëTût
() const;

54 
	`£tTût
(
tût_
);

55 
glm
::
vec2
 
	$gëCíãr
() const;

56 
	}
};

58 ˛as†
	cRe˘PosCamîa
 : 
public
 
RídîCamîa


60 
°d
::
wók_±r
<
Re˘Posôi⁄Æ
> 
fﬁlowì
;

61 
	mpublic
:

62 
öô
(c⁄° 
°d
::
sh¨ed_±r
<
Re˘Posôi⁄Æ
>& 
fﬁlowì_
, 
w
, 
h
);

63 
£tFﬁlowì
(c⁄° 
°d
::
sh¨ed_±r
<
Re˘Posôi⁄Æ
>& 
fﬁlowì_
);

64 
upd©e
();

69 
	$boﬁ
 (*
	tPosôi⁄ÆCom∑ª
Ë(c⁄° 
	tPosôi⁄Æ
& 
	tpos1
, c⁄° Posôi⁄Æ& 
	tpos2
);

71 ˛as†
	cPosWøµî


77 
public
:

78 
vútuÆ
 
Posôi⁄Æ
* 
	$gë
() const

80 
°d
::
cout
 << "ERROR\n";

81  
nuŒ±r
;

83 
vútuÆ
 ~
	$PosWøµî
()

86 
	}
}

89 
	gSh¨edWøµî
 : 
public
 
PosWøµî


91 
°d
::
sh¨ed_±r
<
Posôi⁄Æ
> 
±r
;

92 
Sh¨edWøµî
(
Posôi⁄Æ
* 
±r_
Ë: 
±r
(ptr_)

96 
Posôi⁄Æ
* 
gë
() const

98  
±r
.
gë
();

102 
	gWókWøµî
 : 
public
 
PosWøµî


104 
°d
::
wók_±r
<
Posôi⁄Æ
> 
±r
;

105 
WókWøµî
(c⁄° 
°d
::
sh¨ed_±r
<
Posôi⁄Æ
>& 
±r_
Ë: 
±r
(ptr_)

109 
Posôi⁄Æ
* 
gë
() const

111  
±r
.
lock
().
gë
();

115 
	gRawWøµî
 : 
public
 
PosWøµî


117 
Posôi⁄Æ
* 
±r
;

118 
RawWøµî
(
Posôi⁄Æ
* 
±r_
Ë: 
±r
(ptr_)

122 
Posôi⁄Æ
* 
gë
() const

124  
±r
;

128 
	g°d
::
	tve˘‹
<
	t°d
::
	tunique_±r
<
	tPosWøµî
>> 
	tpoöãrVec
;

129 
	g°d
::
	tve˘‹
<
	tPosôi⁄Æ
*> 
	tposôi⁄ÆVec
;

131 ˛as†
	cQuadTªe


133 
c⁄°ex¥
 
	mmaxC≠acôy
 = 100;

134 
poöãrVec
 
	mvec
;

135 
	mglm
::
vec4
 
ªgi⁄
;

136 
•lô
();

137 
boﬁ
 
c⁄èös
(
Posôi⁄Æ
& 
posôi⁄Æ
);

138 
QuadTªe
* 
	mnodes
[4] = {
nuŒ±r
,nullptr,nullptr,nullptr};

139 
move
(
QuadTªe
& 
t1
, QuadTªe& 
t2
, 
Posôi⁄Æ
& 
obj
);

140 
gëNóª°Hñ≥r
(
posôi⁄ÆVec
& 
vec
, c⁄° 
glm
::
vec2
& 
˚¡î
, 
ødius
);

141 
gëNóª°Hñ≥r
(
posôi⁄ÆVec
& 
vec
, c⁄° 
glm
::
vec4
& 
¨ó
 );

142 
gëNóª°Hñ≥r
(
posôi⁄ÆVec
& 
vec
, 
Posôi⁄Æ
& 
obj
);

143 
	gpublic
:

144 
QuadTªe
(c⁄° 
glm
::
vec4
& 
ª˘
);

145 
ªndî
(c⁄° 
glm
::
vec2
& 
di•œ˚mít
);

146 
ªndî
(
RídîCamîa
& 
ˇmîa
);

147 ~
QuadTªe
();

148 
cou¡
 ();

149 
size
();

150 
boﬁ
 
ªmove
(
Posôi⁄Æ
& 
obj
, 
Posôi⁄ÆCom∑ª
 
func
 = 
nuŒ±r
);

151 
QuadTªe
* 
föd
(
Posôi⁄Æ
& 
obj
);

152 
posôi⁄ÆVec
 
gëNóª°
–
Posôi⁄Æ
& 
obj
);

153 
posôi⁄ÆVec
 
gëNóª°
–c⁄° 
glm
::
vec4
& 
¨ó
);

154 
posôi⁄ÆVec
 
gëNóª°
(c⁄° 
glm
::
vec2
& 
˚¡î
, 
ødius
);

155 
add
(
PosWøµî
& 
obj
);

156 
	g°d
::
sh¨ed_±r
<
Posôi⁄Æ
>& 
add
(Posôi⁄Æ& 
pos
);

157 
˛ór
();

158 
m≠
((*
fun
)(c⁄° 
Posôi⁄Æ
& 
pos
));

159 
QuadTªe
* 
	`upd©e
(
Posôi⁄Æ
& 
obj
, QuadTªe& 
ex≥˘ed
);

160 
ölöe
 c⁄° 
glm
::
vec4
& 
	$gëRe˘
()

162  
ªgi⁄
;

163 
	}
}

166 
	~<£t
>

167 ˛as†
	cBiTªe


169 
	sBiTªeEÀmít


171 
Posôi⁄Æ
* 
	mposôi⁄Æ
;

172 
	mglm
::
vec4
 
ª˘
;

175 
	sBiTªeSc‹e


177 
c⁄°ex¥
 
	groundNth
 = 4;

178 
	gnodeY
, 
	gñemítX
;

179 
boﬁ
 
	g›î©‹
 < (c⁄° 
	gBiTªeSc‹e
& 
	gŸhî
) const

181  
round
(
nodeY
,
roundNth
Ë=round(
Ÿhî
.nodeY,roundNthË?Ñound(
ñemítX
,roundNth) <Ñound(other.elementX,roundNth) :Ñound(nodeY,roundNth) <Ñound(other.nodeY,roundNth);

183 
boﬁ
 
	g›î©‹
 =(c⁄° 
BiTªeSc‹e
& 
Ÿhî
) const

185  (
round
(
nodeY
,
roundNth
Ë=round(
Ÿhî
.nodeY,roundNthË&&Ñound(
ñemítX
,roundNth) ==Ñound(other.elementX,roundNth));

187 
boﬁ
 
	g›î©‹
 <(c⁄° 
BiTªeSc‹e
& 
Ÿhî
) const

189  *
this
 < 
Ÿhî
 || *this == other;

191 
	g°d
::
°rög
 
toSåög
() const

193  
c⁄vît
(
nodeY
Ë+ " " + c⁄vît(
ñemítX
);

197 
	g°d
::
	tmu…im≠
<
	tBiTªeSc‹e
,
	tBiTªeEÀmít
> 
	tBiTªeSt‹age
;

198 
c⁄°ex¥
 
	gmaxNodeSize
 = 128;

199 
	sBiTªeNode


205 
	gglm
::
vec2
 
vîtDimí
;

206 
	gsize
 = 0;

207 
	gBiTªeSt‹age
::
ôî©‹
 
°¨t
;

208 
BiTªeNode
* 
	gnodes
[2] = {0,0};

209 
	gbigSize
 = 0;

210 
	gmón
 = 0;

211 
	gM2
 = 0;

212 
gëV¨ün˚
()

214  
	gM2
/
	gsize
;

219 
BiTªeSt‹age
 
	gñemíts
;

220 
BiTªeNode
 
	ghód
;

221 
	gglm
::
vec4
 
ªgi⁄
;

223 
	gãm∂©e
<
ty≥«me
 
	gCÆœbÀ
>

224 autÿ
	$¥o˚ssEÀmít
(
CÆœbÀ
 
func
, 
Posôi⁄Æ
& 
wøp
, c⁄° 
glm
::
vec4
& 
ª˘
)

226  
	`¥o˚ssEÀmít
(
func
,
wøp
,
ª˘
,
hód
);

227 
	}
}

229 
	gãm∂©e
<
ty≥«me
 
	gCÆœbÀ
>

230 autÿ
	$¥o˚ssEÀmít
(
CÆœbÀ
 
func
, 
Posôi⁄Æ
& 
wøp
, c⁄° 
glm
::
vec4
& 
ª˘
, 
BiTªeNode
& 
node
)

235 i‡(!
node
.
nodes
[0])

237  
	`func
({&
wøp
,
ª˘
},
node
);

241 
•lô
 = 
node
.
vîtDimí
.
x
 +Çode.vîtDimí.
y
/2;

242 i‡(
ª˘
.
y
 < 
•lô
 &&Ñe˘.y +Ñe˘.
a
 > split)

244 
bŸHeight
 = 
ª˘
.
y
 +Ñe˘.
a
 - 
•lô
;

245 
	`¥o˚ssEÀmít
(
func
,
wøp
,{
ª˘
.
x
,
•lô
,ª˘.
z
,
bŸHeight
},*
node
.
nodes
[1]);

246  
	`¥o˚ssEÀmít
(
func
,
wøp
,{
ª˘
.
x
,ª˘.
y
,ª˘.
z
,ª˘.
a
 - 
bŸHeight
},*
node
.
nodes
[0]);

250 i‡(
ª˘
.
y
 < 
•lô
)

252  
	`¥o˚ssEÀmít
(
func
,
wøp
,
ª˘
,*
node
.
nodes
[0]);

256  
	`¥o˚ssEÀmít
(
func
,
wøp
,
ª˘
,*
node
.
nodes
[1]);

261 
	}
}

262 
	gãm∂©e
<
ty≥«me
 
	gCÆœbÀ
>

263 
	$¥o˚ssNode
(
CÆœbÀ
 
func
, 
BiTªeNode
& 
node
)

265 
	`func
(
node
);

266 i‡(
node
.
nodes
[0])

268 
PﬁyRídî
::
	`ªque°Löe
({
ªgi⁄
.
x
,
node
.
vîtDimí
.x +Çode.vîtDimí.
y
/2,ªgi⁄.x +Ñegi⁄.
z
,node.vertDimen.x +Çode.vertDimen.y/2},

270 
	`¥o˚ssNode
(
func
,*
node
.
nodes
[0]);

271 
	`¥o˚ssNode
(
func
,*
node
.
nodes
[1]);

273 
	}
}

274 
BiTªeSc‹e
 
ˇlcuœãSc‹e
(c⁄° 
BiTªeEÀmít
& 
ñemít
, 
BiTªeNode
& 
node
);

275 
	gBiTªeSt‹age
::
ôî©‹
 
ö£π
(c⁄° 
BiTªeEÀmít
& 
ñemít
, 
BiTªeNode
& 
node
);

276 
upd©eNode
(
BiTªeSt‹age
::
ôî©‹
& 
ô
, 
BiTªeNode
& 
node
);

277 
	gpublic
:

278 
BiTªe
(c⁄° 
glm
::
vec4
& 
ªgi⁄_
);

279 
	$size
()

281  
ñemíts
.
	`size
();

282 
	}
}

283 
	$cou¡Nodes
()

285 
cou¡
 = 0;

286 
	`¥o˚ssNode
([&
cou¡
,
this
](
BiTªeNode
& 
node
){count ++;

287 i‡(
node
.
nodes
[0])

289 
PﬁyRídî
::
	`ªque°Löe
({0,
node
.
vîtDimí
.
x
 +Çode.vîtDimí.
y
/2,
ªgi⁄
.x +Ñegi⁄.
z
,node.vertDimen.x +Çode.vertDimen.y/2},{1,1,0,1},0,1,0);

291 },
hód
);

292  
cou¡
;

293 
	}
}

294 
ö£π
(
Posôi⁄Æ
& 
wøp
);

295 
ªmove
(
Posôi⁄Æ
& 
wøp
);

296 
	gãm∂©e
<
ty≥«me
 
	gCÆœbÀ
>

297 
	$¥o˚ssCﬁlisi⁄s
(
CÆœbÀ
 
func
)

299 autÿ
ô
 = 
ñemíts
.
	`begö
();

300 autÿ
íd
 = 
ñemíts
.
	`íd
();

301 
ô
 !
íd
)

303 
xB‹dî
 = 
ô
->
£c⁄d
.
ª˘
.
x
 + it->£c⁄d.ª˘.
z
;

304 
Re˘Posôi⁄Æ
* 
r1
 = 
°©ic_ˇ°
<Re˘Posôi⁄Æ*>(
ô
->
£c⁄d
.
posôi⁄Æ
);

306 autÿ
ˇndid©e
 = 
°d
::
	`√xt
(
ô
);

307 
cou¡
 = 0;

309 
ˇndid©e
 !
íd
)

313 i‡(
ˇndid©e
->
£c⁄d
.
posôi⁄Æ
 =
ô
->second.positional ||

314 
ˇndid©e
->
£c⁄d
.
ª˘
.
x
 > 
xB‹dî
 ||

315 
ˇndid©e
->
£c⁄d
.
ª˘
.
x
 < 
ô
->second.rect.x)

321 
Re˘Posôi⁄Æ
* 
r2
 = 
°©ic_ˇ°
<Re˘Posôi⁄Æ*>(
ˇndid©e
->
£c⁄d
.
posôi⁄Æ
);

322 i‡(
	`vecI¡î£˘
(
r1
->
	`gëRe˘
(),
r2
->gëRe˘(),r1->
	`gëTût
(),r2->getTilt()))

324 
	`func
(*
r1
,*
r2
);

328 ++
ˇndid©e
;

329 
cou¡
++;

331 ++
ô
;

333 
	}
}

334 
	gãm∂©e
<
ty≥«me
 
	gCÆœbÀ
>

335 
	$m≠
(
CÆœbÀ
 
func
)

338 autÿ
íd
 = 
ñemíts
.
	`íd
();

339 autÿ
ô
 = 
ñemíts
.
	`begö
(); ià!
íd
;++it)

341 
	`func
(*
ô
->
£c⁄d
.
posôi⁄Æ
);

344 
	}
}

345 
	$showCﬁlisi⁄s
()

347 
glm
::
vec2
 
mou£Pos
 = 
	`∑útoVec
(
Mou£M™agî
::
	`gëMou£Pos
());

348 
Posôi⁄Æ
 
	`p
(
mou£Pos
);

349 autÿ
ô
 = 
ñemíts
.
	`begö
();

350 
	`¥o˚ssEÀmít
([&
ô
,
this
](c⁄° 
BiTªeEÀmít
& 
ñemít
, 
BiTªeNode
& 
node
Ë
muèbÀ
 {

351 
ô
 = 
	`ö£π
(
ñemít
,
node
);

352 },
p
,
glm
::
	`vec4
(
mou£Pos
,10,10));

353 autÿ
ˇndid©e
 = 
°d
::
	`√xt
(
ô
);

354 
i
 = 0;

355 
ˇndid©e
 !
ñemíts
.
	`íd
())

357 i‡–
ˇndid©e
->
£c⁄d
.
posôi⁄Æ
 =
ô
->second.positional ||

358 
ˇndid©e
->
£c⁄d
.
ª˘
.
x
 > 
ô
->£c⁄d.ª˘.x + it->£c⁄d.ª˘.
z
 ||

359 
ˇndid©e
->
£c⁄d
.
ª˘
.
x
 < 
ô
->second.rect.x)

363 
PﬁyRídî
::
	`ªque°Re˘
(
ˇndid©e
->
£c⁄d
.
posôi⁄Æ
->
	`gëBoundögRe˘
(),{1,1,0,1},
åue
,0,1);

364 
PﬁyRídî
::
	`ªque°Re˘
(
ˇndid©e
->
£c⁄d
.
ª˘
,{1,0,0,1},
åue
,0,1);

366 ++
ˇndid©e
;

367 ++
i
;

369 
	`ªmove
(
p
);

370 
°d
::
cout
 << 
i
 << "\n";

371 
	}
}

372 
	g¥iv©e
:

377 ˛as†
	cRawQuadTªe


379 c⁄° 
	mmaxC≠acôy
;

380 
posôi⁄ÆVec
 
	mvec
;

381 
	mglm
::
vec4
 
ªgi⁄
;

382 
•lô
();

383 
boﬁ
 
c⁄èös
(
Posôi⁄Æ
& 
posôi⁄Æ
);

384 
RawQuadTªe
* 
	mnodes
[4] = {
nuŒ±r
,nullptr,nullptr,nullptr};

385 
move
(
RawQuadTªe
& 
t1
, RawQuadTªe& 
t2
, 
Posôi⁄Æ
& 
obj
);

386 
gëNóª°Hñ≥r
(
posôi⁄ÆVec
& 
vec
, c⁄° 
glm
::
vec2
& 
˚¡î
, 
ødius
);

387 
gëNóª°Hñ≥r
(
posôi⁄ÆVec
& 
vec
, c⁄° 
glm
::
vec4
& 
¨ó
 );

388 
gëNóª°Hñ≥r
(
posôi⁄ÆVec
& 
vec
, 
Posôi⁄Æ
& 
obj
);

390 
	gpublic
:

391 
RawQuadTªe
(c⁄° 
glm
::
vec4
& 
ª˘
);

392 
ªndî
(c⁄° 
glm
::
vec2
& 
di•œ˚mít
);

393 ~
RawQuadTªe
();

394 
cou¡
 ();

395 
size
();

396 
ªmove
(
Posôi⁄Æ
& 
obj
, 
Posôi⁄ÆCom∑ª
 
func
 = 
nuŒ±r
);

397 
RawQuadTªe
* 
föd
(
Posôi⁄Æ
& 
obj
);

398 
posôi⁄ÆVec
 
gëNóª°
–
Posôi⁄Æ
& 
obj
);

399 
posôi⁄ÆVec
 
gëNóª°
–c⁄° 
glm
::
vec4
& 
¨ó
);

400 
posôi⁄ÆVec
 
gëNóª°
(c⁄° 
glm
::
vec2
& 
˚¡î
, 
ødius
);

401 
add
(
Posôi⁄Æ
& 
obj
);

402 
˛ór
();

403 
RawQuadTªe
* 
upd©e
(
Posôi⁄Æ
& 
obj
, RawQuadTªe& 
ex≥˘ed
);

404 
ölöe
 c⁄° 
	gglm
::
vec4
& 
	$gëRe˘
()

406  
ªgi⁄
;

407 
	}
}

	@C:\Users\leoou\OneDrive\Desktop\resources\glInterface.cpp

1 
	~<SDL.h
>

3 
	~"SDLhñ≥r.h
"

5 
	~"glI¡îÁ˚.h
"

8 
	gglm
::
vec4
 
P™ñ
::
	$sˇÀ
(c⁄° 
glm
::
vec4
& 
sˇÀRe˘
)

10 
glm
::
vec4
 
ªndîRe˘
 = 
ª˘
*glm::
	`vec4
(
sˇÀRe˘
.
z
,sˇÀRe˘.
a
,scaleRect.z,scaleRect.a);

11 
ªndîRe˘
.
x
 +
sˇÀRe˘
.x;

12 
ªndîRe˘
.
y
 +
sˇÀRe˘
.y;

13  
ªndîRe˘
;

15 
	}
}

16 
	gP™ñ
::
	$P™ñ
(c⁄° 
glm
::
vec4
& 
ª˘_
, c⁄° glm::vec4& 
bCﬁ‹
, 
S¥ôeWøµî
* 
•r
, 
z_
 ) : 
	`ª˘
‘e˘_), 
	`backgroundCﬁ‹
(bCﬁ‹), 
	`•rôe
(•r), 
	$ba£Z
(
z_
)

19 
	}
}

22 
	gP™ñ
::
	$£tDoUpd©e
(
boﬁ
 
vÆ
)

24 
doUpd©e
 = 
vÆ
;

25 
	}
}

27 
boﬁ
 
	gP™ñ
::
	$gëDoUpd©e
()

29  
doUpd©e
;

30 
	}
}

32 c⁄° 
	gglm
::
vec4
& 
P™ñ
::
	$gëRe˘
()

34  
ª˘
;

35 
	}
}

36 
boﬁ
 
	gP™ñ
::
	$gëDód
()

38  
dód
;

39 
	}
}

41 
	gP™ñ
::
	$ch™geRe˘
(c⁄° 
glm
::
vec4
& 
ª˘
)

43 
this
->
ª˘
 =Ñect;

44 
	}
}

46 
	gP™ñ
::
	$£tS¥ôe
(
S¥ôeWøµî
* 
•rôe
)

48 
this
->
•rôe
 = sprite;

49 
	}
}

51 
	gP™ñ
::
	$upd©e
(
mou£X
,
mou£Y
, 
z
, c⁄° 
glm
::
vec4
& 
sˇÀ
)

53 
∑øm
 = 
‹igöÆS¥ôe
;

54 
	}
}

55 
	gP™ñ
::
	$upd©e
(
mou£X
, 
mou£Y
, 
z
)

57 
	`upd©e
(
mou£X
,
mou£Y
,
z
,{0,0,1,1});

58 
	}
}

59 
	gP™ñ
::
	$upd©eBlô
(
z
, c⁄° 
glm
::
vec4
& 
blô
)

61 
glm
::
vec4
 
sˇÀ
 = {
blô
.
x
 - 
ª˘
.x*blô.
z
/ª˘.z,blô.
y
 -Ñe˘.y*blô.
a
/rect.a,blit.z/rect.z,blit.a/rect.a};

62 autÿ
mou£Pos
 = 
Mou£M™agî
::
	`gëMou£Pos
();

63 
	`upd©e
(
mou£Pos
.
fú°
,mou£Pos.
£c⁄d
,
z
,
sˇÀ
);

64 
	}
}

66 
	gP™ñ
::
	$upd©eBlô
(
z
, 
RídîCamîa
& 
ˇmîa
, 
boﬁ
 
absﬁuã
)

68 
	`upd©eBlô
(
z
,
ˇmîa
,
absﬁuã
,
ª˘
);

69 
	}
}

71 
	gP™ñ
::
	$upd©eBlô
(
z
, 
RídîCamîa
& 
ˇmîa
, 
boﬁ
 
absﬁuã
, c⁄° 
glm
::
vec4
& 
blô
)

73 
glm
::
vec4
 
ªndîRe˘
, 
sˇÀ
;

74 
glm
::
vec2
 
mou£Pos
;

75 i‡(
absﬁuã
)

77 
mou£Pos
 = 
ˇmîa
.
	`toAbsﬁuã
(
	`∑útoVec
(
Mou£M™agî
::
	`gëMou£Pos
()));

78 
ªndîRe˘
 = 
ˇmîa
.
	`toAbsﬁuã
(
blô
);

82 
mou£Pos
 = 
ˇmîa
.
	`toS¸ìn
(ˇmîa.
	`toW‹ld
(
	`∑útoVec
(
Mou£M™agî
::
	`gëMou£Pos
())));

83 
ªndîRe˘
 = 
ˇmîa
.
	`toS¸ìn
(
blô
);

85 
sˇÀ
 = {
ªndîRe˘
.
x
 - 
ª˘
.x*ªndîRe˘.
z
/ª˘.z,ªndîRe˘.
y
 -Ñe˘.y*ªndîRe˘.
a
/rect.a,renderRect.z/rect.z,renderRect.a/rect.a};

87 
	`upd©e
(
mou£Pos
.
x
,mou£Pos.
y
,
z
,
sˇÀ
);

88 
	}
}

90 
	gP™ñ
::
	$ªque°Wrôe
(
F⁄t
& 
f⁄t
, 
F⁄tP¨amëî
&& 
∑øm
, 
z
)

92 
∑øm
.
z
 = 
	`gëZ
() + z + .1;

93 
f⁄t
.
	`ªque°Wrôe
(
°d
::
	`move
(
∑øm
));

94 
	}
}

96 
	gMesßge
::
Mesßge
(c⁄° 
glm
::
vec4
& 
box
, 
S¥ôeWøµî
* 
•r
, c⁄° 
F⁄tP¨amëî
& 
∑øm
, 
F⁄t
* 
f⁄t
, c⁄° glm::vec4& 
cﬁ‹
, 
°d
::
°rög
 (*
°rFunc
)(), 
z_
 ) :

97 
P™ñ
(
box
,
cﬁ‹
,
•r
,
z_
), 
f⁄t
(f⁄t), 
∑≥r
(
∑øm
), 
‹igöÆP≠î
’¨am),
	$dy«micSåög
(
°rFunc
)

100 
	}
}

102 
	gMesßge
::
	$upd©e
(
mou£X
, 
mou£Y
, 
z
, c⁄° 
glm
::
vec4
& 
sˇÀRe˘
)

104 
glm
::
vec4
 
ªndîRe˘
 = 
	`sˇÀ
(
sˇÀRe˘
);

106 i‡(!
•rôe
 && 
backgroundCﬁ‹
.
a
 > 0)

108 
PﬁyRídî
::
	`ªque°Re˘
(
ªndîRe˘
,
backgroundCﬁ‹
,
åue
,0,
	`gëZ
(Ë+ 
z
);

110 i‡(
•rôe
)

112 
•rôe
->
	`ªque°
({
ªndîRe˘
,
∑øm
.
ødüns
,∑øm.
ef„˘
,∑øm.
töt
,∑øm.
¥ogøm
,
	`gëZ
()+ 
z
,∑øm.
p‹ti⁄
});

114 i‡(
f⁄t
)

116 
°d
::
°rög
 
¥öt
 = 
∑≥r
.
ãxt
;

117 i‡(
dy«micSåög
)

119 
¥öt
 = 
	`dy«micSåög
();

121 
f⁄t
->
	`ªque°Wrôe
({
¥öt
,
ªndîRe˘
,
∑≥r
.
™gÀ
,∑≥r.
cﬁ‹
,
	`gëZ
(Ë+ 
z
 + .1});

123 
∑≥r
 = 
‹igöÆP≠î
;

125 
P™ñ
::
	`upd©e
(
mou£X
,
mou£Y
,
z
,
sˇÀRe˘
);

126 
	}
}

128 
	gTickî
::
Tickî
(
duøti⁄
, c⁄° 
glm
::
vec4
& 
box
, 
S¥ôeWøµî
* 
•r
, c⁄° 
F⁄tP¨amëî
& 
∑øm
, 
F⁄t
* 
f⁄t
, c⁄° glm::vec4& 
cﬁ‹
, 
°d
::
°rög
 (*
°rFunc
)(), 
z_
 ) :

129 
Mesßge
(
box
,
•r
,
∑øm
,
f⁄t
,
cﬁ‹
,
°rFunc
,
z_
), 
	$mûli£c⁄ds
(
duøti⁄
)

131 
time
.
	`£t
();

132 
ba£Y
 = 
box
.
y
;

133 
	}
}

135 
	gTickî
::
	$upd©e
(
mou£X
, 
mou£Y
, 
z
, c⁄° 
glm
::
vec4
& 
sˇÀRe˘
)

137 i‡(
time
.
	`timePas£d
(
mûli£c⁄ds
))

139 
dód
 = 
åue
;

141 
£c⁄ds
 = 
time
.
	`gëTimePas£d
()/1000.0;

142 
ª˘
.
y
 = 
ba£Y
 - 
	`log
(
time
.
	`gëTimePas£d
())*10;

144 
∑≥r
.
cﬁ‹
.
a
 = 1.0/(
£c⁄ds
);

145 
∑øm
.
töt
.
a
 = 1.0/(
£c⁄ds
);

146 
Mesßge
::
	`upd©e
(
mou£X
,
mou£Y
,
z
,
sˇÀRe˘
);

147 
	}
}

149 
	gBuâ⁄
::
Buâ⁄
(c⁄° 
glm
::
vec4
& 
box
, (*
func
)(Buâ⁄*), 
S¥ôeWøµî
* 
•r
,

150 c⁄° 
F⁄tP¨amëî
& 
∑øm
, 
F⁄t
* 
f⁄t
, c⁄° 
glm
::
vec4
& 
cﬁ‹
, 
°d
::
	`°rög
 (*
°rFunc
Ë(), 
z_
 ) :

151 
	`Mesßge
–
box
,
•r
,
∑øm
,
f⁄t
,
cﬁ‹
,
°rFunc
,
z_
), 
	`toDo
(
func
), 
	$ba£Cﬁ‹
(
cﬁ‹
)

154 
	}
}

155 
	gBuâ⁄
::
	$¥ess
()

157 i‡(
toDo
 !
nuŒ±r
)

159 
	`toDo
(
this
);

161 
	}
}

163 
	gBuâ⁄
::
	$hovî
()

165 
∑≥r
.
cﬁ‹
 *= .5;

166 
backgroundCﬁ‹
 *= .5;

167 
	}
}

169 
	gBuâ⁄
::
	$ªndî
(
x
, 
y
, 
z
, c⁄° 
glm
::
vec4
& 
sˇÀRe˘
)

171 
Mesßge
::
	`upd©e
(
x
,
y
,
z
, 
sˇÀRe˘
);

172 
	}
}

174 
	gBuâ⁄
::
	$upd©e
(
mou£X
, 
mou£Y
, 
z
, c⁄° 
glm
::
vec4
& 
sˇÀRe˘
)

176 
glm
::
vec4
 
ªndîRe˘
 = 
	`sˇÀ
(
sˇÀRe˘
);

179 i‡(
	`poötInVec
(
ªndîRe˘
,
mou£X
,
mou£Y
,0))

181 
	`hovî
();

182 i‡(
Mou£M™agî
::
	`gëJu°Clicked
(Ë=
SDL_BUTTON_LEFT
)

185 
	`¥ess
();

188 
	`ªndî
(
mou£X
,
mou£Y
,
z
, 
sˇÀRe˘
);

189 
backgroundCﬁ‹
 = 
ba£Cﬁ‹
;

190 
	}
}

192 
	gWödowSwôchBuâ⁄
::
	$WödowSwôchBuâ⁄
(c⁄° 
glm
::
vec4
& 
box
, 
S¥ôeWøµî
* 
•r
, 
I¡îÁ˚
& 
Á˚
, 
Wödow
& 
to
, c⁄° 
F⁄tP¨amëî
& 
∑øm
, 
F⁄t
* 
f⁄t
, c⁄° glm::vec4& 
cﬁ‹
Ë: 
	$Buâ⁄
(
box
,
nuŒ±r
,
•r
, 
∑øm
, 
f⁄t
, 
cﬁ‹
)

194 
öãrÁ˚
 = &
Á˚
;

195 
swôchTo
 = &
to
;

196 
	}
}

198 
	gWödowSwôchBuâ⁄
::
	$¥ess
()

200 i‡(
öãrÁ˚
 && 
swôchTo
)

202 
öãrÁ˚
->
	`swôchCuºít
(
swôchTo
);

204 
	}
}

206 
	gC⁄dSwôchBuâ⁄
::
C⁄dSwôchBuâ⁄
(c⁄° 
glm
::
vec4
& 
box
,
S¥ôeWøµî
* 
•r
, 
I¡îÁ˚
& 
Á˚
, 
Wödow
& 
to
, c⁄° 
F⁄tP¨amëî
& 
∑øm
, 
F⁄t
* 
f⁄t
, c⁄° glm::vec4& 
cﬁ‹
,

207 
	$boﬁ
 (*
c⁄dFunc
)()Ë: 
	`WödowSwôchBuâ⁄
(
box
,
•r
,
Á˚
,
to
,
∑øm
,
f⁄t
,
cﬁ‹
), 
	$c⁄d
(
c⁄dFunc
)

210 
	}
}

212 
	gC⁄dSwôchBuâ⁄
::
	$ªndî
(
x
, 
y
, 
z
, c⁄° 
glm
::
vec4
& 
sˇÀRe˘
)

214 i‡(!
	`doSwôch
())

216 
backgroundCﬁ‹
 *
glm
::
	`vec4
(glm::
	`vec3
(.5),1);

218 
Buâ⁄
::
	`ªndî
(
x
,
y
,
z
,
sˇÀRe˘
);

219 
	}
}

221 
boﬁ
 
	gC⁄dSwôchBuâ⁄
::
	$doSwôch
()

223  
c⁄d
 && 
	`c⁄d
();

224 
	}
}

226 
	gC⁄dSwôchBuâ⁄
::
	$¥ess
()

228 i‡(
	`doSwôch
())

230 
WödowSwôchBuâ⁄
::
	`¥ess
();

232 
	}
}

234 
	gWödow
::
	$Wödow
(c⁄° 
glm
::
vec2
& 
dimí
, 
S¥ôeWøµî
* 
•r
, c⁄° glm::
vec4
& 
bg
, 
z_
Ë: 
	`P™ñ
({ 0,0,dimí.
x
,dimí.
y
},bg,•r,z_)

236 
	gglm
::
vec2
 
s¸ìnDimí
 = 
RídîProgøm
::
gëS¸ìnDimí
();

237 
	gª˘
.
	gz
 +(
ª˘
.
z
 =0Ë* 
s¸ìnDimí
.
x
;

238 
	gª˘
.
	ga
 +(
ª˘
.
a
 =0Ë* 
s¸ìnDimí
.
y
;

239 
	gª˘
.
	gx
 = 
s¸ìnDimí
.
x
/2 - 
ª˘
.
z
/2;

240 
	gª˘
.
	gy
 = 
s¸ìnDimí
.
y
/2 - 
ª˘
.
a
/2;

243 
	gWödow
::
	$Wödow
–c⁄° 
glm
::
vec4
& 
box
, 
S¥ôeWøµî
* 
•r
, c⁄° glm::vec4& 
bg
, 
z_
Ë: 
	$P™ñ
–
box
,
bg
,
•r
, 
z_
)

245 
ª˘
.
z
 +‘e˘.z =0Ë* 
RídîProgøm
::
	`gëS¸ìnDimí
().
x
;

246 
ª˘
.
a
 +‘e˘.®=0Ë* 
RídîProgøm
::
	`gëS¸ìnDimí
().
y
;

247 
	}
}

249 
	gWödow
::
	$cou¡P™ñs
()

251  
∑√ls
.
	`size
();

252 
	}
}

254 
	gWödow
::
	$ªmoveP™ñ
(
P™ñ
& 
buâ⁄
)

256 autÿ
íd
 = 
∑√ls
.
	`íd
();

257 autÿ
ô
 = 
∑√ls
.
	`begö
(); ià!
íd
; ++it)

259 i‡((*
ô
).
fú°
.
	`gë
(Ë=&
buâ⁄
)

261 
∑√ls
.
	`îa£
(
ô
);

265 
	}
}

267 
	gWödow
::
	$addP™ñ
(
P™ñ
& 
buâ⁄
, 
boﬁ
 
absﬁuã
)

269 
∑√ls
.
	`push_back
({
°d
::
unique_±r
<
P™ñ
>(&
buâ⁄
),
absﬁuã
});

270 
buâ⁄
.
	`ch™geRe˘
(buâ⁄.
	`gëRe˘
(Ë+ 
glm
::
	`vec4
({
ª˘
.
x
,ª˘.
y
,0,0}));

271 
	}
}

273 
	gWödow
::
	$£tCamîa
(
RídîCamîa
* 
ˇm
)

275 
ˇmîa
 = 
ˇm
;

276 
	}
}

278 
	gWödow
::
	$upd©e
(
x
, 
y
, 
z
, c⁄° 
glm
::
vec4
& 
blô
)

280 i‡(
doUpd©e
)

282 
glm
::
vec4
 
ªndîRe˘
 = 
	`sˇÀ
(
blô
);

283 i‡(
•rôe
)

285 
•rôe
->
	`ªque°
({
ªndîRe˘
,0,
NONE
,{1,1,1,1},&
RídîProgøm
::
basicProgøm
,
	`gëZ
(Ë+ 
z
 + 
∑øm
.z});

287 i‡(
backgroundCﬁ‹
.
a
 > 0)

289 
PﬁyRídî
::
	`ªque°Re˘
(
ªndîRe˘
,
backgroundCﬁ‹
,
åue
,0,
	`gëZ
(Ë+ 
z
 + 
∑øm
.z);

291 autÿ
íd
 = 
∑√ls
.
	`íd
();

292 autÿ
i
 = 
∑√ls
.
	`begö
(); i !
íd
;)

294 i‡(
i
->
fú°
.
	`gë
()->
	`gëDoUpd©e
())

296 
boﬁ
 
hovî
 = 
	`poötInVec
(
i
->
fú°
.
	`gë
()->
	`gëRe˘
(),
x
,
y
,0);

297 i‡(
ˇmîa
)

299 
i
->
fú°
.
	`gë
()->
	`upd©eBlô
(
	`gëZ
(Ë+ 
z
 + .1,*
ˇmîa
, i->
£c⁄d
);

303 
i
->
fú°
.
	`gë
()->
	`upd©e
(
x
,
y
,
	`gëZ
()+ 
z
 + .1,
blô
);

305 i‡(
i
->
fú°
->
	`gëDód
())

307 
i
 = 
∑√ls
.
	`îa£
(i);

311 ++
i
;

316 ++
i
;

322 
	}
}

324 
	gWödow
::
	$upd©eT›
(
z
, c⁄° 
glm
::
vec4
& 
blô
)

329 
	`upd©eBlô
(
z
,
blô
);

330 
	}
}

332 
	gWödow
::
	$upd©eT›
(
z
)

334 
	`upd©eT›
(
z
,
ª˘
);

335 
	}
}

337 
	gWödow
::
	$swôchTo
(
Wödow
& 
Ÿhî
)

340 
	}
}

342 
Wödow
::
	$⁄Swôch
(
Wödow
& 
¥evious
)

345 
	}
}

347 
Wödow
::
	$ªque°NG⁄
(
n
,c⁄° 
glm
::
vec2
& 
˚¡î
,
side
,c⁄° glm::
vec4
& 
cﬁ‹
,
™gÀ
,
boﬁ
 
fûÀd
,
z
)

349 
glm
::
vec2
 
√wCíãr
 = 
ˇmîa
 ? camîa->
	`toS¸ìn
(
˚¡î
) : center;

350 
PﬁyRídî
::
	`ªque°NG⁄
(
n
,
√wCíãr
,
side
,
cﬁ‹
,
™gÀ
,
fûÀd
,
z
);

351 
	}
}

353 
	gWödow
::
	$ªque°Re˘
(c⁄° 
glm
::
vec4
& 
ª˘
, c⁄° glm::vec4& 
cﬁ‹
, 
boﬁ
 
fûÀd
, 
™gÀ
, 
z
)

355 
glm
::
vec4
 
√wRe˘
 = 
ˇmîa
 ? camîa->
	`toS¸ìn
(
ª˘
) :Ñect;

356 
PﬁyRídî
::
	`ªque°Re˘
(
√wRe˘
, 
cﬁ‹
, 
fûÀd
, 
™gÀ
, 
z
);

357 
	}
}

359 
	gWödow
::
	$ªque°Löe
(c⁄° 
glm
::
vec4
& 
löe
, c⁄° glm::vec4& 
cﬁ‹
, 
z
)

362 
glm
::
vec4
 
√wLöe
 = 
ˇmîa
 ? glm::
	`vec4
(ˇmîa->
	`toS¸ìn
({
löe
.
x
,löe.
y
}),ˇmîa->toS¸ìn({löe.
z
,löe.
a
})) :Üine;

363 
PﬁyRídî
::
	`ªque°Löe
(
√wLöe
,
cﬁ‹
,
z
);

364 
	}
}

366 
	gOnOffBuâ⁄
::
	$OnOffBuâ⁄
(
Wödow
& 
wödow1
, Wödow& 
wödow2
, c⁄° 
glm
::
vec4
& 
ª˘
, 
S¥ôeWøµî
* 
•r
, c⁄° 
F⁄tP¨amëî
& 
∑øm
, 
F⁄t
* 
f⁄t
,

367 c⁄° 
glm
::
vec4
& 
cﬁ‹
Ë: 
	`Buâ⁄
(
ª˘
,
nuŒ±r
,
•r
,
∑øm
,
f⁄t
,cﬁ‹), 
	`èrgë1
(&
wödow1
), 
	$èrgë2
(&
wödow2
)

370 
	}
}

372 
	gOnOffBuâ⁄
::
	$¥ess
()

374 i‡(
èrgë1
 && 
èrgë2
)

376 
boﬁ
 
⁄O√
 = 
èrgë1
->
	`gëDoUpd©e
();

377 
èrgë2
->
	`£tDoUpd©e
(
⁄O√
);

378 
èrgë1
->
	`£tDoUpd©e
(!
⁄O√
);

380 
	}
}

382 
	gI¡îÁ˚
::
	$upd©e
()

384 i‡(
cuºít
)

386 
cuºít
->
	`upd©eT›
(0);

388 
	}
}

390 
	gI¡îÁ˚
::
	$swôchCuºít
(
Wödow
* 
wödow
)

392 i‡(
cuºít
)

394 
cuºít
->
	`swôchTo
(*
wödow
);

396 i‡(
wödow
)

398 
wödow
->
	`⁄Swôch
(*
cuºít
);

400 
RídîProgøm
::
	`ª£tR™ge
();

401 
cuºít
 = 
wödow
;

403 
	}
}

	@C:\Users\leoou\OneDrive\Desktop\resources\glInterface.h

1 #i‚de‡
GLINTERFACE_H_INCLUDED


2 
	#GLINTERFACE_H_INCLUDED


	)

4 
	~<mem‹y
>

6 
	~"FªeTy≥Hñ≥r.h
"

7 
	~"SDLhñ≥r.h
"

9 
	~"ªndî.h
"

11 ˛as†
	cP™ñ


13 
	m¥Ÿe˘ed
:

14 
glm
::
vec4
 
sˇÀ
(c⁄° glm::vec4& 
sˇÀRe˘
);

15 
	mglm
::
vec4
 
ª˘
, 
	mbackgroundCﬁ‹
;

16 
S¥ôeWøµî
* 
	m•rôe
 = 
nuŒ±r
;

17 
	mba£Z
 = 0;

18 
S¥ôeP¨amëî
 
	m∑øm
;

20 c⁄° 
S¥ôeP¨amëî
 
	m‹igöÆS¥ôe
;

21 
boﬁ
 
	mdód
 = 
Ál£
;

22 
boﬁ
 
	mdoUpd©e
 = 
åue
;

24 
	mpublic
:

25 
P™ñ
(c⁄° 
glm
::
vec4
& 
ª˘_
, c⁄° glm::vec4& 
bCﬁ‹
, 
S¥ôeWøµî
* 
•r
, 
z_
 = 0);

26 
£tDoUpd©e
(
boﬁ
 
vÆ
);

27 
boﬁ
 
gëDoUpd©e
();

28 c⁄° 
	mglm
::
vec4
& 
gëRe˘
();

29 
boﬁ
 
gëDód
();

30 
ch™geRe˘
(c⁄° 
glm
::
vec4
& 
ª˘
);

31 
£tS¥ôe
(
S¥ôeWøµî
* 
•rôe
);

32 
vútuÆ
 
upd©e
(
mou£X
,
mou£Y
, 
z
, c⁄° 
glm
::
vec4
& 
sˇÀ
);

35 
upd©e
(
mou£X
, 
mou£Y
, 
z
);

36 
upd©eBlô
(
z
, c⁄° 
glm
::
vec4
& 
blô
);

37 
upd©eBlô
(
z
, 
RídîCamîa
& 
ˇmîa
, 
boﬁ
 
absﬁuã
);

38 
upd©eBlô
(
z
, 
RídîCamîa
& 
ˇmîa
, 
boﬁ
 
absﬁuã
, c⁄° 
glm
::
vec4
& 
blô
);

39 
ªque°Wrôe
(
F⁄t
& 
f⁄t
, 
F⁄tP¨amëî
&& 
∑øm
, 
z
);

40 
	$gëZ
()

42  
ba£Z
 + 
∑øm
.
z
;

44 
	}
};

46 ˛as†
	cMesßge
 : 
public
 
P™ñ


48 
¥Ÿe˘ed
:

49 
F⁄t
* 
f⁄t
 = 
nuŒ±r
;

50 c⁄° 
F⁄tP¨amëî
 
	m‹igöÆP≠î
;

51 
F⁄tP¨amëî
 
	m∑≥r
;

52 
	m°d
::
°rög
 (*
dy«micSåög
Ë(Ë
nuŒ±r
;

53 
	mpublic
:

54 
Mesßge
(c⁄° 
glm
::
vec4
& 
box
, 
S¥ôeWøµî
* 
•r
, c⁄° 
F⁄tP¨amëî
& 
∑øm
, 
F⁄t
* 
f⁄t
, c⁄° glm::vec4& 
cﬁ‹
, 
°d
::
°rög
 (*
°rFunc
)(), 
z_
 = 0);

55 
vútuÆ
 
upd©e
(
mou£X
, 
mou£Y
, 
z
, c⁄° 
glm
::
vec4
& 
sˇÀRe˘
);

58 ˛as†
	cTickî
 : 
public
 
Mesßge


60 
mûli£c⁄ds
;

61 
DñèTime
 
	mtime
;

62 
	mba£Y
 = 0;

63 
	mpublic
:

64 
Tickî
(
duøti⁄
,c⁄° 
glm
::
vec4
& 
box
, 
S¥ôeWøµî
* 
•r
, c⁄° 
F⁄tP¨amëî
& 
∑øm
, 
F⁄t
* 
f⁄t
, c⁄° glm::vec4& 
cﬁ‹
, 
°d
::
°rög
 (*
°rFunc
)(), 
z_
 = 0);

65 
vútuÆ
 
upd©e
(
mou£X
, 
mou£Y
, 
z
, c⁄° 
glm
::
vec4
& 
sˇÀRe˘
);

68 ˛as†
	cBuâ⁄
 : 
public
 
Mesßge


70 
¥Ÿe˘ed
:

71 c⁄° 
glm
::
vec4
 
ba£Cﬁ‹
;

72 (*
toDo
Ë(
Buâ⁄
*Ë
nuŒ±r
;

73 
public
:

74 
usög
 
P™ñ
::
upd©e
;

76 
	`Buâ⁄
(c⁄° 
glm
::
vec4
& 
box
, (*
func
)(
Buâ⁄
*), 
S¥ôeWøµî
* 
•r
, c⁄° 
F⁄tP¨amëî
& 
∑øm
, 
F⁄t
* 
f⁄t
, c⁄° glm::vec4& 
cﬁ‹
, 
°d
::
	`°rög
 (*
°rFunc
)(Ë
nuŒ±r
, 
z_
 = 0);

77 
vútuÆ
 
	`¥ess
();

78 
vútuÆ
 
	`hovî
();

79 
vútuÆ
 
	`ªndî
(
x
, 
y
, 
z
, c⁄° 
glm
::
vec4
& 
sˇÀRe˘
);

80 
vútuÆ
 
	`upd©e
(
mou£X
, 
mou£Y
, 
z
, c⁄° 
glm
::
vec4
& 
sˇÀRe˘
);

83 
˛ass
 
I¡îÁ˚
;

84 
˛ass
 
Wödow
;

85 ˛as†
	cWödowSwôchBuâ⁄
 : 
public
 
Buâ⁄


87 
I¡îÁ˚
* 
öãrÁ˚
 = 
nuŒ±r
;

88 
Wödow
* 
swôchTo
 = 
nuŒ±r
;

89 
public
:

90 
	`WödowSwôchBuâ⁄
(c⁄° 
glm
::
vec4
& 
box
,
S¥ôeWøµî
* 
•r
, 
I¡îÁ˚
& 
Á˚
, 
Wödow
& 
to
, c⁄° 
F⁄tP¨amëî
& 
∑øm
, 
F⁄t
* 
f⁄t
, c⁄° glm::vec4& 
cﬁ‹
);

91 
	`¥ess
();

94 ˛as†
	cC⁄dSwôchBuâ⁄
 : 
public
 
WödowSwôchBuâ⁄


96 
	`boﬁ
 (*
c⁄d
Ë(Ë
nuŒ±r
;

97 
public
:

98 
	`C⁄dSwôchBuâ⁄
(c⁄° 
glm
::
vec4
& 
box
,
S¥ôeWøµî
* 
•r
, 
I¡îÁ˚
& 
Á˚
, 
Wödow
& 
to
, c⁄° 
F⁄tP¨amëî
& 
∑øm
, 
F⁄t
* 
f⁄t
, c⁄° glm::vec4& 
cﬁ‹
,

99 
	`boﬁ
 (*
c⁄dFunc
)());

100 
	`ªndî
(
x
, 
y
, 
z
, c⁄° 
glm
::
vec4
& 
sˇÀRe˘
);

101 
vútuÆ
 
boﬁ
 
	`doSwôch
();

102 
	`¥ess
();

106 ˛as†
	cWödow
 : 
public
 
P™ñ


109 
°d
::
	t∑ú
<
	t°d
::
	tunique_±r
<
	tP™ñ
>,
	tboﬁ
> 
	tP™ñPaú
;

110 
¥Ÿe˘ed
:

111 
°d
::
li°
<
P™ñPaú
> 
∑√ls
;

112 
RídîCamîa
* 
ˇmîa
 = 
nuŒ±r
;

113 
public
:

114 
	`Wödow
–c⁄° 
glm
::
vec2
& 
dimí
, 
S¥ôeWøµî
* 
•r
, c⁄° glm::
vec4
& 
bg
, 
z_
 = 0);

115 
	`Wödow
–c⁄° 
glm
::
vec4
& 
box
, 
S¥ôeWøµî
* 
•r
, c⁄° glm::vec4& 
bg
, 
z_
 = 0);

116 
	`cou¡P™ñs
();

117 
	`ªmoveP™ñ
(
P™ñ
& 
buâ⁄
);

118 
	`addP™ñ
(
P™ñ
& 
buâ⁄
, 
boﬁ
 
absﬁuã
 = 
Ál£
);

119 
	`£tCamîa
(
RídîCamîa
* 
ˇm
);

120 
vútuÆ
 
	`upd©e
(
x
, 
y
, 
z
, c⁄° 
glm
::
vec4
& 
sˇÀ
);

121 
vútuÆ
 
	`upd©eT›
(
z
, c⁄° 
glm
::
vec4
& 
blô
);

122 
vútuÆ
 
	`upd©eT›
(
z
);

123 
vútuÆ
 
	`swôchTo
(
Wödow
& 
sw≠To
);

124 
vútuÆ
 
	`⁄Swôch
(
Wödow
& 
¥evious
);

125 
vútuÆ
 
	`ªque°NG⁄
(
n
,c⁄° 
glm
::
vec2
& 
˚¡î
,
side
,c⁄° glm::
vec4
& 
cﬁ‹
,
™gÀ
,
boﬁ
 
fûÀd
,
z
);

126 
vútuÆ
 
	`ªque°Re˘
(c⁄° 
glm
::
vec4
& 
ª˘
, c⁄° glm::vec4& 
cﬁ‹
, 
boﬁ
 
fûÀd
, 
™gÀ
, 
z
);

127 
vútuÆ
 
	`ªque°Löe
(c⁄° 
glm
::
vec4
& 
löe
, c⁄° glm::vec4& 
cﬁ‹
, 
z
);

130 ˛as†
	cOnOffMode


132 
DYNAMIC
,

133 
OFF
,

134 
ON


137 ˛as†
	cOnOffBuâ⁄
 : 
public
 
Buâ⁄


139 
public
:

140 
	`OnOffBuâ⁄
(
Wödow
& 
wödow1
,Wödow& 
wödow2
, c⁄° 
glm
::
vec4
& 
ª˘
, 
S¥ôeWøµî
* 
•r
, c⁄° 
F⁄tP¨amëî
& 
∑øm
, 
F⁄t
* 
f⁄t
, c⁄° glm::vec4& 
cﬁ‹
);

141 
	`¥ess
();

142 
¥iv©e
:

143 
Wödow
* 
èrgë1
 = 
nuŒ±r
;

144 
Wödow
* 
èrgë2
 = 
nuŒ±r
;

147 ˛as†
	cI¡îÁ˚


149 
Wödow
* 
cuºít
 = 
nuŒ±r
;

150 
public
:

151 
	`upd©e
();

152 
	`swôchCuºít
(
Wödow
* 
wödow
);

	@C:\Users\leoou\OneDrive\Desktop\resources\physics.cpp

1 
	~"physics.h
"

2 
	~"v™ûœ.h
"

4 
	gF‹˚sComp⁄ít
::
	$≠∂yF‹˚
(
F‹˚Ve˘‹
 
f‹˚
)

6 
föÆF‹˚
 +
f‹˚
;

7 
	}
}

9 
	gF‹˚sComp⁄ít
::
	$F‹˚sComp⁄ít
(
E¡ôy
& 
ítôy
, 
‰i˘i⁄_
Ë: 
	`Comp⁄ít
”¡ôy), 
Comp⁄ítC⁄èöî
<
F‹˚sComp⁄ít
>(&ítôy), 
	`move
”¡ôy.
gëComp⁄ít
<
MoveComp⁄ít
>()),
	$‰i˘i⁄
(
‰i˘i⁄_
)

12 
	}
}

14 
	gF‹˚sComp⁄ít
::
	$£tMoveComp⁄ít
(
MoveComp⁄ít
* 
move_
)

16 
move
 = 
move_
;

17 
	}
}

19 
boﬁ
 
	gF‹˚sComp⁄ít
::
	$gëBeögPushed
()

21  
föÆF‹˚
.
x
 !0 || föÆF‹˚.
y
 != 0;

22 
	}
}

24 
	gF‹˚sComp⁄ít
::
	$addF‹˚
(
F‹˚Ve˘‹
 
f‹˚
)

26 
	`≠∂yF‹˚
(
f‹˚
);

27 i‡(
glm
::
	`Àngth
(
f‹˚
) > 10)

29 
f‹˚
 = 
glm
::
	`n‹mÆize
(force)*10.0f;

31 
	}
}

33 
	gF‹˚sComp⁄ít
::
	$upd©e
()

35 i‡(
	`gëBeögPushed
(Ë&& 
move
)

37 
move
->
	`£tPos
(move->
	`gëPos
(Ë+ 
föÆF‹˚
);

39 
föÆF‹˚
 = 
‰i˘i⁄
*finalForce;

41 
föÆF‹˚
.
x
 = 
	`abs
(finalForce.x) <= .00001 ? 0 : finalForce.x;

42 
föÆF‹˚
.
y
 = 
	`abs
(finalForce.y) <= .00001 ? 0 : finalForce.y;

46 
	}
}

48 
	gChaöLökComp⁄ít
::
	$ChaöLökComp⁄ít
(
E¡ôy
& 
ítôy
, c⁄° 
LökPå
& 
down_
, 
lökDi°_
, 
ãnsi⁄_
,
‰i˘i⁄_
) :

49 
	`F‹˚sComp⁄ít
(
ítôy
,
‰i˘i⁄_
), 
Comp⁄ítC⁄èöî
<
ChaöLökComp⁄ít
>”¡ôy), 
	`down
(
down_
), 
	`lökDi°
(
lökDi°_
), 
	$ãnsi⁄
(
ãnsi⁄_
)

52 
	}
}

54 
	gChaöLökComp⁄ít
::
	$£tLök
(c⁄° 
LökPå
& 
lök
)

56 
down
 = 
lök
;

57 
	}
}

59 
ChaöLökComp⁄ít
* 
	gChaöLökComp⁄ít
::
	$gëNextLök
()

61 i‡(
down
.
	`gë
())

63  
down
->
gëComp⁄ít
<
ChaöLökComp⁄ít
>();

65  
nuŒ±r
;

66 
	}
}

68 
	gglm
::
vec2
 
ChaöLökComp⁄ít
::
	$gëLökPos
()

70 i‡(
move
)

72  
move
->
	`gëCíãr
();

74 
	}
}

76 
	gChaöLökComp⁄ít
::
	$upd©e
()

78 i‡(
move
)

80 
F‹˚sComp⁄ít
::
	`upd©e
();

81 autÿ
downPå
 = 
down
.
	`gë
();

82 
boﬁ
 
¥öt
 = 
Ál£
;

83 i‡(
downPå
)

85 i‡(
ChaöLökComp⁄ít
* 
downLök
 = 
downPå
->
gëComp⁄ít
<ChainLinkComponent>())

87 
glm
::
vec2
 
ourPoöt
 = 
	`gëLökPos
();

88 
glm
::
vec2
 
downPoöt
 = 
downLök
->
	`gëLökPos
();

89 
glm
::
vec2
 
chaöF‹˚
 = 
ãnsi⁄
*(
downPoöt
 - 
ourPoöt
);

90 
	`addF‹˚
(
chaöF‹˚
);

91 
downLök
->
	`addF‹˚
(-1.0f*
chaöF‹˚
);

93 i‡(
	`poötDi°™˚
(
downPoöt
,
ourPoöt
Ë> 
lökDi°
)

95 
glm
::
vec2
 
di•
 = 
lökDi°
*glm::
	`n‹mÆize
(
downPoöt
 - 
ourPoöt
);

96 
move
->
	`ãÀp‹t
(
downPoöt
 - 
di•
);

103 
	}
}

105 
	gChaöRídîComp⁄ít
::
	$ChaöRídîComp⁄ít
(c⁄° 
glm
::
vec4
 
cﬁ‹_
,
ChaöLökRídî
 
ªndîFunc_
, 
RídîCamîa
* 
ˇmîa
, 
E¡ôy
& 
ítôy
) :

106 
	`RídîComp⁄ít
(
ítôy
, 
ˇmîa
),

107 
Comp⁄ítC⁄èöî
<
ChaöRídîComp⁄ít
>(
ítôy
),

108 
	`ªndîFunc
(
ªndîFunc_
),

109 
	$cﬁ‹
(
cﬁ‹_
)

112 
	}
}

114 
	gChaöRídîComp⁄ít
::
	$upd©e
()

116 i‡(
ªndîFunc
)

118 i‡(
ChaöLökComp⁄ít
* 
lök
 = 
ítôy
->
gëComp⁄ít
<ChainLinkComponent>())

120 
	`ªndîFunc
(*
this
,*
lök
);

123 
	}
}

125 
	gChaö
::
	$Chaö
(
ChaöLökRídî
 
ªndîFunc_
, c⁄° 
glm
::
vec4
& 
cﬁ‹1
, c⁄° glm::vec4& 
cﬁ‹2
, 
lökDi°_
, 
Àngth
, glm::
vec2
 
°¨t
, 
ãnsi⁄_
, 
™gÀ
, 
‰i˘i⁄_
)

128 
glm
::
vec2
 
tût
 = glm::
	`vec2
(
	`cos
(
™gÀ
),-
	`sö
◊ngÀ))*
lökDi°_
;

129 
LökPå
 
¥ev
;

130 
glm
::
vec4
 
gødõ¡
 = 
cﬁ‹2
 - 
cﬁ‹1
;

131 
i
 = 0; i < 
Àngth
; ++i)

133 
LökPå
 
lök
 = 
°d
::
sh¨ed_±r
<
E¡ôy
>(
√w
 
	`E¡ôy
());

134 
glm
::
vec2
 
•awn
 = 
°¨t
 + ()
i
*
tût
;

135 
lök
->
	`addComp⁄ít
(*(
√w
 
	`MoveComp⁄ít
(0,
glm
::
	`vec4
(
•awn
,1,1),*lök.
	`gë
())));

136 
lök
->
	`addComp⁄ít
(*(
√w
 
	`ChaöLökComp⁄ít
(*lök.
	`gë
(),
¥ev
,
lökDi°_
,
ãnsi⁄_
,
‰i˘i⁄_
)));

137 
lök
->
	`addComp⁄ít
(*(
√w
 
	`ChaöRídîComp⁄ít
(
cﬁ‹1
 + ()
i
/
Àngth
*
gødõ¡
,
ªndîFunc_
,
RídîCamîa
::
cuºítCamîa
,*lök.
	`gë
())));

138 
¥ev
 = 
lök
;

139 i‡(
i
 == 0)

141 
bŸtom

lök
;

143 i‡(
i
 =
Àngth
 - 1)

145 
t›
 = 
lök
;

149 
	}
}

151 
	gChaö
::
	$£tBŸtomPos
(c⁄° 
glm
::
vec2
& 
pos
)

153 i‡(
ChaöLökComp⁄ít
* 
lök
 = 
bŸtom
->
gëComp⁄ít
<ChainLinkComponent>())

156 i‡(
MoveComp⁄ít
* 
move
 = 
lök
->
	`gëMove
())

158 
move
->
	`ãÀp‹t
(
pos
);

161 
	}
}

163 
	gChaö
::
	$upd©e
()

165 
	`≠∂y
([](
ChaöLökComp⁄ít
& 
lök
){

166 
lök
.
	`gëE¡ôy
().
	`upd©e
();

168 
	}
}

170 
	gChaö
::
	$cﬁlide
(
E¡ôy
& 
ítôy
)

172 
	`≠∂y
([
ítôy
](
ChaöLökComp⁄ít
& 
lök
Ë
muèbÀ
 {

173 
lök
.
	`cﬁlide
(
ítôy
);

175 
	}
}

	@C:\Users\leoou\OneDrive\Desktop\resources\physics.h

1 #i‚de‡
PHYSICS_H_INCLUDED


2 
	#PHYSICS_H_INCLUDED


	)

4 
	~"comp⁄íts.h
"

5 
	~"glGame.h
"

7 
	gglm
::
	tvec2
 
	tF‹˚Ve˘‹
;

8 
˛ass
 
	gF‹˚sComp⁄ít
 : 
public
 
Comp⁄ít
,Öubli¯
	gComp⁄ítC⁄èöî
<ForcesComponent>

10 
	g¥Ÿe˘ed
:

11 
F‹˚Ve˘‹
 
föÆF‹˚
 = 
glm
::
vec2
(0);

12 
MoveComp⁄ít
* 
	gmove
 = 
nuŒ±r
;

13 
	g‰i˘i⁄
= 0;

14 
≠∂yF‹˚
(
F‹˚Ve˘‹
 
f‹˚
);

15 
	gpublic
:

16 
c⁄°ex¥
 
ba£Fri˘i⁄
 = .999f;

17 
F‹˚sComp⁄ít
(
E¡ôy
& 
ítôy
, 
‰i˘i⁄_
 = 
ba£Fri˘i⁄
);

18 
£tMoveComp⁄ít
(
MoveComp⁄ít
* 
move_
);

19 
MoveComp⁄ít
* 
gëMove
()

21  
	gmove
;

23 
boﬁ
 
gëBeögPushed
();

24 
vútuÆ
 
addF‹˚
(
F‹˚Ve˘‹
 
f‹˚
);

25 
upd©e
();

26 
	gglm
::
vec2
 
gëFöÆF‹˚
()

28  
föÆF‹˚
;

30 
	gvútuÆ
 ~
F‹˚sComp⁄ít
()

37 
	g°d
::
	tsh¨ed_±r
<
	tE¡ôy
> 
	tLökPå
;

38 
˛ass
 
	gChaöLökComp⁄ít
 : 
public
 
F‹˚sComp⁄ít
,Öubli¯
	gComp⁄ítC⁄èöî
<ChainLinkComponent>

40 
LökPå
 
	gdown
;

42 
	gpublic
:

43 
c⁄°ex¥
 
ba£Tísi⁄
 = .0001f;

44 c⁄° 
	glökDi°
 = 0;

45 c⁄° 
	gãnsi⁄
 = 0;

46 
ChaöLökComp⁄ít
(
E¡ôy
& 
ítôy
, c⁄° 
LökPå
& 
down_
, 
lökDi°_
, 
ãnsi⁄_
 = 
ba£Tísi⁄
, 
‰i˘i⁄_
 = 
F‹˚sComp⁄ít
::
ba£Fri˘i⁄
);

47 
£tLök
(c⁄° 
LökPå
& 
lök
);

48 
ChaöLökComp⁄ít
* 
gëNextLök
();

49 
vútuÆ
 
	gglm
::
vec2
 
gëLökPos
();

50 
upd©e
();

53 
˛ass
 
	gChaöRídîComp⁄ít
;

54 (*
	tChaöLökRídî
)(
	tChaöRídîComp⁄ít
&,
	tChaöLökComp⁄ít
&);

55 
˛ass
 
ChaöRídîComp⁄ít
 : 
public
 
RídîComp⁄ít
,Öubli¯
Comp⁄ítC⁄èöî
<ChainRenderComponent>

57 
ChaöLökRídî
 
ªndîFunc
;

58 
public
:

59 
glm
::
vec4
 
cﬁ‹
;

60 
	`ChaöRídîComp⁄ít
(c⁄° 
glm
::
vec4
 
cﬁ‹_
,
ChaöLökRídî
 
ªndîFunc_
, 
RídîCamîa
* 
ˇmîa
, 
E¡ôy
& 
ítôy
);

61 
	`upd©e
();

62 
	}
};

64 
	sChaö


66 
LökPå
 
	mt›
,

67 
	mbŸtom
;

68 
Chaö
(
ChaöLökRídî
 
ªndîFunc_
, c⁄° 
glm
::
vec4
& 
cﬁ‹1
, c⁄° glm::vec4& 
cﬁ‹2
, 
lökDi°_
, 
Àngth
, glm::
vec2
 
°¨t
,
ãnsi⁄_
 = .00001f, 
™gÀ
 = 0, 
‰i˘i⁄
 = 
F‹˚sComp⁄ít
::
ba£Fri˘i⁄
);

69 
	mãm∂©e
<
ty≥«me
 
	mCÆœbÀ
>

70 
Chaö
(
CÆœbÀ
 
func
, 
Àngth
)

73 
LökPå
 
	m¥ev
 = 
t›
;

74 
	mi
 = 0; i < 
	mÀngth
; ++i)

76 
	m¥ev
 = 
func
(
¥ev
, 
i
);

77 i‡(
	mi
 == 0)

79 
bŸtom
 = 
¥ev
;

81 i‡(
	mi
 =
Àngth
 - 1)

83 
t›
 = 
¥ev
;

87 
£tBŸtomPos
(c⁄° 
glm
::
vec2
& 
pos
);

88 
upd©e
();

89 
vútuÆ
 
cﬁlide
(
E¡ôy
& 
ítôy
);

90 
	mãm∂©e
<
ty≥«me
 
	mCÆœbÀ
>

91 
≠∂y
(
CÆœbÀ
 
func
)

93 i‡(
	mt›
.
gë
())

95 
ChaöLökComp⁄ít
* 
	mlök
 = 
t›
->
gëComp⁄ít
<ChainLinkComponent>();

96 
	mlök
)

98 
func
(*
lök
);

99 
	mlök
 = 
lök
->
gëNextLök
();

103 
	mãm∂©e
<
ty≥«me
 
	mRëTy≥
,Åy≥«mê
	mCÆœbÀ
>

104 
RëTy≥
 
fﬁd
(RëTy≥ 
°¨t
, 
CÆœbÀ
 
fun
)

108 
RëTy≥
 
	mvÆ
 = 
°¨t
;

109 
≠∂y
([&
vÆ
, &
fun
](
ChaöLökComp⁄ít
& 
lök
)

111 
vÆ
 = 
fun
(vÆ,
lök
);

113  
	mvÆ
;

115 
	mãm∂©e
<
ty≥«me
 
	mCÆœbÀ
>

116 
boﬁ
 
checkAŒ
(
CÆœbÀ
 
fun
)

119 i‡(
	mt›
.
gë
())

121 
ChaöLökComp⁄ít
* 
	mlök
 = 
t›
->
gëComp⁄ít
<ChainLinkComponent>();

122 
	mlök
)

124 i‡(!
fun
(*
lök
))

126  
	mÁl£
;

128 
	mlök
 = 
lök
->
gëNextLök
();

130  
	måue
;

132  
	mÁl£
;

	@C:\Users\leoou\OneDrive\Desktop\resources\render.cpp

1 
	~<s°ªam
>

2 
	~<f°ªam
>

5 
	#STB_IMAGE_IMPLEMENTATION


	)

6 
	~"°b_image.h
"

8 
	~"SDL.h
"

10 
	~"geomëry.h
"

11 
	~"ªndî.h
"

12 
	~"SDLhñ≥r.h
"

14 
	$døwRe˘™gÀ
(
RídîProgøm
& 
¥ogøm
, c⁄° 
glm
::
vec3
& 
cﬁ‹
, c⁄° glm::
vec4
& 
ª˘
, 
™gÀ
)

16 
glm
::
vec2
 
˚¡î
 = {
ª˘
.
x
+ª˘.
z
/2,ª˘.
y
+ª˘.
a
/2};

17 
glm
::
vec2
 
t›L
 = 
	`rŸ©ePoöt
({
ª˘
.
x
,ª˘.
y
},
˚¡î
,
™gÀ
);

18 
glm
::
vec2
 
t›R
 = 
	`rŸ©ePoöt
({
ª˘
.
x
+ª˘.
z
,ª˘.
y
},
˚¡î
,
™gÀ
);

19 
glm
::
vec2
 
bŸL
 = 
	`rŸ©ePoöt
({
ª˘
.
x
,ª˘.
y
+ª˘.
a
},
˚¡î
,
™gÀ
);

20 
glm
::
vec2
 
bŸR
 = 
	`rŸ©ePoöt
({
ª˘
.
x
+ª˘.
z
,ª˘.
y
+ª˘.
a
},
˚¡î
,
™gÀ
);

21 
	`døwLöe
(
¥ogøm
,
cﬁ‹
,{{
t›L
.
x
,t›L.
y
,
t›R
.x,topR.y},

22 {
t›L
.
x
,Å›L.
y
, 
bŸL
.x, botL.y},

23 {
t›R
.
x
,t›R.
y
,
bŸR
.x,botR.y},

24 {
bŸL
.
x
, bŸL.
y
, 
bŸR
.x, botR.y}});

25 
	}
}

27 
	$addPoötToBuf„r
(
buf„r
[], 
glm
::
vec4
 
poöt
, 
ödex
)

29 
buf„r
[
ödex
] = 
poöt
.
x
;

30 
buf„r
[
ödex
+1] = 
poöt
.
y
;

31 
buf„r
[
ödex
+2] = 
poöt
.
z
;

32 
buf„r
[
ödex
+3] = 
poöt
.
a
;

33 
	}
}

34 
	$addPoötToBuf„r
(
buf„r
[], 
glm
::
vec3
 
poöt
, 
ödex
)

36 
buf„r
[
ödex
] = 
poöt
.
x
;

37 
buf„r
[
ödex
+1] = 
poöt
.
y
;

38 
buf„r
[
ödex
+2] = 
poöt
.
z
;

39 
	}
}

40 
	$addPoötToBuf„r
(
buf„r
[], 
glm
::
vec2
 
poöt
, 
ödex
)

42 
	`addPoötToBuf„r
(
buf„r
, {
poöt
.
x
,Öoöt.
y
, 0}, 
ödex
);

43 
	}
}

45 
	$døwNG⁄
(
RídîProgøm
& 
¥ogøm
, c⁄° 
glm
::
vec3
& 
cﬁ‹
, c⁄° glm::
vec2
& 
˚¡î
, 
ødius
, 
n
, 
™gÀ
)

47 i‡(
n
 > 2)

51 
vîtNum
 = (
n
*3);

52 
buf„r
[
vîtNum
];

53 
subAngÀ
 = 2*
M_PI
/
n
;

54 
™gÀF¨
 = 
°d
::
	`fmod
((
M_PI
/2 - 
subAngÀ
/2),subAngÀË+ 
™gÀ
;

55 
glm
::
vec2
 
fú°Vîãx
 = {
˚¡î
.
x
 - 
	`cos
(
™gÀF¨
)*
ødius
, cíãr.
y
 + 
	`sö
(angleFar)*radius};

56 
	`addPoötToBuf„r
(
buf„r
,
fú°Vîãx
,0);

57 
	`addPoötToBuf„r
(
buf„r
,
	`rŸ©ePoöt
(
fú°Vîãx
,
˚¡î
,-
subAngÀ
),3);

58 
i
 = 2; i < 
n
; ++i)

60 
modI
 = 3*
i
;

62 
	`addPoötToBuf„r
(
buf„r
,
	`rŸ©ePoöt
({buf„r[
modI
 - 3],buf„r[modI - 2]},
˚¡î
,-
subAngÀ
),modI);

64 
	`glBödVîãxAºay
(
RídîProgøm
::
VAO
);

65 
	`glBödBuf„r
(
GL_ARRAY_BUFFER
,
RídîProgøm
::
VBO
);

66 
	`glBuf„rD©a
(
GL_ARRAY_BUFFER
,(
buf„r
),buf„r,
GL_STATIC_DRAW
);

67 
	`glVîãxAâribPoöãr
(

70 
GL_FLOAT
,

71 
GL_FALSE
,

75 
	`glE«bÀVîãxAâribAºay
(0);

76 
¥ogøm
.
	`£tVec3fv
("cﬁ‹",
cﬁ‹
);

77 
¥ogøm
.
	`u£
();

78 
	`glDøwAºays
(
GL_POLYGON
,0,
n
);

82 
	}
}

83 
	$døwCú˛e
(
RídîProgøm
& 
¥ogøm
, 
glm
::
vec3
 
cﬁ‹
,
x
, 
y
, 
ødius
)

85 
GLÊﬂt
 
d©a
[360*3];

86 
c⁄vît
 = 2*
M_PI
/360;

87 
i
 = 0; i < 360; i ++)

89 
	`addPoötToBuf„r
(
d©a
,{
x
 + 
	`cos
(
i
*
c⁄vît
)*
ødius
, 
y
 + 
	`sö
(i*convert)*radius},i*3);

91 
	`glBödBuf„r
(
GL_ARRAY_BUFFER
,
RídîProgøm
::
VBO
);

92 
	`glBuf„rD©a
(
GL_ARRAY_BUFFER
,(
d©a
),d©a,
GL_STATIC_DRAW
);

93 
	`glVîãxAâribPoöãr
(

96 
GL_FLOAT
,

97 
GL_FALSE
,

101 
	`glE«bÀVîãxAâribAºay
(0);

102 
¥ogøm
.
	`£tVec3fv
("cﬁ‹",
cﬁ‹
);

103 
¥ogøm
.
	`u£
();

104 
	`glDøwAºays
(
GL_LINE_LOOP
,0,360);

105 
	`glBödBuf„r
(
GL_ARRAY_BUFFER
,0);

106 
	}
}

108 
døwLöe
(
RídîProgøm
& 
¥ogøm
, 
glm
::
vec3
 
cﬁ‹
, c⁄° 
°d
::
ve˘‹
<glm::
vec4
>& 
poöts
)

110 
size
 = 
poöts
.size();

111 
GLÊﬂt
 
	gbuf„r_d©a
[
size
*6];

112 
	gi
 = 0;ò< 
	gsize
; i ++)

114 
addPoötToBuf„r
(
buf„r_d©a
,{
poöts
[
i
].
x
,poöts[i].
y
},i*6);

115 
addPoötToBuf„r
(
buf„r_d©a
,{
poöts
[
i
].
z
,poöts[i].
a
},i*6+3);

118 
glBödBuf„r
(
GL_ARRAY_BUFFER
,
RídîProgøm
::
VBO
);

119 
	gÀngth
 = (
buf„r_d©a
);

120 
glBuf„rD©a
(
GL_ARRAY_BUFFER
,
Àngth
,
buf„r_d©a
,
GL_STATIC_DRAW
);

122 
glVîãxAâribPoöãr
(

125 
GL_FLOAT
,

126 
GL_FALSE
,

130 
glE«bÀVîãxAâribAºay
(0);

131 
	g¥ogøm
.
£tVec3fv
("cﬁ‹",
cﬁ‹
);

132 
	g¥ogøm
.
u£
();

133 
glDøwAºays
(
GL_LINES
,0,
size
*2);

134 
glBödBuf„r
(
GL_ARRAY_BUFFER
,0);

138 
	$lﬂdShadîs
(c⁄° 
GLch¨
* 
sour˚
, 
GLíum
 
shadîTy≥
 )

140 
°d
::
if°ªam
 
öput
;

141 
öput
.
	`›í
(
sour˚
);

142 
shadî
 = -1;

143 i‡(
öput
.
	`is_›í
())

145 
°d
::
°rög°ªam
 
°ªam
;

146 
°ªam
 << 
öput
.
	`rdbuf
();

147 
shadî
 = 
	`glCª©eShadî
(
shadîTy≥
);

148 
°d
::
°rög
 
°r
 = 
°ªam
.
	`°r
();

149 c⁄° * 
code
 = 
°r
.
	`c_°r
();

150 
	`glShadîSour˚
(
shadî
,1, &
code
, 
NULL
);

151 
	`glCompûeShadî
(
shadî
);

152 
suc˚ss
;

153 
öfoLog
[512];

154 
	`glGëShadîiv
(
shadî
, 
GL_COMPILE_STATUS
, &
suc˚ss
);

155 i‡(!
suc˚ss
)

157 
	`glGëShadîInfoLog
(
shadî
, 512, 
NULL
, 
öfoLog
);

158 
°d
::
cout
 << "Eº‹Üﬂdög shadî: " << 
öfoLog
 << std::
ídl
;

163 
°d
::
cout
 << "C™'àföd shadî! Sour˚: " << 
sour˚
 << std::
ídl
;

165  
shadî
;

167 
	}
}

169 
	gRídîProgøm
::
s¸ìnWidth
 = 0;

170 
	gRídîProgøm
::
s¸ìnHeight
 = 0;

171 
RídîProgøm
 
	gRídîProgøm
::
basicProgøm
;

172 
RídîProgøm
 
	gRídîProgøm
::
löeProgøm
;

173 
RídîProgøm
 
	gRídîProgøm
::
∑ötProgøm
;

174 
VõwR™ge
 
	gRídîProgøm
::
ba£R™ge
;

175 
VõwR™ge
 
	gRídîProgøm
::
cuºítR™ge
;

176 
	gRídîProgøm
::
	$RídîProgøm
(
°d
::
°rög
 
vîãxP©h
, std::°rög 
‰agmítP©h
)

178 
	`öô
(
vîãxP©h
,
‰agmítP©h
);

179 
	}
}

180 
	gRídîProgøm
::
	$öô
(
°d
::
°rög
 
vîãxP©h
, std::°rög 
‰agmítP©h
)

182 
GLuöt
 
‰agmít
 = -1, 
vîãx
= -1;

183 
¥ogøm
 = 
	`glCª©eProgøm
();

184 
vîãx
 = 
	`lﬂdShadîs
(
vîãxP©h
.
	`c_°r
(), 
GL_VERTEX_SHADER
 );

185 
‰agmít
 = 
	`lﬂdShadîs
(
‰agmítP©h
.
	`c_°r
(),
GL_FRAGMENT_SHADER
);

186 
	`glAâachShadî
(
¥ogøm
,
vîãx
);

187 
	`glAâachShadî
(
¥ogøm
, 
‰agmít
);

188 
	`glLökProgøm
(
¥ogøm
);

189 
	`glDñëeShadî
(
‰agmít
);

190 
	`glDñëeShadî
(
vîãx
);

191 
	}
}

192 
GLuöt
 
	gRídîProgøm
::
VBO
, RídîProgøm::
VAO
;

193 
	gRídîProgøm
::
	$öô
(
s¸ìnWidth
, 
s¸ìnHeight
)

195 
RídîProgøm
::
s¸ìnWidth
 = screenWidth;

196 
RídîProgøm
::
s¸ìnHeight
 = screenHeight;

200 
gÀwEx≥rimíèl
 = 
åue
;

202 
GLíum
 
îr
=
	`gÀwInô
();

203 if(
îr
!=
GLEW_OK
) {

205 
°d
::
cout
 << "gÀwInô faûed: " << 
	`gÀwGëEº‹Såög
(
îr
Ë<< std::
ídl
;

208 
ba£R™ge
 =

210 {0,
s¸ìnWidth
},

211 {0,
s¸ìnHeight
},

214 
cuºítR™ge
 = 
ba£R™ge
;

216 
	`glBÀndFuncSï¨©e
(
GL_SRC_ALPHA
, 
GL_ONE_MINUS_SRC_ALPHA
, 
GL_ONE
, 
GL_ZERO
);

217 
	`glE«bÀ
(
GL_BLEND
);

218 
	`glE«bÀ
(
GL_DEPTH_TEST
);

219 
	`glE«bÀ
(
GL_PRIMITIVE_RESTART
);

220 
	`glCÀ¨Cﬁ‹
(1,1,1,1);

222 
RídîProgøm
::
löeProgøm
.
	`öô
("../../resources/shaders/vertex/simpleVertex.h","../../resources/shaders/fragment/simpleFragment.h");

223 
glm
::
m©4
 
m©
 = 
	`gëOπho
();

224 
löeProgøm
.
	`£tM©rix4fv
("¥oje˘i⁄",
glm
::
	`vÆue_±r
(
m©
));

225 
RídîProgøm
::
basicProgøm
.
	`öô
("../../resources/shaders/vertex/vertexShader.h","../../resources/shaders/fragment/fragmentShader.h");

226 
basicProgøm
.
	`£tM©rix4fv
("¥oje˘i⁄",
glm
::
	`vÆue_±r
(
m©
));

227 
RídîProgøm
::
∑ötProgøm
.
	`öô
("../../resources/shaders/vertex/vertexShader.h","../../resources/shaders/fragment/paintShader.h");

228 
∑ötProgøm
.
	`£tM©rix4fv
("¥oje˘i⁄",
glm
::
	`vÆue_±r
(
m©
));

229 
	`glGíVîãxAºays
(1,&
VAO
);

230 
	`glGíBuf„rs
(1,&
VBO
);

233 
	}
}

235 
	gglm
::
vec2
 
RídîProgøm
::
	$toAbsﬁuã
(c⁄° 
glm
::
vec2
& 
poöt
)

237 
øtio
 = 
VõwR™ge
::
	`gëXR™ge
(
cuºítR™ge
)/VõwR™ge::gëXR™ge(
ba£R™ge
);

238  {
poöt
.
x
*
VõwR™ge
::
	`gëXR™ge
(
cuºítR™ge
)/VõwR™ge::gëXR™ge(
ba£R™ge
),poöt.
y
*VõwR™ge::
	`gëYR™ge
(currentRange)/ViewRange::getYRange(baseRange)};

239 
	}
}

240 
	gglm
::
vec4
 
RídîProgøm
::
	$toAbsﬁuã
(c⁄° 
glm
::
vec4
& 
ª˘
)

242  
glm
::
	`vec4
(
	`toAbsﬁuã
({
ª˘
.
x
,ª˘.
y
}),toAbsﬁuã({ª˘.
z
,ª˘.
a
}));

243 
	}
}

245 c⁄° 
	gglm
::
vec2
& 
RídîProgøm
::
	$gëXR™ge
()

247  
cuºítR™ge
.
xR™ge
;

248 
	}
}

249 c⁄° 
	gglm
::
vec2
& 
RídîProgøm
::
	$gëYR™ge
()

251  
cuºítR™ge
.
yR™ge
;

252 
	}
}

253 c⁄° 
	gglm
::
vec2
& 
RídîProgøm
::
	$gëZR™ge
()

255  
cuºítR™ge
.
zR™ge
;

256 
	}
}

257 
	gRídîProgøm
::
	$£tXR™ge
(
x1
, 
x2
)

259 
cuºítR™ge
.
xR™ge
.
x
 = 
x1
;

260 
cuºítR™ge
.
xR™ge
.
y
 = 
x2
;

261 
	}
}

262 
	gRídîProgøm
::
	$£tYR™ge
(
y1
, 
y2
)

264 
cuºítR™ge
.
yR™ge
.
x
 = 
y1
;

265 
cuºítR™ge
.
yR™ge
.
y
 = 
y2
;

266 
	}
}

267 
	gRídîProgøm
::
	$£tZR™ge
(
z1
, 
z2
)

269 
cuºítR™ge
.
zR™ge
.
x
 = 
z1
;

270 
cuºítR™ge
.
zR™ge
.
y
 = 
z2
;

271 
	}
}

273 
	gRídîProgøm
::
	$ª£tR™ge
()

275 
cuºítR™ge
 = 
ba£R™ge
;

276 
	}
}

278 
	gglm
::
m©4
 
RídîProgøm
::
	$gëOπho
()

280  (
glm
::
	`‹tho
(
cuºítR™ge
.
xR™ge
.
x
, cuºítR™ge.xR™ge.
y
, cuºítR™ge.
yR™ge
.y, cuºítR™ge.yR™ge.x, cuºítR™ge.
zR™ge
.x, currentRange.zRange.y));

281 
	}
}

283 
	gglm
::
vec2
 
RídîProgøm
::
	$gëS¸ìnDimí
()

285  {
s¸ìnWidth
,
s¸ìnHeight
};

286 
	}
}

288 
	gRídîProgøm
::
	$u£
()

290 
glm
::
m©4
 
m©
 = 
RídîProgøm
::
	`gëOπho
();

291 
	`£tM©rix4fv
("¥oje˘i⁄",
glm
::
	`vÆue_±r
(
m©
));

292 
	`glU£Progøm
(
¥ogøm
);

293 
	}
}

294 
	gRídîProgøm
::
	$£tM©rix4fv
(
°d
::
°rög
 
«me
, c⁄° 
GLÊﬂt
* 
vÆue
)

296 
	`glU£Progøm
(
¥ogøm
);

297 
	`glUnif‹mM©rix4fv
(
	`glGëUnif‹mLoˇti⁄
(
¥ogøm
,
«me
.
	`c_°r
()),1,
GL_FALSE
,
vÆue
);

298 
	`glU£Progøm
(0);

299 
	}
}

300 
	gRídîProgøm
::
	$£tVec3fv
(
°d
::
°rög
 
«me
,
glm
::
vec3
 
vÆue
)

302 
	`glU£Progøm
(
¥ogøm
);

303 
	`glUnif‹m3fv
(
	`glGëUnif‹mLoˇti⁄
(
¥ogøm
,
«me
.
	`c_°r
()),1,
glm
::
	`vÆue_±r
(
vÆue
));

304 
	`glU£Progøm
(0);

305 
	}
}

306 
	gRídîProgøm
::
	$£tVec4fv
(
°d
::
°rög
 
«me
,
glm
::
vec4
 
vÆue
)

308 
	`glU£Progøm
(
¥ogøm
);

309 
	`glUnif‹m4fv
(
	`glGëUnif‹mLoˇti⁄
(
¥ogøm
,
«me
.
	`c_°r
()),1,
glm
::
	`vÆue_±r
(
vÆue
));

310 
	`glU£Progøm
(0);

311 
	}
}

312 
	gRídîProgøm
::
	$£tVec2fv
(
°d
::
°rög
 
«me
, 
glm
::
vec2
 
vÆue
)

314 
	`glU£Progøm
(
¥ogøm
);

315 
	`glUnif‹m2fv
(
	`glGëUnif‹mLoˇti⁄
(
¥ogøm
,
«me
.
	`c_°r
()),1,
glm
::
	`vÆue_±r
(
vÆue
));

316 
	`glU£Progøm
(0);

317 
	}
}

319 
RídîCamîa
* 
	gRídîCamîa
::
cuºítCamîa
 = 
nuŒ±r
;

321 
	gRídîCamîa
::
	$öô
(
w
, 
h
)

323 
ª˘
.
z
 = 
w
;

324 
ª˘
.
a
 = 
h
;

325 
	}
}

327 c⁄° 
	gglm
::
vec4
& 
RídîCamîa
::
	$gëRe˘
() const

329  
ª˘
;

330 
	}
}

332 
	gRídîCamîa
::
	$ª˚¡î
(c⁄° 
glm
::
vec2
& 
poöt
)

334 
ª˘
.
x
 = 
poöt
.x -Ñe˘.
z
/2;

335 
ª˘
.
y
 = 
poöt
.y -Ñe˘.
a
/2;

336 
	}
}

339 
	gglm
::
vec4
 
RídîCamîa
::
	$toS¸ìn
(c⁄° 
glm
::
vec4
& 
ch™ge
) const

341 
glm
::
vec2
 
poöt
 = 
	`toS¸ìn
({
ch™ge
.
x
,ch™ge.
y
});

342  {
poöt
.
x
,poöt.
y
,
ch™ge
.
z
, ch™ge.
a
};

343 
	}
}

345 
	gglm
::
vec2
 
RídîCamîa
::
	$toS¸ìn
(c⁄° 
glm
::
vec2
& 
poöt
) const

348  {(
poöt
.
x
 - 
ª˘
.x), (poöt.
y
 -Ñect.y)};

349 
	}
}

351 
	gglm
::
vec4
 
RídîCamîa
::
	$toW‹ld
(c⁄° 
glm
::
vec4
& 
ch™ge
) const

354 
glm
::
vec2
 
poöt
 = 
	`toW‹ld
({
ch™ge
.
x
,ch™ge.
y
});

355  {
poöt
.
x
,poöt.
y
 , 
ch™ge
.
z
, ch™ge.
a
};

356 
	}
}

358 
	gglm
::
vec2
 
RídîCamîa
::
	$toW‹ld
(c⁄° 
glm
::
vec2
& 
poöt
) const

360 
glm
::
vec2
 
s¸ìnDimí
 = 
RídîProgøm
::
	`gëS¸ìnDimí
();

361  {(
poöt
.
x
/
s¸ìnDimí
.x*
ª˘
.
z
 +Ñe˘.x), (poöt.
y
/s¸ìnDimí.y*ª˘.
a
 +Ñect.y)};

362 
	}
}

364 
	gglm
::
vec4
 
RídîCamîa
::
	$toAbsﬁuã
(c⁄° 
glm
::
vec4
& 
ª˘
) const

366  
glm
::
	`vec4
(
	`toAbsﬁuã
({
ª˘
.
x
,ª˘.
y
}),toAbsﬁuã({ª˘.
z
,ª˘.
a
}));

367 
	}
}

368 
	gglm
::
vec2
 
RídîCamîa
::
	$toAbsﬁuã
(c⁄° 
glm
::
vec2
& 
poöt
) const

375  
RídîProgøm
::
	`toAbsﬁuã
(
poöt
);

376 
	}
}

379 c⁄° 
	gS¥ôe
::
Êﬂts
 = 26;

380 c⁄° 
size_t
 
	gS¥ôe
::
ÊﬂtSize
 = ();

381 
	gS¥ôe
::
	$lﬂd
(
°d
::
°rög
 
sour˚
)

384 
	`glGíVîãxAºays
(1, &
VAO
);

385 
	`glGíBuf„rs
(1,&
VBO
);

386 
	`glGíBuf„rs
(1,&
modVBO
);

388 
	`glBödVîãxAºay
(
VAO
);

390 
	`glGíTextuªs
(1, &
ãxtuª
);

391 
	`glBödTextuª
(
GL_TEXTURE_2D
,
ãxtuª
);

393 
	`glTexP¨amëîi
(
GL_TEXTURE_2D
, 
GL_TEXTURE_WRAP_S
, 
GL_CLAMP_TO_EDGE
);

394 
	`glTexP¨amëîi
(
GL_TEXTURE_2D
, 
GL_TEXTURE_WRAP_T
, 
GL_CLAMP_TO_EDGE
);

395 
	`glTexP¨amëîi
(
GL_TEXTURE_2D
, 
GL_TEXTURE_MIN_FILTER
, 
GL_LINEAR_MIPMAP_LINEAR
);

396 
	`glTexP¨amëîi
(
GL_TEXTURE_2D
, 
GL_TEXTURE_MAG_FILTER
, 
GL_LINEAR
);

398 
ch™√ls
;

400 * 
d©a
 = 
	`°bi_lﬂd
(
sour˚
.
	`c_°r
(),&
width
, &
height
, &
ch™√ls
, 0);

401 
rgb
 = 0;

402 
ch™√ls
)

405 
rgb
 = 
GL_RED
;

408 
rgb
 = 
GL_RG
;

411 
rgb
 = 
GL_RGB
;

414 
rgb
 = 
GL_RGBA
;

415 
å™•¨ít
 = 
åue
;

419 i‡(
d©a
)

421 
	`glTexImage2D
(
GL_TEXTURE_2D
, 0, 
rgb
,
width
, 
height
, 0,Ñgb, 
GL_UNSIGNED_BYTE
, 
d©a
);

422 
	`glGíî©eMùm≠
(
GL_TEXTURE_2D
);

426 
°d
::
cout
 << "Eº‹ÜﬂdögÅextuª: " << 
sour˚
 << std::
ídl
;

431 
	`°bi_image_‰ì
(
d©a
);

432 
	`lﬂdVîti˚s
();

434 
	`glBödVîãxAºay
(0);

435 
	`glBödBuf„r
(
GL_ARRAY_BUFFER
,0);

436 
	}
}

438 
	gS¥ôe
::
	$S¥ôe
–
°d
::
°rög
 
sour˚
)

440 
	`öô
(
sour˚
);

441 
	}
}

442 
	gS¥ôe
::~
	$S¥ôe
()

445 
	`glDñëeTextuªs
(1,&
ãxtuª
);

446 
	}
}

447 
	gS¥ôe
::
	$£tTöt
(
glm
::
vec3
 
cﬁ‹
)

449 
töt
 = 
cﬁ‹
;

450 
	}
}

451 
	gS¥ôe
::
	$öô
(
°d
::
°rög
 
sour˚
)

453 
	`lﬂd
(
sour˚
);

454 
	}
}

455 
	gS¥ôe
::
	$lﬂdVîti˚s
()

458 
	`glBödBuf„r
(
GL_ARRAY_BUFFER
,
VBO
);

459 
	`glBuf„rD©a
(
GL_ARRAY_BUFFER
, (
vÆues
),vÆues, 
GL_STATIC_DRAW
);

460 
	`glE«bÀVîãxAâribAºay
(0);

461 
	`glVîãxAâribPoöãr
(0,4,
GL_FLOAT
,
GL_FALSE
,0,0);

462 
deÁu…Vîticõs
 = 
åue
;

464 
	}
}

465 
	gS¥ôe
::
lﬂdVîti˚s
(c⁄° 
°d
::
ve˘‹
<>& 
vît
)

467 
size
 = 
vît
.size();

468 
	gvîticõs
[
size
];

469 
	gi
 = 0; i < 
	gsize
; i ++)

471 
	gvîticõs
[
i
] = 
vît
[i];

473 
glBödBuf„r
(
GL_ARRAY_BUFFER
,
VBO
);

474 
glBuf„rD©a
(
GL_ARRAY_BUFFER
, (
vîticõs
),vîticõs, 
GL_STATIC_DRAW
);

475 
glE«bÀVîãxAâribAºay
(0);

476 
glVîãxAâribPoöãr
(0,4,
GL_FLOAT
,
GL_FALSE
,0,0);

477 
	gdeÁu…Vîticõs
 = 
Ál£
;

480 
	gS¥ôe
::
	$ª£t
()

482 
	`glBödVîãxAºay
(0);

483 
	`glBödBuf„r
(
GL_ARRAY_BUFFER
,0);

494 
töt
 = {1,1,1};

495 
	}
}

497 
	gãm∂©e
<
˛ass
 
	gT
>

498 
	gS¥ôe
::
	$lﬂdBuf„r
(& 
buf„rs
,
loˇti⁄
, 
T
 
¨r
[], 
size
, 
d©aSize
, 
divis‹
)

500 
	`glGíBuf„rs
(1,&
buf„rs
);

501 
	`glBödBuf„r
(
GL_ARRAY_BUFFER
, 
buf„rs
);

502 
	`glBuf„rD©a
(
GL_ARRAY_BUFFER
, (*
¨r
)*
size
,áº, 
GL_STATIC_DRAW
);

503 
	`glE«bÀVîãxAâribAºay
(
loˇti⁄
);

504 
	`glVîãxAâribPoöãr
(
loˇti⁄
,
d©aSize
,
GL_FLOAT
,
GL_FALSE
,0,0);

505 
	`glVîãxAâribDivis‹
(
loˇti⁄
,
divis‹
);

508 
	}
}

510 
	gS¥ôe
::
	$lﬂdD©a
(
GLÊﬂt
* 
d©a
, c⁄° 
S¥ôeP¨amëî
& 
∑ømëî
, 
ödex
)

512 i‡(
d©a
!
nuŒ±r
)

515 c⁄° 
S¥ôeP¨amëî
* 
cuºít
 = &
∑ømëî
;

517 
glm
::
m©4
 
m©t
 = glm::
	`m©4
(1.0f);

518 
m©t
 = 
glm
::
	`å™¶©e
(m©t,{
cuºít
->
ª˘
.
x
 + (cuºít->ª˘.
z
)/2,cuºít->ª˘.
y
 + (cuºít->ª˘.
a
)/2,0});

519 
m©t
 = 
glm
::
	`rŸ©e
(m©t, 
cuºít
->
ødüns
, glm::
	`vec3
(0,0,1));

520 
m©t
 = 
glm
::
	`sˇÀ
(m©t, {
cuºít
->
ª˘
.
z
/2, cuºít->ª˘.
a
/2,1});

521 c⁄° *
pSour˚
 = (c⁄° *)
glm
::
	`vÆue_±r
(
m©t
);

522 
j
 = 0; j < 16; j++)

524 
d©a
[
j
+
ödex
] =
pSour˚
[j];

526 
d©a
[
ödex
 + 16]
cuºít
->
ef„˘
;

527 
d©a
[
ödex
 + 16 + 1] = 
cuºít
->
töt
.
x
;

528 
d©a
[
ödex
 + 16 + 2] = 
cuºít
->
töt
.
y
;

529 
d©a
[
ödex
 + 16 + 3] = 
cuºít
->
töt
.
z
;

530 
d©a
[
ödex
 + 16 + 4] = 
cuºít
->
töt
.
a
;

531 
d©a
[
ödex
 + 20 + 1] = 
cuºít
->
z
;

532 
d©a
[
ödex
 + 20 + 2] = 
cuºít
->
p‹ti⁄
.
x
;

533 
d©a
[
ödex
 + 20 + 3] = 
cuºít
->
p‹ti⁄
.
y
;

534 
d©a
[
ödex
 + 20 + 4] = 
cuºít
->
p‹ti⁄
.
z
;

535 
d©a
[
ödex
 + 20 + 5] = 
cuºít
->
p‹ti⁄
.
a
;

548 
throw
 
√w
 
°d
::
	`övÆid_¨gumít
("null buffer");

550 
	}
}

552 
	gS¥ôe
::
	$døw
(
RídîProgøm
& 
¥ogøm
, 
GLÊﬂt
* 
d©a
, 
ö°™˚s
)

554 
	`glBödVîãxAºay
(
VAO
);

555 
	`glBödTextuª
(
GL_TEXTURE_2D
,
ãxtuª
);

557 
	`glBödBuf„r
(
GL_ARRAY_BUFFER
,
modVBO
);

558 
GLsizei
 
vec4Size
 = 4*
ÊﬂtSize
;

559 
°ride
 = 
ÊﬂtSize
*
Êﬂts
;

560 
	`glBuf„rD©a
(
GL_ARRAY_BUFFER
,
°ride
*
ö°™˚s
,
d©a
,
GL_STATIC_DRAW
);

561 
	`glVîãxAâribPoöãr
(3, 4, 
GL_FLOAT
, 
GL_FALSE
, 
°ride
, (*)0);

562 
	`glVîãxAâribPoöãr
(4, 4, 
GL_FLOAT
, 
GL_FALSE
, 
°ride
, (*)(
vec4Size
));

563 
	`glVîãxAâribPoöãr
(5, 4, 
GL_FLOAT
, 
GL_FALSE
, 
°ride
, (*)(2 * 
vec4Size
));

564 
	`glVîãxAâribPoöãr
(6, 4, 
GL_FLOAT
, 
GL_FALSE
, 
°ride
, (*)(3 * 
vec4Size
));

565 
	`glVîãxAâribPoöãr
(7, 1, 
GL_FLOAT
, 
GL_FALSE
, 
°ride
, (*)(4*
vec4Size
));

566 
	`glVîãxAâribPoöãr
(8, 4, 
GL_FLOAT
, 
GL_FALSE
, 
°ride
, (*)(4*
vec4Size
 + 
ÊﬂtSize
));

567 
	`glVîãxAâribPoöãr
(9, 1,
GL_FLOAT
, 
GL_FALSE
, 
°ride
, (*)((
Êﬂts
-5)*
ÊﬂtSize
));

568 
	`glVîãxAâribPoöãr
(10, 4, 
GL_FLOAT
, 
GL_FALSE
, 
°ride
, (*)((
Êﬂts
-4)*
ÊﬂtSize
));

569 
	`glE«bÀVîãxAâribAºay
(3);

570 
	`glE«bÀVîãxAâribAºay
(4);

571 
	`glE«bÀVîãxAâribAºay
(5);

572 
	`glE«bÀVîãxAâribAºay
(6);

573 
	`glE«bÀVîãxAâribAºay
(7);

574 
	`glE«bÀVîãxAâribAºay
(8);

575 
	`glE«bÀVîãxAâribAºay
(9);

576 
	`glE«bÀVîãxAâribAºay
(10);

578 
	`glVîãxAâribDivis‹
(3, 1);

579 
	`glVîãxAâribDivis‹
(4, 1);

580 
	`glVîãxAâribDivis‹
(5, 1);

581 
	`glVîãxAâribDivis‹
(6, 1);

582 
	`glVîãxAâribDivis‹
(7, 1);

583 
	`glVîãxAâribDivis‹
(8, 1);

584 
	`glVîãxAâribDivis‹
(9, 1);

585 
	`glVîãxAâribDivis‹
(10, 1);

587 
¥ogøm
.
	`u£
();

588 
	`glDøwEÀmítsIn°™˚d
(
GL_TRIANGLES
,6,
GL_UNSIGNED_INT
,
ödi˚s
,
ö°™˚s
);

589 
	`glBödVîãxAºay
(0);

590 
	`glBödBuf„r
(
GL_ARRAY_BUFFER
,0);

591 
	`ª£t
();

593 
	}
}

595 
	gS¥ôe
::
ªndîIn°™˚d
(
RídîProgøm
& 
¥ogøm
, c⁄° 
°d
::
ve˘‹
<
S¥ôeP¨amëî
>& 
∑ømëîs
)

597 
°ride
 = 
ÊﬂtSize
*
Êﬂts
;

598 
	gsize
 = 
∑ømëîs
.
size
();

599 
GLÊﬂt
* 
	gd©a
 = 
√w
 GLÊﬂt[
gëFlﬂts
()*
size
];

601 
	gi
 = 0; i < 
	gsize
; i ++)

603 
lﬂdD©a
(
d©a
, 
∑ømëîs
[
i
],i*
Êﬂts
);

605 
døw
(
¥ogøm
,
d©a
, 
size
);

606 
	gdñëe
[] 
	gd©a
;

609 
	gS¥ôe
::
	$gëVAO
()

611  
VAO
;

612 
	}
}

614 
	gglm
::
vec2
 
S¥ôe
::
	$gëDimí
()

616  {
width
,
height
};

617 
	}
}

619 
	gS¥ôe
::
	$gëFlﬂts
()

621  
Êﬂts
;

622 
	}
}

625 c⁄° 
	gS¥ôe9
::
Êﬂts9
 = 
S¥ôe
::
Êﬂts
*9;

626 
	gS¥ôe9
::
	$S¥ôe9
(
°d
::
°rög
 
sour˚
, 
glm
::
vec2
 
W
, glm::vec2 
H
Ë: 
	$S¥ôe
(
sour˚
)

628 
widths
 = 
W
;

629 
heights
 = 
H
;

630 
	}
}

631 
	gS¥ôe9
::
	$öô
(
°d
::
°rög
 
sour˚
,
glm
::
vec2
 
W
, glm::vec2 
H
)

633 
S¥ôe
::
	`öô
(
sour˚
);

634 
widths
 = 
W
;

635 
heights
 = 
H
;

636 
	}
}

638 
	gS¥ôe9
::
	$gëFlﬂts
()

640  
Êﬂts9
;

641 
	}
}

643 
	gS¥ôe9
::
	$lﬂdD©a
(
GLÊﬂt
* 
d©a
, c⁄° 
S¥ôeP¨amëî
& 
∑ømëî
, 
ödex
)

645 c⁄° 
S¥ôeP¨amëî
* 
cuºít
 = &
∑ømëî
;

646 
glm
::
vec4
 
ª˘
 = 
cuºít
->rect;

647 
boﬁ
 
tooWide
 = (
widths
.
x
+widths.
y
>
ª˘
.
z
);

648 
boﬁ
 
tooHigh
 = (
heights
.
x
+heights.
y
>
ª˘
.
a
);

649 
glm
::
vec2
 
modW
 = {
widths
.
x
-(widths.x+widths.
y
-
ª˘
.
z
)*.5*
tooWide
,widths.y-(widths.y+widths.x-rect.z)*.5*tooWide};

650 
glm
::
vec2
 
modH
 = {
heights
.
x
-(heights.x+heights.
y
-
ª˘
.
z
)*.5*
tooHigh
,heights.y-(heights.y+heights.x-rect.z)*.5*tooHigh};

652  
g
 = 0; g < 3; g ++)

654 
h‹iz
 = (
ª˘
.
z
-
modW
.
x
-modW.
y
)*!
tooWide
;

655 
vît
 = (
ª˘
.
a
- 
modH
.
x
-modH.
y
)*!
tooHigh
;

656 
h
 = 0; h < 3; h ++)

658 
glm
::
vec4
 
r
 = {
ª˘
.
x
 + 
modW
.x*(
h
 > 0Ë+ (
h‹iz
)*(h>1),

659 
ª˘
.
y
 + 
modH
.
x
*(
g
>0Ë+ (
vît
)*(g>1),

660 
modW
.
x
*(
h
 =0Ë+ 
h‹iz
*(h==1)+modW.
y
*(h==2),

661 
modH
.
x
*(
g
==0Ë+ 
vît
 * (g =1Ë+ modH.
y
*(g==2)};

662 
glm
::
vec2
 
˚¡î
 = 
	`rŸ©ePoöt
({
r
.
x
+r.
z
/2,r.
y
+r.
a
/2},{
ª˘
.x +Ñe˘.z/2,Ñe˘.y +Ñe˘.a/2},
cuºít
->
ødüns
);

663 
S¥ôe
::
	`lﬂdD©a
(
d©a
,{{
˚¡î
.
x
 - 
r
.
z
/2,˚¡î.
y
 -Ñ.
a
/2,r.z,r.a},

664 
cuºít
->
ødüns
,
NONE
,cuºít->
töt
,cuºít->
¥ogøm
,
∑ømëî
.
z
,{1.0/3*
h
,(1.0/3)*
g
,1.0/3,1.0/3}}, 
ödex
 + (g*3+h)*
Êﬂts
);

667 
	}
}

670 
	gBa£Anim©i⁄
::
	$Ba£Anim©i⁄
(
°d
::
°rög
 
sour˚
, 
•ìd
, 
≥rRow
, 
rows
, c⁄° 
glm
::
vec4
& 
sub
)

672 
	`öô
(
sour˚
,
•ìd
,
≥rRow
,
rows
, 
sub
);

673 
	}
}

675 
	gBa£Anim©i⁄
::
	$gëFømes
()

677  
subSe˘i⁄
.
z
*subSe˘i⁄.
a
;

678 
	}
}

680 
	gBa£Anim©i⁄
::
	$gëDuøti⁄
(
•ìd
)

682 i‡(
•ìd
 == -1)

684 
•ìd
 = 
Âs
;

686  1000/
•ìd
*
subSe˘i⁄
.
z
*subSe˘i⁄.
a
;

687 
	}
}

689 
	gglm
::
vec2
 
Ba£Anim©i⁄
::
	$gëDimí
()

691  {
‰ameDimí
.
x
*
width
,‰ameDimí.
y
*
height
};

692 
	}
}

694 
	gglm
::
vec4
 
Ba£Anim©i⁄
::
	$gëP‹ti⁄
(c⁄° 
Anim©i⁄P¨amëî
& 
∑øm
)

697 
glm
::
vec4
 
backup
 = 
subSe˘i⁄
;

698 i‡(
∑øm
.
subSe˘i⁄
.
z
 !0 ||Ö¨am.subSe˘i⁄.
a
 != 0)

700 
subSe˘i⁄
 = 
∑øm
.subSection;

702 
≥rRow
 = 
subSe˘i⁄
.
z
;

703 
rows
 = 
subSe˘i⁄
.
a
;

704 
‰amesSö˚
 = 
∑øm
.
°¨t
;

705 i‡(
∑øm
.
°¨t
 < 0 )

707 
‰amesSö˚
 = ((
∑øm
.
Âs
 =-1)*Â†+ (∑øm.Â†!-1)*∑øm.Âs)*(
	`SDL_GëTicks
(Ë+Ö¨am.
°¨t
)/1000.0;

710 
glm
::
vec4
 
™swî
 = {
‰ameDimí
.
x
*(
‰amesSö˚
%(
≥rRow
)Ë+ 
subSe˘i⁄
.x,

711 (
‰ameDimí
.
y
*((
‰amesSö˚
/
≥rRow
)%
rows
)Ë+ 
subSe˘i⁄
.y,‰ameDimí.
x
, frameDimen.y};

713 
subSe˘i⁄
 = 
backup
;

715  
™swî
;

716 
	}
}

718 
S¥ôeP¨amëî
 
	gBa£Anim©i⁄
::
	$¥o˚ssP¨am
(c⁄° 
S¥ôeP¨amëî
& 
sP¨am
,c⁄° 
Anim©i⁄P¨amëî
& 
aP¨am
)

721 
S¥ôeP¨amëî
 
∑øm
 = 
sP¨am
;

722 i‡(
aP¨am
.
å™sf‹m
 &&áP¨am.
ˇmîa
)

724 
∑øm
.
ª˘
 = ((
aP¨am
.
ˇmîa
)->*◊P¨am.
å™sf‹m
))(param.rect);

729 
glm
::
vec4
 
p‹ti⁄
 = 
	`gëP‹ti⁄
(
aP¨am
);

730 
∑øm
.
p‹ti⁄
 = {∑øm.p‹ti⁄.
x
 +Ö‹ti⁄.x,Ö¨am.p‹ti⁄.
y
 +Ö‹ti⁄.y,Ö¨am.p‹ti⁄.
z
*p‹ti⁄.z,Ö¨am.p‹ti⁄.
a
*portion.a};

731  
∑øm
;

732 
	}
}

734 
	gBa£Anim©i⁄
::
	$öô
(
°d
::
°rög
 
sour˚
, 
•ìd
, 
≥rRow
, 
rows
, c⁄° 
glm
::
vec4
& 
sub
)

736 
S¥ôe
::
	`öô
(
sour˚
);

737 
Âs
 = 
•ìd
;

738 
‰ameDimí
.
x
 = 1.0/(
≥rRow
);

739 
‰ameDimí
.
y
 = 1.0/(
rows
);

740 
subSe˘i⁄
 = 
sub
;

741 i‡(
sub
.
z
 == 0)

743 
subSe˘i⁄
.
z
 = 
≥rRow
;

745 i‡(
sub
.
a
 == 0)

747 
subSe˘i⁄
.
a
 = 
rows
;

749 
	}
}

750 
	gBa£Anim©i⁄
::
ªndîIn°™˚d
(
RídîProgøm
& 
¥ogøm
, c⁄° 
°d
::
li°
<
FuŒAnim©i⁄P¨amëî
>& 
∑ømëîs
)

752 autÿ
size
 = 
∑ømëîs
.
íd
();

753 
	g°d
::
ve˘‹
<
S¥ôeP¨amëî
> 
∑øms
;

754 
	g≥rRow
 = 
subSe˘i⁄
.
z
;

755 
	grows
 = 
subSe˘i⁄
.
a
;

756 autÿ
	gi
 = 
∑ømëîs
.
begö
(); i !
size
; ++i)

758 
	g∑øms
.
push_back
(
¥o˚ssP¨am
(
i
->
fú°
,i->
£c⁄d
));

760 
	gS¥ôe
::
ªndîIn°™˚d
(
¥ogøm
, 
∑øms
);

763 
	gBa£Anim©i⁄
::
ªndîIn°™˚d
(
RídîProgøm
& 
¥ogøm
, c⁄° 
°d
::
ve˘‹
<
S¥ôeP¨amëî
>& 
∑ømëîs
)

765 
size
 = 
∑ømëîs
.size();

766 
	g°d
::
ve˘‹
<
S¥ôeP¨amëî
> 
∑øms
;

767 
	g≥rRow
 = 
subSe˘i⁄
.
z
;

768 
	grows
 = 
subSe˘i⁄
.
a
;

769 
	gi
 = 0; i < 
	gsize
; i ++)

771 
S¥ôeP¨amëî
 
	g∑øm
 = 
∑ømëîs
[
i
];

774 
	g∑øm
.
	gp‹ti⁄
 = 
gëP‹ti⁄
({
SDL_GëTicks
(),-1});

775 
	g∑øms
.
push_back
({
∑øm
});

777 
	gS¥ôe
::
ªndîIn°™˚d
(
¥ogøm
, 
∑øms
);

780 
	g°d
::
ve˘‹
<
S¥ôeWøµî
*> 
S¥ôeM™agî
::
•rôes
;

781 
	g°d
::
m≠
<
zWøµî
,°d::
li°
<
S¥ôeP¨amëî
>,
	gS¥ôeM™agî
::
ZWøµîCom∑øt‹
> 
S¥ôeM™agî
::
∑øms
;

782 
	gS¥ôeWøµî
::
	$öô
(
°d
::
°rög
 
sour˚
)

784 
•r
 = 
√w
 
	`S¥ôe
(
sour˚
);

785 
S¥ôeM™agî
::
	`addS¥ôe
(*
this
);

786 
	}
}

788 
	gS¥ôeWøµî
::
	$öô
(
S¥ôe
* 
•rôe
)

790 
•r
 = 
•rôe
;

791 
S¥ôeM™agî
::
	`addS¥ôe
(*
this
);

792 
	}
}

794 
	gS¥ôeWøµî
::
	$ªque°
(c⁄° 
S¥ôeP¨amëî
& 
∑øm
)

796 
S¥ôeM™agî
::
	`ªque°
(*
this
,
∑øm
);

797 
	}
}

799 
	gS¥ôeWøµî
::
	$ª£t
()

802 
	}
}

804 
S¥ôeWøµî
::
ªndî
(c⁄° 
°d
::
li°
<
S¥ôeP¨amëî
>& 
∑ømëîs
, 
zMod
)

806 i‡(
	g•r
)

808 autÿ
	gíd
 = 
∑ømëîs
.
íd
();

809 
	gsize
 = 
∑ømëîs
.
size
();

811 
	gÊﬂts
 = 
•r
->
gëFlﬂts
();

812 
GLÊﬂt
* 
	gd©a
 = 
√w
 GLÊﬂt[
size
*
Êﬂts
];

813 
glBödVîãxAºay
(
•r
->
VAO
);

814 
glBödTextuª
(
GL_TEXTURE_2D
,
•r
->
ãxtuª
);

815 
glBödBuf„r
(
GL_ARRAY_BUFFER
,
•r
->
modVBO
);

816 
	gödex
 = 0;

817 
	gi
 = 0;

819 
S¥ôeP¨amëî
 
	gcuºít
;

821 autÿ
	gô
 = 
∑ømëîs
.
begö
(); ià!
íd
; ++it)

823 
	gcuºít
 = *
ô
;

826 
	g•r
->
lﬂdD©a
(
d©a
, 
cuºít
, 
ödex
*
Êﬂts
);

827 
	gödex
 ++;

828 i‡(
	gi
 =
size
 - 1 || ((
°d
::
√xt
(
ô
))->
¥ogøm
 !
cuºít
.program ) )

830 
•r
->
døw
(*(
cuºít
.
¥ogøm
),
d©a
,(
ödex
)*
Êﬂts
/spr->floats);

831 
	gödex
 = 0;

832 
	gdñëe
[] 
	gd©a
;

833 i‡(
	gi
 !
size
 - 1)

835 
d©a
 = 
√w
 
GLÊﬂt
[(
size
-
i
-1)*
Êﬂts
];

839 
	gi
 ++;

841 
glBödVîãxAºay
(0);

842 
glBödBuf„r
(
GL_ARRAY_BUFFER
,0);

843 
	g•r
->
ª£t
();

847 
S¥ôe
* 
	gS¥ôeWøµî
::
	$gëS¥ôe
()

849  
•r
;

850 
	}
}

852 
	gglm
::
vec2
 
S¥ôeWøµî
::
	$gëDimí
()

854 i‡(!
	`isRódy
())

856 
throw
 
°d
::
	`logic_îr‹
("TriedÅo get dimensions of uninitialized SpriteWrapper!");

858  
•r
->
	`gëDimí
();

859 
	}
}

861 
boﬁ
 
	gS¥ôeWøµî
::
	$isRódy
()

863  
•r
;

864 
	}
}

866 
	gS¥ôeWøµî
::~
	$S¥ôeWøµî
()

868 
	`ª£t
();

869 
dñëe
 
•r
;

870 
	}
}

872 
Ba£Anim©i⁄
* 
	gAnim©i⁄Wøµî
::
	$gëAnim©i⁄
()

874  
°©ic_ˇ°
<
Ba£Anim©i⁄
*>(
•r
);

875 
	}
}

877 
	gAnim©i⁄Wøµî
::
	$öô
(
Ba£Anim©i⁄
* 
a
)

879 
S¥ôeWøµî
::
	`öô
(
a
);

880 
	}
}

881 
	gAnim©i⁄Wøµî
::
	$ª£t
()

883 autÿ
íd
 = 
aP¨amëîs
.
	`íd
();

884 autÿ
i
 = 
aP¨amëîs
.
	`begö
(); i !
íd
;)

886 i‡(
i
->
£c⁄d
.
ª≥©
 <= 0)

888 
i

aP¨amëîs
.
	`îa£
(i);

892 
glm
::
vec4
 
p‹ti⁄
 = 
°©ic_ˇ°
<
Ba£Anim©i⁄
*>(
•r
)->
	`gëP‹ti⁄
(
i
->
£c⁄d
);

893 i‡(
p‹ti⁄
.
x
 +Ö‹ti⁄.
z
 =1 &&Ö‹ti⁄.
y
 +Ö‹ti⁄.
a
 == 1)

895 
i
->
£c⁄d
.
ª≥©
 --;

897 ++
i
;

900 
S¥ôeWøµî
::
	`ª£t
();

901 
	}
}

903 
	gAnim©i⁄Wøµî
::
	$ªque°
(c⁄° 
S¥ôeP¨amëî
& 
∑øm
)

905 
	`ªque°
(
∑øm
,{});

906 
	}
}

908 
	gAnim©i⁄Wøµî
::
	$ªque°
(c⁄° 
S¥ôeP¨amëî
& 
sP¨am
, c⁄° 
Anim©i⁄P¨amëî
& 
aP¨am
)

910 
S¥ôeWøµî
::
	`ªque°
(
°©ic_ˇ°
<
Ba£Anim©i⁄
*>(
•r
)->
	`¥o˚ssP¨am
(
sP¨am
,
aP¨am
));

911 
	}
}

912 
	gAnim©i⁄Wøµî
::~
	$Anim©i⁄Wøµî
()

914 
	`ª£t
();

915 
	}
}

917 
	gS¥ôeM™agî
::
	$addS¥ôe
(
S¥ôeWøµî
& 
•r
)

919 
•rôes
.
	`push_back
(&
•r
);

920 
	}
}

922 
	gS¥ôeM™agî
::
	$ªque°
(
S¥ôeWøµî
& 
wøµî
, c⁄° 
S¥ôeP¨amëî
& 
∑øm
)

924 
∑øms
[{
∑øm
.
z
,&
wøµî
}].
	`push_back
(param);

925 
	}
}

927 
	gS¥ôeM™agî
::
	$ªndî
()

929 
i
= 0;

930 autÿ
íd
 = 
∑øms
.
	`íd
();

931 
boﬁ
 
shouldBeE«bÀd
 = 
	`glIsE«bÀd
(
GL_DEPTH_TEST
Ë=
GL_TRUE
;

932 i‡(
shouldBeE«bÀd
)

934 
	`glDißbÀ
(
GL_DEPTH_TEST
);

936 autÿ
ô
 = 
∑øms
.
	`begö
(); ià!
íd
; ++it)

938 
ô
->
fú°
.
£c⁄d
->
	`ªndî
(it->second,0);

939 ++
i
;

941 i‡(
shouldBeE«bÀd
)

943 
	`glE«bÀ
(
GL_DEPTH_TEST
);

945 
∑øms
.
	`˛ór
();

952 
	}
}

954 
	gPﬁyRídî
::
VAO
 = -1;

955 
	gPﬁyRídî
::
löeVBO
 = -1;

956 
	gPﬁyRídî
::
pﬁyVBO
 = -1;

957 
	gPﬁyRídî
::
cﬁ‹VBO
 = -1;

958 
	gPﬁyRídî
::
ª°¨t
 = 65535;

959 
RídîProgøm
 
	gPﬁyRídî
::
pﬁyRídîî
;

960 
	g°d
::
ve˘‹
<
°d
::
∑ú
<
glm
::
vec3
,
	gglm
::
vec4
>> 
PﬁyRídî
::
löes
;

961 
	gPﬁySt‹age
<
	gglm
::
vec4
> 
PﬁyRídî
::
pﬁyCﬁ‹s
;

962 
	gPﬁySt‹age
<
	gglm
::
vec3
> 
PﬁyRídî
::
pﬁyPoöts
;

963 
	gPﬁySt‹age
<
	gGLuöt
> 
	gPﬁyRídî
::
pﬁyIndi˚s
;

964 
	gPﬁyRídî
::
pﬁyg⁄Reque°s
 = 0;

965 
	gPﬁyRídî
::
	$öô
(
s¸ìnWidth
, 
s¸ìnHeight
)

967 
	`glGíVîãxAºays
(1,&
VAO
);

968 
	`glGíBuf„rs
(1,&
löeVBO
);

969 
	`glGíBuf„rs
(1,&
cﬁ‹VBO
);

970 
	`glGíBuf„rs
(1,&
pﬁyVBO
);

974 
pﬁyRídîî
.
	`öô
("../../resources/shaders/vertex/polygonVertex.h","../../resources/shaders/fragment/simpleFragment.h");

976 
	`glPrimôiveRe°¨tIndex
(
ª°¨t
);

977 
	`glE«bÀ
(
GL_PRIMITIVE_RESTART
);

979 
	}
}

981 
	gPﬁyRídî
::
	$ªque°Löe
(c⁄° 
glm
::
vec4
& 
löe
, c⁄° glm::vec4& 
cﬁ‹
, 
z
, 
thick√ss
, 
RídîCamîa
* 
ˇmîa
)

983 
	`ªque°Gødõ¡Löe
(
löe
,
cﬁ‹
,cﬁ‹,
z
,
thick√ss
,
ˇmîa
);

984 
	}
}

986 
	gPﬁyRídî
::
	$ªque°Gødõ¡Löe
(c⁄° 
glm
::
vec4
& 
löe
, c⁄° glm::vec4& 
cﬁ‹1
, c⁄° glm::vec4& 
cﬁ‹2
, 
z
, 
thick√ss
, 
RídîCamîa
* 
ˇmîa
)

990 
di°
 = 
	`sqπ
(
	`pow
(
löe
.
y
 -Üöe.
a
,2Ë+Öow÷öe.
x
 -Üöe.
z
,2));

991 
glm
::
vec2
 
≥ΩVe˘‹
 = {-(
löe
.
y
 -Üöe.
a
)/
di°
,÷öe.
x
 -Üöe.
z
)/dist};

992 
i
 = 0; i < 
thick√ss
; ++i)

994 
glm
::
vec2
 
p1
 = glm::
	`vec2
(
löe
.
x
,löe.
y
);

995 
glm
::
vec2
 
p2
 = glm::
	`vec2
(
löe
.
z
,löe.
a
);

996 i‡(
thick√ss
 > 1)

998 
glm
::
vec2
 
di•
 = 
≥ΩVe˘‹
*(
thick√ss
/2.0f-
i
);

999 
p1
 +
di•
;

1000 
p2
 +
di•
;

1002 i‡(
ˇmîa
)

1004 
p1
 = 
ˇmîa
->
	`toS¸ìn
(p1);

1005 
p2
 = 
ˇmîa
->
	`toS¸ìn
(p2);

1007 
löes
.
	`push_back
(
°d
::
∑ú
<
glm
::
vec3
,glm::
vec4
>(glm::
	`vec3
(
p1
,
z
),
cﬁ‹1
));

1008 
löes
.
	`push_back
(
°d
::
∑ú
<
glm
::
vec3
, glm::
vec4
>(glm::
	`vec3
(
p2
,
z
),
cﬁ‹2
));

1010 
	}
}

1011 
	gPﬁyRídî
::
	$ªque°Cú˛e
–c⁄° 
glm
::
vec4
& 
cﬁ‹
,c⁄° glm::
vec2
& 
˚¡î
, 
ødius
, 
boﬁ
 
fûÀd
, 
z
)

1013 
	`ªque°NG⁄
(360,
˚¡î
,
ødius
,
cﬁ‹
,0,
fûÀd
,
z
,
åue
);

1014 
	}
}

1016 
	gglm
::
vec2
 
	$Êo‹Vec
(c⁄° 
glm
::
vec2
& 
vec
)

1018  {
	`Êo‹
(
vec
.
x
),Êo‹(vec.
y
)};

1019 
	}
}

1021 
	gPﬁyRídî
::
	$ªque°Re˘
(c⁄° 
glm
::
vec4
& 
ª˘
, c⁄° glm::vec4& 
cﬁ‹
, 
boﬁ
 
fûÀd
, 
™gÀ
, 
z
)

1023 
glm
::
vec2
 
t›Le·
 = {
ª˘
.
x
,ª˘.
y
};

1024 
glm
::
vec2
 
t›Right
 = {
ª˘
.
x
 +Ñe˘.
z
,Ñe˘.
y
};

1025 
glm
::
vec2
 
bŸLe·
 = {
ª˘
.
x
,ª˘.
y
 +Ñe˘.
a
};

1026 
glm
::
vec2
 
bŸRight
 = {
t›Right
.
x
,
bŸLe·
.
y
};

1027 i‡(
™gÀ
 != 0)

1029 
glm
::
vec2
 
˚¡î
 = {
ª˘
.
x
 +Ñe˘.
z
/2,Ñe˘.
y
 +Ñe˘.
a
/2};

1030 
t›Le·
 = 
	`Êo‹Vec
(
	`rŸ©ePoöt
—›Le·,
˚¡î
,
™gÀ
));

1031 
t›Right
 = 
	`Êo‹Vec
(
	`rŸ©ePoöt
—›Right,
˚¡î
,
™gÀ
));

1032 
bŸLe·
 = 
	`Êo‹Vec
(
	`rŸ©ePoöt
(bŸLe·,
˚¡î
,
™gÀ
));

1033 
bŸRight
 = 
	`Êo‹Vec
(
	`rŸ©ePoöt
(bŸRight, 
˚¡î
, 
™gÀ
));

1035 i‡(
fûÀd
)

1037 
size
 = 
pﬁyIndi˚s
.
	`size
(Ë- 
pﬁyg⁄Reque°s
;

1038 
i
 = 0;i < 4; ++i)

1040 
pﬁyCﬁ‹s
.
	`push_back
(
cﬁ‹
);

1041 
pﬁyIndi˚s
.
	`push_back
(
size
 + 
i
);

1043 
pﬁyIndi˚s
.
	`push_back
(
ª°¨t
);

1044 
pﬁyPoöts
.
	`push_back
({
t›Le·
.
x
,t›Le·.
y
,
z
});

1045 
pﬁyPoöts
.
	`push_back
({
t›Right
.
x
,t›Right.
y
,
z
});

1046 
pﬁyPoöts
.
	`push_back
({
bŸLe·
.
x
,bŸLe·.
y
,
z
});

1047 
pﬁyPoöts
.
	`push_back
({
bŸRight
.
x
,bŸRight.
y
,
z
});

1048 
pﬁyg⁄Reque°s
++;

1052 
	`ªque°Löe
({
t›Le·
.
x
,t›Le·.
y
,
t›Right
.x,t›Right.y},
cﬁ‹
,
z
);

1053 
	`ªque°Löe
({
t›Le·
.
x
,t›Le·.
y
,
bŸLe·
.x,bŸLe·.y},
cﬁ‹
,
z
);

1054 
	`ªque°Löe
({
bŸLe·
.
x
,bŸLe·.
y
,
bŸRight
.x,bŸRight.y},
cﬁ‹
,
z
);

1055 
	`ªque°Löe
({
bŸRight
.
x
,bŸRight.
y
,
t›Right
.x,t›Right.y},
cﬁ‹
,
z
);

1057 
	}
}

1059 
	gPﬁyRídî
::
	$ªque°NG⁄
(
n
, c⁄° 
glm
::
vec2
& 
˚¡î
, 
side
, c⁄° glm::
vec4
& 
cﬁ‹
, 
™gÀ
, 
boﬁ
 
fûÀd
, 
z
, boﬁ 
ødius
)

1062 
cy˛eAngÀ
 = 2.0/
n
*
M_PI
;

1063 i‡(
ødius
)

1065 
side
 = 2*side*
	`sö
(
M_PI
/
n
);

1069 
glm
::
vec2
 
fú°
 = {
˚¡î
.
x
 - 
side
/2, cíãr.
y
 + side/2/
	`èn
(
cy˛eAngÀ
/2)};

1070 i‡(
™gÀ
 != 0)

1072 
fú°
 = 
	`rŸ©ePoöt
(fú°,
˚¡î
,
™gÀ
);

1074 
glm
::
vec2
 
√xt
 = 
fú°
;

1075 i‡(
fûÀd
)

1077 
glm
::
vec2
 
ãmp
;

1078 
pﬁyPoöts
.
	`push_back
({
fú°
.
x
,fú°.
y
,
z
});

1079 
pﬁyCﬁ‹s
.
	`push_back
(
cﬁ‹
);

1080 
ödicõs
 = 
pﬁyIndi˚s
.
	`size
(Ë- 
pﬁyg⁄Reque°s
;

1081 
pﬁyIndi˚s
.
	`push_back
(
ödicõs
);

1082 
i
 = 1; i < 
n
; ++i)

1084 
ãmp
 = 
√xt
;

1085 
√xt
 = 
	`rŸ©ePoöt
(
fú°
, 
˚¡î
,
cy˛eAngÀ
*((
i
%2)*2-1));

1086 
fú°
 = 
ãmp
;

1087 
pﬁyPoöts
.
	`push_back
({
√xt
.
x
,√xt.
y
,
z
});

1088 
pﬁyCﬁ‹s
.
	`push_back
(
cﬁ‹
);

1089 
pﬁyIndi˚s
.
	`push_back
(
ödicõs
 + 
i
);

1091 
pﬁyIndi˚s
.
	`push_back
(
ª°¨t
);

1092 
pﬁyg⁄Reque°s
++;

1097 
i
 = 0; i < 
n
; ++i)

1099 
√xt
 = 
	`rŸ©ePoöt
(
fú°
, 
˚¡î
,
cy˛eAngÀ
);

1100 
	`ªque°Löe
({
fú°
.
x
,fú°.
y
,
√xt
.x,√xt.y},
cﬁ‹
,
z
);

1102 
fú°
 = 
√xt
;

1106 
	}
}

1108 
	gPﬁyRídî
::
ªque°Pﬁyg⁄
(c⁄° 
°d
::
ve˘‹
<
glm
::
vec3
>& 
poöts
, c⁄° glm::
vec4
& 
cﬁ‹
)

1110 
size
 = 
poöts
.size(Ë- 
pﬁyg⁄Reque°s
;

1111 
	gödi˚s

pﬁyIndi˚s
.
size
();

1112 
	gi
 = 0; i < 
	gsize
; ++i)

1114 
	gpﬁyPoöts
.
push_back
(
poöts
[
i
]);

1115 
	gpﬁyCﬁ‹s
.
push_back
(
cﬁ‹
);

1116 
	gpﬁyIndi˚s
.
push_back
(
ödi˚s
 +
i
);

1118 
	gpﬁyg⁄Reque°s
 ++;

1122 
	gPﬁyRídî
::
	$ªndîLöes
()

1124 
	`glBödVîãxAºay
(
VAO
);

1125 
size
 = 
löes
.
	`size
();

1126 
vîtSize
 = 
size
*3;

1127 
cﬁ‹Size
 = 
size
*4;

1128 
size_t
 
ÊﬂtSize
 = (
GLÊﬂt
);

1129 
GLÊﬂt
* 
vîticõs
 = 
√w
 GLÊﬂt[
size
*3];

1130 
GLÊﬂt
* 
cﬁ‹s
 = 
√w
 GLÊﬂt[
size
*4];

1131 
i
 = 0; i < 
size
; i ++)

1133 
	`addPoötToBuf„r
(
vîticõs
,
löes
[
i
].
fú°
,i*3);

1135 
	`addPoötToBuf„r
(
cﬁ‹s
,
löes
[
i
].
£c⁄d
,i*4);

1138 
	`glBödBuf„r
(
GL_ARRAY_BUFFER
,
löeVBO
);

1139 
	`glBuf„rD©a
(
GL_ARRAY_BUFFER
,
vîtSize
*
ÊﬂtSize
,
vîticõs
,
GL_STATIC_DRAW
);

1140 
	`glVîãxAâribPoöãr
(0,3,
GL_FLOAT
,
GL_FALSE
,0,(*)0);

1141 
	`glE«bÀVîãxAâribAºay
(0);

1144 
	`glBödBuf„r
(
GL_ARRAY_BUFFER
, 
cﬁ‹VBO
);

1145 
	`glBuf„rD©a
(
GL_ARRAY_BUFFER
,
cﬁ‹Size
*
ÊﬂtSize
, 
cﬁ‹s
, 
GL_STATIC_DRAW
);

1146 
	`glVîãxAâribPoöãr
(1,4,
GL_FLOAT
,
GL_FALSE
,0,(*)0);

1147 
	`glE«bÀVîãxAâribAºay
(1);

1150 
pﬁyRídîî
.
	`u£
();

1152 
	`glDøwAºays
(
GL_LINES
,0,
size
);

1153 
	`glBödVîãxAºay
(0);

1154 
	`glBödBuf„r
(
GL_ARRAY_BUFFER
,0);

1155 
löes
.
	`˛ór
();

1157 
dñëe
 [] 
vîticõs
;

1158 
dñëe
 [] 
cﬁ‹s
;

1159 
	}
}

1161 
	gPﬁyRídî
::
	$ªndîPﬁyg⁄s
()

1163 
	`glBödVîãxAºay
(
VAO
);

1165 
	`glBödBuf„r
(
GL_ARRAY_BUFFER
,
pﬁyVBO
);

1166 
	`glBuf„rD©a
(
GL_ARRAY_BUFFER
,
pﬁyPoöts
.
	`size
()*(
GLÊﬂt
)*3,&pﬁyPoöts[0],
GL_STATIC_DRAW
);

1167 
	`glVîãxAâribPoöãr
(0,3,
GL_FLOAT
,
GL_FALSE
,0,(*)0);

1168 
	`glE«bÀVîãxAâribAºay
(0);

1171 
	`glBödBuf„r
(
GL_ARRAY_BUFFER
, 
cﬁ‹VBO
);

1172 
	`glBuf„rD©a
(
GL_ARRAY_BUFFER
,
pﬁyCﬁ‹s
.
	`size
()*(
GLÊﬂt
)*4, &pﬁyCﬁ‹s[0], 
GL_STATIC_DRAW
);

1173 
	`glVîãxAâribPoöãr
(1,4,
GL_FLOAT
,
GL_FALSE
,0,(*)0);

1174 
	`glE«bÀVîãxAâribAºay
(1);

1177 
pﬁyRídîî
.
	`u£
();

1178 
	`glDøwEÀmíts
(
GL_TRIANGLE_STRIP
,
pﬁyIndi˚s
.
	`size
(),
GL_UNSIGNED_INT
,&polyIndices[0]);

1180 
	`glBödBuf„r
(
GL_ARRAY_BUFFER
,0);

1181 
	`glBödVîãxAºay
(0);

1184 
pﬁyPoöts
.
	`˛ór
();

1185 
pﬁyCﬁ‹s
.
	`˛ór
();

1186 
pﬁyIndi˚s
.
	`˛ór
();

1187 
pﬁyg⁄Reque°s
 = 0;

1193 
	}
}

1195 
	gPﬁyRídî
::
	$ªndîMesh
(* 
mesh
, 
w
, 
h
)

1198 
	}
}

1200 
	gPﬁyRídî
::
	$ªndî
()

1202 i‡(
löes
.
	`size
() > 0)

1204 
	`ªndîLöes
();

1206 i‡(
pﬁyCﬁ‹s
.
	`size
() > 0)

1208 
	`ªndîPﬁyg⁄s
();

1210 
	}
}

1212 
	gAnim©i⁄Sequí˚r
::
	$gëSèãIndex
(
‰ameSèπ
,* 
timeSö˚_
)

1214 
timeSö˚
 = (
	`SDL_GëTicks
(Ë- 
‰ameSèπ
)%
fuŒDuøti⁄
;

1215 
ödex
 = 
öfoSize
 - 1;

1216 
i
 = 0; i < 
öfoSize
; ++i)

1219 i‡(
timeSö˚
 - 
öfo
[
i
].
x
 <= 0)

1221 
ödex
 = 
°d
::
	`max
(
i
,0);

1224 
timeSö˚
 -
öfo
[
i
].
x
;

1226 i‡(
timeSö˚_
)

1228 *
timeSö˚_
 = 
timeSö˚
;

1230  
ödex
;

1231 
	}
}

1233 
	gAnim©i⁄Sequí˚r
::
Anim©i⁄Sequí˚r
(c⁄° 
°d
::
ve˘‹
<
glm
::
vec2
>& 
ba£Info
)

1235 
öfo
 = 
√w
 
glm
::
vec3
[
ba£Info
.
size
()];

1236 
	göfoSize
 = 
ba£Info
.
size
();

1237 
	gi
 = 0; i < 
	göfoSize
; ++i)

1239 
	göfo
[
i
] = {
ba£Info
[i].
x
,ba£Info[i].
y
,
tŸÆFømes
};

1240 
	gfuŒDuøti⁄
 +
ba£Info
[
i
].
x
;

1241 
	gtŸÆFømes
 +
ba£Info
[
i
].
y
;

1245 
Anim©i⁄P¨amëî
 
	gAnim©i⁄Sequí˚r
::
	$¥o˚ss
(
‰ameSèπ
)

1248 
timeSö˚
 = 0;

1249 
ödex
 = 
	`gëSèãIndex
(
‰ameSèπ
,&
timeSö˚
);

1250 
Anim©i⁄P¨amëî
 
∑øm
;

1251 
∑øm
.
Âs
 = 1000.0*
öfo
[
ödex
].
y
/öfo[ödex].
x
;

1252 
∑øm
.
°¨t
 = 
	`fmod
((
timeSö˚
*
öfo
[
ödex
].
y
/öfo[ödex].
x
 + info[ödex].
z
),
tŸÆFømes
);

1254  
∑øm
;

1255 
	}
}

1257 
	gAnim©i⁄Sequí˚r
::
	$gëSèãIndex
(
‰ameSèπ
)

1259 i‡(
	`isD⁄e
(
‰ameSèπ
))

1263  
	`gëSèãIndex
(
‰ameSèπ
,
nuŒ±r
);

1264 
	}
}

1266 
boﬁ
 
	gAnim©i⁄Sequí˚r
::
	$isD⁄e
(
‰ameSèπ
)

1268  
	`SDL_GëTicks
(Ë- 
‰ameSèπ
 >
fuŒDuøti⁄
;

1269 
	}
}

1271 
	gAnim©i⁄Sequí˚r
::~
	$Anim©i⁄Sequí˚r
()

1274 
	}
}

	@C:\Users\leoou\OneDrive\Desktop\resources\render.h

1 #i‚de‡
SPRITES_H_INCLUDED


2 
	#SPRITES_H_INCLUDED


	)

4 
	~<io°ªam
>

6 
	~<ve˘‹
>

7 
	~<m≠
>

8 
	~<li°
>

9 
	~"gÀw.h
"

11 
	~"glm.hµ
"

12 
	~"gtc/m©rix_å™sf‹m.hµ
"

13 
	~"gtc/ty≥_±r.hµ
"

15 
	~"v™ûœ.h
"

17 
˛ass
 
	gRídîProgøm
;

18 
døwLöe
(
RídîProgøm
& 
¥ogøm
,
glm
::
vec3
 
cﬁ‹
,c⁄° 
°d
::
ve˘‹
<glm::
vec4
>& 
poöts
);

19 
døwCú˛e
(
RídîProgøm
& 
¥ogøm
, 
glm
::
vec3
 
cﬁ‹
,
x
, 
y
, 
ødius
);

20 
døwNG⁄
(
RídîProgøm
& 
¥ogøm
, c⁄° 
glm
::
vec3
& 
cﬁ‹
, c⁄° glm::
vec2
& 
˚¡î
, 
ødius
, 
n
, 
™gÀ
);

21 
døwRe˘™gÀ
(
RídîProgøm
& 
¥ogøm
, c⁄° 
glm
::
vec3
& 
cﬁ‹
, c⁄° glm::
vec4
& 
ª˘
, 
™gÀ
);

22 
addPoötToBuf„r
(
buf„r
[], 
glm
::
vec3
 
poöt
, 
ödex
);

23 
addPoötToBuf„r
(
buf„r
[], 
glm
::
vec2
 
poöt
, 
ödex
);

24 
addPoötToBuf„r
(
buf„r
[], 
glm
::
vec4
 
poöt
, 
ödex
);

26 
	sVõwR™ge


28 
gëXR™ge
(c⁄° 
VõwR™ge
& 
ønge
)

30  
abs
(
ønge
.
xR™ge
[1] -Ñange.xRange[0]);

32 
gëYR™ge
(c⁄° 
VõwR™ge
& 
ønge
)

34  
abs
(
ønge
.
yR™ge
[1] -Ñange.yRange[0]);

36 
gëZR™ge
(c⁄° 
VõwR™ge
& 
ønge
)

38  
abs
(
ønge
.
zR™ge
[1] -Ñange.zRange[0]);

40 
	mglm
::
vec2
 
xR™ge
 = {0,0};

41 
	mglm
::
vec2
 
yR™ge
 = {0,0};

42 
	mglm
::
vec2
 
zR™ge
 = {0,0};

45 ˛as†
	cRídîProgøm


48 
	m¥ogøm
;

49 
	ms¸ìnWidth
, 
	ms¸ìnHeight
;

50 
VõwR™ge
 
	mba£R™ge
;

51 
VõwR™ge
 
	mcuºítR™ge
;

52 
	mpublic
:

53 
GLuöt
 
VBO
, 
	mVAO
;

54 
RídîProgøm
 
	mbasicProgøm
, 
	mlöeProgøm
;

55 
RídîProgøm
 
	m∑ötProgøm
;

56 
RídîProgøm
(
°d
::
°rög
 
vîãxP©h
, std::°rög 
‰agmítP©h
);

57 
	$RídîProgøm
()

61 
	`öô
(
°d
::
°rög
 
vîãxP©h
, std::°rög 
‰agmítP©h
);

62 
	`öô
(
s¸ìnWidth
, 
s¸ìnHeight
);

64 
glm
::
vec2
 
	`toAbsﬁuã
(c⁄° glm::vec2& 
poöt
);

65 
glm
::
vec4
 
	`toAbsﬁuã
(c⁄° glm::vec4& 
ª˘
);

67 c⁄° 
glm
::
vec2
& 
	`gëXR™ge
();

68 c⁄° 
glm
::
vec2
& 
	`gëYR™ge
();

69 c⁄° 
glm
::
vec2
& 
	`gëZR™ge
();

70 
	`£tXR™ge
(
x1
, 
x2
);

71 
	`£tYR™ge
(
y1
, 
y2
);

72 
	`£tZR™ge
(
z1
, 
z2
);

73 
	`ª£tR™ge
();

74 
glm
::
m©4
 
	`gëOπho
();

75 
glm
::
vec2
 
	`gëS¸ìnDimí
();

76 
	`£tM©rix4fv
(
°d
::
°rög
 
«me
, c⁄° 
GLÊﬂt
* 
vÆue
);

77 
	`£tVec3fv
(
°d
::
°rög
 
«me
,
glm
::
vec3
 
vÆue
);

78 
	`£tVec4fv
(
°d
::
°rög
 
«me
, 
glm
::
vec4
 
vÆue
);

79 
	`£tVec2fv
(
°d
::
°rög
 
«me
, 
glm
::
vec2
 
vÆue
);

80 
	`u£
();

83 
	}
};

85 ˛as†
	cRídîCamîa


87 
	m¥Ÿe˘ed
:

88 
glm
::
vec4
 
ª˘
 = {0,0,0,0};

90 
	gpublic
:

91 
RídîCamîa
* 
cuºítCamîa
;

92 
vútuÆ
 
öô
(
w
, 
h
);

93 c⁄° 
	gglm
::
vec4
& 
	$gëRe˘
() const;

94 
	`ª˚¡î
(c⁄° 
glm
::
vec2
& 
poöt
);

96 
glm
::
vec2
 
	$toS¸ìn
(c⁄° 
glm
::
vec2
& 
poöt
) const;

97 
glm
::
vec4
 
	$toS¸ìn
(c⁄° 
glm
::
vec4
& 
ª˘
) const;

99 
glm
::
vec2
 
	$toW‹ld
(c⁄° 
glm
::
vec2
& 
poöt
) const;

100 
glm
::
vec4
 
	$toW‹ld
(c⁄° 
glm
::
vec4
& 
ª˘
) const;

102 
glm
::
vec2
 
	$toAbsﬁuã
(c⁄° 
glm
::
vec2
& 
poöt
) const;

103 
glm
::
vec4
 
	$toAbsﬁuã
(c⁄° 
glm
::
vec4
& 
ª˘
) const;

104 
	}
};

109 
	eRídîEf„˘


111 
	mNONE
,

112 
	mMIRROR
,

113 
	mHORIZMIRROR


116 
	sS¥ôeP¨amëî


118 
	mglm
::
vec4
 
ª˘
 = {0,0,0,0};

119 
	mødüns
 = 0;

120 
RídîEf„˘
 
	mef„˘
 = 
NONE
;

121 
	mglm
::
vec4
 
töt
 = {1,1,1,1};

122 
RídîProgøm
* 
	m¥ogøm
 = &RídîProgøm::
basicProgøm
;

123 
	mz
 = 0;

124 
	mglm
::
vec4
 
p‹ti⁄
 = {0,0,1,1};

125 
boﬁ
 
	m›î©‹
 ==(c⁄° 
S¥ôeP¨amëî
& 
p2
)

127  
this
->
ª˘
 =
p2
.ª˘ &&Åhis->
ødüns
 ==Ö2.radians &&

128 
this
->
ef„˘
 =
p2
.ef„˘ &&Åhis->
töt
 ==Ö2.tint &&

129 
this
->
¥ogøm
 =
p2
.¥ogøm &&Åhis->
z
 ==Ö2.z &&

130 
this
->
p‹ti⁄
 =
p2
.portion;

136 
˛ass
 
	gS¥ôeWøµî
;

137 ˛as†
	cS¥ôe


139 
‰õnd
 
	mS¥ôeWøµî
;

140 
	m¥Ÿe˘ed
:

141 
width
 = 0, 
	mheight
 = 0;

142 
	mãxtuª
 = -1;

143 
	mãxCo‹d
 = 1;

144 
	mvÆues
[16] = {

145 -1, 1, 0, 
ãxCo‹d
,

146 1, 1, 
ãxCo‹d
,ÅexCoord,

148 1, -1, 
ãxCo‹d
, 0

151 
	gödi˚s
[6] = {

155 
boﬁ
 
	gdeÁu…Vîticõs
 = 
Ál£
;

156 
	gglm
::
vec3
 
töt
;

157 
	gVBO
=-1,
	gmodVBO
 = -1, 
	gVAO
=-1;

158 c⁄° 
	gÊﬂts
;

159 c⁄° 
size_t
 
	gÊﬂtSize
;

160 
lﬂd
(
°d
::
°rög
 
sour˚
);

161 
vútuÆ
 
lﬂdD©a
(
GLÊﬂt
* 
d©a
, c⁄° 
S¥ôeP¨amëî
& 
∑ømëî
, 
ödex
);

162 
døw
–
RídîProgøm
& 
¥ogøm
, 
GLÊﬂt
* 
d©a
, 
ö°™˚s
);

163 
boﬁ
 
	gå™•¨ít
 = 
Ál£
;

164 
	gpublic
:

165 
S¥ôe
(
°d
::
°rög
 
sour˚
);

166 
	$S¥ôe
()

168 
ãxtuª
 = -1;

169 
	}
}

170 ~
S¥ôe
();

171 
öô
(
°d
::
°rög
 
sour˚
);

172 
lﬂdVîti˚s
();

173 
lﬂdVîti˚s
(c⁄° 
°d
::
ve˘‹
<>& 
vîticõs
);

174 
	gãm∂©e
<
˛ass
 
	gT
>
lﬂdBuf„r
(& 
buf„r
, 
loˇti⁄
, 
T
 
¨r
[], 
size
, 
d©aSize
, 
divis‹
 = 0);

176 
vútuÆ
 
ªndîIn°™˚d
(
RídîProgøm
& 
¥ogøm
, c⁄° 
°d
::
ve˘‹
<
S¥ôeP¨amëî
>& 
∑ømëîs
);

177 
gëVAO
();

178 
vútuÆ
 
	gglm
::
vec2
 
gëDimí
();

179 
vútuÆ
 
gëFlﬂts
();

180 
ª£t
();

181 
£tTöt
(
glm
::
vec3
 
cﬁ‹
);

182 
múr‹
();

183 
Êù
();

184 * 
gëD©a
(* 
w
, * 
h
, * 
c
);

185 
‰ìD©a
(* 
d©a
);

189 ˛as†
	cS¥ôe9
 : 
public
 
S¥ôe


191 c⁄° 
Êﬂts9
;

192 
	mglm
::
vec2
 
widths
;

193 
	mglm
::
vec2
 
heights
;

194 
lﬂdD©a
(
GLÊﬂt
* 
d©a
, c⁄° 
S¥ôeP¨amëî
& 
∑ømëî
, 
ödex
);

195 
	mpublic
:

196 
S¥ôe9
(
°d
::
°rög
 
sour˚
, 
glm
::
vec2
 
W
, glm::vec2 
H
);

197 
	$S¥ôe9
()

201 
	`gëFlﬂts
();

202 
	`öô
(
°d
::
°rög
 
sour˚
, 
glm
::
vec2
 
W
, glm::vec2 
H
);

204 
	}
};

206 
	sAnim©i⁄P¨amëî


208 
	m°¨t
 = -1;

209 
	mÂs
 = -1;

210 
	mª≥©
 = 0;

211 
	mglm
::
vec4
 
subSe˘i⁄
 = 
glm
::vec4(0);

212 
	mglm
::
vec4
 (
RídîCamîa
::*
å™sf‹m
Ë(c⁄° 
glm
::vec4&Ëc⁄° = 
nuŒ±r
;

213 
RídîCamîa
* 
	mˇmîa
 = 
nuŒ±r
;

216 
	g°d
::
	t∑ú
<
	tS¥ôeP¨amëî
,
	tAnim©i⁄P¨amëî
> 
	tFuŒAnim©i⁄P¨amëî
;

218 ˛as†
	cBa£Anim©i⁄
 : 
public
 
S¥ôe


220 
Âs
 = 0;

221 
	mglm
::
vec2
 
‰ameDimí
;

222 
	mglm
::
vec4
 
subSe˘i⁄
 = {0,0,0,0};

223 
	gpublic
:

224 
Ba£Anim©i⁄
(
°d
::
°rög
 
sour˚
, 
•ìd
, 
≥rRow
, 
rows
, c⁄° 
glm
::
vec4
& 
sub
 = {0,0,0,0});

225 
	$Ba£Anim©i⁄
()

228 
	}
}

229 
gëFømes
();

230 
	gglm
::
vec2
 
gëDimí
();

231 
gëDuøti⁄
(
•ìd
 = -1);

232 
	gglm
::
vec4
 
gëP‹ti⁄
(c⁄° 
Anim©i⁄P¨amëî
& 
∑øm
);

233 
S¥ôeP¨amëî
 
¥o˚ssP¨am
(c⁄° S¥ôeP¨amëî& 
sP¨am
,c⁄° 
Anim©i⁄P¨amëî
& 
aP¨am
);

234 
öô
(
°d
::
°rög
 
sour˚
,
•ìd
, 
≥rRow
, 
rows
, c⁄° 
glm
::
vec4
& 
sub
 = {0,0,0,0});

235 
usög
 
	gS¥ôe
::
ªndîIn°™˚d
;

236 
ªndîIn°™˚d
(
RídîProgøm
& 
¥ogøm
, c⁄° 
°d
::
li°
<
FuŒAnim©i⁄P¨amëî
>& 
∑ømëîs
);

237 
ªndîIn°™˚d
(
RídîProgøm
& 
¥ogøm
, c⁄° 
°d
::
ve˘‹
<
S¥ôeP¨amëî
>& 
∑ømëîs
);

240 ˛as†
	cS¥ôeWøµî


243 
	m¥Ÿe˘ed
:

244 
S¥ôe
* 
•r
 = 
nuŒ±r
;

245 
	mpublic
:

246 
vútuÆ
 
öô
(
°d
::
°rög
 
sour˚
);

247 
vútuÆ
 
öô
(
S¥ôe
* 
•r
);

248 
vútuÆ
 
ª£t
();

249 
vútuÆ
 
ªndî
(c⁄° 
°d
::
li°
<
S¥ôeP¨amëî
>& 
∑ømëîs
, 
zMod
 =0);

250 
S¥ôe
* 
gëS¥ôe
();

251 
	mglm
::
vec2
 
gëDimí
();

252 
boﬁ
 
isRódy
();

253 
vútuÆ
 
ªque°
(c⁄° 
S¥ôeP¨amëî
& 
∑øm
);

254 
	mvútuÆ
 ~
S¥ôeWøµî
();

259 ˛as†
	cAnim©i⁄Wøµî
 : 
public
 
S¥ôeWøµî


261 
°d
::
li°
<
FuŒAnim©i⁄P¨amëî
> 
aP¨amëîs
;

262 
	mpublic
:

263 
Ba£Anim©i⁄
* 
gëAnim©i⁄
();

264 
öô
(
Ba£Anim©i⁄
* 
a
);

265 
ª£t
();

266 
usög
 
	mS¥ôeWøµî
::
ªque°
;

267 
ªque°
(c⁄° 
S¥ôeP¨amëî
& 
∑øm
);

268 
ªque°
(c⁄° 
S¥ôeP¨amëî
& 
•¨am
,c⁄° 
Anim©i⁄P¨amëî
& 
≠¨am
);

269 ~
Anim©i⁄Wøµî
();

272 
	g°d
::
	t∑ú
<,
	tS¥ôeWøµî
*> 
	tzWøµî
;

274 ˛as†
	cS¥ôeM™agî


276 
	sZWøµîCom∑øt‹


278 
boﬁ
 
›î©‹
 ()(c⁄° 
	mzWøµî
& 
	ma
, c⁄° zWøµî& 
	mb
) const

280 i‡(
	ma
.
	mfú°
 =
b
.
fú°
)

282  
a
.
£c⁄d
 < 
b
.second;

284  
	ma
.
	mfú°
 < 
	mb
.first;

287 
	g°d
::
ve˘‹
<
S¥ôeWøµî
*> 
•rôes
;

288 
	g°d
::
m≠
<
zWøµî
,°d::
li°
<
S¥ôeP¨amëî
>,
	gZWøµîCom∑øt‹
> 
	g∑øms
;

289 
	gpublic
:

290 
c⁄°ex¥
 
zIn¸emít
 = .001;

292 
addS¥ôe
(
S¥ôeWøµî
& 
•r
);

293 
ªque°
(
S¥ôeWøµî
& 
wøµî
,c⁄° 
S¥ôeP¨amëî
& 
∑øm
);

294 
ªndî
();

298 
	gãm∂©e
<
ty≥«me
 
	gT
>

299 
usög
 
	gPﬁySt‹age
 = 
°d
::
ve˘‹
<
T
>;

300 
	sPﬁyRídî


302 
	m°d
::
ve˘‹
<
°d
::
∑ú
<
glm
::
vec3
,
	mglm
::
vec4
>> 
löes
;

303 
	mPﬁySt‹age
<
	mglm
::
vec4
> 
pﬁyCﬁ‹s
;

304 
	mPﬁySt‹age
<
	mglm
::
vec3
> 
pﬁyPoöts
;

305 
	mPﬁySt‹age
<
	mGLuöt
> 
	mpﬁyIndi˚s
;

306 
	mpﬁyg⁄Reque°s
;

307 
RídîProgøm
 
	mpﬁyRídîî
;

308 
	mVAO
;

309 
	mlöeVBO
;

310 
	mpﬁyVBO
;

311 
	mcﬁ‹VBO
;

312 
öô
(
s¸ìnWidth
, 
s¸ìnHeight
);

313 
ªque°Löe
(c⁄° 
glm
::
vec4
& 
löe
, c⁄° glm::vec4& 
cﬁ‹
, 
z
 = 0, 
thick√ss
 = 1, 
RídîCamîa
* 
ˇmîa
 = 0);

314 
ªque°Gødõ¡Löe
(c⁄° 
glm
::
vec4
& 
löe
, c⁄° glm::vec4& 
cﬁ‹1
, c⁄° glm::vec4& 
cﬁ‹2
, 
z
 = 0, 
thick√ss
 = 1, 
RídîCamîa
* 
ˇmîa
 = 0);

315 
ªque°Cú˛e
(c⁄° 
glm
::
vec4
& 
cﬁ‹
,c⁄° glm::
vec2
& 
˚¡î
, 
ødius
, 
boﬁ
 
fûÀd
, 
z
);

316 
ªque°Re˘
(c⁄° 
glm
::
vec4
& 
ª˘
, c⁄° glm::vec4& 
cﬁ‹
, 
boﬁ
 
fûÀd
, 
™gÀ
, 
z
);

317 
ªque°NG⁄
(
n
, c⁄° 
glm
::
vec2
& 
˚¡î
, 
side
, c⁄° glm::
vec4
& 
cﬁ‹
, 
™gÀ
, 
boﬁ
 
fûÀd
, 
z
, boﬁ 
ødius
 = 
Ál£
);

318 
ªque°Pﬁyg⁄
(c⁄° 
°d
::
ve˘‹
<
glm
::
vec3
>& 
poöts
, c⁄° glm::
vec4
& 
cﬁ‹
);

319 
ªndî
();

320 
ªndîMesh
(* 
mesh
, 
w
, 
h
);

321 
ªndîLöes
();

322 
ªndîPﬁyg⁄s
();

323 
	m¥iv©e
:

325 
ª°¨t
;

328 ˛as†
	cAnim©i⁄Sequí˚r


330 
	mtŸÆFømes
 = 0;

331 
	mfuŒDuøti⁄
 = 0;

332 
	möfoSize
 = 0;

333 
	mglm
::
vec3
* 
öfo
 = 
nuŒ±r
;

334 
gëSèãIndex
(
‰ameSèπ
, * 
timeSö˚
);

335 
	mpublic
:

336 
Anim©i⁄Sequí˚r
(c⁄° 
°d
::
ve˘‹
<
glm
::
vec2
>& 
öfo_
);

337 
Anim©i⁄P¨amëî
 
¥o˚ss
(
‰ameSèπ
);

338 
gëSèãIndex
(
‰ameSèπ
);

339 
boﬁ
 
isD⁄e
(
‰ameSèπ
);

340 ~
Anim©i⁄Sequí˚r
();

	@C:\Users\leoou\OneDrive\Desktop\resources\shaders\fragment\fragmentShader.h

1 #vîsi⁄ 330 
c‹e


3 
out
 
vec4
 
	g‰agCﬁ‹
;

4 
ö
 
vec2
 
	gãxCo‹d
;

5 
ö
 
vec4
 
	gshade
;

6 
unif‹m
 
ßm∂î2D
 
	g•rôe
;

8 
	$maö
()

10 
vec4
 
ãxt
 = 
	`ãxtuª
(
•rôe
,
ãxCo‹d
);

11 
‰agCﬁ‹
 = 
	`vec4
(
ãxt
*
shade
);

13 
	}
}

	@C:\Users\leoou\OneDrive\Desktop\resources\shaders\fragment\outlineShader.h

1 #vîsi⁄ 330 
c‹e


3 
out
 
vec4
 
	g‰agCﬁ‹
;

4 
ö
 
vec2
 
	gãxCo‹d
;

6 
ö
 
vec3
 
	gshade
;

7 
unif‹m
 
ßm∂î2D
 
	g•rôe
;

9 
	$maö
()

11 
off£t
 = .01;

12 
‰agCﬁ‹
 = 
	`ãxtuª
(
•rôe
,
ãxCo‹d
);

13 
thªshﬁd
 = .5;

14 
vec2
 
À·
 = 
	`vec2
(
ãxCo‹d
.
x
 - 
off£t
,ÅexCo‹d.
y
);

15 
vec2
 
right
 = 
	`vec2
(
ãxCo‹d
.
x
 + 
off£t
,ÅexCo‹d.
y
);

16 
vec2
 
up
 =
	`vec2
(
ãxCo‹d
.
x
,ÅexCo‹d.
y
 - 
off£t
);

17 
vec2
 
down
 = 
	`vec2
(
ãxCo‹d
.
x
,ÅexCo‹d.
y
 + 
off£t
);

18 i‡(((
À·
.
x
 >0 && 
	`ãxtuª
(
•rôe
,À·).
a
 > 
thªshﬁd
 )|| (
right
.x <= 1 &&Åexture(sprite,right).a >Åhreshold )||

19 (
up
.
y
 >0 && 
	`ãxtuª
(
•rôe
,up).
a
 > 
thªshﬁd
Ë|| ( 
down
.y <= 1 &&Åexture(sprite,down).a >Åhreshold)) &&

20 
‰agCﬁ‹
.
a
 < 
thªshﬁd
)

22 
‰agCﬁ‹
 = 
	`vec4
(
shade
,1);

24 
	}
}

	@C:\Users\leoou\OneDrive\Desktop\resources\shaders\fragment\paintShader.h

1 #vîsi⁄ 330 
c‹e


3 
out
 
vec4
 
	g‰agCﬁ‹
;

4 
ö
 
vec2
 
	gãxCo‹d
;

6 
ö
 
vec3
 
	gshade
;

7 
unif‹m
 
ßm∂î2D
 
	g•rôe
;

9 
	$maö
()

11 
‰agCﬁ‹
 = 
	`ãxtuª
(
•rôe
,
ãxCo‹d
);

12 
thªshﬁd
 = .3;

13 i‡(
‰agCﬁ‹
.
a
 > 
thªshﬁd
)

15 
‰agCﬁ‹
 = 
	`vec4
(
shade
,1);

17 
	}
}

	@C:\Users\leoou\OneDrive\Desktop\resources\shaders\fragment\simpleFragment.h

1 #vîsi⁄ 330 
c‹e


3 
out
 
vec4
 
	gFøgCﬁ‹
;

5 
ö
 
vec4
 
	gshade
;

7 
	$maö
()

9 
FøgCﬁ‹
 = 
shade
;

10 
	}
}

	@C:\Users\leoou\OneDrive\Desktop\resources\shaders\fragment\wordFragment.h

1 #vîsi⁄ 330 
c‹e


3 
out
 
vec4
 
	g‰agCﬁ‹
;

4 
ö
 
vec2
 
	gãxCo‹d
;

5 
ö
 
vec4
 
	gshade
;

6 
unif‹m
 
ßm∂î2D
 
	g•rôe
;

8 
	$maö
()

10 
vec4
 
ãxt
 = 
	`ãxtuª
(
•rôe
,
ãxCo‹d
);

11 i‡(
ãxt
.
a
 < .5)

13 
disˇrd
;

15 
‰agCﬁ‹
 = 
	`vec4
(
ãxt
.
r
)*
shade
;

17 
	}
}

	@C:\Users\leoou\OneDrive\Desktop\resources\shaders\vertex\polygonVertex.h

1 #vîsi⁄ 330 
c‹e


3 
	$œyout
 (
loˇti⁄
 = 0Ë
ö
 
vec3
 
poöts
;

4 
	$œyout
 (
loˇti⁄
 = 1Ë
ö
 
vec4
 
cﬁ‹
;

5 
	$œyout
 (
loˇti⁄
 = 2Ë
ö
 
vec3
 
åi
;

7 
unif‹m
 
m©4
 
¥oje˘i⁄
;

9 
out
 
vec2
 
ãxCo‹d
;

10 
out
 
vec4
 
shade
;

12 
	$maö
()

14 
gl_Posôi⁄
 = 
¥oje˘i⁄
*
	`vec4
(
poöts
.
xyz
,1);

15 
shade
 = 
cﬁ‹
;

16 
	}
}

	@C:\Users\leoou\OneDrive\Desktop\resources\shaders\vertex\simpleVertex.h

1 #vîsi⁄ 330 
c‹e


3 
	$œyout
 (
loˇti⁄
 = 0Ë
ö
 
vec3
 
poöts
;

5 
unif‹m
 
vec3
 
cﬁ‹
;

6 
unif‹m
 
m©4
 
¥oje˘i⁄
;

8 
out
 
vec2
 
ãxCo‹d
;

9 
out
 
vec3
 
shade
;

11 
	$maö
()

13 
gl_Posôi⁄
 = 
¥oje˘i⁄
*
	`vec4
(
poöts
.
xyz
,1);

14 
shade
 = 
cﬁ‹
;

15 
	}
}

	@C:\Users\leoou\OneDrive\Desktop\resources\shaders\vertex\vertexShader.h

1 #vîsi⁄ 330 
c‹e


3 
	$œyout
 (
loˇti⁄
 = 0Ë
ö
 
vec4
 
vÆues
;

4 
	$œyout
 (
loˇti⁄
 = 3Ë
ö
 
m©4
 
å™sf‹m
;

5 
	$œyout
 (
loˇti⁄
 = 7Ë
ö
 
ef„˘
;

6 
	$œyout
 (
loˇti⁄
 = 8Ë
ö
 
vec4
 
cﬁ‹
;

7 
	$œyout
 (
loˇti⁄
 = 9Ë
ö
 
dïth
;

8 
	$œyout
 (
loˇti⁄
 = 10Ë
ö
 
vec4
 
p‹ti⁄
;

10 
unif‹m
 
m©4
 
¥oje˘i⁄
;

12 
out
 
vec2
 
ãxCo‹d
;

13 
out
 
vec4
 
shade
;

16 
	$maö
()

18 
z
 = 
vÆues
.z;

19 
a
 = 
vÆues
.a;

20 
p‹ti⁄X
 = 
p‹ti⁄
.
x
;

21 
p‹ti⁄Y
 = 
p‹ti⁄
.
y
;

22 i‡(
ef„˘
 == 1)

24 
z
*=-1;

25 
p‹ti⁄X
 +
p‹ti⁄
.
z
;

29 i‡(
ef„˘
 == 2)

31 
a
*=-1;

32 
p‹ti⁄Y
 +
p‹ti⁄
.
a
;

35 
gl_Posôi⁄
 = 
¥oje˘i⁄
*
å™sf‹m
*
	`vec4
(
vÆues
.
xy
,
dïth
,1);

37 
ãxCo‹d
 = 
	`vec2
–
p‹ti⁄X
 + 
z
*
p‹ti⁄
.z,
p‹ti⁄Y
 + 
a
*portion.a);

38 
shade
 = 
cﬁ‹
;

40 
	}
}

	@C:\Users\leoou\OneDrive\Desktop\resources\shaders\vertex\wordVertex.h

1 #vîsi⁄ 330 
c‹e


2 
	$œyout
 (
loˇti⁄
 = 0Ë
ö
 
vec4
 
vîãx
;

3 
	$œyout
 (
loˇti⁄
 = 1Ë
ö
 
z
;

4 
out
 
vec2
 
TexCo‹ds
;

6 
unif‹m
 
m©4
 
¥oje˘i⁄
;

8 
	$maö
()

10 
gl_Posôi⁄
 = 
¥oje˘i⁄
*
	`vec4
(
vîãx
.
xy
, 1, 1.0);

11 
TexCo‹ds
 = 
vîãx
.
zw
;

12 
	}
}

	@C:\Users\leoou\OneDrive\Desktop\resources\stb_image.h

111 #i‚de‡
STBI_INCLUDE_STB_IMAGE_H


112 
	#STBI_INCLUDE_STB_IMAGE_H


	)

320 #i‚de‡
STBI_NO_STDIO


321 
	~<°dio.h
>

324 
	#STBI_VERSION
 1

	)

328 
	mSTBI_deÁu…
 = 0,

330 
	mSTBI_gªy
 = 1,

331 
	mSTBI_gªy_Æpha
 = 2,

332 
	mSTBI_rgb
 = 3,

333 
	mSTBI_rgb_Æpha
 = 4

336 
	~<°dlib.h
>

337 
	t°bi_uc
;

338 
	t°bi_us
;

340 #ifde‡
__˝lu•lus


344 #i‚de‡
STBIDEF


345 #ifde‡
STB_IMAGE_STATIC


346 
	#STBIDEF
 

	)

348 
	#STBIDEF
 

	)

363 (*
ªad
Ë(*
u£r
,*
d©a
,
size
);

364 (*
skù
Ë(*
u£r
,
n
);

365 (*
eof
Ë(*
u£r
);

366 } 
	t°bi_io_ˇŒbacks
;

373 
STBIDEF
 
°bi_uc
 *
°bi_lﬂd_‰om_mem‹y
 (°bi_u¯c⁄° *
buf„r
, 
Àn
 , *
x
, *
y
, *
ch™√ls_ö_fûe
, 
desúed_ch™√ls
);

374 
STBIDEF
 
°bi_uc
 *
°bi_lﬂd_‰om_ˇŒbacks
(
°bi_io_ˇŒbacks
 c⁄° *
˛bk
 , *
u£r
, *
x
, *
y
, *
ch™√ls_ö_fûe
, 
desúed_ch™√ls
);

376 #i‚de‡
STBI_NO_STDIO


377 
STBIDEF
 
°bi_uc
 *
°bi_lﬂd
 (c⁄° *
fûíame
, *
x
, *
y
, *
ch™√ls_ö_fûe
, 
desúed_ch™√ls
);

378 
STBIDEF
 
°bi_uc
 *
°bi_lﬂd_‰om_fûe
 (
FILE
 *
f
, *
x
, *
y
, *
ch™√ls_ö_fûe
, 
desúed_ch™√ls
);

382 #i‚de‡
STBI_NO_GIF


383 
STBIDEF
 
°bi_uc
 *
°bi_lﬂd_gif_‰om_mem‹y
(°bi_u¯c⁄° *
buf„r
, 
Àn
, **
dñays
, *
x
, *
y
, *
z
, *
comp
, 
ªq_comp
);

386 #ifde‡
STBI_WINDOWS_UTF8


387 
STBIDEF
 
°bi_c⁄vît_wch¨_to_utf8
(*
buf„r
, 
size_t
 
buf„æí
, c⁄° 
wch¨_t
* 
öput
);

395 
STBIDEF
 
°bi_us
 *
°bi_lﬂd_16_‰om_mem‹y
 (
°bi_uc
 c⁄° *
buf„r
, 
Àn
, *
x
, *
y
, *
ch™√ls_ö_fûe
, 
desúed_ch™√ls
);

396 
STBIDEF
 
°bi_us
 *
°bi_lﬂd_16_‰om_ˇŒbacks
(
°bi_io_ˇŒbacks
 c⁄° *
˛bk
, *
u£r
, *
x
, *
y
, *
ch™√ls_ö_fûe
, 
desúed_ch™√ls
);

398 #i‚de‡
STBI_NO_STDIO


399 
STBIDEF
 
°bi_us
 *
°bi_lﬂd_16
 (c⁄° *
fûíame
, *
x
, *
y
, *
ch™√ls_ö_fûe
, 
desúed_ch™√ls
);

400 
STBIDEF
 
°bi_us
 *
°bi_lﬂd_‰om_fûe_16
(
FILE
 *
f
, *
x
, *
y
, *
ch™√ls_ö_fûe
, 
desúed_ch™√ls
);

407 #i‚de‡
STBI_NO_LINEAR


408 
STBIDEF
 *
°bi_lﬂdf_‰om_mem‹y
 (
°bi_uc
 c⁄° *
buf„r
, 
Àn
, *
x
, *
y
, *
ch™√ls_ö_fûe
, 
desúed_ch™√ls
);

409 
STBIDEF
 *
°bi_lﬂdf_‰om_ˇŒbacks
 (
°bi_io_ˇŒbacks
 c⁄° *
˛bk
, *
u£r
, *
x
, *
y
, *
ch™√ls_ö_fûe
, 
desúed_ch™√ls
);

411 #i‚de‡
STBI_NO_STDIO


412 
STBIDEF
 *
°bi_lﬂdf
 (c⁄° *
fûíame
, *
x
, *
y
, *
ch™√ls_ö_fûe
, 
desúed_ch™√ls
);

413 
STBIDEF
 *
°bi_lﬂdf_‰om_fûe
 (
FILE
 *
f
, *
x
, *
y
, *
ch™√ls_ö_fûe
, 
desúed_ch™√ls
);

417 #i‚de‡
STBI_NO_HDR


418 
STBIDEF
 
°bi_hdr_to_ldr_gamma
(
gamma
);

419 
STBIDEF
 
°bi_hdr_to_ldr_sˇÀ
(
sˇÀ
);

422 #i‚de‡
STBI_NO_LINEAR


423 
STBIDEF
 
°bi_ldr_to_hdr_gamma
(
gamma
);

424 
STBIDEF
 
°bi_ldr_to_hdr_sˇÀ
(
sˇÀ
);

428 
STBIDEF
 
°bi_is_hdr_‰om_ˇŒbacks
(
°bi_io_ˇŒbacks
 c⁄° *
˛bk
, *
u£r
);

429 
STBIDEF
 
°bi_is_hdr_‰om_mem‹y
(
°bi_uc
 c⁄° *
buf„r
, 
Àn
);

430 #i‚de‡
STBI_NO_STDIO


431 
STBIDEF
 
°bi_is_hdr
 (c⁄° *
fûíame
);

432 
STBIDEF
 
°bi_is_hdr_‰om_fûe
(
FILE
 *
f
);

438 
STBIDEF
 c⁄° *
°bi_Áûuª_ªas⁄
 ();

441 
STBIDEF
 
°bi_image_‰ì
 (*
ªtvÆ_‰om_°bi_lﬂd
);

444 
STBIDEF
 
°bi_öfo_‰om_mem‹y
(
°bi_uc
 c⁄° *
buf„r
, 
Àn
, *
x
, *
y
, *
comp
);

445 
STBIDEF
 
°bi_öfo_‰om_ˇŒbacks
(
°bi_io_ˇŒbacks
 c⁄° *
˛bk
, *
u£r
, *
x
, *
y
, *
comp
);

446 
STBIDEF
 
°bi_is_16_bô_‰om_mem‹y
(
°bi_uc
 c⁄° *
buf„r
, 
Àn
);

447 
STBIDEF
 
°bi_is_16_bô_‰om_ˇŒbacks
(
°bi_io_ˇŒbacks
 c⁄° *
˛bk
, *
u£r
);

449 #i‚de‡
STBI_NO_STDIO


450 
STBIDEF
 
°bi_öfo
 (c⁄° *
fûíame
, *
x
, *
y
, *
comp
);

451 
STBIDEF
 
°bi_öfo_‰om_fûe
 (
FILE
 *
f
, *
x
, *
y
, *
comp
);

452 
STBIDEF
 
°bi_is_16_bô
 (c⁄° *
fûíame
);

453 
STBIDEF
 
°bi_is_16_bô_‰om_fûe
(
FILE
 *
f
);

461 
STBIDEF
 
°bi_£t_u≈ªmu…ùly_⁄_lﬂd
(
Êag_åue_if_should_u≈ªmu…ùly
);

465 
STBIDEF
 
°bi_c⁄vît_ùh⁄e_≤g_to_rgb
(
Êag_åue_if_should_c⁄vît
);

468 
STBIDEF
 
°bi_£t_Êù_vîtiˇŒy_⁄_lﬂd
(
Êag_åue_if_should_Êù
);

472 
STBIDEF
 *
°bi_zlib_decode_mÆloc_guesssize
(c⁄° *
buf„r
, 
Àn
, 
öôül_size
, *
ouéí
);

473 
STBIDEF
 *
°bi_zlib_decode_mÆloc_guesssize_hódîÊag
(c⁄° *
buf„r
, 
Àn
, 
öôül_size
, *
ouéí
, 
∑r£_hódî
);

474 
STBIDEF
 *
°bi_zlib_decode_mÆloc
(c⁄° *
buf„r
, 
Àn
, *
ouéí
);

475 
STBIDEF
 
°bi_zlib_decode_buf„r
(*
obuf„r
, 
ﬁí
, c⁄° *
ibuf„r
, 
ûí
);

477 
STBIDEF
 *
°bi_zlib_decode_nohódî_mÆloc
(c⁄° *
buf„r
, 
Àn
, *
ouéí
);

478 
STBIDEF
 
°bi_zlib_decode_nohódî_buf„r
(*
obuf„r
, 
ﬁí
, c⁄° *
ibuf„r
, 
ûí
);

481 #ifde‡
__˝lu•lus


490 #ifde‡
STB_IMAGE_IMPLEMENTATION


492 #i‡
deföed
(
STBI_ONLY_JPEG
Ë|| deföed(
STBI_ONLY_PNG
Ë|| deföed(
STBI_ONLY_BMP
) \

493 || 
deföed
(
STBI_ONLY_TGA
Ë|| deföed(
STBI_ONLY_GIF
Ë|| deföed(
STBI_ONLY_PSD
) \

494 || 
deföed
(
STBI_ONLY_HDR
Ë|| deföed(
STBI_ONLY_PIC
Ë|| deföed(
STBI_ONLY_PNM
) \

495 || 
	$deföed
(
STBI_ONLY_ZLIB
)

496 #i‚de‡
STBI_ONLY_JPEG


497 
	#STBI_NO_JPEG


	)

499 #i‚de‡
STBI_ONLY_PNG


500 
	#STBI_NO_PNG


	)

502 #i‚de‡
STBI_ONLY_BMP


503 
	#STBI_NO_BMP


	)

505 #i‚de‡
STBI_ONLY_PSD


506 
	#STBI_NO_PSD


	)

508 #i‚de‡
STBI_ONLY_TGA


509 
	#STBI_NO_TGA


	)

511 #i‚de‡
STBI_ONLY_GIF


512 
	#STBI_NO_GIF


	)

514 #i‚de‡
STBI_ONLY_HDR


515 
	#STBI_NO_HDR


	)

517 #i‚de‡
STBI_ONLY_PIC


518 
	#STBI_NO_PIC


	)

520 #i‚de‡
STBI_ONLY_PNM


521 
	#STBI_NO_PNM


	)

525 #i‡
	`deföed
(
STBI_NO_PNG
Ë&& !deföed(
STBI_SUPPORT_ZLIB
Ë&& !deföed(
STBI_NO_ZLIB
)

526 
	#STBI_NO_ZLIB


	)

530 
	~<°d¨g.h
>

531 
	~<°ddef.h
>

532 
	~<°dlib.h
>

533 
	~<°rög.h
>

534 
	~<limôs.h
>

536 #i‡!
	`deföed
(
STBI_NO_LINEAR
Ë|| !deföed(
STBI_NO_HDR
)

537 
	~<m©h.h
>

540 #i‚de‡
STBI_NO_STDIO


541 
	~<°dio.h
>

544 #i‚de‡
STBI_ASSERT


545 
	~<as£π.h
>

546 
	#STBI_ASSERT
(
x
Ë
	`as£π
(x)

	)

549 #ifde‡
__˝lu•lus


550 
	#STBI_EXTERN
 "C"

	)

552 
	#STBI_EXTERN
 

	)

556 #i‚de‡
_MSC_VER


557 #ifde‡
__˝lu•lus


558 
	#°bi_ölöe
 
ölöe


	)

560 
	#°bi_ölöe


	)

563 
	#°bi_ölöe
 
__f‹˚ölöe


	)

567 #ifde‡
_MSC_VER


568 
	t°bi__uöt16
;

569 sig√d 
	t°bi__öt16
;

570 
	t°bi__uöt32
;

571 sig√d 
	t°bi__öt32
;

573 
	~<°döt.h
>

574 
uöt16_t
 
	t°bi__uöt16
;

575 
öt16_t
 
	t°bi__öt16
;

576 
uöt32_t
 
	t°bi__uöt32
;

577 
öt32_t
 
	t°bi__öt32
;

581 
	tvÆid©e_uöt32
[(
°bi__uöt32
)==4 ? 1 : -1];

583 #ifde‡
_MSC_VER


584 
	#STBI_NOTUSED
(
v
Ë()(v)

	)

586 
	#STBI_NOTUSED
(
v
Ë()(v)

	)

589 #ifde‡
_MSC_VER


590 
	#STBI_HAS_LROTL


	)

593 #ifde‡
STBI_HAS_LROTL


594 
	#°bi_ÃŸ
(
x
,
y
Ë
	`_ÃŸl
(x,y)

	)

596 
	#°bi_ÃŸ
(
x
,
y
Ë(((xË<< (y)Ë| ((xË>> (32 - (y))))

	)

599 #i‡
	`deföed
(
STBI_MALLOC
Ë&& deföed(
STBI_FREE
Ë&& (deföed(
STBI_REALLOC
Ë|| deföed(
STBI_REALLOC_SIZED
))

601 #ñi‡!
	`deföed
(
STBI_MALLOC
Ë&& !deföed(
STBI_FREE
Ë&& !deföed(
STBI_REALLOC
Ë&& !deföed(
STBI_REALLOC_SIZED
)

607 #i‚de‡
STBI_MALLOC


608 
	#STBI_MALLOC
(
sz
Ë
	`mÆloc
(sz)

	)

609 
	#STBI_REALLOC
(
p
,
√wsz
Ë
	`ªÆloc
’,√wsz)

	)

610 
	#STBI_FREE
(
p
Ë
	`‰ì
’)

	)

613 #i‚de‡
STBI_REALLOC_SIZED


614 
	#STBI_REALLOC_SIZED
(
p
,
ﬁdsz
,
√wsz
Ë
	`STBI_REALLOC
’,√wsz)

	)

618 #i‡
	`deföed
(
__x86_64__
Ë|| deföed(
_M_X64
)

619 
	#STBI__X64_TARGET


	)

620 #ñi‡
	`deföed
(
__i386
Ë|| deföed(
_M_IX86
)

621 
	#STBI__X86_TARGET


	)

624 #i‡
	`deföed
(
__GNUC__
Ë&& deföed(
STBI__X86_TARGET
Ë&& !deföed(
__SSE2__
Ë&& !deföed(
STBI_NO_SIMD
)

632 
	#STBI_NO_SIMD


	)

635 #i‡
	`deföed
(
__MINGW32__
Ë&& deföed(
STBI__X86_TARGET
Ë&& !deföed(
STBI_MINGW_ENABLE_SSE2
Ë&& !deföed(
STBI_NO_SIMD
)

647 
	#STBI_NO_SIMD


	)

650 #i‡!
	`deföed
(
STBI_NO_SIMD
Ë&& (deföed(
STBI__X86_TARGET
Ë|| deföed(
STBI__X64_TARGET
))

651 
	#STBI_SSE2


	)

652 
	~<emmöåö.h
>

654 #ifde‡
_MSC_VER


656 #i‡
_MSC_VER
 >= 1400

657 
	~<öåö.h
>

658 
	$°bi__˝uid3
()

660 
öfo
[4];

661 
	`__˝uid
(
öfo
,1);

662  
öfo
[3];

663 
	}
}

665 
	$°bi__˝uid3
()

667 
ªs
;

668 
__asm
 {

669 
mov
 
óx
,1

670 
˝uid


671 
mov
 
ªs
,
edx


673  
ªs
;

674 
	}
}

677 
	#STBI_SIMD_ALIGN
(
ty≥
, 
«me
Ë
	`__de˛•ec
(
	`Æign
(16)Ëty≥ 
	)
name

679 #i‡!
deföed
(
STBI_NO_JPEG
Ë&& deföed(
STBI_SSE2
)

680 
	$°bi__s£2_avaûabÀ
()

682 
öfo3
 = 
	`°bi__˝uid3
();

683  ((
öfo3
 >> 26) & 1) != 0;

684 
	}
}

688 
	#STBI_SIMD_ALIGN
(
ty≥
, 
«me
Ëty≥Çamê
	`__©åibuã__
((
	`Æig√d
(16)))

	)

690 #i‡!
deföed
(
STBI_NO_JPEG
Ë&& deföed(
STBI_SSE2
)

691 
	$°bi__s£2_avaûabÀ
()

697 
	}
}

704 #i‡
deföed
(
STBI_NO_SIMD
Ë&& deföed(
STBI_NEON
)

705 #unde‡
STBI_NEON


708 #ifde‡
STBI_NEON


709 
	~<¨m_√⁄.h
>

711 
	#STBI_SIMD_ALIGN
(
ty≥
, 
«me
Ëty≥Çamê
	`__©åibuã__
((
	`Æig√d
(16)))

	)

714 #i‚de‡
STBI_SIMD_ALIGN


715 
	#STBI_SIMD_ALIGN
(
ty≥
, 
«me
Ëty≥ 
	)
name

726 
°bi__uöt32
 
	mimg_x
, 
	mimg_y
;

727 
	mimg_n
, 
	mimg_out_n
;

729 
°bi_io_ˇŒbacks
 
	mio
;

730 *
	mio_u£r_d©a
;

732 
	mªad_‰om_ˇŒbacks
;

733 
	mbuÊí
;

734 
°bi_uc
 
	mbuf„r_°¨t
[128];

736 
°bi_uc
 *
	mimg_buf„r
, *
	mimg_buf„r_íd
;

737 
°bi_uc
 *
	mimg_buf„r_‹igöÆ
, *
	mimg_buf„r_‹igöÆ_íd
;

738 } 
	t°bi__c⁄ãxt
;

741 
°bi__ªfûl_buf„r
(
°bi__c⁄ãxt
 *
s
);

744 
	$°bi__°¨t_mem
(
°bi__c⁄ãxt
 *
s
, 
°bi_uc
 c⁄° *
buf„r
, 
Àn
)

746 
s
->
io
.
ªad
 = 
NULL
;

747 
s
->
ªad_‰om_ˇŒbacks
 = 0;

748 
s
->
img_buf„r
 = s->
img_buf„r_‹igöÆ
 = (
°bi_uc
 *Ë
buf„r
;

749 
s
->
img_buf„r_íd
 = s->
img_buf„r_‹igöÆ_íd
 = (
°bi_uc
 *Ë
buf„r
+
Àn
;

750 
	}
}

753 
	$°bi__°¨t_ˇŒbacks
(
°bi__c⁄ãxt
 *
s
, 
°bi_io_ˇŒbacks
 *
c
, *
u£r
)

755 
s
->
io
 = *
c
;

756 
s
->
io_u£r_d©a
 = 
u£r
;

757 
s
->
buÊí
 = (s->
buf„r_°¨t
);

758 
s
->
ªad_‰om_ˇŒbacks
 = 1;

759 
s
->
img_buf„r_‹igöÆ
 = s->
buf„r_°¨t
;

760 
	`°bi__ªfûl_buf„r
(
s
);

761 
s
->
img_buf„r_‹igöÆ_íd
 = s->
img_buf„r_íd
;

762 
	}
}

764 #i‚de‡
STBI_NO_STDIO


766 
	$°bi__°dio_ªad
(*
u£r
, *
d©a
, 
size
)

768  (Ë
	`‰ód
(
d©a
,1,
size
,(
FILE
*Ë
u£r
);

769 
	}
}

771 
	$°bi__°dio_skù
(*
u£r
, 
n
)

773 
	`f£ek
((
FILE
*Ë
u£r
, 
n
, 
SEEK_CUR
);

774 
	}
}

776 
	$°bi__°dio_eof
(*
u£r
)

778  
	`„of
((
FILE
*Ë
u£r
);

779 
	}
}

781 
°bi_io_ˇŒbacks
 
	g°bi__°dio_ˇŒbacks
 =

783 
°bi__°dio_ªad
,

784 
°bi__°dio_skù
,

785 
°bi__°dio_eof
,

788 
	$°bi__°¨t_fûe
(
°bi__c⁄ãxt
 *
s
, 
FILE
 *
f
)

790 
	`°bi__°¨t_ˇŒbacks
(
s
, &
°bi__°dio_ˇŒbacks
, (*Ë
f
);

791 
	}
}

797 
	$°bi__ªwöd
(
°bi__c⁄ãxt
 *
s
)

802 
s
->
img_buf„r
 = s->
img_buf„r_‹igöÆ
;

803 
s
->
img_buf„r_íd
 = s->
img_buf„r_‹igöÆ_íd
;

804 
	}
}

808 
	mSTBI_ORDER_RGB
,

809 
	mSTBI_ORDER_BGR


814 
	mbôs_≥r_ch™√l
;

815 
	mnum_ch™√ls
;

816 
	mch™√l_‹dî
;

817 } 
	t°bi__ªsu…_öfo
;

819 #i‚de‡
STBI_NO_JPEG


820 
°bi__j≥g_ã°
(
°bi__c⁄ãxt
 *
s
);

821 *
°bi__j≥g_lﬂd
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
, 
ªq_comp
, 
°bi__ªsu…_öfo
 *
ri
);

822 
°bi__j≥g_öfo
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
);

825 #i‚de‡
STBI_NO_PNG


826 
°bi__≤g_ã°
(
°bi__c⁄ãxt
 *
s
);

827 *
°bi__≤g_lﬂd
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
, 
ªq_comp
, 
°bi__ªsu…_öfo
 *
ri
);

828 
°bi__≤g_öfo
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
);

829 
°bi__≤g_is16
(
°bi__c⁄ãxt
 *
s
);

832 #i‚de‡
STBI_NO_BMP


833 
°bi__bmp_ã°
(
°bi__c⁄ãxt
 *
s
);

834 *
°bi__bmp_lﬂd
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
, 
ªq_comp
, 
°bi__ªsu…_öfo
 *
ri
);

835 
°bi__bmp_öfo
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
);

838 #i‚de‡
STBI_NO_TGA


839 
°bi__tga_ã°
(
°bi__c⁄ãxt
 *
s
);

840 *
°bi__tga_lﬂd
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
, 
ªq_comp
, 
°bi__ªsu…_öfo
 *
ri
);

841 
°bi__tga_öfo
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
);

844 #i‚de‡
STBI_NO_PSD


845 
°bi__psd_ã°
(
°bi__c⁄ãxt
 *
s
);

846 *
°bi__psd_lﬂd
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
, 
ªq_comp
, 
°bi__ªsu…_öfo
 *
ri
, 
bpc
);

847 
°bi__psd_öfo
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
);

848 
°bi__psd_is16
(
°bi__c⁄ãxt
 *
s
);

851 #i‚de‡
STBI_NO_HDR


852 
°bi__hdr_ã°
(
°bi__c⁄ãxt
 *
s
);

853 *
°bi__hdr_lﬂd
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
, 
ªq_comp
, 
°bi__ªsu…_öfo
 *
ri
);

854 
°bi__hdr_öfo
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
);

857 #i‚de‡
STBI_NO_PIC


858 
°bi__pic_ã°
(
°bi__c⁄ãxt
 *
s
);

859 *
°bi__pic_lﬂd
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
, 
ªq_comp
, 
°bi__ªsu…_öfo
 *
ri
);

860 
°bi__pic_öfo
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
);

863 #i‚de‡
STBI_NO_GIF


864 
°bi__gif_ã°
(
°bi__c⁄ãxt
 *
s
);

865 *
°bi__gif_lﬂd
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
, 
ªq_comp
, 
°bi__ªsu…_öfo
 *
ri
);

866 *
°bi__lﬂd_gif_maö
(
°bi__c⁄ãxt
 *
s
, **
dñays
, *
x
, *
y
, *
z
, *
comp
, 
ªq_comp
);

867 
°bi__gif_öfo
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
);

870 #i‚de‡
STBI_NO_PNM


871 
°bi__≤m_ã°
(
°bi__c⁄ãxt
 *
s
);

872 *
°bi__≤m_lﬂd
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
, 
ªq_comp
, 
°bi__ªsu…_öfo
 *
ri
);

873 
°bi__≤m_öfo
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
);

877 c⁄° *
	g°bi__g_Áûuª_ªas⁄
;

879 
STBIDEF
 c⁄° *
	$°bi_Áûuª_ªas⁄
()

881  
°bi__g_Áûuª_ªas⁄
;

882 
	}
}

884 
	$°bi__îr
(c⁄° *
°r
)

886 
°bi__g_Áûuª_ªas⁄
 = 
°r
;

888 
	}
}

890 *
	$°bi__mÆloc
(
size_t
 
size
)

892  
	`STBI_MALLOC
(
size
);

893 
	}
}

907 
	$°bi__addsizes_vÆid
(
a
, 
b
)

909 i‡(
b
 < 0)  0;

914  
a
 <
INT_MAX
 - 
b
;

915 
	}
}

919 
	$°bi__mul2sizes_vÆid
(
a
, 
b
)

921 i‡(
a
 < 0 || 
b
 < 0)  0;

922 i‡(
b
 == 0)  1;

924  
a
 <
INT_MAX
/
b
;

925 
	}
}

928 
	$°bi__mad2sizes_vÆid
(
a
, 
b
, 
add
)

930  
	`°bi__mul2sizes_vÆid
(
a
, 
b
Ë&& 
	`°bi__addsizes_vÆid
◊*b, 
add
);

931 
	}
}

934 
	$°bi__mad3sizes_vÆid
(
a
, 
b
, 
c
, 
add
)

936  
	`°bi__mul2sizes_vÆid
(
a
, 
b
Ë&& stbi__mul2sizes_vÆid◊*b, 
c
) &&

937 
	`°bi__addsizes_vÆid
(
a
*
b
*
c
, 
add
);

938 
	}
}

941 #i‡!
deföed
(
STBI_NO_LINEAR
Ë|| !deföed(
STBI_NO_HDR
)

942 
	$°bi__mad4sizes_vÆid
(
a
, 
b
, 
c
, 
d
, 
add
)

944  
	`°bi__mul2sizes_vÆid
(
a
, 
b
Ë&& stbi__mul2sizes_vÆid◊*b, 
c
) &&

945 
	`°bi__mul2sizes_vÆid
(
a
*
b
*
c
, 
d
Ë&& 
	`°bi__addsizes_vÆid
◊*b*c*d, 
add
);

946 
	}
}

950 *
	$°bi__mÆloc_mad2
(
a
, 
b
, 
add
)

952 i‡(!
	`°bi__mad2sizes_vÆid
(
a
, 
b
, 
add
)Ë 
NULL
;

953  
	`°bi__mÆloc
(
a
*
b
 + 
add
);

954 
	}
}

956 *
	$°bi__mÆloc_mad3
(
a
, 
b
, 
c
, 
add
)

958 i‡(!
	`°bi__mad3sizes_vÆid
(
a
, 
b
, 
c
, 
add
)Ë 
NULL
;

959  
	`°bi__mÆloc
(
a
*
b
*
c
 + 
add
);

960 
	}
}

962 #i‡!
deföed
(
STBI_NO_LINEAR
Ë|| !deföed(
STBI_NO_HDR
)

963 *
	$°bi__mÆloc_mad4
(
a
, 
b
, 
c
, 
d
, 
add
)

965 i‡(!
	`°bi__mad4sizes_vÆid
(
a
, 
b
, 
c
, 
d
, 
add
)Ë 
NULL
;

966  
	`°bi__mÆloc
(
a
*
b
*
c
*
d
 + 
add
);

967 
	}
}

974 #ifde‡
STBI_NO_FAILURE_STRINGS


975 
	#°bi__îr
(
x
,
y
Ë0

	)

976 #ñi‡
deföed
(
STBI_FAILURE_USERMSG
)

977 
	#°bi__îr
(
x
,
y
Ë
	`°bi__îr
(y)

	)

979 
	#°bi__îr
(
x
,
y
Ë
	`°bi__îr
(x)

	)

982 
	#°bi__îΩf
(
x
,
y
Ë((*)(
size_t
Ë(
	`°bi__îr
(x,y)?
NULL
:NULL))

	)

983 
	#°bi__îΩuc
(
x
,
y
Ë((*)(
size_t
Ë(
	`°bi__îr
(x,y)?
NULL
:NULL))

	)

985 
STBIDEF
 
	$°bi_image_‰ì
(*
ªtvÆ_‰om_°bi_lﬂd
)

987 
	`STBI_FREE
(
ªtvÆ_‰om_°bi_lﬂd
);

988 
	}
}

990 #i‚de‡
STBI_NO_LINEAR


991 *
°bi__ldr_to_hdr
(
°bi_uc
 *
d©a
, 
x
, 
y
, 
comp
);

994 #i‚de‡
STBI_NO_HDR


995 
°bi_uc
 *
°bi__hdr_to_ldr
(*
d©a
, 
x
, 
y
, 
comp
);

998 
	g°bi__vîtiˇŒy_Êù_⁄_lﬂd
 = 0;

1000 
STBIDEF
 
	$°bi_£t_Êù_vîtiˇŒy_⁄_lﬂd
(
Êag_åue_if_should_Êù
)

1002 
°bi__vîtiˇŒy_Êù_⁄_lﬂd
 = 
Êag_åue_if_should_Êù
;

1003 
	}
}

1005 *
	$°bi__lﬂd_maö
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
, 
ªq_comp
, 
°bi__ªsu…_öfo
 *
ri
, 
bpc
)

1007 
	`mem£t
(
ri
, 0, (*ri));

1008 
ri
->
bôs_≥r_ch™√l
 = 8;

1009 
ri
->
ch™√l_‹dî
 = 
STBI_ORDER_RGB
;

1010 
ri
->
num_ch™√ls
 = 0;

1012 #i‚de‡
STBI_NO_JPEG


1013 i‡(
	`°bi__j≥g_ã°
(
s
)Ë 
	`°bi__j≥g_lﬂd
(s,
x
,
y
,
comp
,
ªq_comp
, 
ri
);

1015 #i‚de‡
STBI_NO_PNG


1016 i‡(
	`°bi__≤g_ã°
(
s
)Ë 
	`°bi__≤g_lﬂd
(s,
x
,
y
,
comp
,
ªq_comp
, 
ri
);

1018 #i‚de‡
STBI_NO_BMP


1019 i‡(
	`°bi__bmp_ã°
(
s
)Ë 
	`°bi__bmp_lﬂd
(s,
x
,
y
,
comp
,
ªq_comp
, 
ri
);

1021 #i‚de‡
STBI_NO_GIF


1022 i‡(
	`°bi__gif_ã°
(
s
)Ë 
	`°bi__gif_lﬂd
(s,
x
,
y
,
comp
,
ªq_comp
, 
ri
);

1024 #i‚de‡
STBI_NO_PSD


1025 i‡(
	`°bi__psd_ã°
(
s
)Ë 
	`°bi__psd_lﬂd
(s,
x
,
y
,
comp
,
ªq_comp
, 
ri
, 
bpc
);

1027 #i‚de‡
STBI_NO_PIC


1028 i‡(
	`°bi__pic_ã°
(
s
)Ë 
	`°bi__pic_lﬂd
(s,
x
,
y
,
comp
,
ªq_comp
, 
ri
);

1030 #i‚de‡
STBI_NO_PNM


1031 i‡(
	`°bi__≤m_ã°
(
s
)Ë 
	`°bi__≤m_lﬂd
(s,
x
,
y
,
comp
,
ªq_comp
, 
ri
);

1034 #i‚de‡
STBI_NO_HDR


1035 i‡(
	`°bi__hdr_ã°
(
s
)) {

1036 *
hdr
 = 
	`°bi__hdr_lﬂd
(
s
, 
x
,
y
,
comp
,
ªq_comp
, 
ri
);

1037  
	`°bi__hdr_to_ldr
(
hdr
, *
x
, *
y
, 
ªq_comp
 ?Ñeq_com∞: *
comp
);

1041 #i‚de‡
STBI_NO_TGA


1043 i‡(
	`°bi__tga_ã°
(
s
))

1044  
	`°bi__tga_lﬂd
(
s
,
x
,
y
,
comp
,
ªq_comp
, 
ri
);

1047  
	`°bi__îΩuc
("unknown imageÅype", "ImageÇot ofány knownÅype, or corrupt");

1048 
	}
}

1050 
°bi_uc
 *
	$°bi__c⁄vît_16_to_8
(
°bi__uöt16
 *
‹ig
, 
w
, 
h
, 
ch™√ls
)

1052 
i
;

1053 
img_Àn
 = 
w
 * 
h
 * 
ch™√ls
;

1054 
°bi_uc
 *
ªdu˚d
;

1056 
ªdu˚d
 = (
°bi_uc
 *Ë
	`°bi__mÆloc
(
img_Àn
);

1057 i‡(
ªdu˚d
 =
NULL
Ë 
	`°bi__îΩuc
("outofmem", "Out of memory");

1059 
i
 = 0; i < 
img_Àn
; ++i)

1060 
ªdu˚d
[
i
] = (
°bi_uc
)((
‹ig
[i] >> 8) & 0xFF);

1062 
	`STBI_FREE
(
‹ig
);

1063  
ªdu˚d
;

1064 
	}
}

1066 
°bi__uöt16
 *
	$°bi__c⁄vît_8_to_16
(
°bi_uc
 *
‹ig
, 
w
, 
h
, 
ch™√ls
)

1068 
i
;

1069 
img_Àn
 = 
w
 * 
h
 * 
ch™√ls
;

1070 
°bi__uöt16
 *
íœrged
;

1072 
íœrged
 = (
°bi__uöt16
 *Ë
	`°bi__mÆloc
(
img_Àn
*2);

1073 i‡(
íœrged
 =
NULL
Ë (
°bi__uöt16
 *Ë
	`°bi__îΩuc
("outofmem", "Out of memory");

1075 
i
 = 0; i < 
img_Àn
; ++i)

1076 
íœrged
[
i
] = (
°bi__uöt16
)((
‹ig
[i] << 8) + orig[i]);

1078 
	`STBI_FREE
(
‹ig
);

1079  
íœrged
;

1080 
	}
}

1082 
	$°bi__vîtiˇl_Êù
(*
image
, 
w
, 
h
, 
byãs_≥r_pixñ
)

1084 
row
;

1085 
size_t
 
byãs_≥r_row
 = (size_t)
w
 * 
byãs_≥r_pixñ
;

1086 
°bi_uc
 
ãmp
[2048];

1087 
°bi_uc
 *
byãs
 = (°bi_u¯*)
image
;

1089 
row
 = 0;Ñow < (
h
>>1);Ñow++) {

1090 
°bi_uc
 *
row0
 = 
byãs
 + 
row
*
byãs_≥r_row
;

1091 
°bi_uc
 *
row1
 = 
byãs
 + (
h
 - 
row
 - 1)*
byãs_≥r_row
;

1093 
size_t
 
byãs_À·
 = 
byãs_≥r_row
;

1094 
byãs_À·
) {

1095 
size_t
 
byãs_c›y
 = (
byãs_À·
 < (
ãmp
)) ? bytes_left : (temp);

1096 
	`mem˝y
(
ãmp
, 
row0
, 
byãs_c›y
);

1097 
	`mem˝y
(
row0
, 
row1
, 
byãs_c›y
);

1098 
	`mem˝y
(
row1
, 
ãmp
, 
byãs_c›y
);

1099 
row0
 +
byãs_c›y
;

1100 
row1
 +
byãs_c›y
;

1101 
byãs_À·
 -
byãs_c›y
;

1104 
	}
}

1106 #i‚de‡
STBI_NO_GIF


1107 
	$°bi__vîtiˇl_Êù_¶i˚s
(*
image
, 
w
, 
h
, 
z
, 
byãs_≥r_pixñ
)

1109 
¶i˚
;

1110 
¶i˚_size
 = 
w
 * 
h
 * 
byãs_≥r_pixñ
;

1112 
°bi_uc
 *
byãs
 = (°bi_u¯*)
image
;

1113 
¶i˚
 = 0; sli˚ < 
z
; ++slice) {

1114 
	`°bi__vîtiˇl_Êù
(
byãs
, 
w
, 
h
, 
byãs_≥r_pixñ
);

1115 
byãs
 +
¶i˚_size
;

1117 
	}
}

1120 *
	$°bi__lﬂd_™d_po°¥o˚ss_8bô
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
, 
ªq_comp
)

1122 
°bi__ªsu…_öfo
 
ri
;

1123 *
ªsu…
 = 
	`°bi__lﬂd_maö
(
s
, 
x
, 
y
, 
comp
, 
ªq_comp
, &
ri
, 8);

1125 i‡(
ªsu…
 =
NULL
)

1126  
NULL
;

1128 i‡(
ri
.
bôs_≥r_ch™√l
 != 8) {

1129 
	`STBI_ASSERT
(
ri
.
bôs_≥r_ch™√l
 == 16);

1130 
ªsu…
 = 
	`°bi__c⁄vît_16_to_8
((
°bi__uöt16
 *Ëªsu…, *
x
, *
y
, 
ªq_comp
 =0 ? *
comp
 :Ñeq_comp);

1131 
ri
.
bôs_≥r_ch™√l
 = 8;

1136 i‡(
°bi__vîtiˇŒy_Êù_⁄_lﬂd
) {

1137 
ch™√ls
 = 
ªq_comp
 ?Ñeq_com∞: *
comp
;

1138 
	`°bi__vîtiˇl_Êù
(
ªsu…
, *
x
, *
y
, 
ch™√ls
 * (
°bi_uc
));

1141  (*Ë
ªsu…
;

1142 
	}
}

1144 
°bi__uöt16
 *
	$°bi__lﬂd_™d_po°¥o˚ss_16bô
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
, 
ªq_comp
)

1146 
°bi__ªsu…_öfo
 
ri
;

1147 *
ªsu…
 = 
	`°bi__lﬂd_maö
(
s
, 
x
, 
y
, 
comp
, 
ªq_comp
, &
ri
, 16);

1149 i‡(
ªsu…
 =
NULL
)

1150  
NULL
;

1152 i‡(
ri
.
bôs_≥r_ch™√l
 != 16) {

1153 
	`STBI_ASSERT
(
ri
.
bôs_≥r_ch™√l
 == 8);

1154 
ªsu…
 = 
	`°bi__c⁄vît_8_to_16
((
°bi_uc
 *Ëªsu…, *
x
, *
y
, 
ªq_comp
 =0 ? *
comp
 :Ñeq_comp);

1155 
ri
.
bôs_≥r_ch™√l
 = 16;

1161 i‡(
°bi__vîtiˇŒy_Êù_⁄_lﬂd
) {

1162 
ch™√ls
 = 
ªq_comp
 ?Ñeq_com∞: *
comp
;

1163 
	`°bi__vîtiˇl_Êù
(
ªsu…
, *
x
, *
y
, 
ch™√ls
 * (
°bi__uöt16
));

1166  (
°bi__uöt16
 *Ë
ªsu…
;

1167 
	}
}

1169 #i‡!
deföed
(
STBI_NO_HDR
Ë&& !deföed(
STBI_NO_LINEAR
)

1170 
	$°bi__Êﬂt_po°¥o˚ss
(*
ªsu…
, *
x
, *
y
, *
comp
, 
ªq_comp
)

1172 i‡(
°bi__vîtiˇŒy_Êù_⁄_lﬂd
 && 
ªsu…
 !
NULL
) {

1173 
ch™√ls
 = 
ªq_comp
 ?Ñeq_com∞: *
comp
;

1174 
	`°bi__vîtiˇl_Êù
(
ªsu…
, *
x
, *
y
, 
ch™√ls
 * ());

1176 
	}
}

1179 #i‚de‡
STBI_NO_STDIO


1181 #i‡
deföed
(
_MSC_VER
Ë&& deföed(
STBI_WINDOWS_UTF8
)

1182 
STBI_EXTERN
 
	$__de˛•ec
(
dŒimp‹t
Ë
__°dˇŒ
 
	`Mu…iByãToWideCh¨
(
˝
, 
Êags
, c⁄° *
°r
, 
cbmb
, 
wch¨_t
 *
wide°r
, 
cchwide
);

1183 
STBI_EXTERN
 
	$__de˛•ec
(
dŒimp‹t
Ë
__°dˇŒ
 
	`WideCh¨ToMu…iByã
(
˝
, 
Êags
, c⁄° 
wch¨_t
 *
wide°r
, 
cchwide
, *
°r
, 
cbmb
, c⁄° *
defch¨
, *
u£d_deÁu…
);

1186 #i‡
	`deföed
(
_MSC_VER
Ë&& deföed(
STBI_WINDOWS_UTF8
)

1187 
STBIDEF
 
	$°bi_c⁄vît_wch¨_to_utf8
(*
buf„r
, 
size_t
 
buf„æí
, c⁄° 
wch¨_t
* 
öput
)

1189  
	`WideCh¨ToMu…iByã
(65001 , 0, 
öput
, -1, 
buf„r
, (Ë
buf„æí
, 
NULL
, NULL);

1190 
	}
}

1193 
FILE
 *
	$°bi__f›í
(c⁄° *
fûíame
, c⁄° *
mode
)

1195 
FILE
 *
f
;

1196 #i‡
	`deföed
(
_MSC_VER
Ë&& deföed(
STBI_WINDOWS_UTF8
)

1197 
wch¨_t
 
wMode
[64];

1198 
wch¨_t
 
wFûíame
[1024];

1199 i‡(0 =
	`Mu…iByãToWideCh¨
(65001 , 0, 
fûíame
, -1, 
wFûíame
, (wFilename)))

1202 i‡(0 =
	`Mu…iByãToWideCh¨
(65001 , 0, 
mode
, -1, 
wMode
, (wMode)))

1205 #i‡
_MSC_VER
 >= 1400

1206 i‡(0 !
	`_wf›í_s
(&
f
, 
wFûíame
, 
wMode
))

1207 
f
 = 0;

1209 
f
 = 
	`_wf›í
(
wFûíame
, 
wMode
);

1212 #ñi‡
	`deföed
(
_MSC_VER
) && _MSC_VER >= 1400

1213 i‡(0 !
	`f›í_s
(&
f
, 
fûíame
, 
mode
))

1214 
f
=0;

1216 
f
 = 
	`f›í
(
fûíame
, 
mode
);

1218  
f
;

1219 
	}
}

1222 
STBIDEF
 
°bi_uc
 *
	$°bi_lﬂd
(c⁄° *
fûíame
, *
x
, *
y
, *
comp
, 
ªq_comp
)

1224 
FILE
 *
f
 = 
	`°bi__f›í
(
fûíame
, "rb");

1225 *
ªsu…
;

1226 i‡(!
f
Ë 
	`°bi__îΩuc
("can't fopen", "UnableÅo open file");

1227 
ªsu…
 = 
	`°bi_lﬂd_‰om_fûe
(
f
,
x
,
y
,
comp
,
ªq_comp
);

1228 
	`f˛o£
(
f
);

1229  
ªsu…
;

1230 
	}
}

1232 
STBIDEF
 
°bi_uc
 *
	$°bi_lﬂd_‰om_fûe
(
FILE
 *
f
, *
x
, *
y
, *
comp
, 
ªq_comp
)

1234 *
ªsu…
;

1235 
°bi__c⁄ãxt
 
s
;

1236 
	`°bi__°¨t_fûe
(&
s
,
f
);

1237 
ªsu…
 = 
	`°bi__lﬂd_™d_po°¥o˚ss_8bô
(&
s
,
x
,
y
,
comp
,
ªq_comp
);

1238 i‡(
ªsu…
) {

1240 
	`f£ek
(
f
, - (Ë(
s
.
img_buf„r_íd
 - s.
img_buf„r
), 
SEEK_CUR
);

1242  
ªsu…
;

1243 
	}
}

1245 
STBIDEF
 
°bi__uöt16
 *
	$°bi_lﬂd_‰om_fûe_16
(
FILE
 *
f
, *
x
, *
y
, *
comp
, 
ªq_comp
)

1247 
°bi__uöt16
 *
ªsu…
;

1248 
°bi__c⁄ãxt
 
s
;

1249 
	`°bi__°¨t_fûe
(&
s
,
f
);

1250 
ªsu…
 = 
	`°bi__lﬂd_™d_po°¥o˚ss_16bô
(&
s
,
x
,
y
,
comp
,
ªq_comp
);

1251 i‡(
ªsu…
) {

1253 
	`f£ek
(
f
, - (Ë(
s
.
img_buf„r_íd
 - s.
img_buf„r
), 
SEEK_CUR
);

1255  
ªsu…
;

1256 
	}
}

1258 
STBIDEF
 
°bi_us
 *
	$°bi_lﬂd_16
(c⁄° *
fûíame
, *
x
, *
y
, *
comp
, 
ªq_comp
)

1260 
FILE
 *
f
 = 
	`°bi__f›í
(
fûíame
, "rb");

1261 
°bi__uöt16
 *
ªsu…
;

1262 i‡(!
f
Ë (
°bi_us
 *Ë
	`°bi__îΩuc
("can't fopen", "UnableÅo open file");

1263 
ªsu…
 = 
	`°bi_lﬂd_‰om_fûe_16
(
f
,
x
,
y
,
comp
,
ªq_comp
);

1264 
	`f˛o£
(
f
);

1265  
ªsu…
;

1266 
	}
}

1271 
STBIDEF
 
°bi_us
 *
	$°bi_lﬂd_16_‰om_mem‹y
(
°bi_uc
 c⁄° *
buf„r
, 
Àn
, *
x
, *
y
, *
ch™√ls_ö_fûe
, 
desúed_ch™√ls
)

1273 
°bi__c⁄ãxt
 
s
;

1274 
	`°bi__°¨t_mem
(&
s
,
buf„r
,
Àn
);

1275  
	`°bi__lﬂd_™d_po°¥o˚ss_16bô
(&
s
,
x
,
y
,
ch™√ls_ö_fûe
,
desúed_ch™√ls
);

1276 
	}
}

1278 
STBIDEF
 
°bi_us
 *
	$°bi_lﬂd_16_‰om_ˇŒbacks
(
°bi_io_ˇŒbacks
 c⁄° *
˛bk
, *
u£r
, *
x
, *
y
, *
ch™√ls_ö_fûe
, 
desúed_ch™√ls
)

1280 
°bi__c⁄ãxt
 
s
;

1281 
	`°bi__°¨t_ˇŒbacks
(&
s
, (
°bi_io_ˇŒbacks
 *)
˛bk
, 
u£r
);

1282  
	`°bi__lﬂd_™d_po°¥o˚ss_16bô
(&
s
,
x
,
y
,
ch™√ls_ö_fûe
,
desúed_ch™√ls
);

1283 
	}
}

1285 
STBIDEF
 
°bi_uc
 *
	$°bi_lﬂd_‰om_mem‹y
(
°bi_uc
 c⁄° *
buf„r
, 
Àn
, *
x
, *
y
, *
comp
, 
ªq_comp
)

1287 
°bi__c⁄ãxt
 
s
;

1288 
	`°bi__°¨t_mem
(&
s
,
buf„r
,
Àn
);

1289  
	`°bi__lﬂd_™d_po°¥o˚ss_8bô
(&
s
,
x
,
y
,
comp
,
ªq_comp
);

1290 
	}
}

1292 
STBIDEF
 
°bi_uc
 *
	$°bi_lﬂd_‰om_ˇŒbacks
(
°bi_io_ˇŒbacks
 c⁄° *
˛bk
, *
u£r
, *
x
, *
y
, *
comp
, 
ªq_comp
)

1294 
°bi__c⁄ãxt
 
s
;

1295 
	`°bi__°¨t_ˇŒbacks
(&
s
, (
°bi_io_ˇŒbacks
 *Ë
˛bk
, 
u£r
);

1296  
	`°bi__lﬂd_™d_po°¥o˚ss_8bô
(&
s
,
x
,
y
,
comp
,
ªq_comp
);

1297 
	}
}

1299 #i‚de‡
STBI_NO_GIF


1300 
STBIDEF
 
°bi_uc
 *
	$°bi_lﬂd_gif_‰om_mem‹y
(
°bi_uc
 c⁄° *
buf„r
, 
Àn
, **
dñays
, *
x
, *
y
, *
z
, *
comp
, 
ªq_comp
)

1302 *
ªsu…
;

1303 
°bi__c⁄ãxt
 
s
;

1304 
	`°bi__°¨t_mem
(&
s
,
buf„r
,
Àn
);

1306 
ªsu…
 = (*Ë
	`°bi__lﬂd_gif_maö
(&
s
, 
dñays
, 
x
, 
y
, 
z
, 
comp
, 
ªq_comp
);

1307 i‡(
°bi__vîtiˇŒy_Êù_⁄_lﬂd
) {

1308 
	`°bi__vîtiˇl_Êù_¶i˚s
–
ªsu…
, *
x
, *
y
, *
z
, *
comp
 );

1311  
ªsu…
;

1312 
	}
}

1315 #i‚de‡
STBI_NO_LINEAR


1316 *
	$°bi__lﬂdf_maö
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
, 
ªq_comp
)

1318 *
d©a
;

1319 #i‚de‡
STBI_NO_HDR


1320 i‡(
	`°bi__hdr_ã°
(
s
)) {

1321 
°bi__ªsu…_öfo
 
ri
;

1322 *
hdr_d©a
 = 
	`°bi__hdr_lﬂd
(
s
,
x
,
y
,
comp
,
ªq_comp
, &
ri
);

1323 i‡(
hdr_d©a
)

1324 
	`°bi__Êﬂt_po°¥o˚ss
(
hdr_d©a
,
x
,
y
,
comp
,
ªq_comp
);

1325  
hdr_d©a
;

1328 
d©a
 = 
	`°bi__lﬂd_™d_po°¥o˚ss_8bô
(
s
, 
x
, 
y
, 
comp
, 
ªq_comp
);

1329 i‡(
d©a
)

1330  
	`°bi__ldr_to_hdr
(
d©a
, *
x
, *
y
, 
ªq_comp
 ?Ñeq_com∞: *
comp
);

1331  
	`°bi__îΩf
("unknown imageÅype", "ImageÇot ofány knownÅype, or corrupt");

1332 
	}
}

1334 
STBIDEF
 *
	$°bi_lﬂdf_‰om_mem‹y
(
°bi_uc
 c⁄° *
buf„r
, 
Àn
, *
x
, *
y
, *
comp
, 
ªq_comp
)

1336 
°bi__c⁄ãxt
 
s
;

1337 
	`°bi__°¨t_mem
(&
s
,
buf„r
,
Àn
);

1338  
	`°bi__lﬂdf_maö
(&
s
,
x
,
y
,
comp
,
ªq_comp
);

1339 
	}
}

1341 
STBIDEF
 *
	$°bi_lﬂdf_‰om_ˇŒbacks
(
°bi_io_ˇŒbacks
 c⁄° *
˛bk
, *
u£r
, *
x
, *
y
, *
comp
, 
ªq_comp
)

1343 
°bi__c⁄ãxt
 
s
;

1344 
	`°bi__°¨t_ˇŒbacks
(&
s
, (
°bi_io_ˇŒbacks
 *Ë
˛bk
, 
u£r
);

1345  
	`°bi__lﬂdf_maö
(&
s
,
x
,
y
,
comp
,
ªq_comp
);

1346 
	}
}

1348 #i‚de‡
STBI_NO_STDIO


1349 
STBIDEF
 *
	$°bi_lﬂdf
(c⁄° *
fûíame
, *
x
, *
y
, *
comp
, 
ªq_comp
)

1351 *
ªsu…
;

1352 
FILE
 *
f
 = 
	`°bi__f›í
(
fûíame
, "rb");

1353 i‡(!
f
Ë 
	`°bi__îΩf
("can't fopen", "UnableÅo open file");

1354 
ªsu…
 = 
	`°bi_lﬂdf_‰om_fûe
(
f
,
x
,
y
,
comp
,
ªq_comp
);

1355 
	`f˛o£
(
f
);

1356  
ªsu…
;

1357 
	}
}

1359 
STBIDEF
 *
	$°bi_lﬂdf_‰om_fûe
(
FILE
 *
f
, *
x
, *
y
, *
comp
, 
ªq_comp
)

1361 
°bi__c⁄ãxt
 
s
;

1362 
	`°bi__°¨t_fûe
(&
s
,
f
);

1363  
	`°bi__lﬂdf_maö
(&
s
,
x
,
y
,
comp
,
ªq_comp
);

1364 
	}
}

1373 
STBIDEF
 
	$°bi_is_hdr_‰om_mem‹y
(
°bi_uc
 c⁄° *
buf„r
, 
Àn
)

1375 #i‚de‡
STBI_NO_HDR


1376 
°bi__c⁄ãxt
 
s
;

1377 
	`°bi__°¨t_mem
(&
s
,
buf„r
,
Àn
);

1378  
	`°bi__hdr_ã°
(&
s
);

1380 
	`STBI_NOTUSED
(
buf„r
);

1381 
	`STBI_NOTUSED
(
Àn
);

1384 
	}
}

1386 #i‚de‡
STBI_NO_STDIO


1387 
STBIDEF
 
	$°bi_is_hdr
 (c⁄° *
fûíame
)

1389 
FILE
 *
f
 = 
	`°bi__f›í
(
fûíame
, "rb");

1390 
ªsu…
=0;

1391 i‡(
f
) {

1392 
ªsu…
 = 
	`°bi_is_hdr_‰om_fûe
(
f
);

1393 
	`f˛o£
(
f
);

1395  
ªsu…
;

1396 
	}
}

1398 
STBIDEF
 
	$°bi_is_hdr_‰om_fûe
(
FILE
 *
f
)

1400 #i‚de‡
STBI_NO_HDR


1401 
pos
 = 
	`·ñl
(
f
);

1402 
ªs
;

1403 
°bi__c⁄ãxt
 
s
;

1404 
	`°bi__°¨t_fûe
(&
s
,
f
);

1405 
ªs
 = 
	`°bi__hdr_ã°
(&
s
);

1406 
	`f£ek
(
f
, 
pos
, 
SEEK_SET
);

1407  
ªs
;

1409 
	`STBI_NOTUSED
(
f
);

1412 
	}
}

1415 
STBIDEF
 
	$°bi_is_hdr_‰om_ˇŒbacks
(
°bi_io_ˇŒbacks
 c⁄° *
˛bk
, *
u£r
)

1417 #i‚de‡
STBI_NO_HDR


1418 
°bi__c⁄ãxt
 
s
;

1419 
	`°bi__°¨t_ˇŒbacks
(&
s
, (
°bi_io_ˇŒbacks
 *Ë
˛bk
, 
u£r
);

1420  
	`°bi__hdr_ã°
(&
s
);

1422 
	`STBI_NOTUSED
(
˛bk
);

1423 
	`STBI_NOTUSED
(
u£r
);

1426 
	}
}

1428 #i‚de‡
STBI_NO_LINEAR


1429 
	g°bi__l2h_gamma
=2.2f, 
	g°bi__l2h_sˇÀ
=1.0f;

1431 
STBIDEF
 
	$°bi_ldr_to_hdr_gamma
(
gamma
Ë{ 
°bi__l2h_gamma
 = gamma; 
	}
}

1432 
STBIDEF
 
	$°bi_ldr_to_hdr_sˇÀ
(
sˇÀ
Ë{ 
°bi__l2h_sˇÀ
 = sˇÀ; 
	}
}

1435 
	g°bi__h2l_gamma_i
=1.0f/2.2f, 
	g°bi__h2l_sˇÀ_i
=1.0f;

1437 
STBIDEF
 
	$°bi_hdr_to_ldr_gamma
(
gamma
Ë{ 
°bi__h2l_gamma_i
 = 1/gamma; 
	}
}

1438 
STBIDEF
 
	$°bi_hdr_to_ldr_sˇÀ
(
sˇÀ
Ë{ 
°bi__h2l_sˇÀ_i
 = 1/sˇÀ; 
	}
}

1448 
	mSTBI__SCAN_lﬂd
=0,

1449 
	mSTBI__SCAN_ty≥
,

1450 
	mSTBI__SCAN_hódî


1453 
	$°bi__ªfûl_buf„r
(
°bi__c⁄ãxt
 *
s
)

1455 
n
 = (
s
->
io
.
ªad
)(s->
io_u£r_d©a
,(*)s->
buf„r_°¨t
,s->
buÊí
);

1456 i‡(
n
 == 0) {

1459 
s
->
ªad_‰om_ˇŒbacks
 = 0;

1460 
s
->
img_buf„r
 = s->
buf„r_°¨t
;

1461 
s
->
img_buf„r_íd
 = s->
buf„r_°¨t
+1;

1462 *
s
->
img_buf„r
 = 0;

1464 
s
->
img_buf„r
 = s->
buf„r_°¨t
;

1465 
s
->
img_buf„r_íd
 = s->
buf„r_°¨t
 + 
n
;

1467 
	}
}

1469 
°bi_ölöe
 
°bi_uc
 
	$°bi__gë8
(
°bi__c⁄ãxt
 *
s
)

1471 i‡(
s
->
img_buf„r
 < s->
img_buf„r_íd
)

1472  *
s
->
img_buf„r
++;

1473 i‡(
s
->
ªad_‰om_ˇŒbacks
) {

1474 
	`°bi__ªfûl_buf„r
(
s
);

1475  *
s
->
img_buf„r
++;

1478 
	}
}

1480 
°bi_ölöe
 
	$°bi__©_eof
(
°bi__c⁄ãxt
 *
s
)

1482 i‡(
s
->
io
.
ªad
) {

1483 i‡(!(
s
->
io
.
eof
)(s->
io_u£r_d©a
))  0;

1486 i‡(
s
->
ªad_‰om_ˇŒbacks
 == 0)  1;

1489  
s
->
img_buf„r
 >s->
img_buf„r_íd
;

1490 
	}
}

1492 
	$°bi__skù
(
°bi__c⁄ãxt
 *
s
, 
n
)

1494 i‡(
n
 < 0) {

1495 
s
->
img_buf„r
 = s->
img_buf„r_íd
;

1498 i‡(
s
->
io
.
ªad
) {

1499 
bÀn
 = (Ë(
s
->
img_buf„r_íd
 - s->
img_buf„r
);

1500 i‡(
bÀn
 < 
n
) {

1501 
s
->
img_buf„r
 = s->
img_buf„r_íd
;

1502 (
s
->
io
.
skù
)(s->
io_u£r_d©a
, 
n
 - 
bÀn
);

1506 
s
->
img_buf„r
 +
n
;

1507 
	}
}

1509 
	$°bi__gën
(
°bi__c⁄ãxt
 *
s
, 
°bi_uc
 *
buf„r
, 
n
)

1511 i‡(
s
->
io
.
ªad
) {

1512 
bÀn
 = (Ë(
s
->
img_buf„r_íd
 - s->
img_buf„r
);

1513 i‡(
bÀn
 < 
n
) {

1514 
ªs
, 
cou¡
;

1516 
	`mem˝y
(
buf„r
, 
s
->
img_buf„r
, 
bÀn
);

1518 
cou¡
 = (
s
->
io
.
ªad
)(s->
io_u£r_d©a
, (*Ë
buf„r
 + 
bÀn
, 
n
 - blen);

1519 
ªs
 = (
cou¡
 =(
n
-
bÀn
));

1520 
s
->
img_buf„r
 = s->
img_buf„r_íd
;

1521  
ªs
;

1525 i‡(
s
->
img_buf„r
+
n
 <s->
img_buf„r_íd
) {

1526 
	`mem˝y
(
buf„r
, 
s
->
img_buf„r
, 
n
);

1527 
s
->
img_buf„r
 +
n
;

1531 
	}
}

1533 
	$°bi__gë16be
(
°bi__c⁄ãxt
 *
s
)

1535 
z
 = 
	`°bi__gë8
(
s
);

1536  (
z
 << 8Ë+ 
	`°bi__gë8
(
s
);

1537 
	}
}

1539 
°bi__uöt32
 
	$°bi__gë32be
(
°bi__c⁄ãxt
 *
s
)

1541 
°bi__uöt32
 
z
 = 
	`°bi__gë16be
(
s
);

1542  (
z
 << 16Ë+ 
	`°bi__gë16be
(
s
);

1543 
	}
}

1545 #i‡
deföed
(
STBI_NO_BMP
Ë&& deföed(
STBI_NO_TGA
Ë&& deföed(
STBI_NO_GIF
)

1548 
	$°bi__gë16À
(
°bi__c⁄ãxt
 *
s
)

1550 
z
 = 
	`°bi__gë8
(
s
);

1551  
z
 + (
	`°bi__gë8
(
s
) << 8);

1552 
	}
}

1555 #i‚de‡
STBI_NO_BMP


1556 
°bi__uöt32
 
	$°bi__gë32À
(
°bi__c⁄ãxt
 *
s
)

1558 
°bi__uöt32
 
z
 = 
	`°bi__gë16À
(
s
);

1559  
z
 + (
	`°bi__gë16À
(
s
) << 16);

1560 
	}
}

1563 
	#STBI__BYTECAST
(
x
Ë((
°bi_uc
) ((x) & 255))

1564 

	)

1577 
°bi_uc
 
	$°bi__compuã_y
(
r
, 
g
, 
b
)

1579  (
°bi_uc
Ë(((
r
*77Ë+ (
g
*150Ë+ (29*
b
)) >> 8);

1580 
	}
}

1582 *
	$°bi__c⁄vît_f‹m©
(*
d©a
, 
img_n
, 
ªq_comp
, 
x
, 
y
)

1584 
i
,
j
;

1585 *
good
;

1587 i‡(
ªq_comp
 =
img_n
Ë 
d©a
;

1588 
	`STBI_ASSERT
(
ªq_comp
 >= 1 &&Ñeq_comp <= 4);

1590 
good
 = (*Ë
	`°bi__mÆloc_mad3
(
ªq_comp
, 
x
, 
y
, 0);

1591 i‡(
good
 =
NULL
) {

1592 
	`STBI_FREE
(
d©a
);

1593  
	`°bi__îΩuc
("outofmem", "Out of memory");

1596 
j
=0; j < (Ë
y
; ++j) {

1597 *
§c
 = 
d©a
 + 
j
 * 
x
 * 
img_n
 ;

1598 *
de°
 = 
good
 + 
j
 * 
x
 * 
ªq_comp
;

1600 
	#STBI__COMBO
(
a
,
b
Ë(◊)*8+(b))

	)

1601 
	#STBI__CASE
(
a
,
b
Ë
	`STBI__COMBO
◊,b): 
i
=
x
-1; i >0; --i, 
§c
 +a, 
de°
 +b)

	)

1604 
	`STBI__COMBO
(
img_n
, 
ªq_comp
)) {

1605 
	`STBI__CASE
(1,2Ë{ 
de°
[0]=
§c
[0]; dest[1]=255; } ;

1606 
	`STBI__CASE
(1,3Ë{ 
de°
[0]=de°[1]=de°[2]=
§c
[0]; } ;

1607 
	`STBI__CASE
(1,4Ë{ 
de°
[0]=de°[1]=de°[2]=
§c
[0]; dest[3]=255; } ;

1608 
	`STBI__CASE
(2,1Ë{ 
de°
[0]=
§c
[0]; } ;

1609 
	`STBI__CASE
(2,3Ë{ 
de°
[0]=de°[1]=de°[2]=
§c
[0]; } ;

1610 
	`STBI__CASE
(2,4Ë{ 
de°
[0]=de°[1]=de°[2]=
§c
[0]; dest[3]=src[1]; } ;

1611 
	`STBI__CASE
(3,4Ë{ 
de°
[0]=
§c
[0];dest[1]=src[1];dest[2]=src[2];dest[3]=255; } ;

1612 
	`STBI__CASE
(3,1Ë{ 
de°
[0]=
	`°bi__compuã_y
(
§c
[0],src[1],src[2]); } ;

1613 
	`STBI__CASE
(3,2Ë{ 
de°
[0]=
	`°bi__compuã_y
(
§c
[0],src[1],src[2]); dest[1] = 255; } ;

1614 
	`STBI__CASE
(4,1Ë{ 
de°
[0]=
	`°bi__compuã_y
(
§c
[0],src[1],src[2]); } ;

1615 
	`STBI__CASE
(4,2Ë{ 
de°
[0]=
	`°bi__compuã_y
(
§c
[0],src[1],src[2]); dest[1] = src[3]; } ;

1616 
	`STBI__CASE
(4,3Ë{ 
de°
[0]=
§c
[0];dest[1]=src[1];dest[2]=src[2]; } ;

1617 : 
	`STBI_ASSERT
(0);

1619 #unde‡
STBI__CASE


1622 
	`STBI_FREE
(
d©a
);

1623  
good
;

1624 
	}
}

1626 
°bi__uöt16
 
	$°bi__compuã_y_16
(
r
, 
g
, 
b
)

1628  (
°bi__uöt16
Ë(((
r
*77Ë+ (
g
*150Ë+ (29*
b
)) >> 8);

1629 
	}
}

1631 
°bi__uöt16
 *
	$°bi__c⁄vît_f‹m©16
(
°bi__uöt16
 *
d©a
, 
img_n
, 
ªq_comp
, 
x
, 
y
)

1633 
i
,
j
;

1634 
°bi__uöt16
 *
good
;

1636 i‡(
ªq_comp
 =
img_n
Ë 
d©a
;

1637 
	`STBI_ASSERT
(
ªq_comp
 >= 1 &&Ñeq_comp <= 4);

1639 
good
 = (
°bi__uöt16
 *Ë
	`°bi__mÆloc
(
ªq_comp
 * 
x
 * 
y
 * 2);

1640 i‡(
good
 =
NULL
) {

1641 
	`STBI_FREE
(
d©a
);

1642  (
°bi__uöt16
 *Ë
	`°bi__îΩuc
("outofmem", "Out of memory");

1645 
j
=0; j < (Ë
y
; ++j) {

1646 
°bi__uöt16
 *
§c
 = 
d©a
 + 
j
 * 
x
 * 
img_n
 ;

1647 
°bi__uöt16
 *
de°
 = 
good
 + 
j
 * 
x
 * 
ªq_comp
;

1649 
	#STBI__COMBO
(
a
,
b
Ë(◊)*8+(b))

	)

1650 
	#STBI__CASE
(
a
,
b
Ë
	`STBI__COMBO
◊,b): 
i
=
x
-1; i >0; --i, 
§c
 +a, 
de°
 +b)

	)

1653 
	`STBI__COMBO
(
img_n
, 
ªq_comp
)) {

1654 
	`STBI__CASE
(1,2Ë{ 
de°
[0]=
§c
[0]; dest[1]=0xffff; } ;

1655 
	`STBI__CASE
(1,3Ë{ 
de°
[0]=de°[1]=de°[2]=
§c
[0]; } ;

1656 
	`STBI__CASE
(1,4Ë{ 
de°
[0]=de°[1]=de°[2]=
§c
[0]; dest[3]=0xffff; } ;

1657 
	`STBI__CASE
(2,1Ë{ 
de°
[0]=
§c
[0]; } ;

1658 
	`STBI__CASE
(2,3Ë{ 
de°
[0]=de°[1]=de°[2]=
§c
[0]; } ;

1659 
	`STBI__CASE
(2,4Ë{ 
de°
[0]=de°[1]=de°[2]=
§c
[0]; dest[3]=src[1]; } ;

1660 
	`STBI__CASE
(3,4Ë{ 
de°
[0]=
§c
[0];dest[1]=src[1];dest[2]=src[2];dest[3]=0xffff; } ;

1661 
	`STBI__CASE
(3,1Ë{ 
de°
[0]=
	`°bi__compuã_y_16
(
§c
[0],src[1],src[2]); } ;

1662 
	`STBI__CASE
(3,2Ë{ 
de°
[0]=
	`°bi__compuã_y_16
(
§c
[0],src[1],src[2]); dest[1] = 0xffff; } ;

1663 
	`STBI__CASE
(4,1Ë{ 
de°
[0]=
	`°bi__compuã_y_16
(
§c
[0],src[1],src[2]); } ;

1664 
	`STBI__CASE
(4,2Ë{ 
de°
[0]=
	`°bi__compuã_y_16
(
§c
[0],src[1],src[2]); dest[1] = src[3]; } ;

1665 
	`STBI__CASE
(4,3Ë{ 
de°
[0]=
§c
[0];dest[1]=src[1];dest[2]=src[2]; } ;

1666 : 
	`STBI_ASSERT
(0);

1668 #unde‡
STBI__CASE


1671 
	`STBI_FREE
(
d©a
);

1672  
good
;

1673 
	}
}

1675 #i‚de‡
STBI_NO_LINEAR


1676 *
	$°bi__ldr_to_hdr
(
°bi_uc
 *
d©a
, 
x
, 
y
, 
comp
)

1678 
i
,
k
,
n
;

1679 *
ouçut
;

1680 i‡(!
d©a
Ë 
NULL
;

1681 
ouçut
 = (*Ë
	`°bi__mÆloc_mad4
(
x
, 
y
, 
comp
, (), 0);

1682 i‡(
ouçut
 =
NULL
Ë{ 
	`STBI_FREE
(
d©a
);  
	`°bi__îΩf
("outofmem", "Out of memory"); }

1684 i‡(
comp
 & 1Ë
n
 = comp; n = comp-1;

1685 
i
=0; i < 
x
*
y
; ++i) {

1686 
k
=0; k < 
n
; ++k) {

1687 
ouçut
[
i
*
comp
 + 
k
] = (Ë(
	`pow
(
d©a
[i*comp+k]/255.0f, 
°bi__l2h_gamma
Ë* 
°bi__l2h_sˇÀ
);

1690 i‡(
n
 < 
comp
) {

1691 
i
=0; i < 
x
*
y
; ++i) {

1692 
ouçut
[
i
*
comp
 + 
n
] = 
d©a
[i*comp +Ç]/255.0f;

1695 
	`STBI_FREE
(
d©a
);

1696  
ouçut
;

1697 
	}
}

1700 #i‚de‡
STBI_NO_HDR


1701 
	#°bi__Êﬂt2öt
(
x
Ë((Ë(x))

	)

1702 
°bi_uc
 *
	$°bi__hdr_to_ldr
(*
d©a
, 
x
, 
y
, 
comp
)

1704 
i
,
k
,
n
;

1705 
°bi_uc
 *
ouçut
;

1706 i‡(!
d©a
Ë 
NULL
;

1707 
ouçut
 = (
°bi_uc
 *Ë
	`°bi__mÆloc_mad3
(
x
, 
y
, 
comp
, 0);

1708 i‡(
ouçut
 =
NULL
Ë{ 
	`STBI_FREE
(
d©a
);  
	`°bi__îΩuc
("outofmem", "Out of memory"); }

1710 i‡(
comp
 & 1Ë
n
 = comp; n = comp-1;

1711 
i
=0; i < 
x
*
y
; ++i) {

1712 
k
=0; k < 
n
; ++k) {

1713 
z
 = (Ë
	`pow
(
d©a
[
i
*
comp
+
k
]*
°bi__h2l_sˇÀ_i
, 
°bi__h2l_gamma_i
) * 255 + 0.5f;

1714 i‡(
z
 < 0) z = 0;

1715 i‡(
z
 > 255) z = 255;

1716 
ouçut
[
i
*
comp
 + 
k
] = (
°bi_uc
Ë
	`°bi__Êﬂt2öt
(
z
);

1718 i‡(
k
 < 
comp
) {

1719 
z
 = 
d©a
[
i
*
comp
+
k
] * 255 + 0.5f;

1720 i‡(
z
 < 0) z = 0;

1721 i‡(
z
 > 255) z = 255;

1722 
ouçut
[
i
*
comp
 + 
k
] = (
°bi_uc
Ë
	`°bi__Êﬂt2öt
(
z
);

1725 
	`STBI_FREE
(
d©a
);

1726  
ouçut
;

1727 
	}
}

1751 #i‚de‡
STBI_NO_JPEG


1754 
	#FAST_BITS
 9

1755 

	)

1758 
°bi_uc
 
	mÁ°
[1 << 
FAST_BITS
];

1760 
°bi__uöt16
 
	mcode
[256];

1761 
°bi_uc
 
	mvÆues
[256];

1762 
°bi_uc
 
	msize
[257];

1763 
	mmaxcode
[18];

1764 
	mdñè
[17];

1765 } 
	t°bi__huffm™
;

1769 
°bi__c⁄ãxt
 *
	ms
;

1770 
°bi__huffm™
 
	mhuff_dc
[4];

1771 
°bi__huffm™
 
	mhuff_ac
[4];

1772 
°bi__uöt16
 
	mdequ™t
[4][64];

1773 
°bi__öt16
 
	mÁ°_ac
[4][1 << 
FAST_BITS
];

1776 
	mimg_h_max
, 
	mimg_v_max
;

1777 
	mimg_mcu_x
, 
	mimg_mcu_y
;

1778 
	mimg_mcu_w
, 
	mimg_mcu_h
;

1783 
	mid
;

1784 
	mh
,
	mv
;

1785 
	mtq
;

1786 
	mhd
,
	mha
;

1787 
	mdc_¥ed
;

1789 
	mx
,
	my
,
	mw2
,
	mh2
;

1790 
°bi_uc
 *
	md©a
;

1791 *
	møw_d©a
, *
	møw_c€ff
;

1792 
°bi_uc
 *
	mlöebuf
;

1793 *
	mc€ff
;

1794 
	mc€ff_w
, 
	mc€ff_h
;

1795 } 
	mimg_comp
[4];

1797 
°bi__uöt32
 
	mcode_buf„r
;

1798 
	mcode_bôs
;

1799 
	mm¨kî
;

1800 
	mnom‹e
;

1802 
	m¥ogªssive
;

1803 
	m•ec_°¨t
;

1804 
	m•ec_íd
;

1805 
	msucc_high
;

1806 
	msucc_low
;

1807 
	meob_run
;

1808 
	mjfif
;

1809 
	m≠p14_cﬁ‹_å™sf‹m
;

1810 
	mrgb
;

1812 
	msˇn_n
, 
	m‹dî
[4];

1813 
	mª°¨t_öãrvÆ
, 
	mtodo
;

1816 (*
	mid˘_block_kî√l
)(
°bi_uc
 *
	mout
, 
	mout_°ride
, 
	md©a
[64]);

1817 (*
	mYCbCr_to_RGB_kî√l
)(
°bi_uc
 *
	mout
, c⁄° stbi_u¯*
	my
, c⁄° stbi_u¯*
	mpcb
, c⁄° stbi_u¯*
	mp¸
, 
	mcou¡
, 
	m°ï
);

1818 
	m°bi_uc
 *(*
	mªßm∂e_row_hv_2_kî√l
)(
°bi_uc
 *
	mout
, stbi_u¯*
	mö_√¨
, stbi_u¯*
	mö_Ár
, 
	mw
, 
	mhs
);

1819 } 
	t°bi__j≥g
;

1821 
	$°bi__buûd_huffm™
(
°bi__huffm™
 *
h
, *
cou¡
)

1823 
i
,
j
,
k
=0;

1824 
code
;

1826 
i
=0; i < 16; ++i)

1827 
j
=0; j < 
cou¡
[
i
]; ++j)

1828 
h
->
size
[
k
++] = (
°bi_uc
Ë(
i
+1);

1829 
h
->
size
[
k
] = 0;

1832 
code
 = 0;

1833 
k
 = 0;

1834 
j
=1; j <= 16; ++j) {

1836 
h
->
dñè
[
j
] = 
k
 - 
code
;

1837 i‡(
h
->
size
[
k
] =
j
) {

1838 
h
->
size
[
k
] =
j
)

1839 
h
->
code
[
k
++] = (
°bi__uöt16
) (code++);

1840 i‡(
code
-1 >(1u << 
j
)Ë 
	`°bi__îr
("bad codeÜengths","Corrupt JPEG");

1843 
h
->
maxcode
[
j
] = 
code
 << (16-j);

1844 
code
 <<= 1;

1846 
h
->
maxcode
[
j
] = 0xffffffff;

1849 
	`mem£t
(
h
->
Á°
, 255, 1 << 
FAST_BITS
);

1850 
i
=0; i < 
k
; ++i) {

1851 
s
 = 
h
->
size
[
i
];

1852 i‡(
s
 <
FAST_BITS
) {

1853 
c
 = 
h
->
code
[
i
] << (
FAST_BITS
-
s
);

1854 
m
 = 1 << (
FAST_BITS
-
s
);

1855 
j
=0; j < 
m
; ++j) {

1856 
h
->
Á°
[
c
+
j
] = (
°bi_uc
Ë
i
;

1861 
	}
}

1865 
	$°bi__buûd_Á°_ac
(
°bi__öt16
 *
Á°_ac
, 
°bi__huffm™
 *
h
)

1867 
i
;

1868 
i
=0; i < (1 << 
FAST_BITS
); ++i) {

1869 
°bi_uc
 
Á°
 = 
h
->Á°[
i
];

1870 
Á°_ac
[
i
] = 0;

1871 i‡(
Á°
 < 255) {

1872 
rs
 = 
h
->
vÆues
[
Á°
];

1873 
run
 = (
rs
 >> 4) & 15;

1874 
magbôs
 = 
rs
 & 15;

1875 
Àn
 = 
h
->
size
[
Á°
];

1877 i‡(
magbôs
 && 
Àn
 + magbô†<
FAST_BITS
) {

1879 
k
 = ((
i
 << 
Àn
Ë& ((1 << 
FAST_BITS
Ë- 1)Ë>> (FAST_BITS - 
magbôs
);

1880 
m
 = 1 << (
magbôs
 - 1);

1881 i‡(
k
 < 
m
Ëk +(~0U << 
magbôs
) + 1;

1883 i‡(
k
 >= -128 && k <= 127)

1884 
Á°_ac
[
i
] = (
°bi__öt16
Ë((
k
 * 256Ë+ (
run
 * 16Ë+ (
Àn
 + 
magbôs
));

1888 
	}
}

1890 
	$°bi__grow_buf„r_unß„
(
°bi__j≥g
 *
j
)

1893 
b
 = 
j
->
nom‹e
 ? 0 : 
	`°bi__gë8
(j->
s
);

1894 i‡(
b
 == 0xff) {

1895 
c
 = 
	`°bi__gë8
(
j
->
s
);

1896 
c
 =0xffË¯
	`°bi__gë8
(
j
->
s
);

1897 i‡(
c
 != 0) {

1898 
j
->
m¨kî
 = (Ë
c
;

1899 
j
->
nom‹e
 = 1;

1903 
j
->
code_buf„r
 |
b
 << (24 - j->
code_bôs
);

1904 
j
->
code_bôs
 += 8;

1905 } 
j
->
code_bôs
 <= 24);

1906 
	}
}

1909 c⁄° 
°bi__uöt32
 
	g°bi__bmask
[17]={0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535};

1912 
°bi_ölöe
 
	$°bi__j≥g_huff_decode
(
°bi__j≥g
 *
j
, 
°bi__huffm™
 *
h
)

1914 
ãmp
;

1915 
c
,
k
;

1917 i‡(
j
->
code_bôs
 < 16Ë
	`°bi__grow_buf„r_unß„
(j);

1921 
c
 = (
j
->
code_buf„r
 >> (32 - 
FAST_BITS
)) & ((1 << FAST_BITS)-1);

1922 
k
 = 
h
->
Á°
[
c
];

1923 i‡(
k
 < 255) {

1924 
s
 = 
h
->
size
[
k
];

1925 i‡(
s
 > 
j
->
code_bôs
)

1927 
j
->
code_buf„r
 <<
s
;

1928 
j
->
code_bôs
 -
s
;

1929  
h
->
vÆues
[
k
];

1938 
ãmp
 = 
j
->
code_buf„r
 >> 16;

1939 
k
=
FAST_BITS
+1 ; ; ++k)

1940 i‡(
ãmp
 < 
h
->
maxcode
[
k
])

1942 i‡(
k
 == 17) {

1944 
j
->
code_bôs
 -= 16;

1948 i‡(
k
 > 
j
->
code_bôs
)

1952 
c
 = ((
j
->
code_buf„r
 >> (32 - 
k
)Ë& 
°bi__bmask
[k]Ë+ 
h
->
dñè
[k];

1953 
	`STBI_ASSERT
((((
j
->
code_buf„r
Ë>> (32 - 
h
->
size
[
c
])Ë& 
°bi__bmask
[h->size[c]]Ë=h->
code
[c]);

1956 
j
->
code_bôs
 -
k
;

1957 
j
->
code_buf„r
 <<
k
;

1958  
h
->
vÆues
[
c
];

1959 
	}
}

1962 c⁄° 
	g°bi__jbüs
[16] = {0,-1,-3,-7,-15,-31,-63,-127,-255,-511,-1023,-2047,-4095,-8191,-16383,-32767};

1966 
°bi_ölöe
 
	$°bi__exãnd_ª˚ive
(
°bi__j≥g
 *
j
, 
n
)

1968 
k
;

1969 
sgn
;

1970 i‡(
j
->
code_bôs
 < 
n
Ë
	`°bi__grow_buf„r_unß„
(j);

1972 
sgn
 = (
°bi__öt32
)
j
->
code_buf„r
 >> 31;

1973 
k
 = 
	`°bi_ÃŸ
(
j
->
code_buf„r
, 
n
);

1974 
	`STBI_ASSERT
(
n
 >0 &&Ç < (Ë((
°bi__bmask
)/(*stbi__bmask)));

1975 
j
->
code_buf„r
 = 
k
 & ~
°bi__bmask
[
n
];

1976 
k
 &
°bi__bmask
[
n
];

1977 
j
->
code_bôs
 -
n
;

1978  
k
 + (
°bi__jbüs
[
n
] & ~
sgn
);

1979 
	}
}

1982 
°bi_ölöe
 
	$°bi__j≥g_gë_bôs
(
°bi__j≥g
 *
j
, 
n
)

1984 
k
;

1985 i‡(
j
->
code_bôs
 < 
n
Ë
	`°bi__grow_buf„r_unß„
(j);

1986 
k
 = 
	`°bi_ÃŸ
(
j
->
code_buf„r
, 
n
);

1987 
j
->
code_buf„r
 = 
k
 & ~
°bi__bmask
[
n
];

1988 
k
 &
°bi__bmask
[
n
];

1989 
j
->
code_bôs
 -
n
;

1990  
k
;

1991 
	}
}

1993 
°bi_ölöe
 
	$°bi__j≥g_gë_bô
(
°bi__j≥g
 *
j
)

1995 
k
;

1996 i‡(
j
->
code_bôs
 < 1Ë
	`°bi__grow_buf„r_unß„
(j);

1997 
k
 = 
j
->
code_buf„r
;

1998 
j
->
code_buf„r
 <<= 1;

1999 --
j
->
code_bôs
;

2000  
k
 & 0x80000000;

2001 
	}
}

2005 c⁄° 
°bi_uc
 
	g°bi__j≥g_dezigzag
[64+15] =

2021 
	$°bi__j≥g_decode_block
(
°bi__j≥g
 *
j
, 
d©a
[64], 
°bi__huffm™
 *
hdc
, stbi__huffm™ *
hac
, 
°bi__öt16
 *
Ác
, 
b
, 
°bi__uöt16
 *
dequ™t
)

2023 
diff
,
dc
,
k
;

2024 
t
;

2026 i‡(
j
->
code_bôs
 < 16Ë
	`°bi__grow_buf„r_unß„
(j);

2027 
t
 = 
	`°bi__j≥g_huff_decode
(
j
, 
hdc
);

2028 i‡(
t
 < 0Ë 
	`°bi__îr
("bad huffman code","Corrupt JPEG");

2031 
	`mem£t
(
d©a
,0,64*(data[0]));

2033 
diff
 = 
t
 ? 
	`°bi__exãnd_ª˚ive
(
j
,Å) : 0;

2034 
dc
 = 
j
->
img_comp
[
b
].
dc_¥ed
 + 
diff
;

2035 
j
->
img_comp
[
b
].
dc_¥ed
 = 
dc
;

2036 
d©a
[0] = (Ë(
dc
 * 
dequ™t
[0]);

2039 
k
 = 1;

2041 
zig
;

2042 
c
,
r
,
s
;

2043 i‡(
j
->
code_bôs
 < 16Ë
	`°bi__grow_buf„r_unß„
(j);

2044 
c
 = (
j
->
code_buf„r
 >> (32 - 
FAST_BITS
)) & ((1 << FAST_BITS)-1);

2045 
r
 = 
Ác
[
c
];

2046 i‡(
r
) {

2047 
k
 +(
r
 >> 4) & 15;

2048 
s
 = 
r
 & 15;

2049 
j
->
code_buf„r
 <<
s
;

2050 
j
->
code_bôs
 -
s
;

2052 
zig
 = 
°bi__j≥g_dezigzag
[
k
++];

2053 
d©a
[
zig
] = (Ë((
r
 >> 8Ë* 
dequ™t
[zig]);

2055 
rs
 = 
	`°bi__j≥g_huff_decode
(
j
, 
hac
);

2056 i‡(
rs
 < 0Ë 
	`°bi__îr
("bad huffman code","Corrupt JPEG");

2057 
s
 = 
rs
 & 15;

2058 
r
 = 
rs
 >> 4;

2059 i‡(
s
 == 0) {

2060 i‡(
rs
 != 0xf0) ;

2061 
k
 += 16;

2063 
k
 +
r
;

2065 
zig
 = 
°bi__j≥g_dezigzag
[
k
++];

2066 
d©a
[
zig
] = (Ë(
	`°bi__exãnd_ª˚ive
(
j
,
s
Ë* 
dequ™t
[zig]);

2069 } 
k
 < 64);

2071 
	}
}

2073 
	$°bi__j≥g_decode_block_¥og_dc
(
°bi__j≥g
 *
j
, 
d©a
[64], 
°bi__huffm™
 *
hdc
, 
b
)

2075 
diff
,
dc
;

2076 
t
;

2077 i‡(
j
->
•ec_íd
 !0Ë 
	`°bi__îr
("can't merge dcándác", "Corrupt JPEG");

2079 i‡(
j
->
code_bôs
 < 16Ë
	`°bi__grow_buf„r_unß„
(j);

2081 i‡(
j
->
succ_high
 == 0) {

2083 
	`mem£t
(
d©a
,0,64*(data[0]));

2084 
t
 = 
	`°bi__j≥g_huff_decode
(
j
, 
hdc
);

2085 
diff
 = 
t
 ? 
	`°bi__exãnd_ª˚ive
(
j
,Å) : 0;

2087 
dc
 = 
j
->
img_comp
[
b
].
dc_¥ed
 + 
diff
;

2088 
j
->
img_comp
[
b
].
dc_¥ed
 = 
dc
;

2089 
d©a
[0] = (Ë(
dc
 << 
j
->
succ_low
);

2092 i‡(
	`°bi__j≥g_gë_bô
(
j
))

2093 
d©a
[0] +(Ë(1 << 
j
->
succ_low
);

2096 
	}
}

2100 
	$°bi__j≥g_decode_block_¥og_ac
(
°bi__j≥g
 *
j
, 
d©a
[64], 
°bi__huffm™
 *
hac
, 
°bi__öt16
 *
Ác
)

2102 
k
;

2103 i‡(
j
->
•ec_°¨t
 =0Ë 
	`°bi__îr
("can't merge dcándác", "Corrupt JPEG");

2105 i‡(
j
->
succ_high
 == 0) {

2106 
shi·
 = 
j
->
succ_low
;

2108 i‡(
j
->
eob_run
) {

2109 --
j
->
eob_run
;

2113 
k
 = 
j
->
•ec_°¨t
;

2115 
zig
;

2116 
c
,
r
,
s
;

2117 i‡(
j
->
code_bôs
 < 16Ë
	`°bi__grow_buf„r_unß„
(j);

2118 
c
 = (
j
->
code_buf„r
 >> (32 - 
FAST_BITS
)) & ((1 << FAST_BITS)-1);

2119 
r
 = 
Ác
[
c
];

2120 i‡(
r
) {

2121 
k
 +(
r
 >> 4) & 15;

2122 
s
 = 
r
 & 15;

2123 
j
->
code_buf„r
 <<
s
;

2124 
j
->
code_bôs
 -
s
;

2125 
zig
 = 
°bi__j≥g_dezigzag
[
k
++];

2126 
d©a
[
zig
] = (Ë((
r
 >> 8Ë<< 
shi·
);

2128 
rs
 = 
	`°bi__j≥g_huff_decode
(
j
, 
hac
);

2129 i‡(
rs
 < 0Ë 
	`°bi__îr
("bad huffman code","Corrupt JPEG");

2130 
s
 = 
rs
 & 15;

2131 
r
 = 
rs
 >> 4;

2132 i‡(
s
 == 0) {

2133 i‡(
r
 < 15) {

2134 
j
->
eob_run
 = (1 << 
r
);

2135 i‡(
r
)

2136 
j
->
eob_run
 +
	`°bi__j≥g_gë_bôs
(j, 
r
);

2137 --
j
->
eob_run
;

2140 
k
 += 16;

2142 
k
 +
r
;

2143 
zig
 = 
°bi__j≥g_dezigzag
[
k
++];

2144 
d©a
[
zig
] = (Ë(
	`°bi__exãnd_ª˚ive
(
j
,
s
Ë<< 
shi·
);

2147 } 
k
 <
j
->
•ec_íd
);

2151 
bô
 = (Ë(1 << 
j
->
succ_low
);

2153 i‡(
j
->
eob_run
) {

2154 --
j
->
eob_run
;

2155 
k
 = 
j
->
•ec_°¨t
; k <j->
•ec_íd
; ++k) {

2156 *
p
 = &
d©a
[
°bi__j≥g_dezigzag
[
k
]];

2157 i‡(*
p
 != 0)

2158 i‡(
	`°bi__j≥g_gë_bô
(
j
))

2159 i‡((*
p
 & 
bô
)==0) {

2160 i‡(*
p
 > 0)

2161 *
p
 +
bô
;

2163 *
p
 -
bô
;

2167 
k
 = 
j
->
•ec_°¨t
;

2169 
r
,
s
;

2170 
rs
 = 
	`°bi__j≥g_huff_decode
(
j
, 
hac
);

2171 i‡(
rs
 < 0Ë 
	`°bi__îr
("bad huffman code","Corrupt JPEG");

2172 
s
 = 
rs
 & 15;

2173 
r
 = 
rs
 >> 4;

2174 i‡(
s
 == 0) {

2175 i‡(
r
 < 15) {

2176 
j
->
eob_run
 = (1 << 
r
) - 1;

2177 i‡(
r
)

2178 
j
->
eob_run
 +
	`°bi__j≥g_gë_bôs
(j, 
r
);

2179 
r
 = 64;

2186 i‡(
s
 !1Ë 
	`°bi__îr
("bad huffman code", "Corrupt JPEG");

2188 i‡(
	`°bi__j≥g_gë_bô
(
j
))

2189 
s
 = 
bô
;

2191 
s
 = -
bô
;

2195 
k
 <
j
->
•ec_íd
) {

2196 *
p
 = &
d©a
[
°bi__j≥g_dezigzag
[
k
++]];

2197 i‡(*
p
 != 0) {

2198 i‡(
	`°bi__j≥g_gë_bô
(
j
))

2199 i‡((*
p
 & 
bô
)==0) {

2200 i‡(*
p
 > 0)

2201 *
p
 +
bô
;

2203 *
p
 -
bô
;

2206 i‡(
r
 == 0) {

2207 *
p
 = (Ë
s
;

2210 --
r
;

2213 } 
k
 <
j
->
•ec_íd
);

2217 
	}
}

2220 
°bi_ölöe
 
°bi_uc
 
	$°bi__˛amp
(
x
)

2223 i‡((Ë
x
 > 255) {

2224 i‡(
x
 < 0)  0;

2225 i‡(
x
 > 255)  255;

2227  (
°bi_uc
Ë
x
;

2228 
	}
}

2230 
	#°bi__f2f
(
x
Ë((Ë(((xË* 4096 + 0.5)))

	)

2231 
	#°bi__fsh
(
x
Ë((xË* 4096)

	)

2234 
	#STBI__IDCT_1D
(
s0
,
s1
,
s2
,
s3
,
s4
,
s5
,
s6
,
s7
) \

2235 
t0
,
t1
,
t2
,
t3
,
p1
,
p2
,
p3
,
p4
,
p5
,
x0
,
x1
,
x2
,
x3
; \

2236 
p2
 = 
s2
; \

2237 
p3
 = 
s6
; \

2238 
p1
 = (
p2
+
p3
Ë* 
	`°bi__f2f
(0.5411961f); \

2239 
t2
 = 
p1
 + 
p3
*
	`°bi__f2f
(-1.847759065f); \

2240 
t3
 = 
p1
 + 
p2
*
	`°bi__f2f
( 0.765366865f); \

2241 
p2
 = 
s0
; \

2242 
p3
 = 
s4
; \

2243 
t0
 = 
	`°bi__fsh
(
p2
+
p3
); \

2244 
t1
 = 
	`°bi__fsh
(
p2
-
p3
); \

2245 
x0
 = 
t0
+
t3
; \

2246 
x3
 = 
t0
-
t3
; \

2247 
x1
 = 
t1
+
t2
; \

2248 
x2
 = 
t1
-
t2
; \

2249 
t0
 = 
s7
; \

2250 
t1
 = 
s5
; \

2251 
t2
 = 
s3
; \

2252 
t3
 = 
s1
; \

2253 
p3
 = 
t0
+
t2
; \

2254 
p4
 = 
t1
+
t3
; \

2255 
p1
 = 
t0
+
t3
; \

2256 
p2
 = 
t1
+
t2
; \

2257 
p5
 = (
p3
+
p4
)*
	`°bi__f2f
( 1.175875602f); \

2258 
t0
 =Å0*
	`°bi__f2f
( 0.298631336f); \

2259 
t1
 =Å1*
	`°bi__f2f
( 2.053119869f); \

2260 
t2
 =Å2*
	`°bi__f2f
( 3.072711026f); \

2261 
t3
 =Å3*
	`°bi__f2f
( 1.501321110f); \

2262 
p1
 = 
p5
 +Ö1*
	`°bi__f2f
(-0.899976223f); \

2263 
p2
 = 
p5
 +Ö2*
	`°bi__f2f
(-2.562915447f); \

2264 
p3
 =Ö3*
	`°bi__f2f
(-1.961570560f); \

2265 
p4
 =Ö4*
	`°bi__f2f
(-0.390180644f); \

2266 
t3
 +
p1
+
p4
; \

2267 
t2
 +
p2
+
p3
; \

2268 
t1
 +
p2
+
p4
; \

2269 
t0
 +
p1
+
p3
;

	)

2271 
	$°bi__id˘_block
(
°bi_uc
 *
out
, 
out_°ride
, 
d©a
[64])

2273 
i
,
vÆ
[64],*
v
=val;

2274 
°bi_uc
 *
o
;

2275 *
d
 = 
d©a
;

2278 
i
=0; i < 8; ++i,++
d
, ++
v
) {

2280 i‡(
d
[ 8]==0 && d[16]==0 && d[24]==0 && d[32]==0

2281 && 
d
[40]==0 && d[48]==0 && d[56]==0) {

2286 
d˘îm
 = 
d
[0]*4;

2287 
v
[0] = v[8] = v[16] = v[24] = v[32] = v[40] = v[48] = v[56] = 
d˘îm
;

2289 
	`STBI__IDCT_1D
(
d
[ 0],d[ 8],d[16],d[24],d[32],d[40],d[48],d[56])

2292 
x0
 +512; 
x1
 +512; 
x2
 +512; 
x3
 += 512;

2293 
v
[ 0] = (
x0
+
t3
) >> 10;

2294 
v
[56] = (
x0
-
t3
) >> 10;

2295 
v
[ 8] = (
x1
+
t2
) >> 10;

2296 
v
[48] = (
x1
-
t2
) >> 10;

2297 
v
[16] = (
x2
+
t1
) >> 10;

2298 
v
[40] = (
x2
-
t1
) >> 10;

2299 
v
[24] = (
x3
+
t0
) >> 10;

2300 
v
[32] = (
x3
-
t0
) >> 10;

2304 
i
=0, 
v
=
vÆ
, 
o
=
out
; i < 8; ++i,v+=8,o+=
out_°ride
) {

2306 
	`STBI__IDCT_1D
(
v
[0],v[1],v[2],v[3],v[4],v[5],v[6],v[7])

2313 
x0
 += 65536 + (128<<17);

2314 
x1
 += 65536 + (128<<17);

2315 
x2
 += 65536 + (128<<17);

2316 
x3
 += 65536 + (128<<17);

2319 
o
[0] = 
	`°bi__˛amp
((
x0
+
t3
) >> 17);

2320 
o
[7] = 
	`°bi__˛amp
((
x0
-
t3
) >> 17);

2321 
o
[1] = 
	`°bi__˛amp
((
x1
+
t2
) >> 17);

2322 
o
[6] = 
	`°bi__˛amp
((
x1
-
t2
) >> 17);

2323 
o
[2] = 
	`°bi__˛amp
((
x2
+
t1
) >> 17);

2324 
o
[5] = 
	`°bi__˛amp
((
x2
-
t1
) >> 17);

2325 
o
[3] = 
	`°bi__˛amp
((
x3
+
t0
) >> 17);

2326 
o
[4] = 
	`°bi__˛amp
((
x3
-
t0
) >> 17);

2328 
	}
}

2330 #ifde‡
STBI_SSE2


2334 
	$°bi__id˘_simd
(
°bi_uc
 *
out
, 
out_°ride
, 
d©a
[64])

2337 
__m128i
 
row0
, 
row1
, 
row2
, 
row3
, 
row4
, 
row5
, 
row6
, 
row7
;

2338 
__m128i
 
tmp
;

2341 
	#d˘_c⁄°
(
x
,
y
Ë
	`_mm_£å_ïi16
((x),(y),(x),(y),(x),(y),(x),(y))

	)

2345 
	#d˘_rŸ
(
out0
,
out1
, 
x
,
y
,
c0
,
c1
) \

2346 
__m128i
 
c0
##
lo
 = 
	`_mm_u≈acklo_ïi16
((
x
),(
y
)); \

2347 
__m128i
 
c0
##
hi
 = 
	`_mm_u≈ackhi_ïi16
((
x
),(
y
)); \

2348 
__m128i
 
out0
##
_l
 = 
	`_mm_madd_ïi16
(
c0
##
lo
, c0); \

2349 
__m128i
 
out0
##
_h
 = 
	`_mm_madd_ïi16
(
c0
##
hi
, c0); \

2350 
__m128i
 
out1
##
_l
 = 
	`_mm_madd_ïi16
(
c0
##
lo
, 
c1
); \

2351 
__m128i
 
out1
##
_h
 = 
	`_mm_madd_ïi16
(
c0
##
hi
, 
c1
)

	)

2354 
	#d˘_widí
(
out
, 
ö
) \

2355 
__m128i
 
out
##
_l
 = 
	`_mm_§ai_ïi32
(
	`_mm_u≈acklo_ïi16
(
	`_mm_£tzîo_si128
(), (
ö
)), 4); \

2356 
__m128i
 
out
##
_h
 = 
	`_mm_§ai_ïi32
(
	`_mm_u≈ackhi_ïi16
(
	`_mm_£tzîo_si128
(), (
ö
)), 4)

	)

2359 
	#d˘_wadd
(
out
, 
a
, 
b
) \

2360 
__m128i
 
out
##
_l
 = 
	`_mm_add_ïi32
(
a
##_l, 
b
##_l); \

2361 
__m128i
 
out
##
_h
 = 
	`_mm_add_ïi32
(
a
##_h, 
b
##_h)

	)

2364 
	#d˘_wsub
(
out
, 
a
, 
b
) \

2365 
__m128i
 
out
##
_l
 = 
	`_mm_sub_ïi32
(
a
##_l, 
b
##_l); \

2366 
__m128i
 
out
##
_h
 = 
	`_mm_sub_ïi32
(
a
##_h, 
b
##_h)

	)

2369 
	#d˘_bÊy32o
(
out0
, 
out1
, 
a
,
b
,
büs
,
s
) \

2371 
__m128i
 
abü£d_l
 = 
	`_mm_add_ïi32
(
a
##
_l
, 
büs
); \

2372 
__m128i
 
abü£d_h
 = 
	`_mm_add_ïi32
(
a
##
_h
, 
büs
); \

2373 
	`d˘_wadd
(
sum
, 
abü£d
, 
b
); \

2374 
	`d˘_wsub
(
dif
, 
abü£d
, 
b
); \

2375 
out0
 = 
	`_mm_∑cks_ïi32
(
	`_mm_§ai_ïi32
(
sum_l
, 
s
), _mm_§ai_ïi32(
sum_h
, s)); \

2376 
out1
 = 
	`_mm_∑cks_ïi32
(
	`_mm_§ai_ïi32
(
dif_l
, 
s
), _mm_§ai_ïi32(
dif_h
, s)); \

2377 }

	)

2380 
	#d˘_öãæóve8
(
a
, 
b
) \

2381 
tmp
 = 
a
; \

2382 
a
 = 
	`_mm_u≈acklo_ïi8
◊, 
b
); \

2383 
b
 = 
	`_mm_u≈ackhi_ïi8
(
tmp
, b)

	)

2386 
	#d˘_öãæóve16
(
a
, 
b
) \

2387 
tmp
 = 
a
; \

2388 
a
 = 
	`_mm_u≈acklo_ïi16
◊, 
b
); \

2389 
b
 = 
	`_mm_u≈ackhi_ïi16
(
tmp
, b)

	)

2391 
	#d˘_∑ss
(
büs
,
shi·
) \

2394 
	`d˘_rŸ
(
t2e
,
t3e
, 
row2
,
row6
, 
rŸ0_0
,
rŸ0_1
); \

2395 
__m128i
 
sum04
 = 
	`_mm_add_ïi16
(
row0
, 
row4
); \

2396 
__m128i
 
dif04
 = 
	`_mm_sub_ïi16
(
row0
, 
row4
); \

2397 
	`d˘_widí
(
t0e
, 
sum04
); \

2398 
	`d˘_widí
(
t1e
, 
dif04
); \

2399 
	`d˘_wadd
(
x0
, 
t0e
, 
t3e
); \

2400 
	`d˘_wsub
(
x3
, 
t0e
, 
t3e
); \

2401 
	`d˘_wadd
(
x1
, 
t1e
, 
t2e
); \

2402 
	`d˘_wsub
(
x2
, 
t1e
, 
t2e
); \

2404 
	`d˘_rŸ
(
y0o
,
y2o
, 
row7
,
row3
, 
rŸ2_0
,
rŸ2_1
); \

2405 
	`d˘_rŸ
(
y1o
,
y3o
, 
row5
,
row1
, 
rŸ3_0
,
rŸ3_1
); \

2406 
__m128i
 
sum17
 = 
	`_mm_add_ïi16
(
row1
, 
row7
); \

2407 
__m128i
 
sum35
 = 
	`_mm_add_ïi16
(
row3
, 
row5
); \

2408 
	`d˘_rŸ
(
y4o
,
y5o
, 
sum17
,
sum35
, 
rŸ1_0
,
rŸ1_1
); \

2409 
	`d˘_wadd
(
x4
, 
y0o
, 
y4o
); \

2410 
	`d˘_wadd
(
x5
, 
y1o
, 
y5o
); \

2411 
	`d˘_wadd
(
x6
, 
y2o
, 
y5o
); \

2412 
	`d˘_wadd
(
x7
, 
y3o
, 
y4o
); \

2413 
	`d˘_bÊy32o
(
row0
,
row7
, 
x0
,
x7
,
büs
,
shi·
); \

2414 
	`d˘_bÊy32o
(
row1
,
row6
, 
x1
,
x6
,
büs
,
shi·
); \

2415 
	`d˘_bÊy32o
(
row2
,
row5
, 
x2
,
x5
,
büs
,
shi·
); \

2416 
	`d˘_bÊy32o
(
row3
,
row4
, 
x3
,
x4
,
büs
,
shi·
); \

2417 }

	)

2419 
__m128i
 
rŸ0_0
 = 
	`d˘_c⁄°
(
	`°bi__f2f
(0.5411961f), stbi__f2f(0.5411961f) + stbi__f2f(-1.847759065f));

2420 
__m128i
 
rŸ0_1
 = 
	`d˘_c⁄°
(
	`°bi__f2f
(0.5411961f) + stbi__f2f( 0.765366865f), stbi__f2f(0.5411961f));

2421 
__m128i
 
rŸ1_0
 = 
	`d˘_c⁄°
(
	`°bi__f2f
(1.175875602f) + stbi__f2f(-0.899976223f), stbi__f2f(1.175875602f));

2422 
__m128i
 
rŸ1_1
 = 
	`d˘_c⁄°
(
	`°bi__f2f
(1.175875602f), stbi__f2f(1.175875602f) + stbi__f2f(-2.562915447f));

2423 
__m128i
 
rŸ2_0
 = 
	`d˘_c⁄°
(
	`°bi__f2f
(-1.961570560f) + stbi__f2f( 0.298631336f), stbi__f2f(-1.961570560f));

2424 
__m128i
 
rŸ2_1
 = 
	`d˘_c⁄°
(
	`°bi__f2f
(-1.961570560f), stbi__f2f(-1.961570560f) + stbi__f2f( 3.072711026f));

2425 
__m128i
 
rŸ3_0
 = 
	`d˘_c⁄°
(
	`°bi__f2f
(-0.390180644f) + stbi__f2f( 2.053119869f), stbi__f2f(-0.390180644f));

2426 
__m128i
 
rŸ3_1
 = 
	`d˘_c⁄°
(
	`°bi__f2f
(-0.390180644f), stbi__f2f(-0.390180644f) + stbi__f2f( 1.501321110f));

2429 
__m128i
 
büs_0
 = 
	`_mm_£t1_ïi32
(512);

2430 
__m128i
 
büs_1
 = 
	`_mm_£t1_ïi32
(65536 + (128<<17));

2433 
row0
 = 
	`_mm_lﬂd_si128
((c⁄° 
__m128i
 *Ë(
d©a
 + 0*8));

2434 
row1
 = 
	`_mm_lﬂd_si128
((c⁄° 
__m128i
 *Ë(
d©a
 + 1*8));

2435 
row2
 = 
	`_mm_lﬂd_si128
((c⁄° 
__m128i
 *Ë(
d©a
 + 2*8));

2436 
row3
 = 
	`_mm_lﬂd_si128
((c⁄° 
__m128i
 *Ë(
d©a
 + 3*8));

2437 
row4
 = 
	`_mm_lﬂd_si128
((c⁄° 
__m128i
 *Ë(
d©a
 + 4*8));

2438 
row5
 = 
	`_mm_lﬂd_si128
((c⁄° 
__m128i
 *Ë(
d©a
 + 5*8));

2439 
row6
 = 
	`_mm_lﬂd_si128
((c⁄° 
__m128i
 *Ë(
d©a
 + 6*8));

2440 
row7
 = 
	`_mm_lﬂd_si128
((c⁄° 
__m128i
 *Ë(
d©a
 + 7*8));

2443 
	`d˘_∑ss
(
büs_0
, 10);

2447 
	`d˘_öãæóve16
(
row0
, 
row4
);

2448 
	`d˘_öãæóve16
(
row1
, 
row5
);

2449 
	`d˘_öãæóve16
(
row2
, 
row6
);

2450 
	`d˘_öãæóve16
(
row3
, 
row7
);

2453 
	`d˘_öãæóve16
(
row0
, 
row2
);

2454 
	`d˘_öãæóve16
(
row1
, 
row3
);

2455 
	`d˘_öãæóve16
(
row4
, 
row6
);

2456 
	`d˘_öãæóve16
(
row5
, 
row7
);

2459 
	`d˘_öãæóve16
(
row0
, 
row1
);

2460 
	`d˘_öãæóve16
(
row2
, 
row3
);

2461 
	`d˘_öãæóve16
(
row4
, 
row5
);

2462 
	`d˘_öãæóve16
(
row6
, 
row7
);

2466 
	`d˘_∑ss
(
büs_1
, 17);

2470 
__m128i
 
p0
 = 
	`_mm_∑ckus_ïi16
(
row0
, 
row1
);

2471 
__m128i
 
p1
 = 
	`_mm_∑ckus_ïi16
(
row2
, 
row3
);

2472 
__m128i
 
p2
 = 
	`_mm_∑ckus_ïi16
(
row4
, 
row5
);

2473 
__m128i
 
p3
 = 
	`_mm_∑ckus_ïi16
(
row6
, 
row7
);

2476 
	`d˘_öãæóve8
(
p0
, 
p2
);

2477 
	`d˘_öãæóve8
(
p1
, 
p3
);

2480 
	`d˘_öãæóve8
(
p0
, 
p1
);

2481 
	`d˘_öãæóve8
(
p2
, 
p3
);

2484 
	`d˘_öãæóve8
(
p0
, 
p2
);

2485 
	`d˘_öãæóve8
(
p1
, 
p3
);

2488 
	`_mm_°‹ñ_ïi64
((
__m128i
 *Ë
out
, 
p0
); ouà+
out_°ride
;

2489 
	`_mm_°‹ñ_ïi64
((
__m128i
 *Ë
out
, 
	`_mm_shufÊe_ïi32
(
p0
, 0x4e)); ouà+
out_°ride
;

2490 
	`_mm_°‹ñ_ïi64
((
__m128i
 *Ë
out
, 
p2
); ouà+
out_°ride
;

2491 
	`_mm_°‹ñ_ïi64
((
__m128i
 *Ë
out
, 
	`_mm_shufÊe_ïi32
(
p2
, 0x4e)); ouà+
out_°ride
;

2492 
	`_mm_°‹ñ_ïi64
((
__m128i
 *Ë
out
, 
p1
); ouà+
out_°ride
;

2493 
	`_mm_°‹ñ_ïi64
((
__m128i
 *Ë
out
, 
	`_mm_shufÊe_ïi32
(
p1
, 0x4e)); ouà+
out_°ride
;

2494 
	`_mm_°‹ñ_ïi64
((
__m128i
 *Ë
out
, 
p3
); ouà+
out_°ride
;

2495 
	`_mm_°‹ñ_ïi64
((
__m128i
 *Ë
out
, 
	`_mm_shufÊe_ïi32
(
p3
, 0x4e));

2498 #unde‡
d˘_c⁄°


2499 #unde‡
d˘_rŸ


2500 #unde‡
d˘_widí


2501 #unde‡
d˘_wadd


2502 #unde‡
d˘_wsub


2503 #unde‡
d˘_bÊy32o


2504 #unde‡
d˘_öãæóve8


2505 #unde‡
d˘_öãæóve16


2506 #unde‡
d˘_∑ss


2507 
	}
}

2511 #ifde‡
STBI_NEON


2515 
	$°bi__id˘_simd
(
°bi_uc
 *
out
, 
out_°ride
, 
d©a
[64])

2517 
öt16x8_t
 
row0
, 
row1
, 
row2
, 
row3
, 
row4
, 
row5
, 
row6
, 
row7
;

2519 
öt16x4_t
 
rŸ0_0
 = 
	`vdup_n_s16
(
	`°bi__f2f
(0.5411961f));

2520 
öt16x4_t
 
rŸ0_1
 = 
	`vdup_n_s16
(
	`°bi__f2f
(-1.847759065f));

2521 
öt16x4_t
 
rŸ0_2
 = 
	`vdup_n_s16
(
	`°bi__f2f
( 0.765366865f));

2522 
öt16x4_t
 
rŸ1_0
 = 
	`vdup_n_s16
(
	`°bi__f2f
( 1.175875602f));

2523 
öt16x4_t
 
rŸ1_1
 = 
	`vdup_n_s16
(
	`°bi__f2f
(-0.899976223f));

2524 
öt16x4_t
 
rŸ1_2
 = 
	`vdup_n_s16
(
	`°bi__f2f
(-2.562915447f));

2525 
öt16x4_t
 
rŸ2_0
 = 
	`vdup_n_s16
(
	`°bi__f2f
(-1.961570560f));

2526 
öt16x4_t
 
rŸ2_1
 = 
	`vdup_n_s16
(
	`°bi__f2f
(-0.390180644f));

2527 
öt16x4_t
 
rŸ3_0
 = 
	`vdup_n_s16
(
	`°bi__f2f
( 0.298631336f));

2528 
öt16x4_t
 
rŸ3_1
 = 
	`vdup_n_s16
(
	`°bi__f2f
( 2.053119869f));

2529 
öt16x4_t
 
rŸ3_2
 = 
	`vdup_n_s16
(
	`°bi__f2f
( 3.072711026f));

2530 
öt16x4_t
 
rŸ3_3
 = 
	`vdup_n_s16
(
	`°bi__f2f
( 1.501321110f));

2532 
	#d˘_l⁄g_mul
(
out
, 
öq
, 
c€ff
) \

2533 
öt32x4_t
 
out
##
_l
 = 
	`vmuŒ_s16
(
	`vgë_low_s16
(
öq
), 
c€ff
); \

2534 
öt32x4_t
 
out
##
_h
 = 
	`vmuŒ_s16
(
	`vgë_high_s16
(
öq
), 
c€ff
)

	)

2536 
	#d˘_l⁄g_mac
(
out
, 
acc
, 
öq
, 
c€ff
) \

2537 
öt32x4_t
 
out
##
_l
 = 
	`vmœl_s16
(
acc
##_l, 
	`vgë_low_s16
(
öq
), 
c€ff
); \

2538 
öt32x4_t
 
out
##
_h
 = 
	`vmœl_s16
(
acc
##_h, 
	`vgë_high_s16
(
öq
), 
c€ff
)

	)

2540 
	#d˘_widí
(
out
, 
öq
) \

2541 
öt32x4_t
 
out
##
_l
 = 
	`vshŒ_n_s16
(
	`vgë_low_s16
(
öq
), 12); \

2542 
öt32x4_t
 
out
##
_h
 = 
	`vshŒ_n_s16
(
	`vgë_high_s16
(
öq
), 12)

	)

2545 
	#d˘_wadd
(
out
, 
a
, 
b
) \

2546 
öt32x4_t
 
out
##
_l
 = 
	`vaddq_s32
(
a
##_l, 
b
##_l); \

2547 
öt32x4_t
 
out
##
_h
 = 
	`vaddq_s32
(
a
##_h, 
b
##_h)

	)

2550 
	#d˘_wsub
(
out
, 
a
, 
b
) \

2551 
öt32x4_t
 
out
##
_l
 = 
	`vsubq_s32
(
a
##_l, 
b
##_l); \

2552 
öt32x4_t
 
out
##
_h
 = 
	`vsubq_s32
(
a
##_h, 
b
##_h)

	)

2555 
	#d˘_bÊy32o
(
out0
,
out1
, 
a
,
b
,
shi·›
,
s
) \

2557 
	`d˘_wadd
(
sum
, 
a
, 
b
); \

2558 
	`d˘_wsub
(
dif
, 
a
, 
b
); \

2559 
out0
 = 
	`vcomböe_s16
(
	`shi·›
(
sum_l
, 
s
), shi·›(
sum_h
, s)); \

2560 
out1
 = 
	`vcomböe_s16
(
	`shi·›
(
dif_l
, 
s
), shi·›(
dif_h
, s)); \

2561 }

	)

2563 
	#d˘_∑ss
(
shi·›
, 
shi·
) \

2566 
öt16x8_t
 
sum26
 = 
	`vaddq_s16
(
row2
, 
row6
); \

2567 
	`d˘_l⁄g_mul
(
p1e
, 
sum26
, 
rŸ0_0
); \

2568 
	`d˘_l⁄g_mac
(
t2e
, 
p1e
, 
row6
, 
rŸ0_1
); \

2569 
	`d˘_l⁄g_mac
(
t3e
, 
p1e
, 
row2
, 
rŸ0_2
); \

2570 
öt16x8_t
 
sum04
 = 
	`vaddq_s16
(
row0
, 
row4
); \

2571 
öt16x8_t
 
dif04
 = 
	`vsubq_s16
(
row0
, 
row4
); \

2572 
	`d˘_widí
(
t0e
, 
sum04
); \

2573 
	`d˘_widí
(
t1e
, 
dif04
); \

2574 
	`d˘_wadd
(
x0
, 
t0e
, 
t3e
); \

2575 
	`d˘_wsub
(
x3
, 
t0e
, 
t3e
); \

2576 
	`d˘_wadd
(
x1
, 
t1e
, 
t2e
); \

2577 
	`d˘_wsub
(
x2
, 
t1e
, 
t2e
); \

2579 
öt16x8_t
 
sum15
 = 
	`vaddq_s16
(
row1
, 
row5
); \

2580 
öt16x8_t
 
sum17
 = 
	`vaddq_s16
(
row1
, 
row7
); \

2581 
öt16x8_t
 
sum35
 = 
	`vaddq_s16
(
row3
, 
row5
); \

2582 
öt16x8_t
 
sum37
 = 
	`vaddq_s16
(
row3
, 
row7
); \

2583 
öt16x8_t
 
sumodd
 = 
	`vaddq_s16
(
sum17
, 
sum35
); \

2584 
	`d˘_l⁄g_mul
(
p5o
, 
sumodd
, 
rŸ1_0
); \

2585 
	`d˘_l⁄g_mac
(
p1o
, 
p5o
, 
sum17
, 
rŸ1_1
); \

2586 
	`d˘_l⁄g_mac
(
p2o
, 
p5o
, 
sum35
, 
rŸ1_2
); \

2587 
	`d˘_l⁄g_mul
(
p3o
, 
sum37
, 
rŸ2_0
); \

2588 
	`d˘_l⁄g_mul
(
p4o
, 
sum15
, 
rŸ2_1
); \

2589 
	`d˘_wadd
(
sump13o
, 
p1o
, 
p3o
); \

2590 
	`d˘_wadd
(
sump24o
, 
p2o
, 
p4o
); \

2591 
	`d˘_wadd
(
sump23o
, 
p2o
, 
p3o
); \

2592 
	`d˘_wadd
(
sump14o
, 
p1o
, 
p4o
); \

2593 
	`d˘_l⁄g_mac
(
x4
, 
sump13o
, 
row7
, 
rŸ3_0
); \

2594 
	`d˘_l⁄g_mac
(
x5
, 
sump24o
, 
row5
, 
rŸ3_1
); \

2595 
	`d˘_l⁄g_mac
(
x6
, 
sump23o
, 
row3
, 
rŸ3_2
); \

2596 
	`d˘_l⁄g_mac
(
x7
, 
sump14o
, 
row1
, 
rŸ3_3
); \

2597 
	`d˘_bÊy32o
(
row0
,
row7
, 
x0
,
x7
,
shi·›
,
shi·
); \

2598 
	`d˘_bÊy32o
(
row1
,
row6
, 
x1
,
x6
,
shi·›
,
shi·
); \

2599 
	`d˘_bÊy32o
(
row2
,
row5
, 
x2
,
x5
,
shi·›
,
shi·
); \

2600 
	`d˘_bÊy32o
(
row3
,
row4
, 
x3
,
x4
,
shi·›
,
shi·
); \

2601 }

	)

2604 
row0
 = 
	`vld1q_s16
(
d©a
 + 0*8);

2605 
row1
 = 
	`vld1q_s16
(
d©a
 + 1*8);

2606 
row2
 = 
	`vld1q_s16
(
d©a
 + 2*8);

2607 
row3
 = 
	`vld1q_s16
(
d©a
 + 3*8);

2608 
row4
 = 
	`vld1q_s16
(
d©a
 + 4*8);

2609 
row5
 = 
	`vld1q_s16
(
d©a
 + 5*8);

2610 
row6
 = 
	`vld1q_s16
(
d©a
 + 6*8);

2611 
row7
 = 
	`vld1q_s16
(
d©a
 + 7*8);

2614 
row0
 = 
	`vaddq_s16
‘ow0, 
	`v£tq_œ√_s16
(1024, 
	`vdupq_n_s16
(0), 0));

2617 
	`d˘_∑ss
(
vrsh∫_n_s32
, 10);

2623 
	#d˘_ån16
(
x
, 
y
Ë{ 
öt16x8x2_t
 
t
 = 
	`vånq_s16
(x, y); x =Å.
vÆ
[0]; y =Å.vÆ[1]; }

	)

2624 
	#d˘_ån32
(
x
, 
y
Ë{ 
öt32x4x2_t
 
t
 = 
	`vånq_s32
(
	`vªöãΩªtq_s32_s16
(x), vªöãΩªtq_s32_s16(y)); x = 
	`vªöãΩªtq_s16_s32
—.
vÆ
[0]); y = vªöãΩªtq_s16_s32—.vÆ[1]); }

	)

2625 
	#d˘_ån64
(
x
, 
y
Ë{ 
öt16x8_t
 
x0
 = x; i¡16x8_à
y0
 = y; x = 
	`vcomböe_s16
(
	`vgë_low_s16
(x0), vgë_low_s16(y0)); y = vcomböe_s16(
	`vgë_high_s16
(x0), vgë_high_s16(y0)); }

	)

2628 
	`d˘_ån16
(
row0
, 
row1
);

2629 
	`d˘_ån16
(
row2
, 
row3
);

2630 
	`d˘_ån16
(
row4
, 
row5
);

2631 
	`d˘_ån16
(
row6
, 
row7
);

2634 
	`d˘_ån32
(
row0
, 
row2
);

2635 
	`d˘_ån32
(
row1
, 
row3
);

2636 
	`d˘_ån32
(
row4
, 
row6
);

2637 
	`d˘_ån32
(
row5
, 
row7
);

2640 
	`d˘_ån64
(
row0
, 
row4
);

2641 
	`d˘_ån64
(
row1
, 
row5
);

2642 
	`d˘_ån64
(
row2
, 
row6
);

2643 
	`d˘_ån64
(
row3
, 
row7
);

2645 #unde‡
d˘_ån16


2646 #unde‡
d˘_ån32


2647 #unde‡
d˘_ån64


2654 
	`d˘_∑ss
(
vsh∫_n_s32
, 16);

2658 
uöt8x8_t
 
p0
 = 
	`vqrshrun_n_s16
(
row0
, 1);

2659 
uöt8x8_t
 
p1
 = 
	`vqrshrun_n_s16
(
row1
, 1);

2660 
uöt8x8_t
 
p2
 = 
	`vqrshrun_n_s16
(
row2
, 1);

2661 
uöt8x8_t
 
p3
 = 
	`vqrshrun_n_s16
(
row3
, 1);

2662 
uöt8x8_t
 
p4
 = 
	`vqrshrun_n_s16
(
row4
, 1);

2663 
uöt8x8_t
 
p5
 = 
	`vqrshrun_n_s16
(
row5
, 1);

2664 
uöt8x8_t
 
p6
 = 
	`vqrshrun_n_s16
(
row6
, 1);

2665 
uöt8x8_t
 
p7
 = 
	`vqrshrun_n_s16
(
row7
, 1);

2668 
	#d˘_ån8_8
(
x
, 
y
Ë{ 
uöt8x8x2_t
 
t
 = 
	`vån_u8
(x, y); x =Å.
vÆ
[0]; y =Å.vÆ[1]; }

	)

2669 
	#d˘_ån8_16
(
x
, 
y
Ë{ 
uöt16x4x2_t
 
t
 = 
	`vån_u16
(
	`vªöãΩªt_u16_u8
(x), vªöãΩªt_u16_u8(y)); x = 
	`vªöãΩªt_u8_u16
—.
vÆ
[0]); y = vªöãΩªt_u8_u16—.vÆ[1]); }

	)

2670 
	#d˘_ån8_32
(
x
, 
y
Ë{ 
uöt32x2x2_t
 
t
 = 
	`vån_u32
(
	`vªöãΩªt_u32_u8
(x), vªöãΩªt_u32_u8(y)); x = 
	`vªöãΩªt_u8_u32
—.
vÆ
[0]); y = vªöãΩªt_u8_u32—.vÆ[1]); }

	)

2676 
	`d˘_ån8_8
(
p0
, 
p1
);

2677 
	`d˘_ån8_8
(
p2
, 
p3
);

2678 
	`d˘_ån8_8
(
p4
, 
p5
);

2679 
	`d˘_ån8_8
(
p6
, 
p7
);

2682 
	`d˘_ån8_16
(
p0
, 
p2
);

2683 
	`d˘_ån8_16
(
p1
, 
p3
);

2684 
	`d˘_ån8_16
(
p4
, 
p6
);

2685 
	`d˘_ån8_16
(
p5
, 
p7
);

2688 
	`d˘_ån8_32
(
p0
, 
p4
);

2689 
	`d˘_ån8_32
(
p1
, 
p5
);

2690 
	`d˘_ån8_32
(
p2
, 
p6
);

2691 
	`d˘_ån8_32
(
p3
, 
p7
);

2694 
	`v°1_u8
(
out
, 
p0
); ouà+
out_°ride
;

2695 
	`v°1_u8
(
out
, 
p1
); ouà+
out_°ride
;

2696 
	`v°1_u8
(
out
, 
p2
); ouà+
out_°ride
;

2697 
	`v°1_u8
(
out
, 
p3
); ouà+
out_°ride
;

2698 
	`v°1_u8
(
out
, 
p4
); ouà+
out_°ride
;

2699 
	`v°1_u8
(
out
, 
p5
); ouà+
out_°ride
;

2700 
	`v°1_u8
(
out
, 
p6
); ouà+
out_°ride
;

2701 
	`v°1_u8
(
out
, 
p7
);

2703 #unde‡
d˘_ån8_8


2704 #unde‡
d˘_ån8_16


2705 #unde‡
d˘_ån8_32


2708 #unde‡
d˘_l⁄g_mul


2709 #unde‡
d˘_l⁄g_mac


2710 #unde‡
d˘_widí


2711 #unde‡
d˘_wadd


2712 #unde‡
d˘_wsub


2713 #unde‡
d˘_bÊy32o


2714 #unde‡
d˘_∑ss


2715 
	}
}

2719 
	#STBI__MARKER_n⁄e
 0xff

	)

2723 
°bi_uc
 
	$°bi__gë_m¨kî
(
°bi__j≥g
 *
j
)

2725 
°bi_uc
 
x
;

2726 i‡(
j
->
m¨kî
 !
STBI__MARKER_n⁄e
Ë{ 
x
 = j->marker; j->marker = STBI__MARKER_none;  x; }

2727 
x
 = 
	`°bi__gë8
(
j
->
s
);

2728 i‡(
x
 !0xffË 
STBI__MARKER_n⁄e
;

2729 
x
 == 0xff)

2730 
x
 = 
	`°bi__gë8
(
j
->
s
);

2731  
x
;

2732 
	}
}

2736 
	#STBI__RESTART
(
x
Ë((xË>0xd0 && (xË<0xd7)

	)

2740 
	$°bi__j≥g_ª£t
(
°bi__j≥g
 *
j
)

2742 
j
->
code_bôs
 = 0;

2743 
j
->
code_buf„r
 = 0;

2744 
j
->
nom‹e
 = 0;

2745 
j
->
img_comp
[0].
dc_¥ed
 = j->img_comp[1].dc_pred = j->img_comp[2].dc_pred = j->img_comp[3].dc_pred = 0;

2746 
j
->
m¨kî
 = 
STBI__MARKER_n⁄e
;

2747 
j
->
todo
 = j->
ª°¨t_öãrvÆ
 ? j->restart_interval : 0x7fffffff;

2748 
j
->
eob_run
 = 0;

2751 
	}
}

2753 
	$°bi__∑r£_íå›y_coded_d©a
(
°bi__j≥g
 *
z
)

2755 
	`°bi__j≥g_ª£t
(
z
);

2756 i‡(!
z
->
¥ogªssive
) {

2757 i‡(
z
->
sˇn_n
 == 1) {

2758 
i
,
j
;

2759 
	`STBI_SIMD_ALIGN
(, 
d©a
[64]);

2760 
n
 = 
z
->
‹dî
[0];

2765 
w
 = (
z
->
img_comp
[
n
].
x
+7) >> 3;

2766 
h
 = (
z
->
img_comp
[
n
].
y
+7) >> 3;

2767 
j
=0; j < 
h
; ++j) {

2768 
i
=0; i < 
w
; ++i) {

2769 
ha
 = 
z
->
img_comp
[
n
].ha;

2770 i‡(!
	`°bi__j≥g_decode_block
(
z
, 
d©a
, z->
huff_dc
+z->
img_comp
[
n
].
hd
, z->
huff_ac
+
ha
, z->
Á°_ac
[ha],Ç, z->
dequ™t
[z->img_comp[n].
tq
]))  0;

2771 
z
->
	`id˘_block_kî√l
(z->
img_comp
[
n
].
d©a
+z->img_comp[n].
w2
*
j
*8+
i
*8, z->img_comp[n].w2, data);

2773 i‡(--
z
->
todo
 <= 0) {

2774 i‡(
z
->
code_bôs
 < 24Ë
	`°bi__grow_buf„r_unß„
(z);

2777 i‡(!
	`STBI__RESTART
(
z
->
m¨kî
))  1;

2778 
	`°bi__j≥g_ª£t
(
z
);

2784 
i
,
j
,
k
,
x
,
y
;

2785 
	`STBI_SIMD_ALIGN
(, 
d©a
[64]);

2786 
j
=0; j < 
z
->
img_mcu_y
; ++j) {

2787 
i
=0; i < 
z
->
img_mcu_x
; ++i) {

2789 
k
=0; k < 
z
->
sˇn_n
; ++k) {

2790 
n
 = 
z
->
‹dî
[
k
];

2793 
y
=0; y < 
z
->
img_comp
[
n
].
v
; ++y) {

2794 
x
=0; x < 
z
->
img_comp
[
n
].
h
; ++x) {

2795 
x2
 = (
i
*
z
->
img_comp
[
n
].
h
 + 
x
)*8;

2796 
y2
 = (
j
*
z
->
img_comp
[
n
].
v
 + 
y
)*8;

2797 
ha
 = 
z
->
img_comp
[
n
].ha;

2798 i‡(!
	`°bi__j≥g_decode_block
(
z
, 
d©a
, z->
huff_dc
+z->
img_comp
[
n
].
hd
, z->
huff_ac
+
ha
, z->
Á°_ac
[ha],Ç, z->
dequ™t
[z->img_comp[n].
tq
]))  0;

2799 
z
->
	`id˘_block_kî√l
(z->
img_comp
[
n
].
d©a
+z->img_comp[n].
w2
*
y2
+
x2
, z->img_comp[n].w2, data);

2805 i‡(--
z
->
todo
 <= 0) {

2806 i‡(
z
->
code_bôs
 < 24Ë
	`°bi__grow_buf„r_unß„
(z);

2807 i‡(!
	`STBI__RESTART
(
z
->
m¨kî
))  1;

2808 
	`°bi__j≥g_ª£t
(
z
);

2815 i‡(
z
->
sˇn_n
 == 1) {

2816 
i
,
j
;

2817 
n
 = 
z
->
‹dî
[0];

2822 
w
 = (
z
->
img_comp
[
n
].
x
+7) >> 3;

2823 
h
 = (
z
->
img_comp
[
n
].
y
+7) >> 3;

2824 
j
=0; j < 
h
; ++j) {

2825 
i
=0; i < 
w
; ++i) {

2826 *
d©a
 = 
z
->
img_comp
[
n
].
c€ff
 + 64 * (
i
 + 
j
 * z->img_comp[n].
c€ff_w
);

2827 i‡(
z
->
•ec_°¨t
 == 0) {

2828 i‡(!
	`°bi__j≥g_decode_block_¥og_dc
(
z
, 
d©a
, &z->
huff_dc
[z->
img_comp
[
n
].
hd
],Ç))

2831 
ha
 = 
z
->
img_comp
[
n
].ha;

2832 i‡(!
	`°bi__j≥g_decode_block_¥og_ac
(
z
, 
d©a
, &z->
huff_ac
[
ha
], z->
Á°_ac
[ha]))

2836 i‡(--
z
->
todo
 <= 0) {

2837 i‡(
z
->
code_bôs
 < 24Ë
	`°bi__grow_buf„r_unß„
(z);

2838 i‡(!
	`STBI__RESTART
(
z
->
m¨kî
))  1;

2839 
	`°bi__j≥g_ª£t
(
z
);

2845 
i
,
j
,
k
,
x
,
y
;

2846 
j
=0; j < 
z
->
img_mcu_y
; ++j) {

2847 
i
=0; i < 
z
->
img_mcu_x
; ++i) {

2849 
k
=0; k < 
z
->
sˇn_n
; ++k) {

2850 
n
 = 
z
->
‹dî
[
k
];

2853 
y
=0; y < 
z
->
img_comp
[
n
].
v
; ++y) {

2854 
x
=0; x < 
z
->
img_comp
[
n
].
h
; ++x) {

2855 
x2
 = (
i
*
z
->
img_comp
[
n
].
h
 + 
x
);

2856 
y2
 = (
j
*
z
->
img_comp
[
n
].
v
 + 
y
);

2857 *
d©a
 = 
z
->
img_comp
[
n
].
c€ff
 + 64 * (
x2
 + 
y2
 * z->img_comp[n].
c€ff_w
);

2858 i‡(!
	`°bi__j≥g_decode_block_¥og_dc
(
z
, 
d©a
, &z->
huff_dc
[z->
img_comp
[
n
].
hd
],Ç))

2865 i‡(--
z
->
todo
 <= 0) {

2866 i‡(
z
->
code_bôs
 < 24Ë
	`°bi__grow_buf„r_unß„
(z);

2867 i‡(!
	`STBI__RESTART
(
z
->
m¨kî
))  1;

2868 
	`°bi__j≥g_ª£t
(
z
);

2875 
	}
}

2877 
	$°bi__j≥g_dequ™tize
(*
d©a
, 
°bi__uöt16
 *
dequ™t
)

2879 
i
;

2880 
i
=0; i < 64; ++i)

2881 
d©a
[
i
] *
dequ™t
[i];

2882 
	}
}

2884 
	$°bi__j≥g_föish
(
°bi__j≥g
 *
z
)

2886 i‡(
z
->
¥ogªssive
) {

2888 
i
,
j
,
n
;

2889 
n
=0;Ç < 
z
->
s
->
img_n
; ++n) {

2890 
w
 = (
z
->
img_comp
[
n
].
x
+7) >> 3;

2891 
h
 = (
z
->
img_comp
[
n
].
y
+7) >> 3;

2892 
j
=0; j < 
h
; ++j) {

2893 
i
=0; i < 
w
; ++i) {

2894 *
d©a
 = 
z
->
img_comp
[
n
].
c€ff
 + 64 * (
i
 + 
j
 * z->img_comp[n].
c€ff_w
);

2895 
	`°bi__j≥g_dequ™tize
(
d©a
, 
z
->
dequ™t
[z->
img_comp
[
n
].
tq
]);

2896 
z
->
	`id˘_block_kî√l
(z->
img_comp
[
n
].
d©a
+z->img_comp[n].
w2
*
j
*8+
i
*8, z->img_comp[n].w2, data);

2901 
	}
}

2903 
	$°bi__¥o˚ss_m¨kî
(
°bi__j≥g
 *
z
, 
m
)

2905 
L
;

2906 
m
) {

2907 
STBI__MARKER_n⁄e
:

2908  
	`°bi__îr
("expected marker","Corrupt JPEG");

2911 i‡(
	`°bi__gë16be
(
z
->
s
Ë!4Ë 
	`°bi__îr
("bad DRIÜen","Corrupt JPEG");

2912 
z
->
ª°¨t_öãrvÆ
 = 
	`°bi__gë16be
(z->
s
);

2916 
L
 = 
	`°bi__gë16be
(
z
->
s
)-2;

2917 
L
 > 0) {

2918 
q
 = 
	`°bi__gë8
(
z
->
s
);

2919 
p
 = 
q
 >> 4, 
sixãí
 = (p != 0);

2920 
t
 = 
q
 & 15,
i
;

2921 i‡(
p
 !0 &&Ö !1Ë 
	`°bi__îr
("bad DQTÅype","Corrupt JPEG");

2922 i‡(
t
 > 3Ë 
	`°bi__îr
("bad DQTÅable","Corrupt JPEG");

2924 
i
=0; i < 64; ++i)

2925 
z
->
dequ™t
[
t
][
°bi__j≥g_dezigzag
[
i
]] = (
°bi__uöt16
)(
sixãí
 ? 
	`°bi__gë16be
(z->
s
Ë: 
	`°bi__gë8
(z->s));

2926 
L
 -(
sixãí
 ? 129 : 65);

2928  
L
==0;

2931 
L
 = 
	`°bi__gë16be
(
z
->
s
)-2;

2932 
L
 > 0) {

2933 
°bi_uc
 *
v
;

2934 
sizes
[16],
i
,
n
=0;

2935 
q
 = 
	`°bi__gë8
(
z
->
s
);

2936 
tc
 = 
q
 >> 4;

2937 
th
 = 
q
 & 15;

2938 i‡(
tc
 > 1 || 
th
 > 3Ë 
	`°bi__îr
("bad DHT header","Corrupt JPEG");

2939 
i
=0; i < 16; ++i) {

2940 
sizes
[
i
] = 
	`°bi__gë8
(
z
->
s
);

2941 
n
 +
sizes
[
i
];

2943 
L
 -= 17;

2944 i‡(
tc
 == 0) {

2945 i‡(!
	`°bi__buûd_huffm™
(
z
->
huff_dc
+
th
, 
sizes
))  0;

2946 
v
 = 
z
->
huff_dc
[
th
].
vÆues
;

2948 i‡(!
	`°bi__buûd_huffm™
(
z
->
huff_ac
+
th
, 
sizes
))  0;

2949 
v
 = 
z
->
huff_ac
[
th
].
vÆues
;

2951 
i
=0; i < 
n
; ++i)

2952 
v
[
i
] = 
	`°bi__gë8
(
z
->
s
);

2953 i‡(
tc
 != 0)

2954 
	`°bi__buûd_Á°_ac
(
z
->
Á°_ac
[
th
], z->
huff_ac
 +Åh);

2955 
L
 -
n
;

2957  
L
==0;

2961 i‡((
m
 >= 0xE0 && m <= 0xEF) || m == 0xFE) {

2962 
L
 = 
	`°bi__gë16be
(
z
->
s
);

2963 i‡(
L
 < 2) {

2964 i‡(
m
 == 0xFE)

2965  
	`°bi__îr
("bad COMÜen","Corrupt JPEG");

2967  
	`°bi__îr
("bad APPÜen","Corrupt JPEG");

2969 
L
 -= 2;

2971 i‡(
m
 =0xE0 && 
L
 >= 5) {

2972 c⁄° 
èg
[5] = {'J','F','I','F','\0'};

2973 
ok
 = 1;

2974 
i
;

2975 
i
=0; i < 5; ++i)

2976 i‡(
	`°bi__gë8
(
z
->
s
Ë!
èg
[
i
])

2977 
ok
 = 0;

2978 
L
 -= 5;

2979 i‡(
ok
)

2980 
z
->
jfif
 = 1;

2981 } i‡(
m
 =0xEE && 
L
 >= 12) {

2982 c⁄° 
èg
[6] = {'A','d','o','b','e','\0'};

2983 
ok
 = 1;

2984 
i
;

2985 
i
=0; i < 6; ++i)

2986 i‡(
	`°bi__gë8
(
z
->
s
Ë!
èg
[
i
])

2987 
ok
 = 0;

2988 
L
 -= 6;

2989 i‡(
ok
) {

2990 
	`°bi__gë8
(
z
->
s
);

2991 
	`°bi__gë16be
(
z
->
s
);

2992 
	`°bi__gë16be
(
z
->
s
);

2993 
z
->
≠p14_cﬁ‹_å™sf‹m
 = 
	`°bi__gë8
(z->
s
);

2994 
L
 -= 6;

2998 
	`°bi__skù
(
z
->
s
, 
L
);

3002  
	`°bi__îr
("unknown marker","Corrupt JPEG");

3003 
	}
}

3006 
	$°bi__¥o˚ss_sˇn_hódî
(
°bi__j≥g
 *
z
)

3008 
i
;

3009 
Ls
 = 
	`°bi__gë16be
(
z
->
s
);

3010 
z
->
sˇn_n
 = 
	`°bi__gë8
(z->
s
);

3011 i‡(
z
->
sˇn_n
 < 1 || z->sˇn_¿> 4 || z->sˇn_¿> (Ëz->
s
->
img_n
Ë 
	`°bi__îr
("bad SOS component count","Corrupt JPEG");

3012 i‡(
Ls
 !6+2*
z
->
sˇn_n
Ë 
	`°bi__îr
("bad SOSÜen","Corrupt JPEG");

3013 
i
=0; i < 
z
->
sˇn_n
; ++i) {

3014 
id
 = 
	`°bi__gë8
(
z
->
s
), 
which
;

3015 
q
 = 
	`°bi__gë8
(
z
->
s
);

3016 
which
 = 0; which < 
z
->
s
->
img_n
; ++which)

3017 i‡(
z
->
img_comp
[
which
].
id
 == id)

3019 i‡(
which
 =
z
->
s
->
img_n
)  0;

3020 
z
->
img_comp
[
which
].
hd
 = 
q
 >> 4; i‡(z->img_comp[which].hd > 3Ë 
	`°bi__îr
("bad DC huff","Corrupt JPEG");

3021 
z
->
img_comp
[
which
].
ha
 = 
q
 & 15; i‡(z->img_comp[which].h®> 3Ë 
	`°bi__îr
("bad AC huff","Corrupt JPEG");

3022 
z
->
‹dî
[
i
] = 
which
;

3026 
Ø
;

3027 
z
->
•ec_°¨t
 = 
	`°bi__gë8
(z->
s
);

3028 
z
->
•ec_íd
 = 
	`°bi__gë8
(z->
s
);

3029 
Ø
 = 
	`°bi__gë8
(
z
->
s
);

3030 
z
->
succ_high
 = (
Ø
 >> 4);

3031 
z
->
succ_low
 = (
Ø
 & 15);

3032 i‡(
z
->
¥ogªssive
) {

3033 i‡(
z
->
•ec_°¨t
 > 63 || z->
•ec_íd
 > 63 || z->•ec_°¨à> z->•ec_íd || z->
succ_high
 > 13 || z->
succ_low
 > 13)

3034  
	`°bi__îr
("bad SOS", "Corrupt JPEG");

3036 i‡(
z
->
•ec_°¨t
 !0Ë 
	`°bi__îr
("bad SOS","Corrupt JPEG");

3037 i‡(
z
->
succ_high
 !0 || z->
succ_low
 !0Ë 
	`°bi__îr
("bad SOS","Corrupt JPEG");

3038 
z
->
•ec_íd
 = 63;

3043 
	}
}

3045 
	$°bi__‰ì_j≥g_comp⁄íts
(
°bi__j≥g
 *
z
, 
ncomp
, 
why
)

3047 
i
;

3048 
i
=0; i < 
ncomp
; ++i) {

3049 i‡(
z
->
img_comp
[
i
].
øw_d©a
) {

3050 
	`STBI_FREE
(
z
->
img_comp
[
i
].
øw_d©a
);

3051 
z
->
img_comp
[
i
].
øw_d©a
 = 
NULL
;

3052 
z
->
img_comp
[
i
].
d©a
 = 
NULL
;

3054 i‡(
z
->
img_comp
[
i
].
øw_c€ff
) {

3055 
	`STBI_FREE
(
z
->
img_comp
[
i
].
øw_c€ff
);

3056 
z
->
img_comp
[
i
].
øw_c€ff
 = 0;

3057 
z
->
img_comp
[
i
].
c€ff
 = 0;

3059 i‡(
z
->
img_comp
[
i
].
löebuf
) {

3060 
	`STBI_FREE
(
z
->
img_comp
[
i
].
löebuf
);

3061 
z
->
img_comp
[
i
].
löebuf
 = 
NULL
;

3064  
why
;

3065 
	}
}

3067 
	$°bi__¥o˚ss_‰ame_hódî
(
°bi__j≥g
 *
z
, 
sˇn
)

3069 
°bi__c⁄ãxt
 *
s
 = 
z
->s;

3070 
Lf
,
p
,
i
,
q
, 
h_max
=1,
v_max
=1,
c
;

3071 
Lf
 = 
	`°bi__gë16be
(
s
); i‡(L‡< 11Ë 
	`°bi__îr
("bad SOFÜen","Corrupt JPEG");

3072 
p
 = 
	`°bi__gë8
(
s
); i‡’ !8Ë 
	`°bi__îr
("only 8-bit","JPEG formatÇot supported: 8-bit only");

3073 
s
->
img_y
 = 
	`°bi__gë16be
(s); i‡(s->img_y =0Ë 
	`°bi__îr
("no header height", "JPEG formatÇot supported: delayed height");

3074 
s
->
img_x
 = 
	`°bi__gë16be
(s); i‡(s->img_x =0Ë 
	`°bi__îr
("0 width","Corrupt JPEG");

3075 
c
 = 
	`°bi__gë8
(
s
);

3076 i‡(
c
 !3 && c !1 && c !4Ë 
	`°bi__îr
("bad component count","Corrupt JPEG");

3077 
s
->
img_n
 = 
c
;

3078 
i
=0; i < 
c
; ++i) {

3079 
z
->
img_comp
[
i
].
d©a
 = 
NULL
;

3080 
z
->
img_comp
[
i
].
löebuf
 = 
NULL
;

3083 i‡(
Lf
 !8+3*
s
->
img_n
Ë 
	`°bi__îr
("bad SOFÜen","Corrupt JPEG");

3085 
z
->
rgb
 = 0;

3086 
i
=0; i < 
s
->
img_n
; ++i) {

3087 c⁄° 
rgb
[3] = { 'R', 'G', 'B' };

3088 
z
->
img_comp
[
i
].
id
 = 
	`°bi__gë8
(
s
);

3089 i‡(
s
->
img_n
 =3 && 
z
->
img_comp
[
i
].
id
 =
rgb
[i])

3090 ++
z
->
rgb
;

3091 
q
 = 
	`°bi__gë8
(
s
);

3092 
z
->
img_comp
[
i
].
h
 = (
q
 >> 4); i‡(!z->img_comp[i].h || z->img_comp[i].h > 4Ë 
	`°bi__îr
("bad H","Corrupt JPEG");

3093 
z
->
img_comp
[
i
].
v
 = 
q
 & 15; i‡(!z->img_comp[i].v || z->img_comp[i].v > 4Ë 
	`°bi__îr
("bad V","Corrupt JPEG");

3094 
z
->
img_comp
[
i
].
tq
 = 
	`°bi__gë8
(
s
); i‡(z->img_comp[i].tq > 3Ë 
	`°bi__îr
("bad TQ","Corrupt JPEG");

3097 i‡(
sˇn
 !
STBI__SCAN_lﬂd
)  1;

3099 i‡(!
	`°bi__mad3sizes_vÆid
(
s
->
img_x
, s->
img_y
, s->
img_n
, 0)Ë 
	`°bi__îr
("tooÜarge", "ImageÅooÜargeÅo decode");

3101 
i
=0; i < 
s
->
img_n
; ++i) {

3102 i‡(
z
->
img_comp
[
i
].
h
 > 
h_max
) h_max = z->img_comp[i].h;

3103 i‡(
z
->
img_comp
[
i
].
v
 > 
v_max
) v_max = z->img_comp[i].v;

3107 
z
->
img_h_max
 = 
h_max
;

3108 
z
->
img_v_max
 = 
v_max
;

3109 
z
->
img_mcu_w
 = 
h_max
 * 8;

3110 
z
->
img_mcu_h
 = 
v_max
 * 8;

3112 
z
->
img_mcu_x
 = (
s
->
img_x
 + z->
img_mcu_w
-1) / z->img_mcu_w;

3113 
z
->
img_mcu_y
 = (
s
->
img_y
 + z->
img_mcu_h
-1) / z->img_mcu_h;

3115 
i
=0; i < 
s
->
img_n
; ++i) {

3117 
z
->
img_comp
[
i
].
x
 = (
s
->
img_x
 * z->img_comp[i].
h
 + 
h_max
-1) / h_max;

3118 
z
->
img_comp
[
i
].
y
 = (
s
->
img_y
 * z->img_comp[i].
v
 + 
v_max
-1) / v_max;

3126 
z
->
img_comp
[
i
].
w2
 = z->
img_mcu_x
 * z->img_comp[i].
h
 * 8;

3127 
z
->
img_comp
[
i
].
h2
 = z->
img_mcu_y
 * z->img_comp[i].
v
 * 8;

3128 
z
->
img_comp
[
i
].
c€ff
 = 0;

3129 
z
->
img_comp
[
i
].
øw_c€ff
 = 0;

3130 
z
->
img_comp
[
i
].
löebuf
 = 
NULL
;

3131 
z
->
img_comp
[
i
].
øw_d©a
 = 
	`°bi__mÆloc_mad2
(z->img_comp[i].
w2
, z->img_comp[i].
h2
, 15);

3132 i‡(
z
->
img_comp
[
i
].
øw_d©a
 =
NULL
)

3133  
	`°bi__‰ì_j≥g_comp⁄íts
(
z
, 
i
+1, 
	`°bi__îr
("outofmem", "Out of memory"));

3135 
z
->
img_comp
[
i
].
d©a
 = (
°bi_uc
*Ë(((
size_t
Ëz->img_comp[i].
øw_d©a
 + 15) & ~15);

3136 i‡(
z
->
¥ogªssive
) {

3138 
z
->
img_comp
[
i
].
c€ff_w
 = z->img_comp[i].
w2
 / 8;

3139 
z
->
img_comp
[
i
].
c€ff_h
 = z->img_comp[i].
h2
 / 8;

3140 
z
->
img_comp
[
i
].
øw_c€ff
 = 
	`°bi__mÆloc_mad3
(z->img_comp[i].
w2
, z->img_comp[i].
h2
, (), 15);

3141 i‡(
z
->
img_comp
[
i
].
øw_c€ff
 =
NULL
)

3142  
	`°bi__‰ì_j≥g_comp⁄íts
(
z
, 
i
+1, 
	`°bi__îr
("outofmem", "Out of memory"));

3143 
z
->
img_comp
[
i
].
c€ff
 = (*Ë(((
size_t
Ëz->img_comp[i].
øw_c€ff
 + 15) & ~15);

3148 
	}
}

3151 
	#°bi__DNL
(
x
Ë((xË=0xdc)

	)

3152 
	#°bi__SOI
(
x
Ë((xË=0xd8)

	)

3153 
	#°bi__EOI
(
x
Ë((xË=0xd9)

	)

3154 
	#°bi__SOF
(
x
Ë((xË=0xc0 || (xË=0xc1 || (xË=0xc2)

	)

3155 
	#°bi__SOS
(
x
Ë((xË=0xda)

	)

3157 
	#°bi__SOF_¥ogªssive
(
x
Ë((xË=0xc2)

	)

3159 
	$°bi__decode_j≥g_hódî
(
°bi__j≥g
 *
z
, 
sˇn
)

3161 
m
;

3162 
z
->
jfif
 = 0;

3163 
z
->
≠p14_cﬁ‹_å™sf‹m
 = -1;

3164 
z
->
m¨kî
 = 
STBI__MARKER_n⁄e
;

3165 
m
 = 
	`°bi__gë_m¨kî
(
z
);

3166 i‡(!
	`°bi__SOI
(
m
)Ë 
	`°bi__îr
("no SOI","Corrupt JPEG");

3167 i‡(
sˇn
 =
STBI__SCAN_ty≥
)  1;

3168 
m
 = 
	`°bi__gë_m¨kî
(
z
);

3169 !
	`°bi__SOF
(
m
)) {

3170 i‡(!
	`°bi__¥o˚ss_m¨kî
(
z
,
m
))  0;

3171 
m
 = 
	`°bi__gë_m¨kî
(
z
);

3172 
m
 =
STBI__MARKER_n⁄e
) {

3174 i‡(
	`°bi__©_eof
(
z
->
s
)Ë 
	`°bi__îr
("no SOF", "Corrupt JPEG");

3175 
m
 = 
	`°bi__gë_m¨kî
(
z
);

3178 
z
->
¥ogªssive
 = 
	`°bi__SOF_¥ogªssive
(
m
);

3179 i‡(!
	`°bi__¥o˚ss_‰ame_hódî
(
z
, 
sˇn
))  0;

3181 
	}
}

3184 
	$°bi__decode_j≥g_image
(
°bi__j≥g
 *
j
)

3186 
m
;

3187 
m
 = 0; m < 4; m++) {

3188 
j
->
img_comp
[
m
].
øw_d©a
 = 
NULL
;

3189 
j
->
img_comp
[
m
].
øw_c€ff
 = 
NULL
;

3191 
j
->
ª°¨t_öãrvÆ
 = 0;

3192 i‡(!
	`°bi__decode_j≥g_hódî
(
j
, 
STBI__SCAN_lﬂd
))  0;

3193 
m
 = 
	`°bi__gë_m¨kî
(
j
);

3194 !
	`°bi__EOI
(
m
)) {

3195 i‡(
	`°bi__SOS
(
m
)) {

3196 i‡(!
	`°bi__¥o˚ss_sˇn_hódî
(
j
))  0;

3197 i‡(!
	`°bi__∑r£_íå›y_coded_d©a
(
j
))  0;

3198 i‡(
j
->
m¨kî
 =
STBI__MARKER_n⁄e
 ) {

3200 !
	`°bi__©_eof
(
j
->
s
)) {

3201 
x
 = 
	`°bi__gë8
(
j
->
s
);

3202 i‡(
x
 == 255) {

3203 
j
->
m¨kî
 = 
	`°bi__gë8
(j->
s
);

3209 } i‡(
	`°bi__DNL
(
m
)) {

3210 
Ld
 = 
	`°bi__gë16be
(
j
->
s
);

3211 
°bi__uöt32
 
NL
 = 
	`°bi__gë16be
(
j
->
s
);

3212 i‡(
Ld
 !4Ë 
	`°bi__îr
("bad DNLÜen", "Corrupt JPEG");

3213 i‡(
NL
 !
j
->
s
->
img_y
Ë 
	`°bi__îr
("bad DNL height", "Corrupt JPEG");

3215 i‡(!
	`°bi__¥o˚ss_m¨kî
(
j
, 
m
))  0;

3217 
m
 = 
	`°bi__gë_m¨kî
(
j
);

3219 i‡(
j
->
¥ogªssive
)

3220 
	`°bi__j≥g_föish
(
j
);

3222 
	}
}

3226 
	g°bi_uc
 *(*
	tªßm∂e_row_func
)(
	t°bi_uc
 *
	tout
, stbi_u¯*
	tö0
, stbi_u¯*
	tö1
,

3227 
	tw
, 
	ths
);

3229 
	#°bi__div4
(
x
Ë((
°bi_uc
Ë((xË>> 2))

	)

3231 
°bi_uc
 *
	$ªßm∂e_row_1
(
°bi_uc
 *
out
, stbi_u¯*
ö_√¨
, stbi_u¯*
ö_Ár
, 
w
, 
hs
)

3233 
	`STBI_NOTUSED
(
out
);

3234 
	`STBI_NOTUSED
(
ö_Ár
);

3235 
	`STBI_NOTUSED
(
w
);

3236 
	`STBI_NOTUSED
(
hs
);

3237  
ö_√¨
;

3238 
	}
}

3240 
°bi_uc
* 
	$°bi__ªßm∂e_row_v_2
(
°bi_uc
 *
out
, stbi_u¯*
ö_√¨
, stbi_u¯*
ö_Ár
, 
w
, 
hs
)

3243 
i
;

3244 
	`STBI_NOTUSED
(
hs
);

3245 
i
=0; i < 
w
; ++i)

3246 
out
[
i
] = 
	`°bi__div4
(3*
ö_√¨
[i] + 
ö_Ár
[i] + 2);

3247  
out
;

3248 
	}
}

3250 
°bi_uc
* 
	$°bi__ªßm∂e_row_h_2
(
°bi_uc
 *
out
, stbi_u¯*
ö_√¨
, stbi_u¯*
ö_Ár
, 
w
, 
hs
)

3253 
i
;

3254 
°bi_uc
 *
öput
 = 
ö_√¨
;

3256 i‡(
w
 == 1) {

3258 
out
[0] = out[1] = 
öput
[0];

3259  
out
;

3262 
out
[0] = 
öput
[0];

3263 
out
[1] = 
	`°bi__div4
(
öput
[0]*3 + input[1] + 2);

3264 
i
=1; i < 
w
-1; ++i) {

3265 
n
 = 3*
öput
[
i
]+2;

3266 
out
[
i
*2+0] = 
	`°bi__div4
(
n
+
öput
[i-1]);

3267 
out
[
i
*2+1] = 
	`°bi__div4
(
n
+
öput
[i+1]);

3269 
out
[
i
*2+0] = 
	`°bi__div4
(
öput
[
w
-2]*3 + input[w-1] + 2);

3270 
out
[
i
*2+1] = 
öput
[
w
-1];

3272 
	`STBI_NOTUSED
(
ö_Ár
);

3273 
	`STBI_NOTUSED
(
hs
);

3275  
out
;

3276 
	}
}

3278 
	#°bi__div16
(
x
Ë((
°bi_uc
Ë((xË>> 4))

	)

3280 
°bi_uc
 *
	$°bi__ªßm∂e_row_hv_2
(
°bi_uc
 *
out
, stbi_u¯*
ö_√¨
, stbi_u¯*
ö_Ár
, 
w
, 
hs
)

3283 
i
,
t0
,
t1
;

3284 i‡(
w
 == 1) {

3285 
out
[0] = out[1] = 
	`°bi__div4
(3*
ö_√¨
[0] + 
ö_Ár
[0] + 2);

3286  
out
;

3289 
t1
 = 3*
ö_√¨
[0] + 
ö_Ár
[0];

3290 
out
[0] = 
	`°bi__div4
(
t1
+2);

3291 
i
=1; i < 
w
; ++i) {

3292 
t0
 = 
t1
;

3293 
t1
 = 3*
ö_√¨
[
i
]+
ö_Ár
[i];

3294 
out
[
i
*2-1] = 
	`°bi__div16
(3*
t0
 + 
t1
 + 8);

3295 
out
[
i
*2 ] = 
	`°bi__div16
(3*
t1
 + 
t0
 + 8);

3297 
out
[
w
*2-1] = 
	`°bi__div4
(
t1
+2);

3299 
	`STBI_NOTUSED
(
hs
);

3301  
out
;

3302 
	}
}

3304 #i‡
deföed
(
STBI_SSE2
Ë|| deföed(
STBI_NEON
)

3305 
°bi_uc
 *
	$°bi__ªßm∂e_row_hv_2_simd
(
°bi_uc
 *
out
, stbi_u¯*
ö_√¨
, stbi_u¯*
ö_Ár
, 
w
, 
hs
)

3308 
i
=0,
t0
,
t1
;

3310 i‡(
w
 == 1) {

3311 
out
[0] = out[1] = 
	`°bi__div4
(3*
ö_√¨
[0] + 
ö_Ár
[0] + 2);

3312  
out
;

3315 
t1
 = 3*
ö_√¨
[0] + 
ö_Ár
[0];

3319 ; 
i
 < ((
w
-1) & ~7); i += 8) {

3320 #i‡
	`deföed
(
STBI_SSE2
)

3323 
__m128i
 
zîo
 = 
	`_mm_£tzîo_si128
();

3324 
__m128i
 
Árb
 = 
	`_mm_lﬂdl_ïi64
((__m128ò*Ë(
ö_Ár
 + 
i
));

3325 
__m128i
 
√¨b
 = 
	`_mm_lﬂdl_ïi64
((__m128ò*Ë(
ö_√¨
 + 
i
));

3326 
__m128i
 
Árw
 = 
	`_mm_u≈acklo_ïi8
(
Árb
, 
zîo
);

3327 
__m128i
 
√¨w
 = 
	`_mm_u≈acklo_ïi8
(
√¨b
, 
zîo
);

3328 
__m128i
 
diff
 = 
	`_mm_sub_ïi16
(
Árw
, 
√¨w
);

3329 
__m128i
 
√¨s
 = 
	`_mm_¶li_ïi16
(
√¨w
, 2);

3330 
__m128i
 
cuº
 = 
	`_mm_add_ïi16
(
√¨s
, 
diff
);

3337 
__m128i
 
¥v0
 = 
	`_mm_¶li_si128
(
cuº
, 2);

3338 
__m128i
 
nxt0
 = 
	`_mm_§li_si128
(
cuº
, 2);

3339 
__m128i
 
¥ev
 = 
	`_mm_ö£π_ïi16
(
¥v0
, 
t1
, 0);

3340 
__m128i
 
√xt
 = 
	`_mm_ö£π_ïi16
(
nxt0
, 3*
ö_√¨
[
i
+8] + 
ö_Ár
[i+8], 7);

3346 
__m128i
 
büs
 = 
	`_mm_£t1_ïi16
(8);

3347 
__m128i
 
curs
 = 
	`_mm_¶li_ïi16
(
cuº
, 2);

3348 
__m128i
 
¥vd
 = 
	`_mm_sub_ïi16
(
¥ev
, 
cuº
);

3349 
__m128i
 
nxtd
 = 
	`_mm_sub_ïi16
(
√xt
, 
cuº
);

3350 
__m128i
 
curb
 = 
	`_mm_add_ïi16
(
curs
, 
büs
);

3351 
__m128i
 
eví
 = 
	`_mm_add_ïi16
(
¥vd
, 
curb
);

3352 
__m128i
 
odd
 = 
	`_mm_add_ïi16
(
nxtd
, 
curb
);

3355 
__m128i
 
öt0
 = 
	`_mm_u≈acklo_ïi16
(
eví
, 
odd
);

3356 
__m128i
 
öt1
 = 
	`_mm_u≈ackhi_ïi16
(
eví
, 
odd
);

3357 
__m128i
 
de0
 = 
	`_mm_§li_ïi16
(
öt0
, 4);

3358 
__m128i
 
de1
 = 
	`_mm_§li_ïi16
(
öt1
, 4);

3361 
__m128i
 
outv
 = 
	`_mm_∑ckus_ïi16
(
de0
, 
de1
);

3362 
	`_mm_°‹eu_si128
((
__m128i
 *Ë(
out
 + 
i
*2), 
outv
);

3363 #ñi‡
	`deföed
(
STBI_NEON
)

3366 
uöt8x8_t
 
Árb
 = 
	`vld1_u8
(
ö_Ár
 + 
i
);

3367 
uöt8x8_t
 
√¨b
 = 
	`vld1_u8
(
ö_√¨
 + 
i
);

3368 
öt16x8_t
 
diff
 = 
	`vªöãΩªtq_s16_u16
(
	`vsubl_u8
(
Árb
, 
√¨b
));

3369 
öt16x8_t
 
√¨s
 = 
	`vªöãΩªtq_s16_u16
(
	`vshŒ_n_u8
(
√¨b
, 2));

3370 
öt16x8_t
 
cuº
 = 
	`vaddq_s16
(
√¨s
, 
diff
);

3377 
öt16x8_t
 
¥v0
 = 
	`vextq_s16
(
cuº
, curr, 7);

3378 
öt16x8_t
 
nxt0
 = 
	`vextq_s16
(
cuº
, curr, 1);

3379 
öt16x8_t
 
¥ev
 = 
	`v£tq_œ√_s16
(
t1
, 
¥v0
, 0);

3380 
öt16x8_t
 
√xt
 = 
	`v£tq_œ√_s16
(3*
ö_√¨
[
i
+8] + 
ö_Ár
[i+8], 
nxt0
, 7);

3386 
öt16x8_t
 
curs
 = 
	`vshlq_n_s16
(
cuº
, 2);

3387 
öt16x8_t
 
¥vd
 = 
	`vsubq_s16
(
¥ev
, 
cuº
);

3388 
öt16x8_t
 
nxtd
 = 
	`vsubq_s16
(
√xt
, 
cuº
);

3389 
öt16x8_t
 
eví
 = 
	`vaddq_s16
(
curs
, 
¥vd
);

3390 
öt16x8_t
 
odd
 = 
	`vaddq_s16
(
curs
, 
nxtd
);

3393 
uöt8x8x2_t
 
o
;

3394 
o
.
vÆ
[0] = 
	`vqrshrun_n_s16
(
eví
, 4);

3395 
o
.
vÆ
[1] = 
	`vqrshrun_n_s16
(
odd
, 4);

3396 
	`v°2_u8
(
out
 + 
i
*2, 
o
);

3400 
t1
 = 3*
ö_√¨
[
i
+7] + 
ö_Ár
[i+7];

3403 
t0
 = 
t1
;

3404 
t1
 = 3*
ö_√¨
[
i
] + 
ö_Ár
[i];

3405 
out
[
i
*2] = 
	`°bi__div16
(3*
t1
 + 
t0
 + 8);

3407 ++
i
; i < 
w
; ++i) {

3408 
t0
 = 
t1
;

3409 
t1
 = 3*
ö_√¨
[
i
]+
ö_Ár
[i];

3410 
out
[
i
*2-1] = 
	`°bi__div16
(3*
t0
 + 
t1
 + 8);

3411 
out
[
i
*2 ] = 
	`°bi__div16
(3*
t1
 + 
t0
 + 8);

3413 
out
[
w
*2-1] = 
	`°bi__div4
(
t1
+2);

3415 
	`STBI_NOTUSED
(
hs
);

3417  
out
;

3418 
	}
}

3421 
°bi_uc
 *
	$°bi__ªßm∂e_row_gíîic
(
°bi_uc
 *
out
, stbi_u¯*
ö_√¨
, stbi_u¯*
ö_Ár
, 
w
, 
hs
)

3424 
i
,
j
;

3425 
	`STBI_NOTUSED
(
ö_Ár
);

3426 
i
=0; i < 
w
; ++i)

3427 
j
=0; j < 
hs
; ++j)

3428 
out
[
i
*
hs
+
j
] = 
ö_√¨
[i];

3429  
out
;

3430 
	}
}

3434 
	#°bi__Êﬂt2fixed
(
x
Ë(((Ë((xË* 4096.0‡+ 0.5f)Ë<< 8)

	)

3435 
	$°bi__YCbCr_to_RGB_row
(
°bi_uc
 *
out
, c⁄° stbi_u¯*
y
, c⁄° stbi_u¯*
pcb
, c⁄° stbi_u¯*
p¸
, 
cou¡
, 
°ï
)

3437 
i
;

3438 
i
=0; i < 
cou¡
; ++i) {

3439 
y_fixed
 = (
y
[
i
] << 20) + (1<<19);

3440 
r
,
g
,
b
;

3441 
¸
 = 
p¸
[
i
] - 128;

3442 
cb
 = 
pcb
[
i
] - 128;

3443 
r
 = 
y_fixed
 + 
¸
* 
	`°bi__Êﬂt2fixed
(1.40200f);

3444 
g
 = 
y_fixed
 + (
¸
*-
	`°bi__Êﬂt2fixed
(0.71414f)Ë+ ((
cb
*-stbi__float2fixed(0.34414f)) & 0xffff0000);

3445 
b
 = 
y_fixed
 + 
cb
* 
	`°bi__Êﬂt2fixed
(1.77200f);

3446 
r
 >>= 20;

3447 
g
 >>= 20;

3448 
b
 >>= 20;

3449 i‡((Ë
r
 > 255) { if (r < 0)Ñ = 0; r = 255; }

3450 i‡((Ë
g
 > 255) { if (g < 0) g = 0; g = 255; }

3451 i‡((Ë
b
 > 255) { if (b < 0) b = 0; b = 255; }

3452 
out
[0] = (
°bi_uc
)
r
;

3453 
out
[1] = (
°bi_uc
)
g
;

3454 
out
[2] = (
°bi_uc
)
b
;

3455 
out
[3] = 255;

3456 
out
 +
°ï
;

3458 
	}
}

3460 #i‡
deföed
(
STBI_SSE2
Ë|| deföed(
STBI_NEON
)

3461 
	$°bi__YCbCr_to_RGB_simd
(
°bi_uc
 *
out
, stbi_u¯c⁄° *
y
, stbi_u¯c⁄° *
pcb
, stbi_u¯c⁄° *
p¸
, 
cou¡
, 
°ï
)

3463 
i
 = 0;

3465 #ifde‡
STBI_SSE2


3469 i‡(
°ï
 == 4) {

3471 
__m128i
 
signÊù
 = 
	`_mm_£t1_ïi8
(-0x80);

3472 
__m128i
 
¸_c⁄°0
 = 
	`_mm_£t1_ïi16
( () ( 1.40200f*4096.0f+0.5f));

3473 
__m128i
 
¸_c⁄°1
 = 
	`_mm_£t1_ïi16
( - () ( 0.71414f*4096.0f+0.5f));

3474 
__m128i
 
cb_c⁄°0
 = 
	`_mm_£t1_ïi16
( - () ( 0.34414f*4096.0f+0.5f));

3475 
__m128i
 
cb_c⁄°1
 = 
	`_mm_£t1_ïi16
( () ( 1.77200f*4096.0f+0.5f));

3476 
__m128i
 
y_büs
 = 
	`_mm_£t1_ïi8
(() () 128);

3477 
__m128i
 
xw
 = 
	`_mm_£t1_ïi16
(255);

3479 ; 
i
+7 < 
cou¡
; i += 8) {

3481 
__m128i
 
y_byãs
 = 
	`_mm_lﬂdl_ïi64
((__m128ò*Ë(
y
+
i
));

3482 
__m128i
 
¸_byãs
 = 
	`_mm_lﬂdl_ïi64
((__m128ò*Ë(
p¸
+
i
));

3483 
__m128i
 
cb_byãs
 = 
	`_mm_lﬂdl_ïi64
((__m128ò*Ë(
pcb
+
i
));

3484 
__m128i
 
¸_bü£d
 = 
	`_mm_x‹_si128
(
¸_byãs
, 
signÊù
);

3485 
__m128i
 
cb_bü£d
 = 
	`_mm_x‹_si128
(
cb_byãs
, 
signÊù
);

3488 
__m128i
 
yw
 = 
	`_mm_u≈acklo_ïi8
(
y_büs
, 
y_byãs
);

3489 
__m128i
 
¸w
 = 
	`_mm_u≈acklo_ïi8
(
	`_mm_£tzîo_si128
(), 
¸_bü£d
);

3490 
__m128i
 
cbw
 = 
	`_mm_u≈acklo_ïi8
(
	`_mm_£tzîo_si128
(), 
cb_bü£d
);

3493 
__m128i
 
yws
 = 
	`_mm_§li_ïi16
(
yw
, 4);

3494 
__m128i
 
¸0
 = 
	`_mm_mulhi_ïi16
(
¸_c⁄°0
, 
¸w
);

3495 
__m128i
 
cb0
 = 
	`_mm_mulhi_ïi16
(
cb_c⁄°0
, 
cbw
);

3496 
__m128i
 
cb1
 = 
	`_mm_mulhi_ïi16
(
cbw
, 
cb_c⁄°1
);

3497 
__m128i
 
¸1
 = 
	`_mm_mulhi_ïi16
(
¸w
, 
¸_c⁄°1
);

3498 
__m128i
 
rws
 = 
	`_mm_add_ïi16
(
¸0
, 
yws
);

3499 
__m128i
 
gwt
 = 
	`_mm_add_ïi16
(
cb0
, 
yws
);

3500 
__m128i
 
bws
 = 
	`_mm_add_ïi16
(
yws
, 
cb1
);

3501 
__m128i
 
gws
 = 
	`_mm_add_ïi16
(
gwt
, 
¸1
);

3504 
__m128i
 
rw
 = 
	`_mm_§ai_ïi16
(
rws
, 4);

3505 
__m128i
 
bw
 = 
	`_mm_§ai_ïi16
(
bws
, 4);

3506 
__m128i
 
gw
 = 
	`_mm_§ai_ïi16
(
gws
, 4);

3509 
__m128i
 
brb
 = 
	`_mm_∑ckus_ïi16
(
rw
, 
bw
);

3510 
__m128i
 
gxb
 = 
	`_mm_∑ckus_ïi16
(
gw
, 
xw
);

3513 
__m128i
 
t0
 = 
	`_mm_u≈acklo_ïi8
(
brb
, 
gxb
);

3514 
__m128i
 
t1
 = 
	`_mm_u≈ackhi_ïi8
(
brb
, 
gxb
);

3515 
__m128i
 
o0
 = 
	`_mm_u≈acklo_ïi16
(
t0
, 
t1
);

3516 
__m128i
 
o1
 = 
	`_mm_u≈ackhi_ïi16
(
t0
, 
t1
);

3519 
	`_mm_°‹eu_si128
((
__m128i
 *Ë(
out
 + 0), 
o0
);

3520 
	`_mm_°‹eu_si128
((
__m128i
 *Ë(
out
 + 16), 
o1
);

3521 
out
 += 32;

3526 #ifde‡
STBI_NEON


3528 i‡(
°ï
 == 4) {

3530 
uöt8x8_t
 
signÊù
 = 
	`vdup_n_u8
(0x80);

3531 
öt16x8_t
 
¸_c⁄°0
 = 
	`vdupq_n_s16
( () ( 1.40200f*4096.0f+0.5f));

3532 
öt16x8_t
 
¸_c⁄°1
 = 
	`vdupq_n_s16
( - () ( 0.71414f*4096.0f+0.5f));

3533 
öt16x8_t
 
cb_c⁄°0
 = 
	`vdupq_n_s16
( - () ( 0.34414f*4096.0f+0.5f));

3534 
öt16x8_t
 
cb_c⁄°1
 = 
	`vdupq_n_s16
( () ( 1.77200f*4096.0f+0.5f));

3536 ; 
i
+7 < 
cou¡
; i += 8) {

3538 
uöt8x8_t
 
y_byãs
 = 
	`vld1_u8
(
y
 + 
i
);

3539 
uöt8x8_t
 
¸_byãs
 = 
	`vld1_u8
(
p¸
 + 
i
);

3540 
uöt8x8_t
 
cb_byãs
 = 
	`vld1_u8
(
pcb
 + 
i
);

3541 
öt8x8_t
 
¸_bü£d
 = 
	`vªöãΩªt_s8_u8
(
	`vsub_u8
(
¸_byãs
, 
signÊù
));

3542 
öt8x8_t
 
cb_bü£d
 = 
	`vªöãΩªt_s8_u8
(
	`vsub_u8
(
cb_byãs
, 
signÊù
));

3545 
öt16x8_t
 
yws
 = 
	`vªöãΩªtq_s16_u16
(
	`vshŒ_n_u8
(
y_byãs
, 4));

3546 
öt16x8_t
 
¸w
 = 
	`vshŒ_n_s8
(
¸_bü£d
, 7);

3547 
öt16x8_t
 
cbw
 = 
	`vshŒ_n_s8
(
cb_bü£d
, 7);

3550 
öt16x8_t
 
¸0
 = 
	`vqdmulhq_s16
(
¸w
, 
¸_c⁄°0
);

3551 
öt16x8_t
 
cb0
 = 
	`vqdmulhq_s16
(
cbw
, 
cb_c⁄°0
);

3552 
öt16x8_t
 
¸1
 = 
	`vqdmulhq_s16
(
¸w
, 
¸_c⁄°1
);

3553 
öt16x8_t
 
cb1
 = 
	`vqdmulhq_s16
(
cbw
, 
cb_c⁄°1
);

3554 
öt16x8_t
 
rws
 = 
	`vaddq_s16
(
yws
, 
¸0
);

3555 
öt16x8_t
 
gws
 = 
	`vaddq_s16
(vaddq_s16(
yws
, 
cb0
), 
¸1
);

3556 
öt16x8_t
 
bws
 = 
	`vaddq_s16
(
yws
, 
cb1
);

3559 
uöt8x8x4_t
 
o
;

3560 
o
.
vÆ
[0] = 
	`vqrshrun_n_s16
(
rws
, 4);

3561 
o
.
vÆ
[1] = 
	`vqrshrun_n_s16
(
gws
, 4);

3562 
o
.
vÆ
[2] = 
	`vqrshrun_n_s16
(
bws
, 4);

3563 
o
.
vÆ
[3] = 
	`vdup_n_u8
(255);

3566 
	`v°4_u8
(
out
, 
o
);

3567 
out
 += 8*4;

3572 ; 
i
 < 
cou¡
; ++i) {

3573 
y_fixed
 = (
y
[
i
] << 20) + (1<<19);

3574 
r
,
g
,
b
;

3575 
¸
 = 
p¸
[
i
] - 128;

3576 
cb
 = 
pcb
[
i
] - 128;

3577 
r
 = 
y_fixed
 + 
¸
* 
	`°bi__Êﬂt2fixed
(1.40200f);

3578 
g
 = 
y_fixed
 + 
¸
*-
	`°bi__Êﬂt2fixed
(0.71414fË+ ((
cb
*-stbi__float2fixed(0.34414f)) & 0xffff0000);

3579 
b
 = 
y_fixed
 + 
cb
* 
	`°bi__Êﬂt2fixed
(1.77200f);

3580 
r
 >>= 20;

3581 
g
 >>= 20;

3582 
b
 >>= 20;

3583 i‡((Ë
r
 > 255) { if (r < 0)Ñ = 0; r = 255; }

3584 i‡((Ë
g
 > 255) { if (g < 0) g = 0; g = 255; }

3585 i‡((Ë
b
 > 255) { if (b < 0) b = 0; b = 255; }

3586 
out
[0] = (
°bi_uc
)
r
;

3587 
out
[1] = (
°bi_uc
)
g
;

3588 
out
[2] = (
°bi_uc
)
b
;

3589 
out
[3] = 255;

3590 
out
 +
°ï
;

3592 
	}
}

3596 
	$°bi__£tup_j≥g
(
°bi__j≥g
 *
j
)

3598 
j
->
id˘_block_kî√l
 = 
°bi__id˘_block
;

3599 
j
->
YCbCr_to_RGB_kî√l
 = 
°bi__YCbCr_to_RGB_row
;

3600 
j
->
ªßm∂e_row_hv_2_kî√l
 = 
°bi__ªßm∂e_row_hv_2
;

3602 #ifde‡
STBI_SSE2


3603 i‡(
	`°bi__s£2_avaûabÀ
()) {

3604 
j
->
id˘_block_kî√l
 = 
°bi__id˘_simd
;

3605 
j
->
YCbCr_to_RGB_kî√l
 = 
°bi__YCbCr_to_RGB_simd
;

3606 
j
->
ªßm∂e_row_hv_2_kî√l
 = 
°bi__ªßm∂e_row_hv_2_simd
;

3610 #ifde‡
STBI_NEON


3611 
j
->
id˘_block_kî√l
 = 
°bi__id˘_simd
;

3612 
j
->
YCbCr_to_RGB_kî√l
 = 
°bi__YCbCr_to_RGB_simd
;

3613 
j
->
ªßm∂e_row_hv_2_kî√l
 = 
°bi__ªßm∂e_row_hv_2_simd
;

3615 
	}
}

3618 
	$°bi__˛ónup_j≥g
(
°bi__j≥g
 *
j
)

3620 
	`°bi__‰ì_j≥g_comp⁄íts
(
j
, j->
s
->
img_n
, 0);

3621 
	}
}

3625 
ªßm∂e_row_func
 
	mªßm∂e
;

3626 
°bi_uc
 *
	mlöe0
,*
	mlöe1
;

3627 
	mhs
,
	mvs
;

3628 
	mw_l‹es
;

3629 
	my°ï
;

3630 
	mypos
;

3631 } 
	t°bi__ªßm∂e
;

3634 
°bi_uc
 
	$°bi__blön_8x8
(
°bi_uc
 
x
, stbi_u¯
y
)

3636 
t
 = 
x
*
y
 + 128;

3637  (
°bi_uc
Ë((
t
 + (t >>8)) >> 8);

3638 
	}
}

3640 
°bi_uc
 *
	$lﬂd_j≥g_image
(
°bi__j≥g
 *
z
, *
out_x
, *
out_y
, *
comp
, 
ªq_comp
)

3642 
n
, 
decode_n
, 
is_rgb
;

3643 
z
->
s
->
img_n
 = 0;

3646 i‡(
ªq_comp
 < 0 ||Ñeq_com∞> 4Ë 
	`°bi__îΩuc
("badÑeq_comp", "InternalÉrror");

3649 i‡(!
	`°bi__decode_j≥g_image
(
z
)Ë{ 
	`°bi__˛ónup_j≥g
(z);  
NULL
; }

3652 
n
 = 
ªq_comp
 ?Ñeq_com∞: 
z
->
s
->
img_n
 >= 3 ? 3 : 1;

3654 
is_rgb
 = 
z
->
s
->
img_n
 =3 && (z->
rgb
 =3 || (z->
≠p14_cﬁ‹_å™sf‹m
 =0 && !z->
jfif
));

3656 i‡(
z
->
s
->
img_n
 =3 && 
n
 < 3 && !
is_rgb
)

3657 
decode_n
 = 1;

3659 
decode_n
 = 
z
->
s
->
img_n
;

3663 
k
;

3664 
i
,
j
;

3665 
°bi_uc
 *
ouçut
;

3666 
°bi_uc
 *
couçut
[4] = { 
NULL
, NULL, NULL, NULL };

3668 
°bi__ªßm∂e
 
ªs_comp
[4];

3670 
k
=0; k < 
decode_n
; ++k) {

3671 
°bi__ªßm∂e
 *
r
 = &
ªs_comp
[
k
];

3675 
z
->
img_comp
[
k
].
löebuf
 = (
°bi_uc
 *Ë
	`°bi__mÆloc
(z->
s
->
img_x
 + 3);

3676 i‡(!
z
->
img_comp
[
k
].
löebuf
Ë{ 
	`°bi__˛ónup_j≥g
(z);  
	`°bi__îΩuc
("outofmem", "Out of memory"); }

3678 
r
->
hs
 = 
z
->
img_h_max
 / z->
img_comp
[
k
].
h
;

3679 
r
->
vs
 = 
z
->
img_v_max
 / z->
img_comp
[
k
].
v
;

3680 
r
->
y°ï
 =Ñ->
vs
 >> 1;

3681 
r
->
w_l‹es
 = (
z
->
s
->
img_x
 +Ñ->
hs
-1) /Ñ->hs;

3682 
r
->
ypos
 = 0;

3683 
r
->
löe0
 =Ñ->
löe1
 = 
z
->
img_comp
[
k
].
d©a
;

3685 i‡(
r
->
hs
 =1 &&Ñ->
vs
 =1Ër->
ªßm∂e
 = 
ªßm∂e_row_1
;

3686 i‡(
r
->
hs
 =1 &&Ñ->
vs
 =2Ër->
ªßm∂e
 = 
°bi__ªßm∂e_row_v_2
;

3687 i‡(
r
->
hs
 =2 &&Ñ->
vs
 =1Ër->
ªßm∂e
 = 
°bi__ªßm∂e_row_h_2
;

3688 i‡(
r
->
hs
 =2 &&Ñ->
vs
 =2Ër->
ªßm∂e
 = 
z
->
ªßm∂e_row_hv_2_kî√l
;

3689 
r
->
ªßm∂e
 = 
°bi__ªßm∂e_row_gíîic
;

3693 
ouçut
 = (
°bi_uc
 *Ë
	`°bi__mÆloc_mad3
(
n
, 
z
->
s
->
img_x
, z->s->
img_y
, 1);

3694 i‡(!
ouçut
Ë{ 
	`°bi__˛ónup_j≥g
(
z
);  
	`°bi__îΩuc
("outofmem", "Out of memory"); }

3697 
j
=0; j < 
z
->
s
->
img_y
; ++j) {

3698 
°bi_uc
 *
out
 = 
ouçut
 + 
n
 * 
z
->
s
->
img_x
 * 
j
;

3699 
k
=0; k < 
decode_n
; ++k) {

3700 
°bi__ªßm∂e
 *
r
 = &
ªs_comp
[
k
];

3701 
y_bŸ
 = 
r
->
y°ï
 >‘->
vs
 >> 1);

3702 
couçut
[
k
] = 
r
->
	`ªßm∂e
(
z
->
img_comp
[k].
löebuf
,

3703 
y_bŸ
 ? 
r
->
löe1
 :Ñ->
löe0
,

3704 
y_bŸ
 ? 
r
->
löe0
 :Ñ->
löe1
,

3705 
r
->
w_l‹es
,Ñ->
hs
);

3706 i‡(++
r
->
y°ï
 >r->
vs
) {

3707 
r
->
y°ï
 = 0;

3708 
r
->
löe0
 =Ñ->
löe1
;

3709 i‡(++
r
->
ypos
 < 
z
->
img_comp
[
k
].
y
)

3710 
r
->
löe1
 +
z
->
img_comp
[
k
].
w2
;

3713 i‡(
n
 >= 3) {

3714 
°bi_uc
 *
y
 = 
couçut
[0];

3715 i‡(
z
->
s
->
img_n
 == 3) {

3716 i‡(
is_rgb
) {

3717 
i
=0; i < 
z
->
s
->
img_x
; ++i) {

3718 
out
[0] = 
y
[
i
];

3719 
out
[1] = 
couçut
[1][
i
];

3720 
out
[2] = 
couçut
[2][
i
];

3721 
out
[3] = 255;

3722 
out
 +
n
;

3725 
z
->
	`YCbCr_to_RGB_kî√l
(
out
, 
y
, 
couçut
[1], couçut[2], z->
s
->
img_x
, 
n
);

3727 } i‡(
z
->
s
->
img_n
 == 4) {

3728 i‡(
z
->
≠p14_cﬁ‹_å™sf‹m
 == 0) {

3729 
i
=0; i < 
z
->
s
->
img_x
; ++i) {

3730 
°bi_uc
 
m
 = 
couçut
[3][
i
];

3731 
out
[0] = 
	`°bi__blön_8x8
(
couçut
[0][
i
], 
m
);

3732 
out
[1] = 
	`°bi__blön_8x8
(
couçut
[1][
i
], 
m
);

3733 
out
[2] = 
	`°bi__blön_8x8
(
couçut
[2][
i
], 
m
);

3734 
out
[3] = 255;

3735 
out
 +
n
;

3737 } i‡(
z
->
≠p14_cﬁ‹_å™sf‹m
 == 2) {

3738 
z
->
	`YCbCr_to_RGB_kî√l
(
out
, 
y
, 
couçut
[1], couçut[2], z->
s
->
img_x
, 
n
);

3739 
i
=0; i < 
z
->
s
->
img_x
; ++i) {

3740 
°bi_uc
 
m
 = 
couçut
[3][
i
];

3741 
out
[0] = 
	`°bi__blön_8x8
(255 - out[0], 
m
);

3742 
out
[1] = 
	`°bi__blön_8x8
(255 - out[1], 
m
);

3743 
out
[2] = 
	`°bi__blön_8x8
(255 - out[2], 
m
);

3744 
out
 +
n
;

3747 
z
->
	`YCbCr_to_RGB_kî√l
(
out
, 
y
, 
couçut
[1], couçut[2], z->
s
->
img_x
, 
n
);

3750 
i
=0; i < 
z
->
s
->
img_x
; ++i) {

3751 
out
[0] = out[1] = out[2] = 
y
[
i
];

3752 
out
[3] = 255;

3753 
out
 +
n
;

3756 i‡(
is_rgb
) {

3757 i‡(
n
 == 1)

3758 
i
=0; i < 
z
->
s
->
img_x
; ++i)

3759 *
out
++ = 
	`°bi__compuã_y
(
couçut
[0][
i
], coutput[1][i], coutput[2][i]);

3761 
i
=0; i < 
z
->
s
->
img_x
; ++i, 
out
 += 2) {

3762 
out
[0] = 
	`°bi__compuã_y
(
couçut
[0][
i
], coutput[1][i], coutput[2][i]);

3763 
out
[1] = 255;

3766 } i‡(
z
->
s
->
img_n
 =4 && z->
≠p14_cﬁ‹_å™sf‹m
 == 0) {

3767 
i
=0; i < 
z
->
s
->
img_x
; ++i) {

3768 
°bi_uc
 
m
 = 
couçut
[3][
i
];

3769 
°bi_uc
 
r
 = 
	`°bi__blön_8x8
(
couçut
[0][
i
], 
m
);

3770 
°bi_uc
 
g
 = 
	`°bi__blön_8x8
(
couçut
[1][
i
], 
m
);

3771 
°bi_uc
 
b
 = 
	`°bi__blön_8x8
(
couçut
[2][
i
], 
m
);

3772 
out
[0] = 
	`°bi__compuã_y
(
r
, 
g
, 
b
);

3773 
out
[1] = 255;

3774 
out
 +
n
;

3776 } i‡(
z
->
s
->
img_n
 =4 && z->
≠p14_cﬁ‹_å™sf‹m
 == 2) {

3777 
i
=0; i < 
z
->
s
->
img_x
; ++i) {

3778 
out
[0] = 
	`°bi__blön_8x8
(255 - 
couçut
[0][
i
], coutput[3][i]);

3779 
out
[1] = 255;

3780 
out
 +
n
;

3783 
°bi_uc
 *
y
 = 
couçut
[0];

3784 i‡(
n
 == 1)

3785 
i
=0; i < 
z
->
s
->
img_x
; ++iË
out
[i] = 
y
[i];

3787 
i
=0; i < 
z
->
s
->
img_x
; ++iË{ *
out
++ = 
y
[i]; *out++ = 255; }

3791 
	`°bi__˛ónup_j≥g
(
z
);

3792 *
out_x
 = 
z
->
s
->
img_x
;

3793 *
out_y
 = 
z
->
s
->
img_y
;

3794 i‡(
comp
Ë*com∞
z
->
s
->
img_n
 >= 3 ? 3 : 1;

3795  
ouçut
;

3797 
	}
}

3799 *
	$°bi__j≥g_lﬂd
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
, 
ªq_comp
, 
°bi__ªsu…_öfo
 *
ri
)

3801 * 
ªsu…
;

3802 
°bi__j≥g
* 
j
 = (°bi__j≥g*Ë
	`°bi__mÆloc
((stbi__jpeg));

3803 
	`STBI_NOTUSED
(
ri
);

3804 
j
->
s
 = s;

3805 
	`°bi__£tup_j≥g
(
j
);

3806 
ªsu…
 = 
	`lﬂd_j≥g_image
(
j
, 
x
,
y
,
comp
,
ªq_comp
);

3807 
	`STBI_FREE
(
j
);

3808  
ªsu…
;

3809 
	}
}

3811 
	$°bi__j≥g_ã°
(
°bi__c⁄ãxt
 *
s
)

3813 
r
;

3814 
°bi__j≥g
* 
j
 = (°bi__j≥g*)
	`°bi__mÆloc
((stbi__jpeg));

3815 
j
->
s
 = s;

3816 
	`°bi__£tup_j≥g
(
j
);

3817 
r
 = 
	`°bi__decode_j≥g_hódî
(
j
, 
STBI__SCAN_ty≥
);

3818 
	`°bi__ªwöd
(
s
);

3819 
	`STBI_FREE
(
j
);

3820  
r
;

3821 
	}
}

3823 
	$°bi__j≥g_öfo_øw
(
°bi__j≥g
 *
j
, *
x
, *
y
, *
comp
)

3825 i‡(!
	`°bi__decode_j≥g_hódî
(
j
, 
STBI__SCAN_hódî
)) {

3826 
	`°bi__ªwöd
–
j
->
s
 );

3829 i‡(
x
Ë*x = 
j
->
s
->
img_x
;

3830 i‡(
y
Ë*y = 
j
->
s
->
img_y
;

3831 i‡(
comp
Ë*com∞
j
->
s
->
img_n
 >= 3 ? 3 : 1;

3833 
	}
}

3835 
	$°bi__j≥g_öfo
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
)

3837 
ªsu…
;

3838 
°bi__j≥g
* 
j
 = (°bi__j≥g*Ë(
	`°bi__mÆloc
((stbi__jpeg)));

3839 
j
->
s
 = s;

3840 
ªsu…
 = 
	`°bi__j≥g_öfo_øw
(
j
, 
x
, 
y
, 
comp
);

3841 
	`STBI_FREE
(
j
);

3842  
ªsu…
;

3843 
	}
}

3853 #i‚de‡
STBI_NO_ZLIB


3856 
	#STBI__ZFAST_BITS
 9

3857 
	#STBI__ZFAST_MASK
 ((1 << 
STBI__ZFAST_BITS
Ë- 1)

	)

3863 
°bi__uöt16
 
	mÁ°
[1 << 
STBI__ZFAST_BITS
];

3864 
°bi__uöt16
 
	mfú°code
[16];

3865 
	mmaxcode
[17];

3866 
°bi__uöt16
 
	mfú°symbﬁ
[16];

3867 
°bi_uc
 
	msize
[288];

3868 
°bi__uöt16
 
	mvÆue
[288];

3869 } 
	t°bi__zhuffm™
;

3871 
°bi_ölöe
 
	$°bi__bôªvî£16
(
n
)

3873 
n
 = ((n & 0xAAAA) >> 1) | ((n & 0x5555) << 1);

3874 
n
 = ((n & 0xCCCC) >> 2) | ((n & 0x3333) << 2);

3875 
n
 = ((n & 0xF0F0) >> 4) | ((n & 0x0F0F) << 4);

3876 
n
 = ((n & 0xFF00) >> 8) | ((n & 0x00FF) << 8);

3877  
n
;

3878 
	}
}

3880 
°bi_ölöe
 
	$°bi__bô_ªvî£
(
v
, 
bôs
)

3882 
	`STBI_ASSERT
(
bôs
 <= 16);

3885  
	`°bi__bôªvî£16
(
v
Ë>> (16-
bôs
);

3886 
	}
}

3888 
	$°bi__zbuûd_huffm™
(
°bi__zhuffm™
 *
z
, c⁄° 
°bi_uc
 *
sizñi°
, 
num
)

3890 
i
,
k
=0;

3891 
code
, 
√xt_code
[16], 
sizes
[17];

3894 
	`mem£t
(
sizes
, 0, (sizes));

3895 
	`mem£t
(
z
->
Á°
, 0, (z->fast));

3896 
i
=0; i < 
num
; ++i)

3897 ++
sizes
[
sizñi°
[
i
]];

3898 
sizes
[0] = 0;

3899 
i
=1; i < 16; ++i)

3900 i‡(
sizes
[
i
] > (1 << i))

3901  
	`°bi__îr
("bad sizes", "Corrupt PNG");

3902 
code
 = 0;

3903 
i
=1; i < 16; ++i) {

3904 
√xt_code
[
i
] = 
code
;

3905 
z
->
fú°code
[
i
] = (
°bi__uöt16
Ë
code
;

3906 
z
->
fú°symbﬁ
[
i
] = (
°bi__uöt16
Ë
k
;

3907 
code
 = (codê+ 
sizes
[
i
]);

3908 i‡(
sizes
[
i
])

3909 i‡(
code
-1 >(1 << 
i
)Ë 
	`°bi__îr
("bad codelengths","Corrupt PNG");

3910 
z
->
maxcode
[
i
] = 
code
 << (16-i);

3911 
code
 <<= 1;

3912 
k
 +
sizes
[
i
];

3914 
z
->
maxcode
[16] = 0x10000;

3915 
i
=0; i < 
num
; ++i) {

3916 
s
 = 
sizñi°
[
i
];

3917 i‡(
s
) {

3918 
c
 = 
√xt_code
[
s
] - 
z
->
fú°code
[s] + z->
fú°symbﬁ
[s];

3919 
°bi__uöt16
 
Á°v
 = (°bi__uöt16Ë((
s
 << 9Ë| 
i
);

3920 
z
->
size
 [
c
] = (
°bi_uc
 ) 
s
;

3921 
z
->
vÆue
[
c
] = (
°bi__uöt16
Ë
i
;

3922 i‡(
s
 <
STBI__ZFAST_BITS
) {

3923 
j
 = 
	`°bi__bô_ªvî£
(
√xt_code
[
s
],s);

3924 
j
 < (1 << 
STBI__ZFAST_BITS
)) {

3925 
z
->
Á°
[
j
] = 
Á°v
;

3926 
j
 +(1 << 
s
);

3929 ++
√xt_code
[
s
];

3933 
	}
}

3943 
°bi_uc
 *
	mzbuf„r
, *
	mzbuf„r_íd
;

3944 
	mnum_bôs
;

3945 
°bi__uöt32
 
	mcode_buf„r
;

3947 *
	mzout
;

3948 *
	mzout_°¨t
;

3949 *
	mzout_íd
;

3950 
	mz_ex∑ndabÀ
;

3952 
°bi__zhuffm™
 
	mz_Àngth
, 
	mz_di°™˚
;

3953 } 
	t°bi__zbuf
;

3955 
°bi_ölöe
 
°bi_uc
 
	$°bi__zgë8
(
°bi__zbuf
 *
z
)

3957 i‡(
z
->
zbuf„r
 >z->
zbuf„r_íd
)  0;

3958  *
z
->
zbuf„r
++;

3959 
	}
}

3961 
	$°bi__fûl_bôs
(
°bi__zbuf
 *
z
)

3964 
	`STBI_ASSERT
(
z
->
code_buf„r
 < (1U << z->
num_bôs
));

3965 
z
->
code_buf„r
 |(Ë
	`°bi__zgë8
(zË<< z->
num_bôs
;

3966 
z
->
num_bôs
 += 8;

3967 } 
z
->
num_bôs
 <= 24);

3968 
	}
}

3970 
°bi_ölöe
 
	$°bi__zª˚ive
(
°bi__zbuf
 *
z
, 
n
)

3972 
k
;

3973 i‡(
z
->
num_bôs
 < 
n
Ë
	`°bi__fûl_bôs
(z);

3974 
k
 = 
z
->
code_buf„r
 & ((1 << 
n
) - 1);

3975 
z
->
code_buf„r
 >>
n
;

3976 
z
->
num_bôs
 -
n
;

3977  
k
;

3978 
	}
}

3980 
	$°bi__zhuffm™_decode_¶ow∑th
(
°bi__zbuf
 *
a
, 
°bi__zhuffm™
 *
z
)

3982 
b
,
s
,
k
;

3985 
k
 = 
	`°bi__bô_ªvî£
(
a
->
code_buf„r
, 16);

3986 
s
=
STBI__ZFAST_BITS
+1; ; ++s)

3987 i‡(
k
 < 
z
->
maxcode
[
s
])

3989 i‡(
s
 == 16)  -1;

3991 
b
 = (
k
 >> (16-
s
)Ë- 
z
->
fú°code
[s] + z->
fú°symbﬁ
[s];

3992 
	`STBI_ASSERT
(
z
->
size
[
b
] =
s
);

3993 
a
->
code_buf„r
 >>
s
;

3994 
a
->
num_bôs
 -
s
;

3995  
z
->
vÆue
[
b
];

3996 
	}
}

3998 
°bi_ölöe
 
	$°bi__zhuffm™_decode
(
°bi__zbuf
 *
a
, 
°bi__zhuffm™
 *
z
)

4000 
b
,
s
;

4001 i‡(
a
->
num_bôs
 < 16Ë
	`°bi__fûl_bôs
(a);

4002 
b
 = 
z
->
Á°
[
a
->
code_buf„r
 & 
STBI__ZFAST_MASK
];

4003 i‡(
b
) {

4004 
s
 = 
b
 >> 9;

4005 
a
->
code_buf„r
 >>
s
;

4006 
a
->
num_bôs
 -
s
;

4007  
b
 & 511;

4009  
	`°bi__zhuffm™_decode_¶ow∑th
(
a
, 
z
);

4010 
	}
}

4012 
	$°bi__zex∑nd
(
°bi__zbuf
 *
z
, *
zout
, 
n
)

4014 *
q
;

4015 
cur
, 
limô
, 
ﬁd_limô
;

4016 
z
->
zout
 = zout;

4017 i‡(!
z
->
z_ex∑ndabÀ
Ë 
	`°bi__îr
("output bufferÜimit","Corrupt PNG");

4018 
cur
 = (Ë(
z
->
zout
 - z->
zout_°¨t
);

4019 
limô
 = 
ﬁd_limô
 = (Ë(
z
->
zout_íd
 - z->
zout_°¨t
);

4020 
cur
 + 
n
 > 
limô
)

4021 
limô
 *= 2;

4022 
q
 = (*Ë
	`STBI_REALLOC_SIZED
(
z
->
zout_°¨t
, 
ﬁd_limô
, 
limô
);

4023 
	`STBI_NOTUSED
(
ﬁd_limô
);

4024 i‡(
q
 =
NULL
Ë 
	`°bi__îr
("outofmem", "Out of memory");

4025 
z
->
zout_°¨t
 = 
q
;

4026 
z
->
zout
 = 
q
 + 
cur
;

4027 
z
->
zout_íd
 = 
q
 + 
limô
;

4029 
	}
}

4031 c⁄° 
	g°bi__zÀngth_ba£
[31] = {

4036 c⁄° 
	g°bi__zÀngth_exåa
[31]=

4039 c⁄° 
	g°bi__zdi°_ba£
[32] = { 1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,

4042 c⁄° 
	g°bi__zdi°_exåa
[32] =

4045 
	$°bi__∑r£_huffm™_block
(
°bi__zbuf
 *
a
)

4047 *
zout
 = 
a
->zout;

4049 
z
 = 
	`°bi__zhuffm™_decode
(
a
, &a->
z_Àngth
);

4050 i‡(
z
 < 256) {

4051 i‡(
z
 < 0Ë 
	`°bi__îr
("bad huffman code","Corrupt PNG");

4052 i‡(
zout
 >
a
->
zout_íd
) {

4053 i‡(!
	`°bi__zex∑nd
(
a
, 
zout
, 1))  0;

4054 
zout
 = 
a
->zout;

4056 *
zout
++ = (Ë
z
;

4058 
°bi_uc
 *
p
;

4059 
Àn
,
di°
;

4060 i‡(
z
 == 256) {

4061 
a
->
zout
 = zout;

4064 
z
 -= 257;

4065 
Àn
 = 
°bi__zÀngth_ba£
[
z
];

4066 i‡(
°bi__zÀngth_exåa
[
z
]Ë
Àn
 +
	`°bi__zª˚ive
(
a
, stbi__zlength_extra[z]);

4067 
z
 = 
	`°bi__zhuffm™_decode
(
a
, &a->
z_di°™˚
);

4068 i‡(
z
 < 0Ë 
	`°bi__îr
("bad huffman code","Corrupt PNG");

4069 
di°
 = 
°bi__zdi°_ba£
[
z
];

4070 i‡(
°bi__zdi°_exåa
[
z
]Ë
di°
 +
	`°bi__zª˚ive
(
a
, stbi__zdist_extra[z]);

4071 i‡(
zout
 - 
a
->
zout_°¨t
 < 
di°
Ë 
	`°bi__îr
("bad dist","Corrupt PNG");

4072 i‡(
zout
 + 
Àn
 > 
a
->
zout_íd
) {

4073 i‡(!
	`°bi__zex∑nd
(
a
, 
zout
, 
Àn
))  0;

4074 
zout
 = 
a
->zout;

4076 
p
 = (
°bi_uc
 *Ë(
zout
 - 
di°
);

4077 i‡(
di°
 == 1) {

4078 
°bi_uc
 
v
 = *
p
;

4079 i‡(
Àn
Ë{ dÿ*
zout
++ = 
v
; --len); }

4081 i‡(
Àn
Ë{ dÿ*
zout
++ = *
p
++; --len); }

4085 
	}
}

4087 
	$°bi__compuã_huffm™_codes
(
°bi__zbuf
 *
a
)

4089 c⁄° 
°bi_uc
 
Àngth_dezigzag
[19] = { 16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15 };

4090 
°bi__zhuffm™
 
z_codñígth
;

4091 
°bi_uc
 
Àncodes
[286+32+137];

4092 
°bi_uc
 
codñígth_sizes
[19];

4093 
i
,
n
;

4095 
hlô
 = 
	`°bi__zª˚ive
(
a
,5) + 257;

4096 
hdi°
 = 
	`°bi__zª˚ive
(
a
,5) + 1;

4097 
h˛í
 = 
	`°bi__zª˚ive
(
a
,4) + 4;

4098 
¡Ÿ
 = 
hlô
 + 
hdi°
;

4100 
	`mem£t
(
codñígth_sizes
, 0, (codelength_sizes));

4101 
i
=0; i < 
h˛í
; ++i) {

4102 
s
 = 
	`°bi__zª˚ive
(
a
,3);

4103 
codñígth_sizes
[
Àngth_dezigzag
[
i
]] = (
°bi_uc
Ë
s
;

4105 i‡(!
	`°bi__zbuûd_huffm™
(&
z_codñígth
, 
codñígth_sizes
, 19))  0;

4107 
n
 = 0;

4108 
n
 < 
¡Ÿ
) {

4109 
c
 = 
	`°bi__zhuffm™_decode
(
a
, &
z_codñígth
);

4110 i‡(
c
 < 0 || c >19Ë 
	`°bi__îr
("bad codelengths", "Corrupt PNG");

4111 i‡(
c
 < 16)

4112 
Àncodes
[
n
++] = (
°bi_uc
Ë
c
;

4114 
°bi_uc
 
fûl
 = 0;

4115 i‡(
c
 == 16) {

4116 
c
 = 
	`°bi__zª˚ive
(
a
,2)+3;

4117 i‡(
n
 =0Ë 
	`°bi__îr
("bad codelengths", "Corrupt PNG");

4118 
fûl
 = 
Àncodes
[
n
-1];

4119 } i‡(
c
 == 17)

4120 
c
 = 
	`°bi__zª˚ive
(
a
,3)+3;

4122 
	`STBI_ASSERT
(
c
 == 18);

4123 
c
 = 
	`°bi__zª˚ive
(
a
,7)+11;

4125 i‡(
¡Ÿ
 - 
n
 < 
c
Ë 
	`°bi__îr
("bad codelengths", "Corrupt PNG");

4126 
	`mem£t
(
Àncodes
+
n
, 
fûl
, 
c
);

4127 
n
 +
c
;

4130 i‡(
n
 !
¡Ÿ
Ë 
	`°bi__îr
("bad codelengths","Corrupt PNG");

4131 i‡(!
	`°bi__zbuûd_huffm™
(&
a
->
z_Àngth
, 
Àncodes
, 
hlô
))  0;

4132 i‡(!
	`°bi__zbuûd_huffm™
(&
a
->
z_di°™˚
, 
Àncodes
+
hlô
, 
hdi°
))  0;

4134 
	}
}

4136 
	$°bi__∑r£_uncom¥es£d_block
(
°bi__zbuf
 *
a
)

4138 
°bi_uc
 
hódî
[4];

4139 
Àn
,
∆í
,
k
;

4140 i‡(
a
->
num_bôs
 & 7)

4141 
	`°bi__zª˚ive
(
a
,á->
num_bôs
 & 7);

4143 
k
 = 0;

4144 
a
->
num_bôs
 > 0) {

4145 
hódî
[
k
++] = (
°bi_uc
Ë(
a
->
code_buf„r
 & 255);

4146 
a
->
code_buf„r
 >>= 8;

4147 
a
->
num_bôs
 -= 8;

4149 
	`STBI_ASSERT
(
a
->
num_bôs
 == 0);

4151 
k
 < 4)

4152 
hódî
[
k
++] = 
	`°bi__zgë8
(
a
);

4153 
Àn
 = 
hódî
[1] * 256 + header[0];

4154 
∆í
 = 
hódî
[3] * 256 + header[2];

4155 i‡(
∆í
 !(
Àn
 ^ 0xffff)Ë 
	`°bi__îr
("zlib corrupt","Corrupt PNG");

4156 i‡(
a
->
zbuf„r
 + 
Àn
 >á->
zbuf„r_íd
Ë 
	`°bi__îr
("readÖast buffer","Corrupt PNG");

4157 i‡(
a
->
zout
 + 
Àn
 >á->
zout_íd
)

4158 i‡(!
	`°bi__zex∑nd
(
a
,á->
zout
, 
Àn
))  0;

4159 
	`mem˝y
(
a
->
zout
,á->
zbuf„r
, 
Àn
);

4160 
a
->
zbuf„r
 +
Àn
;

4161 
a
->
zout
 +
Àn
;

4163 
	}
}

4165 
	$°bi__∑r£_zlib_hódî
(
°bi__zbuf
 *
a
)

4167 
cmf
 = 
	`°bi__zgë8
(
a
);

4168 
cm
 = 
cmf
 & 15;

4170 
Êg
 = 
	`°bi__zgë8
(
a
);

4171 i‡((
cmf
*256+
Êg
Ë% 31 !0Ë 
	`°bi__îr
("bad zlib header","Corrupt PNG");

4172 i‡(
Êg
 & 32Ë 
	`°bi__îr
("noÖreset dict","Corrupt PNG");

4173 i‡(
cm
 !8Ë 
	`°bi__îr
("bad compression","Corrupt PNG");

4176 
	}
}

4178 c⁄° 
°bi_uc
 
	g°bi__zdeÁu…_Àngth
[288] =

4190 c⁄° 
°bi_uc
 
	g°bi__zdeÁu…_di°™˚
[32] =

4207 
	$°bi__∑r£_zlib
(
°bi__zbuf
 *
a
, 
∑r£_hódî
)

4209 
föÆ
, 
ty≥
;

4210 i‡(
∑r£_hódî
)

4211 i‡(!
	`°bi__∑r£_zlib_hódî
(
a
))  0;

4212 
a
->
num_bôs
 = 0;

4213 
a
->
code_buf„r
 = 0;

4215 
föÆ
 = 
	`°bi__zª˚ive
(
a
,1);

4216 
ty≥
 = 
	`°bi__zª˚ive
(
a
,2);

4217 i‡(
ty≥
 == 0) {

4218 i‡(!
	`°bi__∑r£_uncom¥es£d_block
(
a
))  0;

4219 } i‡(
ty≥
 == 3) {

4222 i‡(
ty≥
 == 1) {

4224 i‡(!
	`°bi__zbuûd_huffm™
(&
a
->
z_Àngth
 , 
°bi__zdeÁu…_Àngth
 , 288))  0;

4225 i‡(!
	`°bi__zbuûd_huffm™
(&
a
->
z_di°™˚
, 
°bi__zdeÁu…_di°™˚
, 32))  0;

4227 i‡(!
	`°bi__compuã_huffm™_codes
(
a
))  0;

4229 i‡(!
	`°bi__∑r£_huffm™_block
(
a
))  0;

4231 } !
föÆ
);

4233 
	}
}

4235 
	$°bi__do_zlib
(
°bi__zbuf
 *
a
, *
obuf
, 
ﬁí
, 
exp
, 
∑r£_hódî
)

4237 
a
->
zout_°¨t
 = 
obuf
;

4238 
a
->
zout
 = 
obuf
;

4239 
a
->
zout_íd
 = 
obuf
 + 
ﬁí
;

4240 
a
->
z_ex∑ndabÀ
 = 
exp
;

4242  
	`°bi__∑r£_zlib
(
a
, 
∑r£_hódî
);

4243 
	}
}

4245 
STBIDEF
 *
	$°bi_zlib_decode_mÆloc_guesssize
(c⁄° *
buf„r
, 
Àn
, 
öôül_size
, *
ouéí
)

4247 
°bi__zbuf
 
a
;

4248 *
p
 = (*Ë
	`°bi__mÆloc
(
öôül_size
);

4249 i‡(
p
 =
NULL
)  NULL;

4250 
a
.
zbuf„r
 = (
°bi_uc
 *Ë
buf„r
;

4251 
a
.
zbuf„r_íd
 = (
°bi_uc
 *Ë
buf„r
 + 
Àn
;

4252 i‡(
	`°bi__do_zlib
(&
a
, 
p
, 
öôül_size
, 1, 1)) {

4253 i‡(
ouéí
Ë*ouéí = (Ë(
a
.
zout
 -á.
zout_°¨t
);

4254  
a
.
zout_°¨t
;

4256 
	`STBI_FREE
(
a
.
zout_°¨t
);

4257  
NULL
;

4259 
	}
}

4261 
STBIDEF
 *
	$°bi_zlib_decode_mÆloc
(c⁄° *
buf„r
, 
Àn
, *
ouéí
)

4263  
	`°bi_zlib_decode_mÆloc_guesssize
(
buf„r
, 
Àn
, 16384, 
ouéí
);

4264 
	}
}

4266 
STBIDEF
 *
	$°bi_zlib_decode_mÆloc_guesssize_hódîÊag
(c⁄° *
buf„r
, 
Àn
, 
öôül_size
, *
ouéí
, 
∑r£_hódî
)

4268 
°bi__zbuf
 
a
;

4269 *
p
 = (*Ë
	`°bi__mÆloc
(
öôül_size
);

4270 i‡(
p
 =
NULL
)  NULL;

4271 
a
.
zbuf„r
 = (
°bi_uc
 *Ë
buf„r
;

4272 
a
.
zbuf„r_íd
 = (
°bi_uc
 *Ë
buf„r
 + 
Àn
;

4273 i‡(
	`°bi__do_zlib
(&
a
, 
p
, 
öôül_size
, 1, 
∑r£_hódî
)) {

4274 i‡(
ouéí
Ë*ouéí = (Ë(
a
.
zout
 -á.
zout_°¨t
);

4275  
a
.
zout_°¨t
;

4277 
	`STBI_FREE
(
a
.
zout_°¨t
);

4278  
NULL
;

4280 
	}
}

4282 
STBIDEF
 
	$°bi_zlib_decode_buf„r
(*
obuf„r
, 
ﬁí
, c⁄° *
ibuf„r
, 
ûí
)

4284 
°bi__zbuf
 
a
;

4285 
a
.
zbuf„r
 = (
°bi_uc
 *Ë
ibuf„r
;

4286 
a
.
zbuf„r_íd
 = (
°bi_uc
 *Ë
ibuf„r
 + 
ûí
;

4287 i‡(
	`°bi__do_zlib
(&
a
, 
obuf„r
, 
ﬁí
, 0, 1))

4288  (Ë(
a
.
zout
 -á.
zout_°¨t
);

4291 
	}
}

4293 
STBIDEF
 *
	$°bi_zlib_decode_nohódî_mÆloc
(c⁄° *
buf„r
, 
Àn
, *
ouéí
)

4295 
°bi__zbuf
 
a
;

4296 *
p
 = (*Ë
	`°bi__mÆloc
(16384);

4297 i‡(
p
 =
NULL
)  NULL;

4298 
a
.
zbuf„r
 = (
°bi_uc
 *Ë
buf„r
;

4299 
a
.
zbuf„r_íd
 = (
°bi_uc
 *Ë
buf„r
+
Àn
;

4300 i‡(
	`°bi__do_zlib
(&
a
, 
p
, 16384, 1, 0)) {

4301 i‡(
ouéí
Ë*ouéí = (Ë(
a
.
zout
 -á.
zout_°¨t
);

4302  
a
.
zout_°¨t
;

4304 
	`STBI_FREE
(
a
.
zout_°¨t
);

4305  
NULL
;

4307 
	}
}

4309 
STBIDEF
 
	$°bi_zlib_decode_nohódî_buf„r
(*
obuf„r
, 
ﬁí
, c⁄° *
ibuf„r
, 
ûí
)

4311 
°bi__zbuf
 
a
;

4312 
a
.
zbuf„r
 = (
°bi_uc
 *Ë
ibuf„r
;

4313 
a
.
zbuf„r_íd
 = (
°bi_uc
 *Ë
ibuf„r
 + 
ûí
;

4314 i‡(
	`°bi__do_zlib
(&
a
, 
obuf„r
, 
ﬁí
, 0, 0))

4315  (Ë(
a
.
zout
 -á.
zout_°¨t
);

4318 
	}
}

4331 #i‚de‡
STBI_NO_PNG


4334 
°bi__uöt32
 
	mÀngth
;

4335 
°bi__uöt32
 
	mty≥
;

4336 } 
	t°bi__≤gchunk
;

4338 
°bi__≤gchunk
 
	$°bi__gë_chunk_hódî
(
°bi__c⁄ãxt
 *
s
)

4340 
°bi__≤gchunk
 
c
;

4341 
c
.
Àngth
 = 
	`°bi__gë32be
(
s
);

4342 
c
.
ty≥
 = 
	`°bi__gë32be
(
s
);

4343  
c
;

4344 
	}
}

4346 
	$°bi__check_≤g_hódî
(
°bi__c⁄ãxt
 *
s
)

4348 c⁄° 
°bi_uc
 
≤g_sig
[8] = { 137,80,78,71,13,10,26,10 };

4349 
i
;

4350 
i
=0; i < 8; ++i)

4351 i‡(
	`°bi__gë8
(
s
Ë!
≤g_sig
[
i
]Ë 
	`°bi__îr
("badÖng sig","Notá PNG");

4353 
	}
}

4357 
°bi__c⁄ãxt
 *
	ms
;

4358 
°bi_uc
 *
	mid©a
, *
	mex∑nded
, *
	mout
;

4359 
	mdïth
;

4360 } 
	t°bi__≤g
;

4364 
	mSTBI__F_n⁄e
=0,

4365 
	mSTBI__F_sub
=1,

4366 
	mSTBI__F_up
=2,

4367 
	mSTBI__F_avg
=3,

4368 
	mSTBI__F_∑ëh
=4,

4370 
	mSTBI__F_avg_fú°
,

4371 
	mSTBI__F_∑ëh_fú°


4374 
°bi_uc
 
	gfú°_row_fûãr
[5] =

4376 
STBI__F_n⁄e
,

4377 
STBI__F_sub
,

4378 
STBI__F_n⁄e
,

4379 
STBI__F_avg_fú°
,

4380 
STBI__F_∑ëh_fú°


4383 
	$°bi__∑ëh
(
a
, 
b
, 
c
)

4385 
p
 = 
a
 + 
b
 - 
c
;

4386 
∑
 = 
	`abs
(
p
-
a
);

4387 
pb
 = 
	`abs
(
p
-
b
);

4388 
pc
 = 
	`abs
(
p
-
c
);

4389 i‡(
∑
 <
pb
 &&Ö®<
pc
Ë 
a
;

4390 i‡(
pb
 <
pc
Ë 
b
;

4391  
c
;

4392 
	}
}

4394 c⁄° 
°bi_uc
 
	g°bi__dïth_sˇÀ_èbÀ
[9] = { 0, 0xff, 0x55, 0, 0x11, 0,0,0, 0x01 };

4397 
	$°bi__¸óã_≤g_image_øw
(
°bi__≤g
 *
a
, 
°bi_uc
 *
øw
, 
°bi__uöt32
 
øw_Àn
, 
out_n
, stbi__uöt32 
x
, stbi__uöt32 
y
, 
dïth
, 
cﬁ‹
)

4399 
byãs
 = (
dïth
 == 16? 2 : 1);

4400 
°bi__c⁄ãxt
 *
s
 = 
a
->s;

4401 
°bi__uöt32
 
i
,
j
,
°ride
 = 
x
*
out_n
*
byãs
;

4402 
°bi__uöt32
 
img_Àn
, 
img_width_byãs
;

4403 
k
;

4404 
img_n
 = 
s
->img_n;

4406 
ouçut_byãs
 = 
out_n
*
byãs
;

4407 
fûãr_byãs
 = 
img_n
*
byãs
;

4408 
width
 = 
x
;

4410 
	`STBI_ASSERT
(
out_n
 =
s
->
img_n
 || out_n == s->img_n+1);

4411 
a
->
out
 = (
°bi_uc
 *Ë
	`°bi__mÆloc_mad3
(
x
, 
y
, 
ouçut_byãs
, 0);

4412 i‡(!
a
->
out
Ë 
	`°bi__îr
("outofmem", "Out of memory");

4414 i‡(!
	`°bi__mad3sizes_vÆid
(
img_n
, 
x
, 
dïth
, 7)Ë 
	`°bi__îr
("tooÜarge", "Corrupt PNG");

4415 
img_width_byãs
 = (((
img_n
 * 
x
 * 
dïth
) + 7) >> 3);

4416 
img_Àn
 = (
img_width_byãs
 + 1Ë* 
y
;

4421 i‡(
øw_Àn
 < 
img_Àn
Ë 
	`°bi__îr
("notÉnoughÖixels","Corrupt PNG");

4423 
j
=0; j < 
y
; ++j) {

4424 
°bi_uc
 *
cur
 = 
a
->
out
 + 
°ride
*
j
;

4425 
°bi_uc
 *
¥i‹
;

4426 
fûãr
 = *
øw
++;

4428 i‡(
fûãr
 > 4)

4429  
	`°bi__îr
("invalid filter","Corrupt PNG");

4431 i‡(
dïth
 < 8) {

4432 
	`STBI_ASSERT
(
img_width_byãs
 <
x
);

4433 
cur
 +
x
*
out_n
 - 
img_width_byãs
;

4434 
fûãr_byãs
 = 1;

4435 
width
 = 
img_width_byãs
;

4437 
¥i‹
 = 
cur
 - 
°ride
;

4440 i‡(
j
 =0Ë
fûãr
 = 
fú°_row_fûãr
[filter];

4443 
k
=0; k < 
fûãr_byãs
; ++k) {

4444 
fûãr
) {

4445 
STBI__F_n⁄e
 : 
cur
[
k
] = 
øw
[k]; ;

4446 
STBI__F_sub
 : 
cur
[
k
] = 
øw
[k]; ;

4447 
STBI__F_up
 : 
cur
[
k
] = 
	`STBI__BYTECAST
(
øw
[k] + 
¥i‹
[k]); ;

4448 
STBI__F_avg
 : 
cur
[
k
] = 
	`STBI__BYTECAST
(
øw
[k] + (
¥i‹
[k]>>1)); ;

4449 
STBI__F_∑ëh
 : 
cur
[
k
] = 
	`STBI__BYTECAST
(
øw
[k] + 
	`°bi__∑ëh
(0,
¥i‹
[k],0)); ;

4450 
STBI__F_avg_fú°
 : 
cur
[
k
] = 
øw
[k]; ;

4451 
STBI__F_∑ëh_fú°
: 
cur
[
k
] = 
øw
[k]; ;

4455 i‡(
dïth
 == 8) {

4456 i‡(
img_n
 !
out_n
)

4457 
cur
[
img_n
] = 255;

4458 
øw
 +
img_n
;

4459 
cur
 +
out_n
;

4460 
¥i‹
 +
out_n
;

4461 } i‡(
dïth
 == 16) {

4462 i‡(
img_n
 !
out_n
) {

4463 
cur
[
fûãr_byãs
] = 255;

4464 
cur
[
fûãr_byãs
+1] = 255;

4466 
øw
 +
fûãr_byãs
;

4467 
cur
 +
ouçut_byãs
;

4468 
¥i‹
 +
ouçut_byãs
;

4470 
øw
 += 1;

4471 
cur
 += 1;

4472 
¥i‹
 += 1;

4476 i‡(
dïth
 < 8 || 
img_n
 =
out_n
) {

4477 
nk
 = (
width
 - 1)*
fûãr_byãs
;

4478 
	#STBI__CASE
(
f
) \

4479 
f
: \

4480 
k
=0; k < 
nk
; ++k)

	)

4481 
fûãr
) {

4483 
STBI__F_n⁄e
: 
	`mem˝y
(
cur
, 
øw
, 
nk
); ;

4484 
	`STBI__CASE
(
STBI__F_sub
Ë{ 
cur
[
k
] = 
	`STBI__BYTECAST
(
øw
[k] + cur[k-
fûãr_byãs
]); } ;

4485 
	`STBI__CASE
(
STBI__F_up
Ë{ 
cur
[
k
] = 
	`STBI__BYTECAST
(
øw
[k] + 
¥i‹
[k]); } ;

4486 
	`STBI__CASE
(
STBI__F_avg
Ë{ 
cur
[
k
] = 
	`STBI__BYTECAST
(
øw
[k] + ((
¥i‹
[k] + cur[k-
fûãr_byãs
])>>1)); } ;

4487 
	`STBI__CASE
(
STBI__F_∑ëh
Ë{ 
cur
[
k
] = 
	`STBI__BYTECAST
(
øw
[k] + 
	`°bi__∑ëh
(cur[k-
fûãr_byãs
],
¥i‹
[k],prior[k-filter_bytes])); } ;

4488 
	`STBI__CASE
(
STBI__F_avg_fú°
Ë{ 
cur
[
k
] = 
	`STBI__BYTECAST
(
øw
[k] + (cur[k-
fûãr_byãs
] >> 1)); } ;

4489 
	`STBI__CASE
(
STBI__F_∑ëh_fú°
Ë{ 
cur
[
k
] = 
	`STBI__BYTECAST
(
øw
[k] + 
	`°bi__∑ëh
(cur[k-
fûãr_byãs
],0,0)); } ;

4491 #unde‡
STBI__CASE


4492 
øw
 +
nk
;

4494 
	`STBI_ASSERT
(
img_n
+1 =
out_n
);

4495 
	#STBI__CASE
(
f
) \

4496 
f
: \

4497 
i
=
x
-1; i >1; --i, 
cur
[
fûãr_byãs
]=255,
øw
+=fûãr_byãs,cur+=
ouçut_byãs
,
¥i‹
+=output_bytes) \

4498 
k
=0; k < 
fûãr_byãs
; ++k)

	)

4499 
fûãr
) {

4500 
	`STBI__CASE
(
STBI__F_n⁄e
Ë{ 
cur
[
k
] = 
øw
[k]; } ;

4501 
	`STBI__CASE
(
STBI__F_sub
Ë{ 
cur
[
k
] = 
	`STBI__BYTECAST
(
øw
[k] + cur[k- 
ouçut_byãs
]); } ;

4502 
	`STBI__CASE
(
STBI__F_up
Ë{ 
cur
[
k
] = 
	`STBI__BYTECAST
(
øw
[k] + 
¥i‹
[k]); } ;

4503 
	`STBI__CASE
(
STBI__F_avg
Ë{ 
cur
[
k
] = 
	`STBI__BYTECAST
(
øw
[k] + ((
¥i‹
[k] + cur[k- 
ouçut_byãs
])>>1)); } ;

4504 
	`STBI__CASE
(
STBI__F_∑ëh
Ë{ 
cur
[
k
] = 
	`STBI__BYTECAST
(
øw
[k] + 
	`°bi__∑ëh
(cur[k- 
ouçut_byãs
],
¥i‹
[k],prior[k- output_bytes])); } ;

4505 
	`STBI__CASE
(
STBI__F_avg_fú°
Ë{ 
cur
[
k
] = 
	`STBI__BYTECAST
(
øw
[k] + (cur[k- 
ouçut_byãs
] >> 1)); } ;

4506 
	`STBI__CASE
(
STBI__F_∑ëh_fú°
Ë{ 
cur
[
k
] = 
	`STBI__BYTECAST
(
øw
[k] + 
	`°bi__∑ëh
(cur[k- 
ouçut_byãs
],0,0)); } ;

4508 #unde‡
STBI__CASE


4512 i‡(
dïth
 == 16) {

4513 
cur
 = 
a
->
out
 + 
°ride
*
j
;

4514 
i
=0; i < 
x
; ++i,
cur
+=
ouçut_byãs
) {

4515 
cur
[
fûãr_byãs
+1] = 255;

4524 i‡(
dïth
 < 8) {

4525 
j
=0; j < 
y
; ++j) {

4526 
°bi_uc
 *
cur
 = 
a
->
out
 + 
°ride
*
j
;

4527 
°bi_uc
 *
ö
 = 
a
->
out
 + 
°ride
*
j
 + 
x
*
out_n
 - 
img_width_byãs
;

4530 
°bi_uc
 
sˇÀ
 = (
cﬁ‹
 =0Ë? 
°bi__dïth_sˇÀ_èbÀ
[
dïth
] : 1;

4538 i‡(
dïth
 == 4) {

4539 
k
=
x
*
img_n
; k >2; k-=2, ++
ö
) {

4540 *
cur
++ = 
sˇÀ
 * ((*
ö
 >> 4) );

4541 *
cur
++ = 
sˇÀ
 * ((*
ö
 ) & 0x0f);

4543 i‡(
k
 > 0Ë*
cur
++ = 
sˇÀ
 * ((*
ö
 >> 4) );

4544 } i‡(
dïth
 == 2) {

4545 
k
=
x
*
img_n
; k >4; k-=4, ++
ö
) {

4546 *
cur
++ = 
sˇÀ
 * ((*
ö
 >> 6) );

4547 *
cur
++ = 
sˇÀ
 * ((*
ö
 >> 4) & 0x03);

4548 *
cur
++ = 
sˇÀ
 * ((*
ö
 >> 2) & 0x03);

4549 *
cur
++ = 
sˇÀ
 * ((*
ö
 ) & 0x03);

4551 i‡(
k
 > 0Ë*
cur
++ = 
sˇÀ
 * ((*
ö
 >> 6) );

4552 i‡(
k
 > 1Ë*
cur
++ = 
sˇÀ
 * ((*
ö
 >> 4) & 0x03);

4553 i‡(
k
 > 2Ë*
cur
++ = 
sˇÀ
 * ((*
ö
 >> 2) & 0x03);

4554 } i‡(
dïth
 == 1) {

4555 
k
=
x
*
img_n
; k >8; k-=8, ++
ö
) {

4556 *
cur
++ = 
sˇÀ
 * ((*
ö
 >> 7) );

4557 *
cur
++ = 
sˇÀ
 * ((*
ö
 >> 6) & 0x01);

4558 *
cur
++ = 
sˇÀ
 * ((*
ö
 >> 5) & 0x01);

4559 *
cur
++ = 
sˇÀ
 * ((*
ö
 >> 4) & 0x01);

4560 *
cur
++ = 
sˇÀ
 * ((*
ö
 >> 3) & 0x01);

4561 *
cur
++ = 
sˇÀ
 * ((*
ö
 >> 2) & 0x01);

4562 *
cur
++ = 
sˇÀ
 * ((*
ö
 >> 1) & 0x01);

4563 *
cur
++ = 
sˇÀ
 * ((*
ö
 ) & 0x01);

4565 i‡(
k
 > 0Ë*
cur
++ = 
sˇÀ
 * ((*
ö
 >> 7) );

4566 i‡(
k
 > 1Ë*
cur
++ = 
sˇÀ
 * ((*
ö
 >> 6) & 0x01);

4567 i‡(
k
 > 2Ë*
cur
++ = 
sˇÀ
 * ((*
ö
 >> 5) & 0x01);

4568 i‡(
k
 > 3Ë*
cur
++ = 
sˇÀ
 * ((*
ö
 >> 4) & 0x01);

4569 i‡(
k
 > 4Ë*
cur
++ = 
sˇÀ
 * ((*
ö
 >> 3) & 0x01);

4570 i‡(
k
 > 5Ë*
cur
++ = 
sˇÀ
 * ((*
ö
 >> 2) & 0x01);

4571 i‡(
k
 > 6Ë*
cur
++ = 
sˇÀ
 * ((*
ö
 >> 1) & 0x01);

4573 i‡(
img_n
 !
out_n
) {

4574 
q
;

4576 
cur
 = 
a
->
out
 + 
°ride
*
j
;

4577 i‡(
img_n
 == 1) {

4578 
q
=
x
-1; q >= 0; --q) {

4579 
cur
[
q
*2+1] = 255;

4580 
cur
[
q
*2+0] = cur[q];

4583 
	`STBI_ASSERT
(
img_n
 == 3);

4584 
q
=
x
-1; q >= 0; --q) {

4585 
cur
[
q
*4+3] = 255;

4586 
cur
[
q
*4+2] = cur[q*3+2];

4587 
cur
[
q
*4+1] = cur[q*3+1];

4588 
cur
[
q
*4+0] = cur[q*3+0];

4593 } i‡(
dïth
 == 16) {

4598 
°bi_uc
 *
cur
 = 
a
->
out
;

4599 
°bi__uöt16
 *
cur16
 = (°bi__uöt16*)
cur
;

4601 
i
=0; i < 
x
*
y
*
out_n
; ++i,
cur16
++,
cur
+=2) {

4602 *
cur16
 = (
cur
[0] << 8) | cur[1];

4607 
	}
}

4609 
	$°bi__¸óã_≤g_image
(
°bi__≤g
 *
a
, 
°bi_uc
 *
image_d©a
, 
°bi__uöt32
 
image_d©a_Àn
, 
out_n
, 
dïth
, 
cﬁ‹
, 
öãæa˚d
)

4611 
byãs
 = (
dïth
 == 16 ? 2 : 1);

4612 
out_byãs
 = 
out_n
 * 
byãs
;

4613 
°bi_uc
 *
föÆ
;

4614 
p
;

4615 i‡(!
öãæa˚d
)

4616  
	`°bi__¸óã_≤g_image_øw
(
a
, 
image_d©a
, 
image_d©a_Àn
, 
out_n
,á->
s
->
img_x
,á->s->
img_y
, 
dïth
, 
cﬁ‹
);

4619 
föÆ
 = (
°bi_uc
 *Ë
	`°bi__mÆloc_mad3
(
a
->
s
->
img_x
,á->s->
img_y
, 
out_byãs
, 0);

4620 
p
=0;Ö < 7; ++p) {

4621 
x‹ig
[] = { 0,4,0,2,0,1,0 };

4622 
y‹ig
[] = { 0,0,4,0,2,0,1 };

4623 
x•c
[] = { 8,8,4,4,2,2,1 };

4624 
y•c
[] = { 8,8,8,4,4,2,2 };

4625 
i
,
j
,
x
,
y
;

4627 
x
 = (
a
->
s
->
img_x
 - 
x‹ig
[
p
] + 
x•c
[p]-1) / xspc[p];

4628 
y
 = (
a
->
s
->
img_y
 - 
y‹ig
[
p
] + 
y•c
[p]-1) / yspc[p];

4629 i‡(
x
 && 
y
) {

4630 
°bi__uöt32
 
img_Àn
 = ((((
a
->
s
->
img_n
 * 
x
 * 
dïth
Ë+ 7Ë>> 3Ë+ 1Ë* 
y
;

4631 i‡(!
	`°bi__¸óã_≤g_image_øw
(
a
, 
image_d©a
, 
image_d©a_Àn
, 
out_n
, 
x
, 
y
, 
dïth
, 
cﬁ‹
)) {

4632 
	`STBI_FREE
(
föÆ
);

4635 
j
=0; j < 
y
; ++j) {

4636 
i
=0; i < 
x
; ++i) {

4637 
out_y
 = 
j
*
y•c
[
p
]+
y‹ig
[p];

4638 
out_x
 = 
i
*
x•c
[
p
]+
x‹ig
[p];

4639 
	`mem˝y
(
föÆ
 + 
out_y
*
a
->
s
->
img_x
*
out_byãs
 + 
out_x
*out_bytes,

4640 
a
->
out
 + (
j
*
x
+
i
)*
out_byãs
, out_bytes);

4643 
	`STBI_FREE
(
a
->
out
);

4644 
image_d©a
 +
img_Àn
;

4645 
image_d©a_Àn
 -
img_Àn
;

4648 
a
->
out
 = 
föÆ
;

4651 
	}
}

4653 
	$°bi__compuã_å™•¨ícy
(
°bi__≤g
 *
z
, 
°bi_uc
 
tc
[3], 
out_n
)

4655 
°bi__c⁄ãxt
 *
s
 = 
z
->s;

4656 
°bi__uöt32
 
i
, 
pixñ_cou¡
 = 
s
->
img_x
 * s->
img_y
;

4657 
°bi_uc
 *
p
 = 
z
->
out
;

4661 
	`STBI_ASSERT
(
out_n
 == 2 || out_n == 4);

4663 i‡(
out_n
 == 2) {

4664 
i
=0; i < 
pixñ_cou¡
; ++i) {

4665 
p
[1] = (p[0] =
tc
[0] ? 0 : 255);

4666 
p
 += 2;

4669 
i
=0; i < 
pixñ_cou¡
; ++i) {

4670 i‡(
p
[0] =
tc
[0] &&Ö[1] ==Åc[1] &&Ö[2] ==Åc[2])

4671 
p
[3] = 0;

4672 
p
 += 4;

4676 
	}
}

4678 
	$°bi__compuã_å™•¨ícy16
(
°bi__≤g
 *
z
, 
°bi__uöt16
 
tc
[3], 
out_n
)

4680 
°bi__c⁄ãxt
 *
s
 = 
z
->s;

4681 
°bi__uöt32
 
i
, 
pixñ_cou¡
 = 
s
->
img_x
 * s->
img_y
;

4682 
°bi__uöt16
 *
p
 = (°bi__uöt16*Ë
z
->
out
;

4686 
	`STBI_ASSERT
(
out_n
 == 2 || out_n == 4);

4688 i‡(
out_n
 == 2) {

4689 
i
 = 0; i < 
pixñ_cou¡
; ++i) {

4690 
p
[1] = (p[0] =
tc
[0] ? 0 : 65535);

4691 
p
 += 2;

4694 
i
 = 0; i < 
pixñ_cou¡
; ++i) {

4695 i‡(
p
[0] =
tc
[0] &&Ö[1] ==Åc[1] &&Ö[2] ==Åc[2])

4696 
p
[3] = 0;

4697 
p
 += 4;

4701 
	}
}

4703 
	$°bi__ex∑nd_≤g_∑Àâe
(
°bi__≤g
 *
a
, 
°bi_uc
 *
∑Àâe
, 
Àn
, 
∑l_img_n
)

4705 
°bi__uöt32
 
i
, 
pixñ_cou¡
 = 
a
->
s
->
img_x
 *á->s->
img_y
;

4706 
°bi_uc
 *
p
, *
ãmp_out
, *
‹ig
 = 
a
->
out
;

4708 
p
 = (
°bi_uc
 *Ë
	`°bi__mÆloc_mad2
(
pixñ_cou¡
, 
∑l_img_n
, 0);

4709 i‡(
p
 =
NULL
Ë 
	`°bi__îr
("outofmem", "Out of memory");

4712 
ãmp_out
 = 
p
;

4714 i‡(
∑l_img_n
 == 3) {

4715 
i
=0; i < 
pixñ_cou¡
; ++i) {

4716 
n
 = 
‹ig
[
i
]*4;

4717 
p
[0] = 
∑Àâe
[
n
 ];

4718 
p
[1] = 
∑Àâe
[
n
+1];

4719 
p
[2] = 
∑Àâe
[
n
+2];

4720 
p
 += 3;

4723 
i
=0; i < 
pixñ_cou¡
; ++i) {

4724 
n
 = 
‹ig
[
i
]*4;

4725 
p
[0] = 
∑Àâe
[
n
 ];

4726 
p
[1] = 
∑Àâe
[
n
+1];

4727 
p
[2] = 
∑Àâe
[
n
+2];

4728 
p
[3] = 
∑Àâe
[
n
+3];

4729 
p
 += 4;

4732 
	`STBI_FREE
(
a
->
out
);

4733 
a
->
out
 = 
ãmp_out
;

4735 
	`STBI_NOTUSED
(
Àn
);

4738 
	}
}

4740 
	g°bi__u≈ªmu…ùly_⁄_lﬂd
 = 0;

4741 
	g°bi__de_ùh⁄e_Êag
 = 0;

4743 
STBIDEF
 
	$°bi_£t_u≈ªmu…ùly_⁄_lﬂd
(
Êag_åue_if_should_u≈ªmu…ùly
)

4745 
°bi__u≈ªmu…ùly_⁄_lﬂd
 = 
Êag_åue_if_should_u≈ªmu…ùly
;

4746 
	}
}

4748 
STBIDEF
 
	$°bi_c⁄vît_ùh⁄e_≤g_to_rgb
(
Êag_åue_if_should_c⁄vît
)

4750 
°bi__de_ùh⁄e_Êag
 = 
Êag_åue_if_should_c⁄vît
;

4751 
	}
}

4753 
	$°bi__de_ùh⁄e
(
°bi__≤g
 *
z
)

4755 
°bi__c⁄ãxt
 *
s
 = 
z
->s;

4756 
°bi__uöt32
 
i
, 
pixñ_cou¡
 = 
s
->
img_x
 * s->
img_y
;

4757 
°bi_uc
 *
p
 = 
z
->
out
;

4759 i‡(
s
->
img_out_n
 == 3) {

4760 
i
=0; i < 
pixñ_cou¡
; ++i) {

4761 
°bi_uc
 
t
 = 
p
[0];

4762 
p
[0] =Ö[2];

4763 
p
[2] = 
t
;

4764 
p
 += 3;

4767 
	`STBI_ASSERT
(
s
->
img_out_n
 == 4);

4768 i‡(
°bi__u≈ªmu…ùly_⁄_lﬂd
) {

4770 
i
=0; i < 
pixñ_cou¡
; ++i) {

4771 
°bi_uc
 
a
 = 
p
[3];

4772 
°bi_uc
 
t
 = 
p
[0];

4773 i‡(
a
) {

4774 
°bi_uc
 
hÆf
 = 
a
 / 2;

4775 
p
[0] = (p[2] * 255 + 
hÆf
Ë/ 
a
;

4776 
p
[1] = (p[1] * 255 + 
hÆf
Ë/ 
a
;

4777 
p
[2] = ( 
t
 * 255 + 
hÆf
Ë/ 
a
;

4779 
p
[0] =Ö[2];

4780 
p
[2] = 
t
;

4782 
p
 += 4;

4786 
i
=0; i < 
pixñ_cou¡
; ++i) {

4787 
°bi_uc
 
t
 = 
p
[0];

4788 
p
[0] =Ö[2];

4789 
p
[2] = 
t
;

4790 
p
 += 4;

4794 
	}
}

4796 
	#STBI__PNG_TYPE
(
a
,
b
,
c
,
d
Ë(((Ë◊Ë<< 24Ë+ ((Ë(bË<< 16Ë+ ((Ë(cË<< 8Ë+ (Ë(d))

	)

4798 
	$°bi__∑r£_≤g_fûe
(
°bi__≤g
 *
z
, 
sˇn
, 
ªq_comp
)

4800 
°bi_uc
 
∑Àâe
[1024], 
∑l_img_n
=0;

4801 
°bi_uc
 
has_å™s
=0, 
tc
[3]={0};

4802 
°bi__uöt16
 
tc16
[3];

4803 
°bi__uöt32
 
ioff
=0, 
id©a_limô
=0, 
i
, 
∑l_Àn
=0;

4804 
fú°
=1,
k
,
öãæa˚
=0, 
cﬁ‹
=0, 
is_ùh⁄e
=0;

4805 
°bi__c⁄ãxt
 *
s
 = 
z
->s;

4807 
z
->
ex∑nded
 = 
NULL
;

4808 
z
->
id©a
 = 
NULL
;

4809 
z
->
out
 = 
NULL
;

4811 i‡(!
	`°bi__check_≤g_hódî
(
s
))  0;

4813 i‡(
sˇn
 =
STBI__SCAN_ty≥
)  1;

4816 
°bi__≤gchunk
 
c
 = 
	`°bi__gë_chunk_hódî
(
s
);

4817 
c
.
ty≥
) {

4818 
	`STBI__PNG_TYPE
('C','g','B','I'):

4819 
is_ùh⁄e
 = 1;

4820 
	`°bi__skù
(
s
, 
c
.
Àngth
);

4822 
	`STBI__PNG_TYPE
('I','H','D','R'): {

4823 
comp
,
fûãr
;

4824 i‡(!
fú°
Ë 
	`°bi__îr
("multiple IHDR","Corrupt PNG");

4825 
fú°
 = 0;

4826 i‡(
c
.
Àngth
 !13Ë 
	`°bi__îr
("bad IHDRÜen","Corrupt PNG");

4827 
s
->
img_x
 = 
	`°bi__gë32be
(s); i‡(s->img_x > (1 << 24)Ë 
	`°bi__îr
("tooÜarge","VeryÜarge image (corrupt?)");

4828 
s
->
img_y
 = 
	`°bi__gë32be
(s); i‡(s->img_y > (1 << 24)Ë 
	`°bi__îr
("tooÜarge","VeryÜarge image (corrupt?)");

4829 
z
->
dïth
 = 
	`°bi__gë8
(
s
); i‡(z->dïth !1 && z->dïth !2 && z->dïth !4 && z->dïth !8 && z->dïth !16Ë 
	`°bi__îr
("1/2/4/8/16-bit only","PNGÇot supported: 1/2/4/8/16-bit only");

4830 
cﬁ‹
 = 
	`°bi__gë8
(
s
); i‡(cﬁ‹ > 6Ë 
	`°bi__îr
("bad ctype","Corrupt PNG");

4831 i‡(
cﬁ‹
 =3 && 
z
->
dïth
 =16Ë 
	`°bi__îr
("bad ctype","Corrupt PNG");

4832 i‡(
cﬁ‹
 =3Ë
∑l_img_n
 = 3; i‡(cﬁ‹ & 1Ë 
	`°bi__îr
("bad ctype","Corrupt PNG");

4833 
comp
 = 
	`°bi__gë8
(
s
); i‡(compË 
	`°bi__îr
("bad comp method","Corrupt PNG");

4834 
fûãr

	`°bi__gë8
(
s
); i‡(fûãrË 
	`°bi__îr
("bad filter method","Corrupt PNG");

4835 
öãæa˚
 = 
	`°bi__gë8
(
s
); i‡(öãæa˚>1Ë 
	`°bi__îr
("bad interlace method","Corrupt PNG");

4836 i‡(!
s
->
img_x
 || !s->
img_y
Ë 
	`°bi__îr
("0-pixel image","Corrupt PNG");

4837 i‡(!
∑l_img_n
) {

4838 
s
->
img_n
 = (
cﬁ‹
 & 2 ? 3 : 1) + (color & 4 ? 1 : 0);

4839 i‡((1 << 30Ë/ 
s
->
img_x
 / s->
img_n
 < s->
img_y
Ë 
	`°bi__îr
("tooÜarge", "ImageÅooÜargeÅo decode");

4840 i‡(
sˇn
 =
STBI__SCAN_hódî
)  1;

4844 
s
->
img_n
 = 1;

4845 i‡((1 << 30Ë/ 
s
->
img_x
 / 4 < s->
img_y
Ë 
	`°bi__îr
("tooÜarge","Corrupt PNG");

4851 
	`STBI__PNG_TYPE
('P','L','T','E'): {

4852 i‡(
fú°
Ë 
	`°bi__îr
("firstÇot IHDR", "Corrupt PNG");

4853 i‡(
c
.
Àngth
 > 256*3Ë 
	`°bi__îr
("invalid PLTE","Corrupt PNG");

4854 
∑l_Àn
 = 
c
.
Àngth
 / 3;

4855 i‡(
∑l_Àn
 * 3 !
c
.
Àngth
Ë 
	`°bi__îr
("invalid PLTE","Corrupt PNG");

4856 
i
=0; i < 
∑l_Àn
; ++i) {

4857 
∑Àâe
[
i
*4+0] = 
	`°bi__gë8
(
s
);

4858 
∑Àâe
[
i
*4+1] = 
	`°bi__gë8
(
s
);

4859 
∑Àâe
[
i
*4+2] = 
	`°bi__gë8
(
s
);

4860 
∑Àâe
[
i
*4+3] = 255;

4865 
	`STBI__PNG_TYPE
('t','R','N','S'): {

4866 i‡(
fú°
Ë 
	`°bi__îr
("firstÇot IHDR", "Corrupt PNG");

4867 i‡(
z
->
id©a
Ë 
	`°bi__îr
("tRNSáfter IDAT","Corrupt PNG");

4868 i‡(
∑l_img_n
) {

4869 i‡(
sˇn
 =
STBI__SCAN_hódî
Ë{ 
s
->
img_n
 = 4;  1; }

4870 i‡(
∑l_Àn
 =0Ë 
	`°bi__îr
("tRNS before PLTE","Corrupt PNG");

4871 i‡(
c
.
Àngth
 > 
∑l_Àn
Ë 
	`°bi__îr
("badÅRNSÜen","Corrupt PNG");

4872 
∑l_img_n
 = 4;

4873 
i
=0; i < 
c
.
Àngth
; ++i)

4874 
∑Àâe
[
i
*4+3] = 
	`°bi__gë8
(
s
);

4876 i‡(!(
s
->
img_n
 & 1)Ë 
	`°bi__îr
("tRNS withálpha","Corrupt PNG");

4877 i‡(
c
.
Àngth
 !(
°bi__uöt32
Ë
s
->
img_n
*2Ë 
	`°bi__îr
("badÅRNSÜen","Corrupt PNG");

4878 
has_å™s
 = 1;

4879 i‡(
z
->
dïth
 == 16) {

4880 
k
 = 0; k < 
s
->
img_n
; ++kË
tc16
[k] = (
°bi__uöt16
)
	`°bi__gë16be
(s);

4882 
k
 = 0; k < 
s
->
img_n
; ++kË
tc
[k] = (
°bi_uc
)(
	`°bi__gë16be
(sË& 255Ë* 
°bi__dïth_sˇÀ_èbÀ
[
z
->
dïth
];

4888 
	`STBI__PNG_TYPE
('I','D','A','T'): {

4889 i‡(
fú°
Ë 
	`°bi__îr
("firstÇot IHDR", "Corrupt PNG");

4890 i‡(
∑l_img_n
 && !
∑l_Àn
Ë 
	`°bi__îr
("no PLTE","Corrupt PNG");

4891 i‡(
sˇn
 =
STBI__SCAN_hódî
Ë{ 
s
->
img_n
 = 
∑l_img_n
;  1; }

4892 i‡(()(
ioff
 + 
c
.
Àngth
) < ()ioff)  0;

4893 i‡(
ioff
 + 
c
.
Àngth
 > 
id©a_limô
) {

4894 
°bi__uöt32
 
id©a_limô_ﬁd
 = 
id©a_limô
;

4895 
°bi_uc
 *
p
;

4896 i‡(
id©a_limô
 =0Ëid©a_limô = 
c
.
Àngth
 > 4096 ? c.length : 4096;

4897 
ioff
 + 
c
.
Àngth
 > 
id©a_limô
)

4898 
id©a_limô
 *= 2;

4899 
	`STBI_NOTUSED
(
id©a_limô_ﬁd
);

4900 
p
 = (
°bi_uc
 *Ë
	`STBI_REALLOC_SIZED
(
z
->
id©a
, 
id©a_limô_ﬁd
, 
id©a_limô
); i‡’ =
NULL
Ë 
	`°bi__îr
("outofmem", "Out of memory");

4901 
z
->
id©a
 = 
p
;

4903 i‡(!
	`°bi__gën
(
s
, 
z
->
id©a
+
ioff
,
c
.
Àngth
)Ë 
	`°bi__îr
("outofdata","Corrupt PNG");

4904 
ioff
 +
c
.
Àngth
;

4908 
	`STBI__PNG_TYPE
('I','E','N','D'): {

4909 
°bi__uöt32
 
øw_Àn
, 
b∂
;

4910 i‡(
fú°
Ë 
	`°bi__îr
("firstÇot IHDR", "Corrupt PNG");

4911 i‡(
sˇn
 !
STBI__SCAN_lﬂd
)  1;

4912 i‡(
z
->
id©a
 =
NULL
Ë 
	`°bi__îr
("no IDAT","Corrupt PNG");

4914 
b∂
 = (
s
->
img_x
 * 
z
->
dïth
 + 7) / 8;

4915 
øw_Àn
 = 
b∂
 * 
s
->
img_y
 * s->
img_n
 + s->img_y ;

4916 
z
->
ex∑nded
 = (
°bi_uc
 *Ë
	`°bi_zlib_decode_mÆloc_guesssize_hódîÊag
((*Ëz->
id©a
, 
ioff
, 
øw_Àn
, (*Ë&øw_Àn, !
is_ùh⁄e
);

4917 i‡(
z
->
ex∑nded
 =
NULL
)  0;

4918 
	`STBI_FREE
(
z
->
id©a
); z->id©®
NULL
;

4919 i‡((
ªq_comp
 =
s
->
img_n
+1 &&Ñeq_com∞!3 && !
∑l_img_n
Ë|| 
has_å™s
)

4920 
s
->
img_out_n
 = s->
img_n
+1;

4922 
s
->
img_out_n
 = s->
img_n
;

4923 i‡(!
	`°bi__¸óã_≤g_image
(
z
, z->
ex∑nded
, 
øw_Àn
, 
s
->
img_out_n
, z->
dïth
, 
cﬁ‹
, 
öãæa˚
))  0;

4924 i‡(
has_å™s
) {

4925 i‡(
z
->
dïth
 == 16) {

4926 i‡(!
	`°bi__compuã_å™•¨ícy16
(
z
, 
tc16
, 
s
->
img_out_n
))  0;

4928 i‡(!
	`°bi__compuã_å™•¨ícy
(
z
, 
tc
, 
s
->
img_out_n
))  0;

4931 i‡(
is_ùh⁄e
 && 
°bi__de_ùh⁄e_Êag
 && 
s
->
img_out_n
 > 2)

4932 
	`°bi__de_ùh⁄e
(
z
);

4933 i‡(
∑l_img_n
) {

4935 
s
->
img_n
 = 
∑l_img_n
;

4936 
s
->
img_out_n
 = 
∑l_img_n
;

4937 i‡(
ªq_comp
 >3Ë
s
->
img_out_n
 =Ñeq_comp;

4938 i‡(!
	`°bi__ex∑nd_≤g_∑Àâe
(
z
, 
∑Àâe
, 
∑l_Àn
, 
s
->
img_out_n
))

4940 } i‡(
has_å™s
) {

4942 ++
s
->
img_n
;

4944 
	`STBI_FREE
(
z
->
ex∑nded
); z->ex∑nded = 
NULL
;

4950 i‡(
fú°
Ë 
	`°bi__îr
("firstÇot IHDR", "Corrupt PNG");

4951 i‡((
c
.
ty≥
 & (1 << 29)) == 0) {

4952 #i‚de‡
STBI_NO_FAILURE_STRINGS


4954 
övÆid_chunk
[] = "XXXX PNG chunkÇot known";

4955 
övÆid_chunk
[0] = 
	`STBI__BYTECAST
(
c
.
ty≥
 >> 24);

4956 
övÆid_chunk
[1] = 
	`STBI__BYTECAST
(
c
.
ty≥
 >> 16);

4957 
övÆid_chunk
[2] = 
	`STBI__BYTECAST
(
c
.
ty≥
 >> 8);

4958 
övÆid_chunk
[3] = 
	`STBI__BYTECAST
(
c
.
ty≥
 >> 0);

4960  
	`°bi__îr
(
övÆid_chunk
, "PNGÇot supported: unknown PNG chunkÅype");

4962 
	`°bi__skù
(
s
, 
c
.
Àngth
);

4966 
	`°bi__gë32be
(
s
);

4968 
	}
}

4970 *
	$°bi__do_≤g
(
°bi__≤g
 *
p
, *
x
, *
y
, *
n
, 
ªq_comp
, 
°bi__ªsu…_öfo
 *
ri
)

4972 *
ªsu…
=
NULL
;

4973 i‡(
ªq_comp
 < 0 ||Ñeq_com∞> 4Ë 
	`°bi__îΩuc
("badÑeq_comp", "InternalÉrror");

4974 i‡(
	`°bi__∑r£_≤g_fûe
(
p
, 
STBI__SCAN_lﬂd
, 
ªq_comp
)) {

4975 i‡(
p
->
dïth
 < 8)

4976 
ri
->
bôs_≥r_ch™√l
 = 8;

4978 
ri
->
bôs_≥r_ch™√l
 = 
p
->
dïth
;

4979 
ªsu…
 = 
p
->
out
;

4980 
p
->
out
 = 
NULL
;

4981 i‡(
ªq_comp
 &&Ñeq_com∞!
p
->
s
->
img_out_n
) {

4982 i‡(
ri
->
bôs_≥r_ch™√l
 == 8)

4983 
ªsu…
 = 
	`°bi__c⁄vît_f‹m©
((*Ëªsu…, 
p
->
s
->
img_out_n
, 
ªq_comp
,Ö->s->
img_x
,Ö->s->
img_y
);

4985 
ªsu…
 = 
	`°bi__c⁄vît_f‹m©16
((
°bi__uöt16
 *Ëªsu…, 
p
->
s
->
img_out_n
, 
ªq_comp
,Ö->s->
img_x
,Ö->s->
img_y
);

4986 
p
->
s
->
img_out_n
 = 
ªq_comp
;

4987 i‡(
ªsu…
 =
NULL
) Ñesult;

4989 *
x
 = 
p
->
s
->
img_x
;

4990 *
y
 = 
p
->
s
->
img_y
;

4991 i‡(
n
Ë*¿
p
->
s
->
img_n
;

4993 
	`STBI_FREE
(
p
->
out
);Ö->ouà
NULL
;

4994 
	`STBI_FREE
(
p
->
ex∑nded
);Ö->ex∑nded = 
NULL
;

4995 
	`STBI_FREE
(
p
->
id©a
);Ö->id©®
NULL
;

4997  
ªsu…
;

4998 
	}
}

5000 *
	$°bi__≤g_lﬂd
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
, 
ªq_comp
, 
°bi__ªsu…_öfo
 *
ri
)

5002 
°bi__≤g
 
p
;

5003 
p
.
s
 = s;

5004  
	`°bi__do_≤g
(&
p
, 
x
,
y
,
comp
,
ªq_comp
, 
ri
);

5005 
	}
}

5007 
	$°bi__≤g_ã°
(
°bi__c⁄ãxt
 *
s
)

5009 
r
;

5010 
r
 = 
	`°bi__check_≤g_hódî
(
s
);

5011 
	`°bi__ªwöd
(
s
);

5012  
r
;

5013 
	}
}

5015 
	$°bi__≤g_öfo_øw
(
°bi__≤g
 *
p
, *
x
, *
y
, *
comp
)

5017 i‡(!
	`°bi__∑r£_≤g_fûe
(
p
, 
STBI__SCAN_hódî
, 0)) {

5018 
	`°bi__ªwöd
–
p
->
s
 );

5021 i‡(
x
Ë*x = 
p
->
s
->
img_x
;

5022 i‡(
y
Ë*y = 
p
->
s
->
img_y
;

5023 i‡(
comp
Ë*com∞
p
->
s
->
img_n
;

5025 
	}
}

5027 
	$°bi__≤g_öfo
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
)

5029 
°bi__≤g
 
p
;

5030 
p
.
s
 = s;

5031  
	`°bi__≤g_öfo_øw
(&
p
, 
x
, 
y
, 
comp
);

5032 
	}
}

5034 
	$°bi__≤g_is16
(
°bi__c⁄ãxt
 *
s
)

5036 
°bi__≤g
 
p
;

5037 
p
.
s
 = s;

5038 i‡(!
	`°bi__≤g_öfo_øw
(&
p
, 
NULL
, NULL, NULL))

5040 i‡(
p
.
dïth
 != 16) {

5041 
	`°bi__ªwöd
(
p
.
s
);

5045 
	}
}

5050 #i‚de‡
STBI_NO_BMP


5051 
	$°bi__bmp_ã°_øw
(
°bi__c⁄ãxt
 *
s
)

5053 
r
;

5054 
sz
;

5055 i‡(
	`°bi__gë8
(
s
) != 'B')  0;

5056 i‡(
	`°bi__gë8
(
s
) != 'M')  0;

5057 
	`°bi__gë32À
(
s
);

5058 
	`°bi__gë16À
(
s
);

5059 
	`°bi__gë16À
(
s
);

5060 
	`°bi__gë32À
(
s
);

5061 
sz
 = 
	`°bi__gë32À
(
s
);

5062 
r
 = (
sz
 == 12 || sz == 40 || sz == 56 || sz == 108 || sz == 124);

5063  
r
;

5064 
	}
}

5066 
	$°bi__bmp_ã°
(
°bi__c⁄ãxt
 *
s
)

5068 
r
 = 
	`°bi__bmp_ã°_øw
(
s
);

5069 
	`°bi__ªwöd
(
s
);

5070  
r
;

5071 
	}
}

5075 
	$°bi__high_bô
(
z
)

5077 
n
=0;

5078 i‡(
z
 == 0)  -1;

5079 i‡(
z
 >0x10000Ë{ 
n
 += 16; z >>= 16; }

5080 i‡(
z
 >0x00100Ë{ 
n
 += 8; z >>= 8; }

5081 i‡(
z
 >0x00010Ë{ 
n
 += 4; z >>= 4; }

5082 i‡(
z
 >0x00004Ë{ 
n
 += 2; z >>= 2; }

5083 i‡(
z
 >0x00002Ë{ 
n
 += 1; }

5084  
n
;

5085 
	}
}

5087 
	$°bi__bôcou¡
(
a
)

5089 
a
 = (a & 0x55555555) + ((a >> 1) & 0x55555555);

5090 
a
 = (a & 0x33333333) + ((a >> 2) & 0x33333333);

5091 
a
 = (a + (a >> 4)) & 0x0f0f0f0f;

5092 
a
 = (a + (a >> 8));

5093 
a
 = (a + (a >> 16));

5094  
a
 & 0xff;

5095 
	}
}

5100 
	$°bi__shi·sig√d
(
v
, 
shi·
, 
bôs
)

5102 
mul_èbÀ
[9] = {

5107 
shi·_èbÀ
[9] = {

5110 i‡(
shi·
 < 0)

5111 
v
 <<-
shi·
;

5113 
v
 >>
shi·
;

5114 
	`STBI_ASSERT
(
v
 >= 0 && v < 256);

5115 
v
 >>(8-
bôs
);

5116 
	`STBI_ASSERT
(
bôs
 >= 0 && bits <= 8);

5117  (Ë((Ë
v
 * 
mul_èbÀ
[
bôs
]Ë>> 
shi·_èbÀ
[bits];

5118 
	}
}

5122 
	mbµ
, 
	moff£t
, 
	mhsz
;

5123 
	mmr
,
	mmg
,
	mmb
,
	mma
, 
	mÆl_a
;

5124 } 
	t°bi__bmp_d©a
;

5126 *
	$°bi__bmp_∑r£_hódî
(
°bi__c⁄ãxt
 *
s
, 
°bi__bmp_d©a
 *
öfo
)

5128 
hsz
;

5129 i‡(
	`°bi__gë8
(
s
Ë!'B' || stbi__gë8(sË!'M'Ë 
	`°bi__îΩuc
("not BMP", "Corrupt BMP");

5130 
	`°bi__gë32À
(
s
);

5131 
	`°bi__gë16À
(
s
);

5132 
	`°bi__gë16À
(
s
);

5133 
öfo
->
off£t
 = 
	`°bi__gë32À
(
s
);

5134 
öfo
->
hsz
 = hsz = 
	`°bi__gë32À
(
s
);

5135 
öfo
->
mr
 = info->
mg
 = info->
mb
 = info->
ma
 = 0;

5137 i‡(
hsz
 !12 && hsz !40 && hsz !56 && hsz !108 && hsz !124Ë 
	`°bi__îΩuc
("unknown BMP", "BMPÅypeÇot supported: unknown");

5138 i‡(
hsz
 == 12) {

5139 
s
->
img_x
 = 
	`°bi__gë16À
(s);

5140 
s
->
img_y
 = 
	`°bi__gë16À
(s);

5142 
s
->
img_x
 = 
	`°bi__gë32À
(s);

5143 
s
->
img_y
 = 
	`°bi__gë32À
(s);

5145 i‡(
	`°bi__gë16À
(
s
Ë!1Ë 
	`°bi__îΩuc
("bad BMP", "bad BMP");

5146 
öfo
->
bµ
 = 
	`°bi__gë16À
(
s
);

5147 i‡(
hsz
 != 12) {

5148 
com¥ess
 = 
	`°bi__gë32À
(
s
);

5149 i‡(
com¥ess
 =1 || com¥es†=2Ë 
	`°bi__îΩuc
("BMP RLE", "BMPÅypeÇot supported: RLE");

5150 
	`°bi__gë32À
(
s
);

5151 
	`°bi__gë32À
(
s
);

5152 
	`°bi__gë32À
(
s
);

5153 
	`°bi__gë32À
(
s
);

5154 
	`°bi__gë32À
(
s
);

5155 i‡(
hsz
 == 40 || hsz == 56) {

5156 i‡(
hsz
 == 56) {

5157 
	`°bi__gë32À
(
s
);

5158 
	`°bi__gë32À
(
s
);

5159 
	`°bi__gë32À
(
s
);

5160 
	`°bi__gë32À
(
s
);

5162 i‡(
öfo
->
bµ
 == 16 || info->bpp == 32) {

5163 i‡(
com¥ess
 == 0) {

5164 i‡(
öfo
->
bµ
 == 32) {

5165 
öfo
->
mr
 = 0xffu << 16;

5166 
öfo
->
mg
 = 0xffu << 8;

5167 
öfo
->
mb
 = 0xffu << 0;

5168 
öfo
->
ma
 = 0xffu << 24;

5169 
öfo
->
Æl_a
 = 0;

5171 
öfo
->
mr
 = 31u << 10;

5172 
öfo
->
mg
 = 31u << 5;

5173 
öfo
->
mb
 = 31u << 0;

5175 } i‡(
com¥ess
 == 3) {

5176 
öfo
->
mr
 = 
	`°bi__gë32À
(
s
);

5177 
öfo
->
mg
 = 
	`°bi__gë32À
(
s
);

5178 
öfo
->
mb
 = 
	`°bi__gë32À
(
s
);

5180 i‡(
öfo
->
mr
 =öfo->
mg
 && info->mg =öfo->
mb
) {

5182  
	`°bi__îΩuc
("bad BMP", "bad BMP");

5185  
	`°bi__îΩuc
("bad BMP", "bad BMP");

5188 
i
;

5189 i‡(
hsz
 != 108 && hsz != 124)

5190  
	`°bi__îΩuc
("bad BMP", "bad BMP");

5191 
öfo
->
mr
 = 
	`°bi__gë32À
(
s
);

5192 
öfo
->
mg
 = 
	`°bi__gë32À
(
s
);

5193 
öfo
->
mb
 = 
	`°bi__gë32À
(
s
);

5194 
öfo
->
ma
 = 
	`°bi__gë32À
(
s
);

5195 
	`°bi__gë32À
(
s
);

5196 
i
=0; i < 12; ++i)

5197 
	`°bi__gë32À
(
s
);

5198 i‡(
hsz
 == 124) {

5199 
	`°bi__gë32À
(
s
);

5200 
	`°bi__gë32À
(
s
);

5201 
	`°bi__gë32À
(
s
);

5202 
	`°bi__gë32À
(
s
);

5207 
	}
}

5210 *
	$°bi__bmp_lﬂd
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
, 
ªq_comp
, 
°bi__ªsu…_öfo
 *
ri
)

5212 
°bi_uc
 *
out
;

5213 
mr
=0,
mg
=0,
mb
=0,
ma
=0, 
Æl_a
;

5214 
°bi_uc
 
∑l
[256][4];

5215 
psize
=0,
i
,
j
,
width
;

5216 
Êù_vîtiˇŒy
, 
∑d
, 
èrgë
;

5217 
°bi__bmp_d©a
 
öfo
;

5218 
	`STBI_NOTUSED
(
ri
);

5220 
öfo
.
Æl_a
 = 255;

5221 i‡(
	`°bi__bmp_∑r£_hódî
(
s
, &
öfo
Ë=
NULL
)

5222  
NULL
;

5224 
Êù_vîtiˇŒy
 = ((Ë
s
->
img_y
) > 0;

5225 
s
->
img_y
 = 
	`abs
(() s->img_y);

5227 
mr
 = 
öfo
.mr;

5228 
mg
 = 
öfo
.mg;

5229 
mb
 = 
öfo
.mb;

5230 
ma
 = 
öfo
.ma;

5231 
Æl_a
 = 
öfo
.all_a;

5233 i‡(
öfo
.
hsz
 == 12) {

5234 i‡(
öfo
.
bµ
 < 24)

5235 
psize
 = (
öfo
.
off£t
 - 14 - 24) / 3;

5237 i‡(
öfo
.
bµ
 < 16)

5238 
psize
 = (
öfo
.
off£t
 - 14 - info.
hsz
) >> 2;

5241 i‡(
öfo
.
bµ
 =24 && 
ma
 == 0xff000000)

5242 
s
->
img_n
 = 3;

5244 
s
->
img_n
 = 
ma
 ? 4 : 3;

5245 i‡(
ªq_comp
 &&Ñeq_comp >= 3)

5246 
èrgë
 = 
ªq_comp
;

5248 
èrgë
 = 
s
->
img_n
;

5251 i‡(!
	`°bi__mad3sizes_vÆid
(
èrgë
, 
s
->
img_x
, s->
img_y
, 0))

5252  
	`°bi__îΩuc
("tooÜarge", "Corrupt BMP");

5254 
out
 = (
°bi_uc
 *Ë
	`°bi__mÆloc_mad3
(
èrgë
, 
s
->
img_x
, s->
img_y
, 0);

5255 i‡(!
out
Ë 
	`°bi__îΩuc
("outofmem", "Out of memory");

5256 i‡(
öfo
.
bµ
 < 16) {

5257 
z
=0;

5258 i‡(
psize
 =0 ||Ösizê> 256Ë{ 
	`STBI_FREE
(
out
);  
	`°bi__îΩuc
("invalid", "Corrupt BMP"); }

5259 
i
=0; i < 
psize
; ++i) {

5260 
∑l
[
i
][2] = 
	`°bi__gë8
(
s
);

5261 
∑l
[
i
][1] = 
	`°bi__gë8
(
s
);

5262 
∑l
[
i
][0] = 
	`°bi__gë8
(
s
);

5263 i‡(
öfo
.
hsz
 !12Ë
	`°bi__gë8
(
s
);

5264 
∑l
[
i
][3] = 255;

5266 
	`°bi__skù
(
s
, 
öfo
.
off£t
 - 14 - info.
hsz
 - 
psize
 * (info.hsz == 12 ? 3 : 4));

5267 i‡(
öfo
.
bµ
 =1Ë
width
 = (
s
->
img_x
 + 7) >> 3;

5268 i‡(
öfo
.
bµ
 =4Ë
width
 = (
s
->
img_x
 + 1) >> 1;

5269 i‡(
öfo
.
bµ
 =8Ë
width
 = 
s
->
img_x
;

5270 { 
	`STBI_FREE
(
out
);  
	`°bi__îΩuc
("bad bpp", "Corrupt BMP"); }

5271 
∑d
 = (-
width
)&3;

5272 i‡(
öfo
.
bµ
 == 1) {

5273 
j
=0; j < (Ë
s
->
img_y
; ++j) {

5274 
bô_off£t
 = 7, 
v
 = 
	`°bi__gë8
(
s
);

5275 
i
=0; i < (Ë
s
->
img_x
; ++i) {

5276 
cﬁ‹
 = (
v
>>
bô_off£t
)&0x1;

5277 
out
[
z
++] = 
∑l
[
cﬁ‹
][0];

5278 
out
[
z
++] = 
∑l
[
cﬁ‹
][1];

5279 
out
[
z
++] = 
∑l
[
cﬁ‹
][2];

5280 i‡(
èrgë
 =4Ë
out
[
z
++] = 255;

5281 i‡(
i
+1 =(Ë
s
->
img_x
) ;

5282 if((--
bô_off£t
) < 0) {

5283 
bô_off£t
 = 7;

5284 
v
 = 
	`°bi__gë8
(
s
);

5287 
	`°bi__skù
(
s
, 
∑d
);

5290 
j
=0; j < (Ë
s
->
img_y
; ++j) {

5291 
i
=0; i < (Ë
s
->
img_x
; i += 2) {

5292 
v
=
	`°bi__gë8
(
s
),
v2
=0;

5293 i‡(
öfo
.
bµ
 == 4) {

5294 
v2
 = 
v
 & 15;

5295 
v
 >>= 4;

5297 
out
[
z
++] = 
∑l
[
v
][0];

5298 
out
[
z
++] = 
∑l
[
v
][1];

5299 
out
[
z
++] = 
∑l
[
v
][2];

5300 i‡(
èrgë
 =4Ë
out
[
z
++] = 255;

5301 i‡(
i
+1 =(Ë
s
->
img_x
) ;

5302 
v
 = (
öfo
.
bµ
 =8Ë? 
	`°bi__gë8
(
s
Ë: 
v2
;

5303 
out
[
z
++] = 
∑l
[
v
][0];

5304 
out
[
z
++] = 
∑l
[
v
][1];

5305 
out
[
z
++] = 
∑l
[
v
][2];

5306 i‡(
èrgë
 =4Ë
out
[
z
++] = 255;

5308 
	`°bi__skù
(
s
, 
∑d
);

5312 
rshi·
=0,
gshi·
=0,
bshi·
=0,
ashi·
=0,
rcou¡
=0,
gcou¡
=0,
bcou¡
=0,
acou¡
=0;

5313 
z
 = 0;

5314 
ósy
=0;

5315 
	`°bi__skù
(
s
, 
öfo
.
off£t
 - 14 - info.
hsz
);

5316 i‡(
öfo
.
bµ
 =24Ë
width
 = 3 * 
s
->
img_x
;

5317 i‡(
öfo
.
bµ
 =16Ë
width
 = 2*
s
->
img_x
;

5318 
width
=0;

5319 
∑d
 = (-
width
) & 3;

5320 i‡(
öfo
.
bµ
 == 24) {

5321 
ósy
 = 1;

5322 } i‡(
öfo
.
bµ
 == 32) {

5323 i‡(
mb
 =0xf‡&& 
mg
 =0xff00 && 
mr
 =0x00ff0000 && 
ma
 == 0xff000000)

5324 
ósy
 = 2;

5326 i‡(!
ósy
) {

5327 i‡(!
mr
 || !
mg
 || !
mb
Ë{ 
	`STBI_FREE
(
out
);  
	`°bi__îΩuc
("bad masks", "Corrupt BMP"); }

5329 
rshi·
 = 
	`°bi__high_bô
(
mr
)-7; 
rcou¡
 = 
	`°bi__bôcou¡
(mr);

5330 
gshi·
 = 
	`°bi__high_bô
(
mg
)-7; 
gcou¡
 = 
	`°bi__bôcou¡
(mg);

5331 
bshi·
 = 
	`°bi__high_bô
(
mb
)-7; 
bcou¡
 = 
	`°bi__bôcou¡
(mb);

5332 
ashi·
 = 
	`°bi__high_bô
(
ma
)-7; 
acou¡
 = 
	`°bi__bôcou¡
(ma);

5334 
j
=0; j < (Ë
s
->
img_y
; ++j) {

5335 i‡(
ósy
) {

5336 
i
=0; i < (Ë
s
->
img_x
; ++i) {

5337 
a
;

5338 
out
[
z
+2] = 
	`°bi__gë8
(
s
);

5339 
out
[
z
+1] = 
	`°bi__gë8
(
s
);

5340 
out
[
z
+0] = 
	`°bi__gë8
(
s
);

5341 
z
 += 3;

5342 
a
 = (
ósy
 =2 ? 
	`°bi__gë8
(
s
) : 255);

5343 
Æl_a
 |
a
;

5344 i‡(
èrgë
 =4Ë
out
[
z
++] = 
a
;

5347 
bµ
 = 
öfo
.bpp;

5348 
i
=0; i < (Ë
s
->
img_x
; ++i) {

5349 
°bi__uöt32
 
v
 = (
bµ
 =16 ? (°bi__uöt32Ë
	`°bi__gë16À
(
s
Ë: 
	`°bi__gë32À
(s));

5350 
a
;

5351 
out
[
z
++] = 
	`STBI__BYTECAST
(
	`°bi__shi·sig√d
(
v
 & 
mr
, 
rshi·
, 
rcou¡
));

5352 
out
[
z
++] = 
	`STBI__BYTECAST
(
	`°bi__shi·sig√d
(
v
 & 
mg
, 
gshi·
, 
gcou¡
));

5353 
out
[
z
++] = 
	`STBI__BYTECAST
(
	`°bi__shi·sig√d
(
v
 & 
mb
, 
bshi·
, 
bcou¡
));

5354 
a
 = (
ma
 ? 
	`°bi__shi·sig√d
(
v
 & ma, 
ashi·
, 
acou¡
) : 255);

5355 
Æl_a
 |
a
;

5356 i‡(
èrgë
 =4Ë
out
[
z
++] = 
	`STBI__BYTECAST
(
a
);

5359 
	`°bi__skù
(
s
, 
∑d
);

5364 i‡(
èrgë
 =4 && 
Æl_a
 == 0)

5365 
i
=4*
s
->
img_x
*s->
img_y
-1; i >= 0; i -= 4)

5366 
out
[
i
] = 255;

5368 i‡(
Êù_vîtiˇŒy
) {

5369 
°bi_uc
 
t
;

5370 
j
=0; j < (Ë
s
->
img_y
>>1; ++j) {

5371 
°bi_uc
 *
p1
 = 
out
 + 
j
 *
s
->
img_x
*
èrgë
;

5372 
°bi_uc
 *
p2
 = 
out
 + (
s
->
img_y
-1-
j
)*s->
img_x
*
èrgë
;

5373 
i
=0; i < (Ë
s
->
img_x
*
èrgë
; ++i) {

5374 
t
 = 
p1
[
i
];Ö1[i] = 
p2
[i];Ö2[i] =Å;

5379 i‡(
ªq_comp
 &&Ñeq_com∞!
èrgë
) {

5380 
out
 = 
	`°bi__c⁄vît_f‹m©
(out, 
èrgë
, 
ªq_comp
, 
s
->
img_x
, s->
img_y
);

5381 i‡(
out
 =
NULL
)  out;

5384 *
x
 = 
s
->
img_x
;

5385 *
y
 = 
s
->
img_y
;

5386 i‡(
comp
Ë*com∞
s
->
img_n
;

5387  
out
;

5388 
	}
}

5393 #i‚de‡
STBI_NO_TGA


5395 
	$°bi__tga_gë_comp
(
bôs_≥r_pixñ
, 
is_gªy
, * 
is_rgb16
)

5398 i‡(
is_rgb16
) *is_rgb16 = 0;

5399 
bôs_≥r_pixñ
) {

5400 8:  
STBI_gªy
;

5401 16: if(
is_gªy
Ë 
STBI_gªy_Æpha
;

5403 15: if(
is_rgb16
) *is_rgb16 = 1;

5404  
STBI_rgb
;

5406 32:  
bôs_≥r_pixñ
/8;

5409 
	}
}

5411 
	$°bi__tga_öfo
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
)

5413 
tga_w
, 
tga_h
, 
tga_comp
, 
tga_image_ty≥
, 
tga_bôs_≥r_pixñ
, 
tga_cﬁ‹m≠_bµ
;

5414 
sz
, 
tga_cﬁ‹m≠_ty≥
;

5415 
	`°bi__gë8
(
s
);

5416 
tga_cﬁ‹m≠_ty≥
 = 
	`°bi__gë8
(
s
);

5417 if–
tga_cﬁ‹m≠_ty≥
 > 1 ) {

5418 
	`°bi__ªwöd
(
s
);

5421 
tga_image_ty≥
 = 
	`°bi__gë8
(
s
);

5422 i‡–
tga_cﬁ‹m≠_ty≥
 == 1 ) {

5423 i‡(
tga_image_ty≥
 != 1 &&Åga_image_type != 9) {

5424 
	`°bi__ªwöd
(
s
);

5427 
	`°bi__skù
(
s
,4);

5428 
sz
 = 
	`°bi__gë8
(
s
);

5429 i‡–(
sz
 != 8) && (sz != 15) && (sz != 16) && (sz != 24) && (sz != 32) ) {

5430 
	`°bi__ªwöd
(
s
);

5433 
	`°bi__skù
(
s
,4);

5434 
tga_cﬁ‹m≠_bµ
 = 
sz
;

5436 i‡–(
tga_image_ty≥
 != 2) && (tga_image_type != 3) && (tga_image_type != 10) && (tga_image_type != 11) ) {

5437 
	`°bi__ªwöd
(
s
);

5440 
	`°bi__skù
(
s
,9);

5441 
tga_cﬁ‹m≠_bµ
 = 0;

5443 
tga_w
 = 
	`°bi__gë16À
(
s
);

5444 if–
tga_w
 < 1 ) {

5445 
	`°bi__ªwöd
(
s
);

5448 
tga_h
 = 
	`°bi__gë16À
(
s
);

5449 if–
tga_h
 < 1 ) {

5450 
	`°bi__ªwöd
(
s
);

5453 
tga_bôs_≥r_pixñ
 = 
	`°bi__gë8
(
s
);

5454 
	`°bi__gë8
(
s
);

5455 i‡(
tga_cﬁ‹m≠_bµ
 != 0) {

5456 if((
tga_bôs_≥r_pixñ
 != 8) && (tga_bits_per_pixel != 16)) {

5459 
	`°bi__ªwöd
(
s
);

5462 
tga_comp
 = 
	`°bi__tga_gë_comp
(
tga_cﬁ‹m≠_bµ
, 0, 
NULL
);

5464 
tga_comp
 = 
	`°bi__tga_gë_comp
(
tga_bôs_≥r_pixñ
, (
tga_image_ty≥
 =3Ë|| (tga_image_ty≥ =11), 
NULL
);

5466 if(!
tga_comp
) {

5467 
	`°bi__ªwöd
(
s
);

5470 i‡(
x
Ë*x = 
tga_w
;

5471 i‡(
y
Ë*y = 
tga_h
;

5472 i‡(
comp
Ë*com∞
tga_comp
;

5474 
	}
}

5476 
	$°bi__tga_ã°
(
°bi__c⁄ãxt
 *
s
)

5478 
ªs
 = 0;

5479 
sz
, 
tga_cﬁ‹_ty≥
;

5480 
	`°bi__gë8
(
s
);

5481 
tga_cﬁ‹_ty≥
 = 
	`°bi__gë8
(
s
);

5482 i‡–
tga_cﬁ‹_ty≥
 > 1 ) 
îr‹End
;

5483 
sz
 = 
	`°bi__gë8
(
s
);

5484 i‡–
tga_cﬁ‹_ty≥
 == 1 ) {

5485 i‡(
sz
 !1 && sz !9Ë
îr‹End
;

5486 
	`°bi__skù
(
s
,4);

5487 
sz
 = 
	`°bi__gë8
(
s
);

5488 i‡–(
sz
 !8Ë&& (sz !15Ë&& (sz !16Ë&& (sz !24Ë&& (sz !32ËË
îr‹End
;

5489 
	`°bi__skù
(
s
,4);

5491 i‡–(
sz
 !2Ë&& (sz !3Ë&& (sz !10Ë&& (sz !11ËË
îr‹End
;

5492 
	`°bi__skù
(
s
,9);

5494 i‡–
	`°bi__gë16À
(
s
Ë< 1 ) 
îr‹End
;

5495 i‡–
	`°bi__gë16À
(
s
Ë< 1 ) 
îr‹End
;

5496 
sz
 = 
	`°bi__gë8
(
s
);

5497 i‡–(
tga_cﬁ‹_ty≥
 =1Ë&& (
sz
 !8Ë&& (sz !16ËË
îr‹End
;

5498 i‡–(
sz
 !8Ë&& (sz !15Ë&& (sz !16Ë&& (sz !24Ë&& (sz !32ËË
îr‹End
;

5500 
ªs
 = 1;

5502 
îr‹End
:

5503 
	`°bi__ªwöd
(
s
);

5504  
ªs
;

5505 
	}
}

5508 
	$°bi__tga_ªad_rgb16
(
°bi__c⁄ãxt
 *
s
, 
°bi_uc
* 
out
)

5510 
°bi__uöt16
 
px
 = (°bi__uöt16)
	`°bi__gë16À
(
s
);

5511 
°bi__uöt16
 
fiveBôMask
 = 31;

5513 
r
 = (
px
 >> 10Ë& 
fiveBôMask
;

5514 
g
 = (
px
 >> 5Ë& 
fiveBôMask
;

5515 
b
 = 
px
 & 
fiveBôMask
;

5517 
out
[0] = (
°bi_uc
)((
r
 * 255)/31);

5518 
out
[1] = (
°bi_uc
)((
g
 * 255)/31);

5519 
out
[2] = (
°bi_uc
)((
b
 * 255)/31);

5525 
	}
}

5527 *
	$°bi__tga_lﬂd
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
, 
ªq_comp
, 
°bi__ªsu…_öfo
 *
ri
)

5530 
tga_off£t
 = 
	`°bi__gë8
(
s
);

5531 
tga_ödexed
 = 
	`°bi__gë8
(
s
);

5532 
tga_image_ty≥
 = 
	`°bi__gë8
(
s
);

5533 
tga_is_RLE
 = 0;

5534 
tga_∑Àâe_°¨t
 = 
	`°bi__gë16À
(
s
);

5535 
tga_∑Àâe_Àn
 = 
	`°bi__gë16À
(
s
);

5536 
tga_∑Àâe_bôs
 = 
	`°bi__gë8
(
s
);

5537 
tga_x_‹igö
 = 
	`°bi__gë16À
(
s
);

5538 
tga_y_‹igö
 = 
	`°bi__gë16À
(
s
);

5539 
tga_width
 = 
	`°bi__gë16À
(
s
);

5540 
tga_height
 = 
	`°bi__gë16À
(
s
);

5541 
tga_bôs_≥r_pixñ
 = 
	`°bi__gë8
(
s
);

5542 
tga_comp
, 
tga_rgb16
=0;

5543 
tga_övîãd
 = 
	`°bi__gë8
(
s
);

5546 *
tga_d©a
;

5547 *
tga_∑Àâe
 = 
NULL
;

5548 
i
, 
j
;

5549 
øw_d©a
[4] = {0};

5550 
RLE_cou¡
 = 0;

5551 
RLE_ª≥©ög
 = 0;

5552 
ªad_√xt_pixñ
 = 1;

5553 
	`STBI_NOTUSED
(
ri
);

5554 
	`STBI_NOTUSED
(
tga_x_‹igö
);

5555 
	`STBI_NOTUSED
(
tga_y_‹igö
);

5558 i‡–
tga_image_ty≥
 >= 8 )

5560 
tga_image_ty≥
 -= 8;

5561 
tga_is_RLE
 = 1;

5563 
tga_övîãd
 = 1 - ((tga_inverted >> 5) & 1);

5566 i‡–
tga_ödexed
 ) 
tga_comp
 = 
	`°bi__tga_gë_comp
(
tga_∑Àâe_bôs
, 0, &
tga_rgb16
);

5567 
tga_comp
 = 
	`°bi__tga_gë_comp
(
tga_bôs_≥r_pixñ
, (
tga_image_ty≥
 =3), &
tga_rgb16
);

5569 if(!
tga_comp
)

5570  
	`°bi__îΩuc
("bad format", "Can't find out TGAÖixelformat");

5573 *
x
 = 
tga_width
;

5574 *
y
 = 
tga_height
;

5575 i‡(
comp
Ë*com∞
tga_comp
;

5577 i‡(!
	`°bi__mad3sizes_vÆid
(
tga_width
, 
tga_height
, 
tga_comp
, 0))

5578  
	`°bi__îΩuc
("tooÜarge", "Corrupt TGA");

5580 
tga_d©a
 = (*)
	`°bi__mÆloc_mad3
(
tga_width
, 
tga_height
, 
tga_comp
, 0);

5581 i‡(!
tga_d©a
Ë 
	`°bi__îΩuc
("outofmem", "Out of memory");

5584 
	`°bi__skù
(
s
, 
tga_off£t
 );

5586 i‡–!
tga_ödexed
 && !
tga_is_RLE
 && !
tga_rgb16
 ) {

5587 
i
=0; i < 
tga_height
; ++i) {

5588 
row
 = 
tga_övîãd
 ? 
tga_height
 -
i
 - 1 : i;

5589 
°bi_uc
 *
tga_row
 = 
tga_d©a
 + 
row
*
tga_width
*
tga_comp
;

5590 
	`°bi__gën
(
s
, 
tga_row
, 
tga_width
 * 
tga_comp
);

5594 i‡–
tga_ödexed
)

5597 
	`°bi__skù
(
s
, 
tga_∑Àâe_°¨t
 );

5599 
tga_∑Àâe
 = (*)
	`°bi__mÆloc_mad2
(
tga_∑Àâe_Àn
, 
tga_comp
, 0);

5600 i‡(!
tga_∑Àâe
) {

5601 
	`STBI_FREE
(
tga_d©a
);

5602  
	`°bi__îΩuc
("outofmem", "Out of memory");

5604 i‡(
tga_rgb16
) {

5605 
°bi_uc
 *
∑l_íåy
 = 
tga_∑Àâe
;

5606 
	`STBI_ASSERT
(
tga_comp
 =
STBI_rgb
);

5607 
i
=0; i < 
tga_∑Àâe_Àn
; ++i) {

5608 
	`°bi__tga_ªad_rgb16
(
s
, 
∑l_íåy
);

5609 
∑l_íåy
 +
tga_comp
;

5611 } i‡(!
	`°bi__gën
(
s
, 
tga_∑Àâe
, 
tga_∑Àâe_Àn
 * 
tga_comp
)) {

5612 
	`STBI_FREE
(
tga_d©a
);

5613 
	`STBI_FREE
(
tga_∑Àâe
);

5614  
	`°bi__îΩuc
("badÖalette", "Corrupt TGA");

5618 
i
=0; i < 
tga_width
 * 
tga_height
; ++i)

5621 i‡–
tga_is_RLE
 )

5623 i‡–
RLE_cou¡
 == 0 )

5626 
RLE_cmd
 = 
	`°bi__gë8
(
s
);

5627 
RLE_cou¡
 = 1 + (
RLE_cmd
 & 127);

5628 
RLE_ª≥©ög
 = 
RLE_cmd
 >> 7;

5629 
ªad_√xt_pixñ
 = 1;

5630 } i‡–!
RLE_ª≥©ög
 )

5632 
ªad_√xt_pixñ
 = 1;

5636 
ªad_√xt_pixñ
 = 1;

5639 i‡–
ªad_√xt_pixñ
 )

5642 i‡–
tga_ödexed
 )

5645 
∑l_idx
 = (
tga_bôs_≥r_pixñ
 =8Ë? 
	`°bi__gë8
(
s
Ë: 
	`°bi__gë16À
(s);

5646 i‡–
∑l_idx
 >
tga_∑Àâe_Àn
 ) {

5648 
∑l_idx
 = 0;

5650 
∑l_idx
 *
tga_comp
;

5651 
j
 = 0; j < 
tga_comp
; ++j) {

5652 
øw_d©a
[
j
] = 
tga_∑Àâe
[
∑l_idx
+j];

5654 } if(
tga_rgb16
) {

5655 
	`STBI_ASSERT
(
tga_comp
 =
STBI_rgb
);

5656 
	`°bi__tga_ªad_rgb16
(
s
, 
øw_d©a
);

5659 
j
 = 0; j < 
tga_comp
; ++j) {

5660 
øw_d©a
[
j
] = 
	`°bi__gë8
(
s
);

5664 
ªad_√xt_pixñ
 = 0;

5668 
j
 = 0; j < 
tga_comp
; ++j)

5669 
tga_d©a
[
i
*
tga_comp
+
j
] = 
øw_d©a
[j];

5672 --
RLE_cou¡
;

5675 i‡–
tga_övîãd
 )

5677 
j
 = 0; j*2 < 
tga_height
; ++j)

5679 
ödex1
 = 
j
 * 
tga_width
 * 
tga_comp
;

5680 
ödex2
 = (
tga_height
 - 1 - 
j
Ë* 
tga_width
 * 
tga_comp
;

5681 
i
 = 
tga_width
 * 
tga_comp
; i > 0; --i)

5683 
ãmp
 = 
tga_d©a
[
ödex1
];

5684 
tga_d©a
[
ödex1
] =Åga_d©a[
ödex2
];

5685 
tga_d©a
[
ödex2
] = 
ãmp
;

5686 ++
ödex1
;

5687 ++
ödex2
;

5692 i‡–
tga_∑Àâe
 !
NULL
 )

5694 
	`STBI_FREE
–
tga_∑Àâe
 );

5699 i‡(
tga_comp
 >3 && !
tga_rgb16
)

5701 * 
tga_pixñ
 = 
tga_d©a
;

5702 
i
=0; i < 
tga_width
 * 
tga_height
; ++i)

5704 
ãmp
 = 
tga_pixñ
[0];

5705 
tga_pixñ
[0] =Åga_pixel[2];

5706 
tga_pixñ
[2] = 
ãmp
;

5707 
tga_pixñ
 +
tga_comp
;

5712 i‡(
ªq_comp
 &&Ñeq_com∞!
tga_comp
)

5713 
tga_d©a
 = 
	`°bi__c⁄vît_f‹m©
—ga_d©a, 
tga_comp
, 
ªq_comp
, 
tga_width
, 
tga_height
);

5717 
tga_∑Àâe_°¨t
 = 
tga_∑Àâe_Àn
 = 
tga_∑Àâe_bôs
 =

5718 
tga_x_‹igö
 = 
tga_y_‹igö
 = 0;

5719 
	`STBI_NOTUSED
(
tga_∑Àâe_°¨t
);

5721  
tga_d©a
;

5722 
	}
}

5728 #i‚de‡
STBI_NO_PSD


5729 
	$°bi__psd_ã°
(
°bi__c⁄ãxt
 *
s
)

5731 
r
 = (
	`°bi__gë32be
(
s
) == 0x38425053);

5732 
	`°bi__ªwöd
(
s
);

5733  
r
;

5734 
	}
}

5736 
	$°bi__psd_decode_æe
(
°bi__c⁄ãxt
 *
s
, 
°bi_uc
 *
p
, 
pixñCou¡
)

5738 
cou¡
, 
∆e·
, 
Àn
;

5740 
cou¡
 = 0;

5741 (
∆e·
 = 
pixñCou¡
 - 
cou¡
) > 0) {

5742 
Àn
 = 
	`°bi__gë8
(
s
);

5743 i‡(
Àn
 == 128) {

5745 } i‡(
Àn
 < 128) {

5747 
Àn
++;

5748 i‡(
Àn
 > 
∆e·
)  0;

5749 
cou¡
 +
Àn
;

5750 
Àn
) {

5751 *
p
 = 
	`°bi__gë8
(
s
);

5752 
p
 += 4;

5753 
Àn
--;

5755 } i‡(
Àn
 > 128) {

5756 
°bi_uc
 
vÆ
;

5759 
Àn
 = 257 -Üen;

5760 i‡(
Àn
 > 
∆e·
)  0;

5761 
vÆ
 = 
	`°bi__gë8
(
s
);

5762 
cou¡
 +
Àn
;

5763 
Àn
) {

5764 *
p
 = 
vÆ
;

5765 
p
 += 4;

5766 
Àn
--;

5772 
	}
}

5774 *
	$°bi__psd_lﬂd
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
, 
ªq_comp
, 
°bi__ªsu…_öfo
 *
ri
, 
bpc
)

5776 
pixñCou¡
;

5777 
ch™√lCou¡
, 
com¥essi⁄
;

5778 
ch™√l
, 
i
;

5779 
bôdïth
;

5780 
w
,
h
;

5781 
°bi_uc
 *
out
;

5782 
	`STBI_NOTUSED
(
ri
);

5785 i‡(
	`°bi__gë32be
(
s
) != 0x38425053)

5786  
	`°bi__îΩuc
("not PSD", "Corrupt PSD image");

5789 i‡(
	`°bi__gë16be
(
s
) != 1)

5790  
	`°bi__îΩuc
("wrong version", "Unsupported version of PSD image");

5793 
	`°bi__skù
(
s
, 6 );

5796 
ch™√lCou¡
 = 
	`°bi__gë16be
(
s
);

5797 i‡(
ch™√lCou¡
 < 0 || channelCount > 16)

5798  
	`°bi__îΩuc
("wrong channel count", "UnsupportedÇumber of channels in PSD image");

5801 
h
 = 
	`°bi__gë32be
(
s
);

5802 
w
 = 
	`°bi__gë32be
(
s
);

5805 
bôdïth
 = 
	`°bi__gë16be
(
s
);

5806 i‡(
bôdïth
 != 8 && bitdepth != 16)

5807  
	`°bi__îΩuc
("unsupported bit depth", "PSD bit depth isÇot 8 or 16 bit");

5819 i‡(
	`°bi__gë16be
(
s
) != 3)

5820  
	`°bi__îΩuc
("wrong color format", "PSD isÇot in RGB color format");

5823 
	`°bi__skù
(
s
,
	`°bi__gë32be
(s) );

5826 
	`°bi__skù
(
s
, 
	`°bi__gë32be
(s) );

5829 
	`°bi__skù
(
s
, 
	`°bi__gë32be
(s) );

5835 
com¥essi⁄
 = 
	`°bi__gë16be
(
s
);

5836 i‡(
com¥essi⁄
 > 1)

5837  
	`°bi__îΩuc
("bad compression", "PSD hasán unknown compression format");

5840 i‡(!
	`°bi__mad3sizes_vÆid
(4, 
w
, 
h
, 0))

5841  
	`°bi__îΩuc
("tooÜarge", "Corrupt PSD");

5845 i‡(!
com¥essi⁄
 && 
bôdïth
 =16 && 
bpc
 == 16) {

5846 
out
 = (
°bi_uc
 *Ë
	`°bi__mÆloc_mad3
(8, 
w
, 
h
, 0);

5847 
ri
->
bôs_≥r_ch™√l
 = 16;

5849 
out
 = (
°bi_uc
 *Ë
	`°bi__mÆloc
(4 * 
w
*
h
);

5851 i‡(!
out
Ë 
	`°bi__îΩuc
("outofmem", "Out of memory");

5852 
pixñCou¡
 = 
w
*
h
;

5858 i‡(
com¥essi⁄
) {

5869 
	`°bi__skù
(
s
, 
h
 * 
ch™√lCou¡
 * 2 );

5872 
ch™√l
 = 0; channel < 4; channel++) {

5873 
°bi_uc
 *
p
;

5875 
p
 = 
out
+
ch™√l
;

5876 i‡(
ch™√l
 >
ch™√lCou¡
) {

5878 
i
 = 0; i < 
pixñCou¡
; i++, 
p
 += 4)

5879 *
p
 = (
ch™√l
 == 3 ? 255 : 0);

5882 i‡(!
	`°bi__psd_decode_æe
(
s
, 
p
, 
pixñCou¡
)) {

5883 
	`STBI_FREE
(
out
);

5884  
	`°bi__îΩuc
("corrupt", "bad RLE data");

5894 
ch™√l
 = 0; channel < 4; channel++) {

5895 i‡(
ch™√l
 >
ch™√lCou¡
) {

5897 i‡(
bôdïth
 =16 && 
bpc
 == 16) {

5898 
°bi__uöt16
 *
q
 = ((°bi__uöt16 *Ë
out
Ë+ 
ch™√l
;

5899 
°bi__uöt16
 
vÆ
 = 
ch™√l
 == 3 ? 65535 : 0;

5900 
i
 = 0; i < 
pixñCou¡
; i++, 
q
 += 4)

5901 *
q
 = 
vÆ
;

5903 
°bi_uc
 *
p
 = 
out
+
ch™√l
;

5904 
°bi_uc
 
vÆ
 = 
ch™√l
 == 3 ? 255 : 0;

5905 
i
 = 0; i < 
pixñCou¡
; i++, 
p
 += 4)

5906 *
p
 = 
vÆ
;

5909 i‡(
ri
->
bôs_≥r_ch™√l
 == 16) {

5910 
°bi__uöt16
 *
q
 = ((°bi__uöt16 *Ë
out
Ë+ 
ch™√l
;

5911 
i
 = 0; i < 
pixñCou¡
; i++, 
q
 += 4)

5912 *
q
 = (
°bi__uöt16
Ë
	`°bi__gë16be
(
s
);

5914 
°bi_uc
 *
p
 = 
out
+
ch™√l
;

5915 i‡(
bôdïth
 == 16) {

5916 
i
 = 0; i < 
pixñCou¡
; i++, 
p
 += 4)

5917 *
p
 = (
°bi_uc
Ë(
	`°bi__gë16be
(
s
) >> 8);

5919 
i
 = 0; i < 
pixñCou¡
; i++, 
p
 += 4)

5920 *
p
 = 
	`°bi__gë8
(
s
);

5928 i‡(
ch™√lCou¡
 >= 4) {

5929 i‡(
ri
->
bôs_≥r_ch™√l
 == 16) {

5930 
i
=0; i < 
w
*
h
; ++i) {

5931 
°bi__uöt16
 *
pixñ
 = (°bi__uöt16 *Ë
out
 + 4*
i
;

5932 i‡(
pixñ
[3] != 0 &&Öixel[3] != 65535) {

5933 
a
 = 
pixñ
[3] / 65535.0f;

5934 
ø
 = 1.0‡/ 
a
;

5935 
öv_a
 = 65535.0‡* (1 - 
ø
);

5936 
pixñ
[0] = (
°bi__uöt16
Ë’ixñ[0]*
ø
 + 
öv_a
);

5937 
pixñ
[1] = (
°bi__uöt16
Ë’ixñ[1]*
ø
 + 
öv_a
);

5938 
pixñ
[2] = (
°bi__uöt16
Ë’ixñ[2]*
ø
 + 
öv_a
);

5942 
i
=0; i < 
w
*
h
; ++i) {

5943 *
pixñ
 = 
out
 + 4*
i
;

5944 i‡(
pixñ
[3] != 0 &&Öixel[3] != 255) {

5945 
a
 = 
pixñ
[3] / 255.0f;

5946 
ø
 = 1.0‡/ 
a
;

5947 
öv_a
 = 255.0‡* (1 - 
ø
);

5948 
pixñ
[0] = (Ë’ixñ[0]*
ø
 + 
öv_a
);

5949 
pixñ
[1] = (Ë’ixñ[1]*
ø
 + 
öv_a
);

5950 
pixñ
[2] = (Ë’ixñ[2]*
ø
 + 
öv_a
);

5957 i‡(
ªq_comp
 &&Ñeq_comp != 4) {

5958 i‡(
ri
->
bôs_≥r_ch™√l
 == 16)

5959 
out
 = (
°bi_uc
 *Ë
	`°bi__c⁄vît_f‹m©16
((
°bi__uöt16
 *Ëout, 4, 
ªq_comp
, 
w
, 
h
);

5961 
out
 = 
	`°bi__c⁄vît_f‹m©
(out, 4, 
ªq_comp
, 
w
, 
h
);

5962 i‡(
out
 =
NULL
)  out;

5965 i‡(
comp
) *comp = 4;

5966 *
y
 = 
h
;

5967 *
x
 = 
w
;

5969  
out
;

5970 
	}
}

5980 #i‚de‡
STBI_NO_PIC


5981 
	$°bi__pic_is4
(
°bi__c⁄ãxt
 *
s
,c⁄° *
°r
)

5983 
i
;

5984 
i
=0; i<4; ++i)

5985 i‡(
	`°bi__gë8
(
s
Ë!(
°bi_uc
)
°r
[
i
])

5989 
	}
}

5991 
	$°bi__pic_ã°_c‹e
(
°bi__c⁄ãxt
 *
s
)

5993 
i
;

5995 i‡(!
	`°bi__pic_is4
(
s
,"\x53\x80\xF6\x34"))

5998 
i
=0;i<84;++i)

5999 
	`°bi__gë8
(
s
);

6001 i‡(!
	`°bi__pic_is4
(
s
,"PICT"))

6005 
	}
}

6009 
°bi_uc
 
	msize
,
	mty≥
,
	mch™√l
;

6010 } 
	t°bi__pic_∑ckë
;

6012 
°bi_uc
 *
	$°bi__ªadvÆ
(
°bi__c⁄ãxt
 *
s
, 
ch™√l
, 
°bi_uc
 *
de°
)

6014 
mask
=0x80, 
i
;

6016 
i
=0; i<4; ++i, 
mask
>>=1) {

6017 i‡(
ch™√l
 & 
mask
) {

6018 i‡(
	`°bi__©_eof
(
s
)Ë 
	`°bi__îΩuc
("bad file","PIC fileÅoo short");

6019 
de°
[
i
]=
	`°bi__gë8
(
s
);

6023  
de°
;

6024 
	}
}

6026 
	$°bi__c›yvÆ
(
ch™√l
,
°bi_uc
 *
de°
,c⁄° stbi_u¯*
§c
)

6028 
mask
=0x80,
i
;

6030 
i
=0;i<4; ++i, 
mask
>>=1)

6031 i‡(
ch™√l
&
mask
)

6032 
de°
[
i
]=
§c
[i];

6033 
	}
}

6035 
°bi_uc
 *
	$°bi__pic_lﬂd_c‹e
(
°bi__c⁄ãxt
 *
s
,
width
,
height
,*
comp
, 
°bi_uc
 *
ªsu…
)

6037 
a˘_comp
=0,
num_∑ckës
=0,
y
,
chaöed
;

6038 
°bi__pic_∑ckë
 
∑ckës
[10];

6043 
°bi__pic_∑ckë
 *
∑ckë
;

6045 i‡(
num_∑ckës
==(
∑ckës
)/(packets[0]))

6046  
	`°bi__îΩuc
("bad format","too manyÖackets");

6048 
∑ckë
 = &
∑ckës
[
num_∑ckës
++];

6050 
chaöed
 = 
	`°bi__gë8
(
s
);

6051 
∑ckë
->
size
 = 
	`°bi__gë8
(
s
);

6052 
∑ckë
->
ty≥
 = 
	`°bi__gë8
(
s
);

6053 
∑ckë
->
ch™√l
 = 
	`°bi__gë8
(
s
);

6055 
a˘_comp
 |
∑ckë
->
ch™√l
;

6057 i‡(
	`°bi__©_eof
(
s
)Ë 
	`°bi__îΩuc
("bad file","fileÅoo short (readingÖackets)");

6058 i‡(
∑ckë
->
size
 !8Ë 
	`°bi__îΩuc
("bad format","packet isn't 8bpp");

6059 } 
chaöed
);

6061 *
comp
 = (
a˘_comp
 & 0x10 ? 4 : 3);

6063 
y
=0; y<
height
; ++y) {

6064 
∑ckë_idx
;

6066 
∑ckë_idx
=0;Öackë_idx < 
num_∑ckës
; ++packet_idx) {

6067 
°bi__pic_∑ckë
 *
∑ckë
 = &
∑ckës
[
∑ckë_idx
];

6068 
°bi_uc
 *
de°
 = 
ªsu…
+
y
*
width
*4;

6070 
∑ckë
->
ty≥
) {

6072  
	`°bi__îΩuc
("bad format","packet has bad compressionÅype");

6075 
x
;

6077 
x
=0;x<
width
;++x, 
de°
+=4)

6078 i‡(!
	`°bi__ªadvÆ
(
s
,
∑ckë
->
ch™√l
,
de°
))

6085 
À·
=
width
, 
i
;

6087 
À·
>0) {

6088 
°bi_uc
 
cou¡
,
vÆue
[4];

6090 
cou¡
=
	`°bi__gë8
(
s
);

6091 i‡(
	`°bi__©_eof
(
s
)Ë 
	`°bi__îΩuc
("bad file","fileÅoo short (pureÑead count)");

6093 i‡(
cou¡
 > 
À·
)

6094 
cou¡
 = (
°bi_uc
Ë
À·
;

6096 i‡(!
	`°bi__ªadvÆ
(
s
,
∑ckë
->
ch™√l
,
vÆue
))  0;

6098 
i
=0; i<
cou¡
; ++i,
de°
+=4)

6099 
	`°bi__c›yvÆ
(
∑ckë
->
ch™√l
,
de°
,
vÆue
);

6100 
À·
 -
cou¡
;

6106 
À·
=
width
;

6107 
À·
>0) {

6108 
cou¡
 = 
	`°bi__gë8
(
s
), 
i
;

6109 i‡(
	`°bi__©_eof
(
s
)Ë 
	`°bi__îΩuc
("bad file","fileÅoo short (mixedÑead count)");

6111 i‡(
cou¡
 >= 128) {

6112 
°bi_uc
 
vÆue
[4];

6114 i‡(
cou¡
==128)

6115 
cou¡
 = 
	`°bi__gë16be
(
s
);

6117 
cou¡
 -= 127;

6118 i‡(
cou¡
 > 
À·
)

6119  
	`°bi__îΩuc
("bad file","scanline overrun");

6121 i‡(!
	`°bi__ªadvÆ
(
s
,
∑ckë
->
ch™√l
,
vÆue
))

6124 
i
=0;i<
cou¡
;++i, 
de°
 += 4)

6125 
	`°bi__c›yvÆ
(
∑ckë
->
ch™√l
,
de°
,
vÆue
);

6127 ++
cou¡
;

6128 i‡(
cou¡
>
À·
Ë 
	`°bi__îΩuc
("bad file","scanline overrun");

6130 
i
=0;i<
cou¡
;++i, 
de°
+=4)

6131 i‡(!
	`°bi__ªadvÆ
(
s
,
∑ckë
->
ch™√l
,
de°
))

6134 
À·
-=
cou¡
;

6142  
ªsu…
;

6143 
	}
}

6145 *
	$°bi__pic_lﬂd
(
°bi__c⁄ãxt
 *
s
,*
px
,*
py
,*
comp
,
ªq_comp
, 
°bi__ªsu…_öfo
 *
ri
)

6147 
°bi_uc
 *
ªsu…
;

6148 
i
, 
x
,
y
, 
öã∫Æ_comp
;

6149 
	`STBI_NOTUSED
(
ri
);

6151 i‡(!
comp
Ëcom∞&
öã∫Æ_comp
;

6153 
i
=0; i<92; ++i)

6154 
	`°bi__gë8
(
s
);

6156 
x
 = 
	`°bi__gë16be
(
s
);

6157 
y
 = 
	`°bi__gë16be
(
s
);

6158 i‡(
	`°bi__©_eof
(
s
)Ë 
	`°bi__îΩuc
("bad file","fileÅoo short (pic header)");

6159 i‡(!
	`°bi__mad3sizes_vÆid
(
x
, 
y
, 4, 0)Ë 
	`°bi__îΩuc
("tooÜarge", "PIC imageÅooÜargeÅo decode");

6161 
	`°bi__gë32be
(
s
);

6162 
	`°bi__gë16be
(
s
);

6163 
	`°bi__gë16be
(
s
);

6166 
ªsu…
 = (
°bi_uc
 *Ë
	`°bi__mÆloc_mad3
(
x
, 
y
, 4, 0);

6167 
	`mem£t
(
ªsu…
, 0xff, 
x
*
y
*4);

6169 i‡(!
	`°bi__pic_lﬂd_c‹e
(
s
,
x
,
y
,
comp
, 
ªsu…
)) {

6170 
	`STBI_FREE
(
ªsu…
);

6171 
ªsu…
=0;

6173 *
px
 = 
x
;

6174 *
py
 = 
y
;

6175 i‡(
ªq_comp
 =0Ëªq_com∞*
comp
;

6176 
ªsu…
=
	`°bi__c⁄vît_f‹m©
‘esu…,4,
ªq_comp
,
x
,
y
);

6178  
ªsu…
;

6179 
	}
}

6181 
	$°bi__pic_ã°
(
°bi__c⁄ãxt
 *
s
)

6183 
r
 = 
	`°bi__pic_ã°_c‹e
(
s
);

6184 
	`°bi__ªwöd
(
s
);

6185  
r
;

6186 
	}
}

6192 #i‚de‡
STBI_NO_GIF


6195 
°bi__öt16
 
	m¥efix
;

6196 
°bi_uc
 
	mfú°
;

6197 
°bi_uc
 
	msuffix
;

6198 } 
	t°bi__gif_lzw
;

6202 
	mw
,
	mh
;

6203 
°bi_uc
 *
	mout
;

6204 
°bi_uc
 *
	mbackground
;

6205 
°bi_uc
 *
	mhi°‹y
;

6206 
	mÊags
, 
	mbgödex
, 
	møtio
, 
	må™•¨ít
, 
	meÊags
;

6207 
°bi_uc
 
	m∑l
[256][4];

6208 
°bi_uc
 
	mÕÆ
[256][4];

6209 
°bi__gif_lzw
 
	mcodes
[8192];

6210 
°bi_uc
 *
	mcﬁ‹_èbÀ
;

6211 
	m∑r£
, 
	m°ï
;

6212 
	mlÊags
;

6213 
	m°¨t_x
, 
	m°¨t_y
;

6214 
	mmax_x
, 
	mmax_y
;

6215 
	mcur_x
, 
	mcur_y
;

6216 
	mlöe_size
;

6217 
	mdñay
;

6218 } 
	t°bi__gif
;

6220 
	$°bi__gif_ã°_øw
(
°bi__c⁄ãxt
 *
s
)

6222 
sz
;

6223 i‡(
	`°bi__gë8
(
s
) != 'G' || stbi__get8(s) != 'I' || stbi__get8(s) != 'F' || stbi__get8(s) != '8')  0;

6224 
sz
 = 
	`°bi__gë8
(
s
);

6225 i‡(
sz
 != '9' && sz != '7')  0;

6226 i‡(
	`°bi__gë8
(
s
) != 'a')  0;

6228 
	}
}

6230 
	$°bi__gif_ã°
(
°bi__c⁄ãxt
 *
s
)

6232 
r
 = 
	`°bi__gif_ã°_øw
(
s
);

6233 
	`°bi__ªwöd
(
s
);

6234  
r
;

6235 
	}
}

6237 
	$°bi__gif_∑r£_cﬁ‹èbÀ
(
°bi__c⁄ãxt
 *
s
, 
°bi_uc
 
∑l
[256][4], 
num_íåõs
, 
å™•
)

6239 
i
;

6240 
i
=0; i < 
num_íåõs
; ++i) {

6241 
∑l
[
i
][2] = 
	`°bi__gë8
(
s
);

6242 
∑l
[
i
][1] = 
	`°bi__gë8
(
s
);

6243 
∑l
[
i
][0] = 
	`°bi__gë8
(
s
);

6244 
∑l
[
i
][3] = 
å™•
 == i ? 0 : 255;

6246 
	}
}

6248 
	$°bi__gif_hódî
(
°bi__c⁄ãxt
 *
s
, 
°bi__gif
 *
g
, *
comp
, 
is_öfo
)

6250 
°bi_uc
 
vîsi⁄
;

6251 i‡(
	`°bi__gë8
(
s
) != 'G' || stbi__get8(s) != 'I' || stbi__get8(s) != 'F' || stbi__get8(s) != '8')

6252  
	`°bi__îr
("not GIF", "Corrupt GIF");

6254 
vîsi⁄
 = 
	`°bi__gë8
(
s
);

6255 i‡(
vîsi⁄
 !'7' && vîsi⁄ !'9'Ë 
	`°bi__îr
("not GIF", "Corrupt GIF");

6256 i‡(
	`°bi__gë8
(
s
Ë!'a'Ë 
	`°bi__îr
("not GIF", "Corrupt GIF");

6258 
°bi__g_Áûuª_ªas⁄
 = "";

6259 
g
->
w
 = 
	`°bi__gë16À
(
s
);

6260 
g
->
h
 = 
	`°bi__gë16À
(
s
);

6261 
g
->
Êags
 = 
	`°bi__gë8
(
s
);

6262 
g
->
bgödex
 = 
	`°bi__gë8
(
s
);

6263 
g
->
øtio
 = 
	`°bi__gë8
(
s
);

6264 
g
->
å™•¨ít
 = -1;

6266 i‡(
comp
 != 0) *comp = 4;

6268 i‡(
is_öfo
)  1;

6270 i‡(
g
->
Êags
 & 0x80)

6271 
	`°bi__gif_∑r£_cﬁ‹èbÀ
(
s
,
g
->
∑l
, 2 << (g->
Êags
 & 7), -1);

6274 
	}
}

6276 
	$°bi__gif_öfo_øw
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
)

6278 
°bi__gif
* 
g
 = (°bi__gif*Ë
	`°bi__mÆloc
((stbi__gif));

6279 i‡(!
	`°bi__gif_hódî
(
s
, 
g
, 
comp
, 1)) {

6280 
	`STBI_FREE
(
g
);

6281 
	`°bi__ªwöd
–
s
 );

6284 i‡(
x
Ë*x = 
g
->
w
;

6285 i‡(
y
Ë*y = 
g
->
h
;

6286 
	`STBI_FREE
(
g
);

6288 
	}
}

6290 
	$°bi__out_gif_code
(
°bi__gif
 *
g
, 
°bi__uöt16
 
code
)

6292 
°bi_uc
 *
p
, *
c
;

6293 
idx
;

6297 i‡(
g
->
codes
[
code
].
¥efix
 >= 0)

6298 
	`°bi__out_gif_code
(
g
, g->
codes
[
code
].
¥efix
);

6300 i‡(
g
->
cur_y
 >g->
max_y
) ;

6302 
idx
 = 
g
->
cur_x
 + g->
cur_y
;

6303 
p
 = &
g
->
out
[
idx
];

6304 
g
->
hi°‹y
[
idx
 / 4] = 1;

6306 
c
 = &
g
->
cﬁ‹_èbÀ
[g->
codes
[
code
].
suffix
 * 4];

6307 i‡(
c
[3] > 128) {

6308 
p
[0] = 
c
[2];

6309 
p
[1] = 
c
[1];

6310 
p
[2] = 
c
[0];

6311 
p
[3] = 
c
[3];

6313 
g
->
cur_x
 += 4;

6315 i‡(
g
->
cur_x
 >g->
max_x
) {

6316 
g
->
cur_x
 = g->
°¨t_x
;

6317 
g
->
cur_y
 +g->
°ï
;

6319 
g
->
cur_y
 >g->
max_y
 && g->
∑r£
 > 0) {

6320 
g
->
°ï
 = (1 << g->
∑r£
Ë* g->
löe_size
;

6321 
g
->
cur_y
 = g->
°¨t_y
 + (g->
°ï
 >> 1);

6322 --
g
->
∑r£
;

6325 
	}
}

6327 
°bi_uc
 *
	$°bi__¥o˚ss_gif_ø°î
(
°bi__c⁄ãxt
 *
s
, 
°bi__gif
 *
g
)

6329 
°bi_uc
 
lzw_cs
;

6330 
°bi__öt32
 
Àn
, 
öô_code
;

6331 
°bi__uöt32
 
fú°
;

6332 
°bi__öt32
 
codesize
, 
codemask
, 
avaû
, 
ﬁdcode
, 
bôs
, 
vÆid_bôs
, 
˛ór
;

6333 
°bi__gif_lzw
 *
p
;

6335 
lzw_cs
 = 
	`°bi__gë8
(
s
);

6336 i‡(
lzw_cs
 > 12Ë 
NULL
;

6337 
˛ór
 = 1 << 
lzw_cs
;

6338 
fú°
 = 1;

6339 
codesize
 = 
lzw_cs
 + 1;

6340 
codemask
 = (1 << 
codesize
) - 1;

6341 
bôs
 = 0;

6342 
vÆid_bôs
 = 0;

6343 
öô_code
 = 0; inô_codê< 
˛ór
; init_code++) {

6344 
g
->
codes
[
öô_code
].
¥efix
 = -1;

6345 
g
->
codes
[
öô_code
].
fú°
 = (
°bi_uc
) init_code;

6346 
g
->
codes
[
öô_code
].
suffix
 = (
°bi_uc
) init_code;

6350 
avaû
 = 
˛ór
+2;

6351 
ﬁdcode
 = -1;

6353 
Àn
 = 0;

6355 i‡(
vÆid_bôs
 < 
codesize
) {

6356 i‡(
Àn
 == 0) {

6357 
Àn
 = 
	`°bi__gë8
(
s
);

6358 i‡(
Àn
 == 0)

6359  
g
->
out
;

6361 --
Àn
;

6362 
bôs
 |(
°bi__öt32
Ë
	`°bi__gë8
(
s
Ë<< 
vÆid_bôs
;

6363 
vÆid_bôs
 += 8;

6365 
°bi__öt32
 
code
 = 
bôs
 & 
codemask
;

6366 
bôs
 >>
codesize
;

6367 
vÆid_bôs
 -
codesize
;

6369 i‡(
code
 =
˛ór
) {

6370 
codesize
 = 
lzw_cs
 + 1;

6371 
codemask
 = (1 << 
codesize
) - 1;

6372 
avaû
 = 
˛ór
 + 2;

6373 
ﬁdcode
 = -1;

6374 
fú°
 = 0;

6375 } i‡(
code
 =
˛ór
 + 1) {

6376 
	`°bi__skù
(
s
, 
Àn
);

6377 (
Àn
 = 
	`°bi__gë8
(
s
)) > 0)

6378 
	`°bi__skù
(
s
,
Àn
);

6379  
g
->
out
;

6380 } i‡(
code
 <
avaû
) {

6381 i‡(
fú°
) {

6382  
	`°bi__îΩuc
("no clear code", "Corrupt GIF");

6385 i‡(
ﬁdcode
 >= 0) {

6386 
p
 = &
g
->
codes
[
avaû
++];

6387 i‡(
avaû
 > 8192) {

6388  
	`°bi__îΩuc
("too many codes", "Corrupt GIF");

6391 
p
->
¥efix
 = (
°bi__öt16
Ë
ﬁdcode
;

6392 
p
->
fú°
 = 
g
->
codes
[
ﬁdcode
].first;

6393 
p
->
suffix
 = (
code
 =
avaû
Ë?Ö->
fú°
 : 
g
->
codes
[code].first;

6394 } i‡(
code
 =
avaû
)

6395  
	`°bi__îΩuc
("illegal code inÑaster", "Corrupt GIF");

6397 
	`°bi__out_gif_code
(
g
, (
°bi__uöt16
Ë
code
);

6399 i‡((
avaû
 & 
codemask
) == 0 &&ávail <= 0x0FFF) {

6400 
codesize
++;

6401 
codemask
 = (1 << 
codesize
) - 1;

6404 
ﬁdcode
 = 
code
;

6406  
	`°bi__îΩuc
("illegal code inÑaster", "Corrupt GIF");

6410 
	}
}

6414 
°bi_uc
 *
	$°bi__gif_lﬂd_√xt
(
°bi__c⁄ãxt
 *
s
, 
°bi__gif
 *
g
, *
comp
, 
ªq_comp
, 
°bi_uc
 *
two_back
)

6416 
di•o£
;

6417 
fú°_‰ame
;

6418 
pi
;

6419 
pcou¡
;

6420 
	`STBI_NOTUSED
(
ªq_comp
);

6423 
fú°_‰ame
 = 0;

6424 i‡(
g
->
out
 == 0) {

6425 i‡(!
	`°bi__gif_hódî
(
s
, 
g
, 
comp
,0))  0;

6426 i‡(!
	`°bi__mad3sizes_vÆid
(4, 
g
->
w
, g->
h
, 0))

6427  
	`°bi__îΩuc
("tooÜarge", "GIF image isÅooÜarge");

6428 
pcou¡
 = 
g
->
w
 * g->
h
;

6429 
g
->
out
 = (
°bi_uc
 *Ë
	`°bi__mÆloc
(4 * 
pcou¡
);

6430 
g
->
background
 = (
°bi_uc
 *Ë
	`°bi__mÆloc
(4 * 
pcou¡
);

6431 
g
->
hi°‹y
 = (
°bi_uc
 *Ë
	`°bi__mÆloc
(
pcou¡
);

6432 i‡(!
g
->
out
 || !g->
background
 || !g->
hi°‹y
)

6433  
	`°bi__îΩuc
("outofmem", "Out of memory");

6438 
	`mem£t
(
g
->
out
, 0x00, 4 * 
pcou¡
);

6439 
	`mem£t
(
g
->
background
, 0x00, 4 * 
pcou¡
);

6440 
	`mem£t
(
g
->
hi°‹y
, 0x00, 
pcou¡
);

6441 
fú°_‰ame
 = 1;

6444 
di•o£
 = (
g
->
eÊags
 & 0x1C) >> 2;

6445 
pcou¡
 = 
g
->
w
 * g->
h
;

6447 i‡((
di•o£
 =3Ë&& (
two_back
 == 0)) {

6448 
di•o£
 = 2;

6451 i‡(
di•o£
 == 3) {

6452 
pi
 = 0;Öò< 
pcou¡
; ++pi) {

6453 i‡(
g
->
hi°‹y
[
pi
]) {

6454 
	`mem˝y
–&
g
->
out
[
pi
 * 4], &
two_back
[pi * 4], 4 );

6457 } i‡(
di•o£
 == 2) {

6459 
pi
 = 0;Öò< 
pcou¡
; ++pi) {

6460 i‡(
g
->
hi°‹y
[
pi
]) {

6461 
	`mem˝y
–&
g
->
out
[
pi
 * 4], &g->
background
[pi * 4], 4 );

6472 
	`mem˝y
–
g
->
background
, g->
out
, 4 * g->
w
 * g->
h
 );

6476 
	`mem£t
–
g
->
hi°‹y
, 0x00, g->
w
 * g->
h
 );

6479 
èg
 = 
	`°bi__gë8
(
s
);

6480 
èg
) {

6483 
°bi__öt32
 
x
, 
y
, 
w
, 
h
;

6484 
°bi_uc
 *
o
;

6486 
x
 = 
	`°bi__gë16À
(
s
);

6487 
y
 = 
	`°bi__gë16À
(
s
);

6488 
w
 = 
	`°bi__gë16À
(
s
);

6489 
h
 = 
	`°bi__gë16À
(
s
);

6490 i‡(((
x
 + 
w
Ë> (
g
->w)Ë|| ((
y
 + 
h
) > (g->h)))

6491  
	`°bi__îΩuc
("bad Image Descriptor", "Corrupt GIF");

6493 
g
->
löe_size
 = g->
w
 * 4;

6494 
g
->
°¨t_x
 = 
x
 * 4;

6495 
g
->
°¨t_y
 = 
y
 * g->
löe_size
;

6496 
g
->
max_x
 = g->
°¨t_x
 + 
w
 * 4;

6497 
g
->
max_y
 = g->
°¨t_y
 + 
h
 * g->
löe_size
;

6498 
g
->
cur_x
 = g->
°¨t_x
;

6499 
g
->
cur_y
 = g->
°¨t_y
;

6505 i‡(
w
 == 0)

6506 
g
->
cur_y
 = g->
max_y
;

6508 
g
->
lÊags
 = 
	`°bi__gë8
(
s
);

6510 i‡(
g
->
lÊags
 & 0x40) {

6511 
g
->
°ï
 = 8 * g->
löe_size
;

6512 
g
->
∑r£
 = 3;

6514 
g
->
°ï
 = g->
löe_size
;

6515 
g
->
∑r£
 = 0;

6518 i‡(
g
->
lÊags
 & 0x80) {

6519 
	`°bi__gif_∑r£_cﬁ‹èbÀ
(
s
,
g
->
ÕÆ
, 2 << (g->
lÊags
 & 7), g->
eÊags
 & 0x01 ? g->
å™•¨ít
 : -1);

6520 
g
->
cﬁ‹_èbÀ
 = (
°bi_uc
 *Ëg->
ÕÆ
;

6521 } i‡(
g
->
Êags
 & 0x80) {

6522 
g
->
cﬁ‹_èbÀ
 = (
°bi_uc
 *Ëg->
∑l
;

6524  
	`°bi__îΩuc
("missing colorÅable", "Corrupt GIF");

6526 
o
 = 
	`°bi__¥o˚ss_gif_ø°î
(
s
, 
g
);

6527 i‡(!
o
Ë 
NULL
;

6530 
pcou¡
 = 
g
->
w
 * g->
h
;

6531 i‡(
fú°_‰ame
 && (
g
->
bgödex
 > 0)) {

6533 
pi
 = 0;Öò< 
pcou¡
; ++pi) {

6534 i‡(
g
->
hi°‹y
[
pi
] == 0) {

6535 
g
->
∑l
[g->
bgödex
][3] = 255;

6536 
	`mem˝y
–&
g
->
out
[
pi
 * 4], &g->
∑l
[g->
bgödex
], 4 );

6541  
o
;

6546 
Àn
;

6547 
ext
 = 
	`°bi__gë8
(
s
);

6548 i‡(
ext
 == 0xF9) {

6549 
Àn
 = 
	`°bi__gë8
(
s
);

6550 i‡(
Àn
 == 4) {

6551 
g
->
eÊags
 = 
	`°bi__gë8
(
s
);

6552 
g
->
dñay
 = 10 * 
	`°bi__gë16À
(
s
);

6555 i‡(
g
->
å™•¨ít
 >= 0) {

6556 
g
->
∑l
[g->
å™•¨ít
][3] = 255;

6558 i‡(
g
->
eÊags
 & 0x01) {

6559 
g
->
å™•¨ít
 = 
	`°bi__gë8
(
s
);

6560 i‡(
g
->
å™•¨ít
 >= 0) {

6561 
g
->
∑l
[g->
å™•¨ít
][3] = 0;

6565 
	`°bi__skù
(
s
, 1);

6566 
g
->
å™•¨ít
 = -1;

6569 
	`°bi__skù
(
s
, 
Àn
);

6573 (
Àn
 = 
	`°bi__gë8
(
s
)) != 0) {

6574 
	`°bi__skù
(
s
, 
Àn
);

6580  (
°bi_uc
 *Ë
s
;

6583  
	`°bi__îΩuc
("unknown code", "Corrupt GIF");

6586 
	}
}

6588 *
	$°bi__lﬂd_gif_maö
(
°bi__c⁄ãxt
 *
s
, **
dñays
, *
x
, *
y
, *
z
, *
comp
, 
ªq_comp
)

6590 i‡(
	`°bi__gif_ã°
(
s
)) {

6591 
œyîs
 = 0;

6592 
°bi_uc
 *
u
 = 0;

6593 
°bi_uc
 *
out
 = 0;

6594 
°bi_uc
 *
two_back
 = 0;

6595 
°bi__gif
 
g
;

6596 
°ride
;

6597 
	`mem£t
(&
g
, 0, (g));

6598 i‡(
dñays
) {

6599 *
dñays
 = 0;

6603 
u
 = 
	`°bi__gif_lﬂd_√xt
(
s
, &
g
, 
comp
, 
ªq_comp
, 
two_back
);

6604 i‡(
u
 =(
°bi_uc
 *Ë
s
) u = 0;

6606 i‡(
u
) {

6607 *
x
 = 
g
.
w
;

6608 *
y
 = 
g
.
h
;

6609 ++
œyîs
;

6610 
°ride
 = 
g
.
w
 * g.
h
 * 4;

6612 i‡(
out
) {

6613 
out
 = (
°bi_uc
*Ë
	`STBI_REALLOC
–out, 
œyîs
 * 
°ride
 );

6614 i‡(
dñays
) {

6615 *
dñays
 = (*Ë
	`STBI_REALLOC
–*dñays, (Ë* 
œyîs
 );

6618 
out
 = (
°bi_uc
*)
	`°bi__mÆloc
–
œyîs
 * 
°ride
 );

6619 i‡(
dñays
) {

6620 *
dñays
 = (*Ë
	`°bi__mÆloc
–
œyîs
 * () );

6623 
	`mem˝y
–
out
 + ((
œyîs
 - 1Ë* 
°ride
), 
u
, stride );

6624 i‡(
œyîs
 >= 2) {

6625 
two_back
 = 
out
 - 2 * 
°ride
;

6628 i‡(
dñays
) {

6629 (*
dñays
)[
œyîs
 - 1U] = 
g
.
dñay
;

6632 } 
u
 != 0);

6635 
	`STBI_FREE
(
g
.
out
);

6636 
	`STBI_FREE
(
g
.
hi°‹y
);

6637 
	`STBI_FREE
(
g
.
background
);

6640 i‡(
ªq_comp
 &&Ñeq_comp != 4)

6641 
out
 = 
	`°bi__c⁄vît_f‹m©
(out, 4, 
ªq_comp
, 
œyîs
 * 
g
.
w
, g.
h
);

6643 *
z
 = 
œyîs
;

6644  
out
;

6646  
	`°bi__îΩuc
("not GIF", "Image wasÇotásá gifÅype.");

6648 
	}
}

6650 *
	$°bi__gif_lﬂd
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
, 
ªq_comp
, 
°bi__ªsu…_öfo
 *
ri
)

6652 
°bi_uc
 *
u
 = 0;

6653 
°bi__gif
 
g
;

6654 
	`mem£t
(&
g
, 0, (g));

6655 
	`STBI_NOTUSED
(
ri
);

6657 
u
 = 
	`°bi__gif_lﬂd_√xt
(
s
, &
g
, 
comp
, 
ªq_comp
, 0);

6658 i‡(
u
 =(
°bi_uc
 *Ë
s
) u = 0;

6659 i‡(
u
) {

6660 *
x
 = 
g
.
w
;

6661 *
y
 = 
g
.
h
;

6665 i‡(
ªq_comp
 &&Ñeq_comp != 4)

6666 
u
 = 
	`°bi__c⁄vît_f‹m©
(u, 4, 
ªq_comp
, 
g
.
w
, g.
h
);

6667 } i‡(
g
.
out
) {

6669 
	`STBI_FREE
(
g
.
out
);

6673 
	`STBI_FREE
(
g
.
hi°‹y
);

6674 
	`STBI_FREE
(
g
.
background
);

6676  
u
;

6677 
	}
}

6679 
	$°bi__gif_öfo
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
)

6681  
	`°bi__gif_öfo_øw
(
s
,
x
,
y
,
comp
);

6682 
	}
}

6688 #i‚de‡
STBI_NO_HDR


6689 
	$°bi__hdr_ã°_c‹e
(
°bi__c⁄ãxt
 *
s
, c⁄° *
sig«tuª
)

6691 
i
;

6692 
i
=0; 
sig«tuª
[i]; ++i)

6693 i‡(
	`°bi__gë8
(
s
Ë!
sig«tuª
[
i
])

6695 
	`°bi__ªwöd
(
s
);

6697 
	}
}

6699 
	$°bi__hdr_ã°
(
°bi__c⁄ãxt
* 
s
)

6701 
r
 = 
	`°bi__hdr_ã°_c‹e
(
s
, "#?RADIANCE\n");

6702 
	`°bi__ªwöd
(
s
);

6703 if(!
r
) {

6704 
r
 = 
	`°bi__hdr_ã°_c‹e
(
s
, "#?RGBE\n");

6705 
	`°bi__ªwöd
(
s
);

6707  
r
;

6708 
	}
}

6710 
	#STBI__HDR_BUFLEN
 1024

	)

6711 *
	$°bi__hdr_gëtokí
(
°bi__c⁄ãxt
 *
z
, *
buf„r
)

6713 
Àn
=0;

6714 
c
 = '\0';

6716 
c
 = (Ë
	`°bi__gë8
(
z
);

6718 !
	`°bi__©_eof
(
z
Ë&& 
c
 != '\n') {

6719 
buf„r
[
Àn
++] = 
c
;

6720 i‡(
Àn
 =
STBI__HDR_BUFLEN
-1) {

6722 !
	`°bi__©_eof
(
z
Ë&& 
	`°bi__gë8
(z) != '\n')

6726 
c
 = (Ë
	`°bi__gë8
(
z
);

6729 
buf„r
[
Àn
] = 0;

6730  
buf„r
;

6731 
	}
}

6733 
	$°bi__hdr_c⁄vît
(*
ouçut
, 
°bi_uc
 *
öput
, 
ªq_comp
)

6735 i‡–
öput
[3] != 0 ) {

6736 
f1
;

6738 
f1
 = (Ë
	`ldexp
(1.0f, 
öput
[3] - ()(128 + 8));

6739 i‡(
ªq_comp
 <= 2)

6740 
ouçut
[0] = (
öput
[0] + i≈ut[1] + i≈ut[2]Ë* 
f1
 / 3;

6742 
ouçut
[0] = 
öput
[0] * 
f1
;

6743 
ouçut
[1] = 
öput
[1] * 
f1
;

6744 
ouçut
[2] = 
öput
[2] * 
f1
;

6746 i‡(
ªq_comp
 =2Ë
ouçut
[1] = 1;

6747 i‡(
ªq_comp
 =4Ë
ouçut
[3] = 1;

6749 
ªq_comp
) {

6750 4: 
ouçut
[3] = 1;

6751 3: 
ouçut
[0] = output[1] = output[2] = 0;

6753 2: 
ouçut
[1] = 1;

6754 1: 
ouçut
[0] = 0;

6758 
	}
}

6760 *
	$°bi__hdr_lﬂd
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
, 
ªq_comp
, 
°bi__ªsu…_öfo
 *
ri
)

6762 
buf„r
[
STBI__HDR_BUFLEN
];

6763 *
tokí
;

6764 
vÆid
 = 0;

6765 
width
, 
height
;

6766 
°bi_uc
 *
sˇ∆öe
;

6767 *
hdr_d©a
;

6768 
Àn
;

6769 
cou¡
, 
vÆue
;

6770 
i
, 
j
, 
k
, 
c1
,
c2
, 
z
;

6771 c⁄° *
hódîTokí
;

6772 
	`STBI_NOTUSED
(
ri
);

6775 
hódîTokí
 = 
	`°bi__hdr_gëtokí
(
s
,
buf„r
);

6776 i‡(
	`°rcmp
(
hódîTokí
, "#?RADIANCE") != 0 && strcmp(headerToken, "#?RGBE") != 0)

6777  
	`°bi__îΩf
("not HDR", "Corrupt HDR image");

6781 
tokí
 = 
	`°bi__hdr_gëtokí
(
s
,
buf„r
);

6782 i‡(
tokí
[0] == 0) ;

6783 i‡(
	`°rcmp
(
tokí
, "FORMAT=32-bô_æe_rgbe"Ë=0Ë
vÆid
 = 1;

6786 i‡(!
vÆid
Ë 
	`°bi__îΩf
("unsupported format", "Unsupported HDR format");

6790 
tokí
 = 
	`°bi__hdr_gëtokí
(
s
,
buf„r
);

6791 i‡(
	`°∫cmp
(
tokí
, "-Y ", 3)Ë 
	`°bi__îΩf
("unsupported dataÜayout", "Unsupported HDR format");

6792 
tokí
 += 3;

6793 
height
 = (Ë
	`°πﬁ
(
tokí
, &token, 10);

6794 *
tokí
 == ' ') ++token;

6795 i‡(
	`°∫cmp
(
tokí
, "+X ", 3)Ë 
	`°bi__îΩf
("unsupported dataÜayout", "Unsupported HDR format");

6796 
tokí
 += 3;

6797 
width
 = (Ë
	`°πﬁ
(
tokí
, 
NULL
, 10);

6799 *
x
 = 
width
;

6800 *
y
 = 
height
;

6802 i‡(
comp
) *comp = 3;

6803 i‡(
ªq_comp
 == 0)Ñeq_comp = 3;

6805 i‡(!
	`°bi__mad4sizes_vÆid
(
width
, 
height
, 
ªq_comp
, (), 0))

6806  
	`°bi__îΩf
("tooÜarge", "HDR image isÅooÜarge");

6809 
hdr_d©a
 = (*Ë
	`°bi__mÆloc_mad4
(
width
, 
height
, 
ªq_comp
, (), 0);

6810 i‡(!
hdr_d©a
)

6811  
	`°bi__îΩf
("outofmem", "Out of memory");

6815 i‡–
width
 < 8 || width >= 32768) {

6817 
j
=0; j < 
height
; ++j) {

6818 
i
=0; i < 
width
; ++i) {

6819 
°bi_uc
 
rgbe
[4];

6820 
maö_decode_lo›
:

6821 
	`°bi__gën
(
s
, 
rgbe
, 4);

6822 
	`°bi__hdr_c⁄vît
(
hdr_d©a
 + 
j
 * 
width
 * 
ªq_comp
 + 
i
 *Ñeq_comp, 
rgbe
,Ñeq_comp);

6827 
sˇ∆öe
 = 
NULL
;

6829 
j
 = 0; j < 
height
; ++j) {

6830 
c1
 = 
	`°bi__gë8
(
s
);

6831 
c2
 = 
	`°bi__gë8
(
s
);

6832 
Àn
 = 
	`°bi__gë8
(
s
);

6833 i‡(
c1
 !2 || 
c2
 !2 || (
Àn
 & 0x80)) {

6836 
°bi_uc
 
rgbe
[4];

6837 
rgbe
[0] = (
°bi_uc
Ë
c1
;

6838 
rgbe
[1] = (
°bi_uc
Ë
c2
;

6839 
rgbe
[2] = (
°bi_uc
Ë
Àn
;

6840 
rgbe
[3] = (
°bi_uc
Ë
	`°bi__gë8
(
s
);

6841 
	`°bi__hdr_c⁄vît
(
hdr_d©a
, 
rgbe
, 
ªq_comp
);

6842 
i
 = 1;

6843 
j
 = 0;

6844 
	`STBI_FREE
(
sˇ∆öe
);

6845 
maö_decode_lo›
;

6847 
Àn
 <<= 8;

6848 
Àn
 |
	`°bi__gë8
(
s
);

6849 i‡(
Àn
 !
width
Ë{ 
	`STBI_FREE
(
hdr_d©a
); STBI_FREE(
sˇ∆öe
);  
	`°bi__îΩf
("invalid decoded scanlineÜength", "corrupt HDR"); }

6850 i‡(
sˇ∆öe
 =
NULL
) {

6851 
sˇ∆öe
 = (
°bi_uc
 *Ë
	`°bi__mÆloc_mad2
(
width
, 4, 0);

6852 i‡(!
sˇ∆öe
) {

6853 
	`STBI_FREE
(
hdr_d©a
);

6854  
	`°bi__îΩf
("outofmem", "Out of memory");

6858 
k
 = 0; k < 4; ++k) {

6859 
∆e·
;

6860 
i
 = 0;

6861 (
∆e·
 = 
width
 - 
i
) > 0) {

6862 
cou¡
 = 
	`°bi__gë8
(
s
);

6863 i‡(
cou¡
 > 128) {

6865 
vÆue
 = 
	`°bi__gë8
(
s
);

6866 
cou¡
 -= 128;

6867 i‡(
cou¡
 > 
∆e·
Ë{ 
	`STBI_FREE
(
hdr_d©a
); STBI_FREE(
sˇ∆öe
);  
	`°bi__îΩf
("corrupt", "bad RLE data in HDR"); }

6868 
z
 = 0; z < 
cou¡
; ++z)

6869 
sˇ∆öe
[
i
++ * 4 + 
k
] = 
vÆue
;

6872 i‡(
cou¡
 > 
∆e·
Ë{ 
	`STBI_FREE
(
hdr_d©a
); STBI_FREE(
sˇ∆öe
);  
	`°bi__îΩf
("corrupt", "bad RLE data in HDR"); }

6873 
z
 = 0; z < 
cou¡
; ++z)

6874 
sˇ∆öe
[
i
++ * 4 + 
k
] = 
	`°bi__gë8
(
s
);

6878 
i
=0; i < 
width
; ++i)

6879 
	`°bi__hdr_c⁄vît
(
hdr_d©a
+(
j
*
width
 + 
i
)*
ªq_comp
, 
sˇ∆öe
 + i*4,Ñeq_comp);

6881 i‡(
sˇ∆öe
)

6882 
	`STBI_FREE
(
sˇ∆öe
);

6885  
hdr_d©a
;

6886 
	}
}

6888 
	$°bi__hdr_öfo
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
)

6890 
buf„r
[
STBI__HDR_BUFLEN
];

6891 *
tokí
;

6892 
vÆid
 = 0;

6893 
dummy
;

6895 i‡(!
x
Ëx = &
dummy
;

6896 i‡(!
y
Ëy = &
dummy
;

6897 i‡(!
comp
Ëcom∞&
dummy
;

6899 i‡(
	`°bi__hdr_ã°
(
s
) == 0) {

6900 
	`°bi__ªwöd
–
s
 );

6905 
tokí
 = 
	`°bi__hdr_gëtokí
(
s
,
buf„r
);

6906 i‡(
tokí
[0] == 0) ;

6907 i‡(
	`°rcmp
(
tokí
, "FORMAT=32-bô_æe_rgbe"Ë=0Ë
vÆid
 = 1;

6910 i‡(!
vÆid
) {

6911 
	`°bi__ªwöd
–
s
 );

6914 
tokí
 = 
	`°bi__hdr_gëtokí
(
s
,
buf„r
);

6915 i‡(
	`°∫cmp
(
tokí
, "-Y ", 3)) {

6916 
	`°bi__ªwöd
–
s
 );

6919 
tokí
 += 3;

6920 *
y
 = (Ë
	`°πﬁ
(
tokí
, &token, 10);

6921 *
tokí
 == ' ') ++token;

6922 i‡(
	`°∫cmp
(
tokí
, "+X ", 3)) {

6923 
	`°bi__ªwöd
–
s
 );

6926 
tokí
 += 3;

6927 *
x
 = (Ë
	`°πﬁ
(
tokí
, 
NULL
, 10);

6928 *
comp
 = 3;

6930 
	}
}

6933 #i‚de‡
STBI_NO_BMP


6934 
	$°bi__bmp_öfo
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
)

6936 *
p
;

6937 
°bi__bmp_d©a
 
öfo
;

6939 
öfo
.
Æl_a
 = 255;

6940 
p
 = 
	`°bi__bmp_∑r£_hódî
(
s
, &
öfo
);

6941 
	`°bi__ªwöd
–
s
 );

6942 i‡(
p
 =
NULL
)

6944 i‡(
x
Ë*x = 
s
->
img_x
;

6945 i‡(
y
Ë*y = 
s
->
img_y
;

6946 i‡(
comp
) {

6947 i‡(
öfo
.
bµ
 =24 && info.
ma
 == 0xff000000)

6948 *
comp
 = 3;

6950 *
comp
 = 
öfo
.
ma
 ? 4 : 3;

6953 
	}
}

6956 #i‚de‡
STBI_NO_PSD


6957 
	$°bi__psd_öfo
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
)

6959 
ch™√lCou¡
, 
dummy
, 
dïth
;

6960 i‡(!
x
Ëx = &
dummy
;

6961 i‡(!
y
Ëy = &
dummy
;

6962 i‡(!
comp
Ëcom∞&
dummy
;

6963 i‡(
	`°bi__gë32be
(
s
) != 0x38425053) {

6964 
	`°bi__ªwöd
–
s
 );

6967 i‡(
	`°bi__gë16be
(
s
) != 1) {

6968 
	`°bi__ªwöd
–
s
 );

6971 
	`°bi__skù
(
s
, 6);

6972 
ch™√lCou¡
 = 
	`°bi__gë16be
(
s
);

6973 i‡(
ch™√lCou¡
 < 0 || channelCount > 16) {

6974 
	`°bi__ªwöd
–
s
 );

6977 *
y
 = 
	`°bi__gë32be
(
s
);

6978 *
x
 = 
	`°bi__gë32be
(
s
);

6979 
dïth
 = 
	`°bi__gë16be
(
s
);

6980 i‡(
dïth
 != 8 && depth != 16) {

6981 
	`°bi__ªwöd
–
s
 );

6984 i‡(
	`°bi__gë16be
(
s
) != 3) {

6985 
	`°bi__ªwöd
–
s
 );

6988 *
comp
 = 4;

6990 
	}
}

6992 
	$°bi__psd_is16
(
°bi__c⁄ãxt
 *
s
)

6994 
ch™√lCou¡
, 
dïth
;

6995 i‡(
	`°bi__gë32be
(
s
) != 0x38425053) {

6996 
	`°bi__ªwöd
–
s
 );

6999 i‡(
	`°bi__gë16be
(
s
) != 1) {

7000 
	`°bi__ªwöd
–
s
 );

7003 
	`°bi__skù
(
s
, 6);

7004 
ch™√lCou¡
 = 
	`°bi__gë16be
(
s
);

7005 i‡(
ch™√lCou¡
 < 0 || channelCount > 16) {

7006 
	`°bi__ªwöd
–
s
 );

7009 (Ë
	`°bi__gë32be
(
s
);

7010 (Ë
	`°bi__gë32be
(
s
);

7011 
dïth
 = 
	`°bi__gë16be
(
s
);

7012 i‡(
dïth
 != 16) {

7013 
	`°bi__ªwöd
–
s
 );

7017 
	}
}

7020 #i‚de‡
STBI_NO_PIC


7021 
	$°bi__pic_öfo
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
)

7023 
a˘_comp
=0,
num_∑ckës
=0,
chaöed
,
dummy
;

7024 
°bi__pic_∑ckë
 
∑ckës
[10];

7026 i‡(!
x
Ëx = &
dummy
;

7027 i‡(!
y
Ëy = &
dummy
;

7028 i‡(!
comp
Ëcom∞&
dummy
;

7030 i‡(!
	`°bi__pic_is4
(
s
,"\x53\x80\xF6\x34")) {

7031 
	`°bi__ªwöd
(
s
);

7035 
	`°bi__skù
(
s
, 88);

7037 *
x
 = 
	`°bi__gë16be
(
s
);

7038 *
y
 = 
	`°bi__gë16be
(
s
);

7039 i‡(
	`°bi__©_eof
(
s
)) {

7040 
	`°bi__ªwöd
–
s
);

7043 i‡–(*
x
Ë!0 && (1 << 28Ë/ (*xË< (*
y
)) {

7044 
	`°bi__ªwöd
–
s
 );

7048 
	`°bi__skù
(
s
, 8);

7051 
°bi__pic_∑ckë
 *
∑ckë
;

7053 i‡(
num_∑ckës
==(
∑ckës
)/(packets[0]))

7056 
∑ckë
 = &
∑ckës
[
num_∑ckës
++];

7057 
chaöed
 = 
	`°bi__gë8
(
s
);

7058 
∑ckë
->
size
 = 
	`°bi__gë8
(
s
);

7059 
∑ckë
->
ty≥
 = 
	`°bi__gë8
(
s
);

7060 
∑ckë
->
ch™√l
 = 
	`°bi__gë8
(
s
);

7061 
a˘_comp
 |
∑ckë
->
ch™√l
;

7063 i‡(
	`°bi__©_eof
(
s
)) {

7064 
	`°bi__ªwöd
–
s
 );

7067 i‡(
∑ckë
->
size
 != 8) {

7068 
	`°bi__ªwöd
–
s
 );

7071 } 
chaöed
);

7073 *
comp
 = (
a˘_comp
 & 0x10 ? 4 : 3);

7076 
	}
}

7091 #i‚de‡
STBI_NO_PNM


7093 
	$°bi__≤m_ã°
(
°bi__c⁄ãxt
 *
s
)

7095 
p
, 
t
;

7096 
p
 = (Ë
	`°bi__gë8
(
s
);

7097 
t
 = (Ë
	`°bi__gë8
(
s
);

7098 i‡(
p
 !'P' || (
t
 != '5' &&Å != '6')) {

7099 
	`°bi__ªwöd
–
s
 );

7103 
	}
}

7105 *
	$°bi__≤m_lﬂd
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
, 
ªq_comp
, 
°bi__ªsu…_öfo
 *
ri
)

7107 
°bi_uc
 *
out
;

7108 
	`STBI_NOTUSED
(
ri
);

7110 i‡(!
	`°bi__≤m_öfo
(
s
, (*)&s->
img_x
, (*)&s->
img_y
, (*)&s->
img_n
))

7113 *
x
 = 
s
->
img_x
;

7114 *
y
 = 
s
->
img_y
;

7115 i‡(
comp
Ë*com∞
s
->
img_n
;

7117 i‡(!
	`°bi__mad3sizes_vÆid
(
s
->
img_n
, s->
img_x
, s->
img_y
, 0))

7118  
	`°bi__îΩuc
("tooÜarge", "PNMÅooÜarge");

7120 
out
 = (
°bi_uc
 *Ë
	`°bi__mÆloc_mad3
(
s
->
img_n
, s->
img_x
, s->
img_y
, 0);

7121 i‡(!
out
Ë 
	`°bi__îΩuc
("outofmem", "Out of memory");

7122 
	`°bi__gën
(
s
, 
out
, s->
img_n
 * s->
img_x
 * s->
img_y
);

7124 i‡(
ªq_comp
 &&Ñeq_com∞!
s
->
img_n
) {

7125 
out
 = 
	`°bi__c⁄vît_f‹m©
(out, 
s
->
img_n
, 
ªq_comp
, s->
img_x
, s->
img_y
);

7126 i‡(
out
 =
NULL
)  out;

7128  
out
;

7129 
	}
}

7131 
	$°bi__≤m_is•a˚
(
c
)

7133  
c
 == ' ' || c == '\t' || c == '\n' || c == '\v' || c == '\f' || c == '\r';

7134 
	}
}

7136 
	$°bi__≤m_skù_whôe•a˚
(
°bi__c⁄ãxt
 *
s
, *
c
)

7139 !
	`°bi__©_eof
(
s
Ë&& 
	`°bi__≤m_is•a˚
(*
c
))

7140 *
c
 = (Ë
	`°bi__gë8
(
s
);

7142 i‡(
	`°bi__©_eof
(
s
Ë|| *
c
 != '#')

7145 !
	`°bi__©_eof
(
s
Ë&& *
c
 != '\n' && *c != '\r' )

7146 *
c
 = (Ë
	`°bi__gë8
(
s
);

7148 
	}
}

7150 
	$°bi__≤m_isdigô
(
c
)

7152  
c
 >= '0' && c <= '9';

7153 
	}
}

7155 
	$°bi__≤m_gëöãgî
(
°bi__c⁄ãxt
 *
s
, *
c
)

7157 
vÆue
 = 0;

7159 !
	`°bi__©_eof
(
s
Ë&& 
	`°bi__≤m_isdigô
(*
c
)) {

7160 
vÆue
 = vÆue*10 + (*
c
 - '0');

7161 *
c
 = (Ë
	`°bi__gë8
(
s
);

7164  
vÆue
;

7165 
	}
}

7167 
	$°bi__≤m_öfo
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
)

7169 
maxv
, 
dummy
;

7170 
c
, 
p
, 
t
;

7172 i‡(!
x
Ëx = &
dummy
;

7173 i‡(!
y
Ëy = &
dummy
;

7174 i‡(!
comp
Ëcom∞&
dummy
;

7176 
	`°bi__ªwöd
(
s
);

7179 
p
 = (Ë
	`°bi__gë8
(
s
);

7180 
t
 = (Ë
	`°bi__gë8
(
s
);

7181 i‡(
p
 !'P' || (
t
 != '5' &&Å != '6')) {

7182 
	`°bi__ªwöd
(
s
);

7186 *
comp
 = (
t
 == '6') ? 3 : 1;

7188 
c
 = (Ë
	`°bi__gë8
(
s
);

7189 
	`°bi__≤m_skù_whôe•a˚
(
s
, &
c
);

7191 *
x
 = 
	`°bi__≤m_gëöãgî
(
s
, &
c
);

7192 
	`°bi__≤m_skù_whôe•a˚
(
s
, &
c
);

7194 *
y
 = 
	`°bi__≤m_gëöãgî
(
s
, &
c
);

7195 
	`°bi__≤m_skù_whôe•a˚
(
s
, &
c
);

7197 
maxv
 = 
	`°bi__≤m_gëöãgî
(
s
, &
c
);

7199 i‡(
maxv
 > 255)

7200  
	`°bi__îr
("max value > 255", "PPM imageÇot 8-bit");

7203 
	}
}

7206 
	$°bi__öfo_maö
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
)

7208 #i‚de‡
STBI_NO_JPEG


7209 i‡(
	`°bi__j≥g_öfo
(
s
, 
x
, 
y
, 
comp
))  1;

7212 #i‚de‡
STBI_NO_PNG


7213 i‡(
	`°bi__≤g_öfo
(
s
, 
x
, 
y
, 
comp
))  1;

7216 #i‚de‡
STBI_NO_GIF


7217 i‡(
	`°bi__gif_öfo
(
s
, 
x
, 
y
, 
comp
))  1;

7220 #i‚de‡
STBI_NO_BMP


7221 i‡(
	`°bi__bmp_öfo
(
s
, 
x
, 
y
, 
comp
))  1;

7224 #i‚de‡
STBI_NO_PSD


7225 i‡(
	`°bi__psd_öfo
(
s
, 
x
, 
y
, 
comp
))  1;

7228 #i‚de‡
STBI_NO_PIC


7229 i‡(
	`°bi__pic_öfo
(
s
, 
x
, 
y
, 
comp
))  1;

7232 #i‚de‡
STBI_NO_PNM


7233 i‡(
	`°bi__≤m_öfo
(
s
, 
x
, 
y
, 
comp
))  1;

7236 #i‚de‡
STBI_NO_HDR


7237 i‡(
	`°bi__hdr_öfo
(
s
, 
x
, 
y
, 
comp
))  1;

7241 #i‚de‡
STBI_NO_TGA


7242 i‡(
	`°bi__tga_öfo
(
s
, 
x
, 
y
, 
comp
))

7245  
	`°bi__îr
("unknown imageÅype", "ImageÇot ofány knownÅype, or corrupt");

7246 
	}
}

7248 
	$°bi__is_16_maö
(
°bi__c⁄ãxt
 *
s
)

7250 #i‚de‡
STBI_NO_PNG


7251 i‡(
	`°bi__≤g_is16
(
s
))  1;

7254 #i‚de‡
STBI_NO_PSD


7255 i‡(
	`°bi__psd_is16
(
s
))  1;

7259 
	}
}

7261 #i‚de‡
STBI_NO_STDIO


7262 
STBIDEF
 
	$°bi_öfo
(c⁄° *
fûíame
, *
x
, *
y
, *
comp
)

7264 
FILE
 *
f
 = 
	`°bi__f›í
(
fûíame
, "rb");

7265 
ªsu…
;

7266 i‡(!
f
Ë 
	`°bi__îr
("can't fopen", "UnableÅo open file");

7267 
ªsu…
 = 
	`°bi_öfo_‰om_fûe
(
f
, 
x
, 
y
, 
comp
);

7268 
	`f˛o£
(
f
);

7269  
ªsu…
;

7270 
	}
}

7272 
STBIDEF
 
	$°bi_öfo_‰om_fûe
(
FILE
 *
f
, *
x
, *
y
, *
comp
)

7274 
r
;

7275 
°bi__c⁄ãxt
 
s
;

7276 
pos
 = 
	`·ñl
(
f
);

7277 
	`°bi__°¨t_fûe
(&
s
, 
f
);

7278 
r
 = 
	`°bi__öfo_maö
(&
s
,
x
,
y
,
comp
);

7279 
	`f£ek
(
f
,
pos
,
SEEK_SET
);

7280  
r
;

7281 
	}
}

7283 
STBIDEF
 
	$°bi_is_16_bô
(c⁄° *
fûíame
)

7285 
FILE
 *
f
 = 
	`°bi__f›í
(
fûíame
, "rb");

7286 
ªsu…
;

7287 i‡(!
f
Ë 
	`°bi__îr
("can't fopen", "UnableÅo open file");

7288 
ªsu…
 = 
	`°bi_is_16_bô_‰om_fûe
(
f
);

7289 
	`f˛o£
(
f
);

7290  
ªsu…
;

7291 
	}
}

7293 
STBIDEF
 
	$°bi_is_16_bô_‰om_fûe
(
FILE
 *
f
)

7295 
r
;

7296 
°bi__c⁄ãxt
 
s
;

7297 
pos
 = 
	`·ñl
(
f
);

7298 
	`°bi__°¨t_fûe
(&
s
, 
f
);

7299 
r
 = 
	`°bi__is_16_maö
(&
s
);

7300 
	`f£ek
(
f
,
pos
,
SEEK_SET
);

7301  
r
;

7302 
	}
}

7305 
STBIDEF
 
	$°bi_öfo_‰om_mem‹y
(
°bi_uc
 c⁄° *
buf„r
, 
Àn
, *
x
, *
y
, *
comp
)

7307 
°bi__c⁄ãxt
 
s
;

7308 
	`°bi__°¨t_mem
(&
s
,
buf„r
,
Àn
);

7309  
	`°bi__öfo_maö
(&
s
,
x
,
y
,
comp
);

7310 
	}
}

7312 
STBIDEF
 
	$°bi_öfo_‰om_ˇŒbacks
(
°bi_io_ˇŒbacks
 c⁄° *
c
, *
u£r
, *
x
, *
y
, *
comp
)

7314 
°bi__c⁄ãxt
 
s
;

7315 
	`°bi__°¨t_ˇŒbacks
(&
s
, (
°bi_io_ˇŒbacks
 *Ë
c
, 
u£r
);

7316  
	`°bi__öfo_maö
(&
s
,
x
,
y
,
comp
);

7317 
	}
}

7319 
STBIDEF
 
	$°bi_is_16_bô_‰om_mem‹y
(
°bi_uc
 c⁄° *
buf„r
, 
Àn
)

7321 
°bi__c⁄ãxt
 
s
;

7322 
	`°bi__°¨t_mem
(&
s
,
buf„r
,
Àn
);

7323  
	`°bi__is_16_maö
(&
s
);

7324 
	}
}

7326 
STBIDEF
 
	$°bi_is_16_bô_‰om_ˇŒbacks
(
°bi_io_ˇŒbacks
 c⁄° *
c
, *
u£r
)

7328 
°bi__c⁄ãxt
 
s
;

7329 
	`°bi__°¨t_ˇŒbacks
(&
s
, (
°bi_io_ˇŒbacks
 *Ë
c
, 
u£r
);

7330  
	`°bi__is_16_maö
(&
s
);

7331 
	}
}

	@C:\Users\leoou\OneDrive\Desktop\resources\vanilla.cpp

1 
	~<limôs.h
>

3 
	#_USE_MATH_DEFINES


	)

4 
	~<m©h.h
>

6 
	~"v™ûœ.h
"

8 
	gNamed
::
	$Named
(
°d
::
°rög
 
«meTag
)

10 
«me
 = 
«meTag
;

11 
	}
}

13 
	g°d
::
°rög
 
Named
::
	$gëName
() const

15  
«me
;

16 
	}
}

18 
	gIDed
::
	$IDed
(
ID
)

20 
id
 = 
ID
;

21 
	}
}

23 
	gIDed
::
	$gëID
()

25  
id
;

26 
	}
}

28 
	gNumbîM™agî
::
	$NumbîM™agî
()

31 
	}
}

32 
NumbîM™agî
::
	$addNumbî
(
numbî
)

34 
size
 = 
numbîs
.
	`size
();

35 
i
 = 0; i < 
size
; i ++)

37 i‡(
numbî
 <
numbîs
[
i
])

39 
numbîs
.
	`ö£π
“umbîs.
	`begö
(Ë+ 
i
,
numbî
);

43 
numbîs
.
	`push_back
(
numbî
);

44 
	}
}

45 
	gNumbîM™agî
::
	$födNumbî
(
code
)

47 
lowî
 = 0;

48 
highî
 = 
numbîs
.
	`size
();

49 
ödex
 = -1;

50 i‡(
highî
 != 0)

52 
ödex
 = (
lowî
+
highî
)/2;

53 
numbîs
[
ödex
] !
code
)

55 
cuºít
 = 
numbîs
[
ödex
];

56 i‡(
cuºít
 < 
code
)

58 
lowî
 = 
ödex
;

62 
highî
 = 
ödex
;

64 
ödex
 = (
lowî
+
highî
)/2;

65 i‡(
cuºít
 =
numbîs
[
ödex
])

71  
ödex
;

73 
	}
}

74 
	gNumbîM™agî
::
	$ªmoveNumbî
(
numbî
)

76 
ödex
 = 
	`födNumbî
(
numbî
);

77 i‡(
ödex
 != -1)

79 
numbîs
.
	`îa£
“umbîs.
	`begö
(Ë+ 
ödex
);

81 
	}
}

82 
	gNumbîM™agî
::~
	$NumbîM™agî
()

84 
numbîs
.
	`˛ór
();

85 
	}
}

86 
Re˘
 
	gPﬁyg⁄
::
	$gëBoundögRe˘
() const

88 
Re˘
 
r
 = {
möX
,
möY
, 
maxX
 - möX, 
maxY
 - minY};

90  
r
;

91 
	}
}

92 
boﬁ
 
	$ª˘I¡î£˘WôhöR™ge
(c⁄° 
Re˘
& 
r1
, 
di°
, c⁄° Re˘& 
r2
)

94  
	`Re˘I¡î£˘
({
r1
.
x
 - 
di°
,Ñ1.
y
 - di°,Ñ1.
w
 + 2*di°,Ñ1.
h
 + 2*di°}, 
r2
);

95 
	}
}

96 
boﬁ
 
	$ª˘I¡î£˘WôhöR™ge
(
x1
, 
y1
, 
w1
, 
h1
, 
di°
, 
x2
, 
y2
, 
w2
, 
h2
)

98  
	`ª˘I¡î£˘WôhöR™ge
({
x1
,
y1
,
w1
,
h1
},
di°
,{
x2
,
y2
,
w2
,
h2
});

99 
	}
}

100 
	$¥ötPoöt
(c⁄° 
Poöt
& 
p
)

102 
°d
::
cout
 << 
p
.
x
 << " " <<Ö.
y
 << std::
ídl
;

103 
	}
}

105 
	$¥ötRe˘
(c⁄° 
Re˘
& 
r
)

107 
°d
::
cout
 << 
r
.
x
 << " " <<Ñ.
y
 << " " <<Ñ.
w
 << " " <<Ñ.
h
 << std::
ídl
;

108 
	}
}

109 
boﬁ
 
	$PoötInRe˘
(c⁄° 
Poöt
& 
poöt
, c⁄° 
Re˘
& 
ª˘
)

111  ((
poöt
.
x
 >
ª˘
.x &&Öoöt.x <ª˘.x +Ñe˘.
w
Ë&& (poöt.
y
 >ª˘.y &&Öoöt.y <ª˘.y +Ñe˘.
h
));

112 
	}
}

113 
boﬁ
 
	$LöeAndLöeI¡î£˘
(c⁄° 
Poöt
& 
a
, c⁄° Poöt& 
b
, c⁄° Poöt& 
c
, c⁄° Poöt& 
d
)

115 
Poöt
 
	`öãr£˘
 (0,0);

116 
boﬁ
 
vÆue
 = 
Ál£
;

117 i‡(
a
.
x
 =
b
.x)

119 
öãr£˘
.
x
 = 
a
.x;

120 
¶›e
 = (
c
.
y
 - 
d
.y)/(c.
x
 - d.x);

121 
öãr£˘
.
y
 = 
¶›e
*
a
.
x
 + 
c
.y - slope*c.x;

123 i‡(
c
.
x
 =
d
.x)

125 
öãr£˘
.
x
 = 
c
.x;

126 
¶›e
 = (
a
.
y
 - 
b
.y)/◊.
x
 - b.x);

127 
öãr£˘
.
y
 = 
¶›e
*
c
.
x
 + 
a
.y - slope*a.x;

131 
¶›e1
 = (
a
.
y
 - 
b
.y)/◊.
x
 - b.x);

132 
¶›e2
 = (
c
.
y
 - 
d
.y)/(c.
x
 - d.x);

133 
˚±1
 = 
a
.
y
 - 
¶›e1
*a.
x
;

134 
˚±2
 = 
c
.
y
 - 
¶›e2
*c.
x
;

136 i‡(
¶›e1
 =
¶›e2
 )

138 i‡(
˚±1
 =
˚±2
)

140 
öãr£˘
.
x
 = 
°d
::
	`max
(°d::
	`mö
(
a
.x,
b
.x),°d::mö(
c
.x,
d
.x));

141 
öãr£˘
.
y
 = 
°d
::
	`max
(°d::
	`mö
(
a
.y,
b
.y),°d::mö(
c
.y,
d
.y));

146 
öãr£˘
.
x
 = (
˚±1
 - 
˚±2
)/(
¶›e2
 - 
¶›e1
);

147 
öãr£˘
.
y
 = 
¶›e1
*öãr£˘.
x
 + 
˚±1
;

151 
vÆue
 = ( (
öãr£˘
.
x
 >
°d
::
	`mö
(
a
.x,
b
.xË&& i¡î£˘.x <°d::
	`max
◊.x,b.x)Ë&& (öãr£˘.x >°d::mö(
c
.x,
d
.x) && intersect.x <= std::max(c.x,d.x)) &&

152 (
öãr£˘
.
y
 >
°d
::
	`mö
(
a
.y,
b
.yË&& i¡î£˘.y <°d::
	`max
◊.y,b.y)Ë&& (öãr£˘.y >°d::mö(
c
.y,
d
.y) && intersect.y <= std::max(c.y,d.y)));

157  
vÆue
;

158 
	}
}

160 
boﬁ
 
	$LöeAndLöeI¡î£˘
(c⁄° 
Löe
& 
l1
, c⁄° Löe& 
l2
)

162  
	`LöeAndLöeI¡î£˘
(
l1
.
a
,l1.
b
, 
l2
.a,l2.b);

163 
	}
}

165 
boﬁ
 
	$LöeAndRe˘I¡î£˘
(c⁄° 
Re˘
& 
r
, 
x1
, 
y1
, 
x2
, 
y2
 )

167 
Poöt
 
a
 = {
x1
,
y1
};

168 
Poöt
 
b
 = {
x2
,
y2
};

169 
Poöt
 
t›Le·
 = {
r
.
x
,r.
y
};

170 
Poöt
 
t›Right
 = {
r
.
x
 +Ñ.
w
,Ñ.
y
};

171 
Poöt
 
bŸtomLe·
 = {
r
.
x
,Ñ.
y
 +Ñ.
h
};

172 
Poöt
 
bŸtomRight
 = {
r
.
x
 +Ñ.
w
,Ñ.
y
 +Ñ.
h
};

173 
boﬁ
 
vÆue
 = 
Ál£
;

174 i‡(
	`PoötInRe˘
(
a
, 
r
))

176 
vÆue
 = 
åue
;

178 i‡(
	`PoötInRe˘
(
b
,
r
))

180 
vÆue
 = 
åue
;

182 i‡–
	`LöeAndLöeI¡î£˘
(
t›Le·
,
t›Right
,
a
, 
b
) ||

183 
	`LöeAndLöeI¡î£˘
(
t›Right
, 
bŸtomRight
, 
a
, 
b
) ||

184 
	`LöeAndLöeI¡î£˘
(
bŸtomRight
, 
bŸtomLe·
, 
a
, 
b
) ||

185 
	`LöeAndLöeI¡î£˘
(
bŸtomLe·
, 
t›Le·
, 
a
,
b
) )

187 
vÆue
 = 
åue
;

191 
vÆue
 = 
Ál£
;

193  
vÆue
;

195 
	}
}

196 
boﬁ
 
	$Re˘I¡î£˘
(c⁄° 
Re˘
& 
r1
, c⁄° Re˘& 
r2
)

198 i‡(
r1
.
x
 <
r2
.x +Ñ2.
w
 &&Ñ1.x +Ñ1.w >r2.x &&Ñ1.
y
 <r2.y +Ñ2.
h
 &&Ñ1.y +Ñ1.h >=Ñ2.y)

200  
åue
;

202  
Ál£
;

204 
	}
}

206 
	$c⁄vîtTo1
(
numbî
)

208 i‡(
numbî
 == 0)

212  
numbî
/(
	`Ábs
(number));

213 
	}
}

215 
	$PoötDi°™˚
(c⁄° 
Poöt
& 
p1
, c⁄° Poöt& 
p2
)

217  
	`sqπ
(
	`pow
((
p1
.
x
 - 
p2
.x),2Ë+Öow’1.
y
 -Ö2.y,2));

218 
	}
}

220 
	$födI¡Lígth
(
x
)

222 i‡(
x
 / 10 == 0)

228  1 + 
	`födI¡Lígth
(
x
/10);

230 
	}
}

232 
	g°d
::
°rög
 
	$c⁄vît
(
öput
)

234 
°d
::
o°rög°ªam
 
os
;

235 
os
 << 
öput
;

236  
os
.
	`°r
();

237 
	}
}

239 
	g°d
::
°rög
 
	$c⁄vît
(
öput
)

241 
°d
::
o°rög°ªam
 
os
;

242 
os
 << 
öput
;

243  
os
.
	`°r
();

244 
	}
}

246 
	$round
(
decimÆ
, 
n
)

248 
ãn
 = 
	`pow
(10,
n
);

249  (()
	`Êo‹
(
decimÆ
*
ãn
))/ten;

250 
	}
}

252 
boﬁ
 
	$™gÀR™ge
(
ød1
, 
ød2
, 
ønge
)

254 
˛am≥d
 =
	`ªmaödî
(
ød1
,2*
M_PI
);

255 
˛am≥dMax
 =
	`ªmaödî
(
ød2
 + 
ønge
,2*
M_PI
);

256 
˛am≥dMö
 = 
	`ªmaödî
(
ød2
 - 
ønge
,2*
M_PI
);

257 i‡(
˛am≥dMö
 > 
˛am≥dMax
)

259 
˛am≥dMax
 +2*
M_PI
;

260 
˛am≥d
 +2*
M_PI
*(clamped < 0);

262  
˛am≥d
 <
˛am≥dMax
 && cœm≥d >
˛am≥dMö
;

263 
	}
}

265 
	$øndomDecimÆ
(
∂a˚s
)

267 
powî
 = 
	`pow
(10, 
∂a˚s
);

268  
	`ønd
()%(
powî
)/(()power);

269 
	}
}

271 
	$c⁄vît
(
°d
::
°rög
 
öput
)

273 
i
 = 0; i < 
öput
.
	`Àngth
(); i ++)

275 
ascii
 = (
öput
[
i
]);

276 i‡((
ascii
 < 48 ||áscii > 57) &&áscii != 46 &&áscii != 45)

278 
°d
::
cout
 << "V™ûœ W¨nög: c⁄vîsi⁄ o‡" + 
öput
 << "wû»ªtu∫ 0 beˇu£ i≈uàc⁄èö†n⁄-numbîs." << std::
ídl
;

282 
j
;

283 
°d
::
i°rög°ªam
 
	`os
(
öput
);

284 
os
 >> 
j
;

285  
j
;

286 
	}
}

288 
	$ch¨Cou¡
(
°d
::
°rög
 
s
, 
c
)

290 
fö
 = 0;

291 
x
 = 0; x < 
s
.
	`Àngth
(); x++)

293 i‡(
s
[
x
] =
c
)

295 
fö
++;

298  
fö
;

299 
	}
}

300 
	$absMö
(
x
, 
y
)

302 i‡(
	`abs
(
x
Ë<abs(
y
))

304  
x
;

306  
y
;

307 
	}
}

308 
	$absMax
(
x
, 
y
)

310 i‡(
	`abs
(
x
Ë>abs(
y
))

312  
x
;

314  
y
;

315 
	}
}

317 
	gGødõ¡Numbî
::
	$Gødõ¡Numbî
(
a
,
b
, 
vñocôy
)

319 
	`lﬂd
(
a
,
b
,
vñocôy
);

320 
	}
}

321 
	gGødõ¡Numbî
::
	$lﬂd
(
a
,
b
, 
vñocôy
)

323 
	`£tS≥ed
(
vñocôy
);

324 
	`£tGﬂl
(
b
);

325 
	`£tVÆue
(
a
);

327 
	}
}

329 
	gGødõ¡Numbî
::
	$upd©e
()

331 
cuºít
 +
	`absMö
(
•ìd
*
	`c⁄vîtTo1
(
gﬂl
-current), (goal - current));

332  
cuºít
;

333 
	}
}

335 
	gGødõ¡Numbî
::
	$£tVÆue
(
d
)

337 
cuºít
 = 
d
;

338 
	}
}

340 
	gGødõ¡Numbî
::
	$£tGﬂl
(
d
)

342 
gﬂl
 = 
d
;

343 
	}
}

345 
	gGødõ¡Numbî
::
	$£tS≥ed
(
s
)

347 
•ìd
 = 
s
;

348 
	}
}

350 
	gGødõ¡Numbî
::
	$gëVÆue
()

352  
cuºít
;

353 
	}
}

355 
boﬁ
 
	gGødõ¡Numbî
::
	$©T¨gë
()

357  
cuºít
 =
gﬂl
;

358 
	}
}

360 
øndWôhG≠s
(c⁄° 
°d
::
ve˘‹
<°d::
∑ú
<,>>& 
ønges
)

362 
	gønge
 = 
ønd
()%
ønges
.
size
();

363 c⁄° 
	g°d
::
∑ú
<,>* 
	g∑ú
 = &
ønges
[
ønge
];

364  
ønd
()%(
	g∑ú
->
	g£c⁄d
-∑ú->
	gfú°
) +Öair->first;

367 
	g°d
::
°rög
* 
	$divideSåög
(
°d
::
°rög
 
öput
)

369 
öput
 +=" ";

370 
howBig
 = 
	`ch¨Cou¡
(
öput
, ' ') + charCount(input, '@');

371 
°d
::
°rög
 *
¨r
 = 
√w
 std::°rög[
howBig
];

372 
l
 = 0;

373 
°d
::
°rög
 
£g
 = "";

374 
v
 = 0; v< 
öput
.
	`Àngth
(); v++)

376 i‡((
öput
[
v
] == ' ' || input[v] == '@' )&& (input[v-1] != ' ' || input[v-1] != '@'))

378 
¨r
[
l
] = (
£g
);

379 
l
++;

380 
£g
 = "";

382 i‡(
öput
[
v
] != ' ')

383 
£g
+
öput
[
v
];

391  
¨r
;

392 
	}
}

394 
	$Á°Pröt
(
°d
::
°rög
 
°r
)

396 
size
 = 
°r
.
	`size
();

397 
i
 = 0; i < 
size
; i ++)

399 
	`putch¨
(
°r
[
i
]);

401 
	}
}

	@C:\Users\leoou\OneDrive\Desktop\resources\vanilla.h

1 #i‚de‡
VANILLA_H_INCLUDED


2 
	#VANILLA_H_INCLUDED


	)

4 
	~<io°ªam
>

5 
	~<tu∂e
>

6 
	~<m©h.h
>

7 
	~<s°ªam
>

8 
	~<ve˘‹
>

9 
	~<¨øy
>

10 
	~<°dlib.h
>

11 
	~<mem‹y
>

12 
	~<°ack
>

13 
	~<un‹dîed_m≠
>

15 ˛as†
	cNamed


17 
	m°d
::
°rög
 
«me
 = "";

18 
	mpublic
:

19 
Named
(
°d
::
°rög
 
«meTag
);

20 
	m°d
::
°rög
 
	$gëName
() const;

23 ˛as†
	cIDed


25 
id
 = 0;

26 
public
:

27 
	`IDed
(
ID
);

28 
	`gëID
();

31 ˛as†
	cNumbîM™agî


33 
¥Ÿe˘ed
:

35 
°d
::
ve˘‹
<> 
numbîs
;

36 
public
:

37 
	`NumbîM™agî
();

38 
vútuÆ
 
	`addNumbî
(
numbî
);

39 
vútuÆ
 
	`födNumbî
(
code
);

40 
vútuÆ
 
	`ªmoveNumbî
(
numbî
);

41 ~
	`NumbîM™agî
();

46 ˛as†
	cPoöt


48 
public
:

49 
x
,
y
;

50 
	$Poöt
(
xCo‹d
 = 0, 
yCo‹d
 = 0)

52 
x
 = 
xCo‹d
;

53 
y
 = 
yCo‹d
;

55 
	}
};

57 ˛as†
	cLöe


60 
	mpublic
:

61 
Poöt
 
a
,
	mb
 ;

62 
	mødüns
;

63 
	$Löe
(c⁄° 
Poöt
& 
x
,c⁄° Poöt&
y
)

65 
a
 =
x
;

66 
b
 = 
y
;

67 
ødüns
 = 
	`©™2
((
a
.
y
 - 
b
.y),◊.
x
 - b.x));

69 
	}
};

72 
¥ötPoöt
(c⁄° 
Poöt
& 
p
);

73 ˛as†
	cSh≠e


75 
Poöt
 
	m˚¡î
 = {0,0};

76 
	g¥Ÿe˘ed
:

77 
vútuÆ
 
	$£tCíãr
(
x
, 
y
)

79 
˚¡î
 = {
x
,
y
};

80 
	}
}

81 
	gpublic
:

82 
	$Sh≠e
()

85 
	}
}

86 c⁄° 
Poöt
& 
	$gëCíãr
() const

88  
˚¡î
;

89 
	}
}

90 
vútuÆ
 
boﬁ
 
	$öãr£˘s
(
Sh≠e
& 
sh≠e
)

92  
Ál£
;

93 
	}
}

94 
vútuÆ
 
boﬁ
 
	$löeI¡î£˘s
(
Löe
& 
löe
)

96  
Ál£
;

97 
	}
}

98 
vútuÆ
 
boﬁ
 
	$poötIn
(
Poöt
& 
p
)

100  
Ál£
;

101 
	}
}

104 
boﬁ
 
LöeAndLöeI¡î£˘
(c⁄° 
Löe
& 
l1
, c⁄° Löe& 
l2
);

105 
˛ass
 
	gRe˘
;

106 ˛as†
	cPﬁyg⁄
 : 
public
 
Sh≠e


108 
¥Ÿe˘ed
:

109 
°d
::
ve˘‹
 <
Löe
> 
löes
;

110 
	mmöX
,
	mmöY
,
	mmaxX
,
	mmaxY
;

111 
	mpublic
:

112 
Pﬁyg⁄
(
°d
::
öôülizî_li°
<
Poöt
> 
li°
)

114 
lﬂd
(
li°
);

117 
	$Pﬁyg⁄
()

120 
	}
}

121 
lﬂd
(
°d
::
öôülizî_li°
<
Poöt
> 
li°
)

123 
size
 = 
li°
.size();

124 
	gxSum
 = 0, 
	gySum
 = 0;

125 
Poöt
 
	gfú°
 = (*
li°
.
begö
());

126 
	gmöX
 = 
fú°
.
x
;

127 
	gmaxX
 = 
fú°
.
x
;

128 
	gmöY
 = 
fú°
.
y
;

129 
	gmaxY
 = 
fú°
.
y
;

130 
Poöt
 
	g¥evPoöt
;

131 
	gcou¡
 = 0;

132 
	g°d
::
öôülizî_li°
<
Poöt
>::
ôî©‹
 
i
 = 
li°
.
begö
(); 
	gi
 !li°.
íd
(); i ++)

134 
Poöt
 
	gcuºít
 = (*
i
);

135 
	gxSum
 +
cuºít
.
x
;

136 
	gySum
 +
cuºít
.
y
;

137 i‡(
	gcuºít
.
	gx
 < 
	gmöX
)

139 
	gmöX
 = 
cuºít
.
x
;

141 i‡(
	gcuºít
.
	gx
 > 
	gmaxX
)

143 
	gmaxX
 = 
cuºít
.
x
;

145 i‡(
	gcuºít
.
	gy
 < 
	gmöY
)

147 
	gmöY
 = 
cuºít
.
y
;

149 i‡(
	gcuºít
.
	gy
 > 
	gmaxY
)

151 
	gmaxY
 = 
cuºít
.
y
;

154 i‡(
	gcou¡
 > 0)

156 
	glöes
.
push_back
(
Löe
(
¥evPoöt
,
cuºít
));

158 
	gcou¡
 ++;

159 
	g¥evPoöt
 = (*
i
);

164 
£tCíãr
(
xSum
/
size
, 
ySum
/size);

167 
	$gëMöX
() const

169  
möX
;

170 
	}
}

171 
	$gëMaxX
() const

173  
maxX
;

174 
	}
}

175 
	$gëMöY
() const

177  
möY
;

178 
	}
}

179 
	$gëMaxY
() const

181  
maxY
;

182 
	}
}

183 
vútuÆ
 
Re˘
 
	$gëBoundögRe˘
() const;

184 
vútuÆ
 c⁄° 
Löe
* 
	$öãr£˘s
(c⁄° 
Pﬁyg⁄
& 
Ÿhî
) const

186 c⁄° 
°d
::
ve˘‹
<
Löe
> 
ŸhîVec
 = 
Ÿhî
.
	`gëLöes
();

187 
ŸhîVecSize
 = 
ŸhîVec
.
	`size
();

189 
i
 = 0; i < 
ŸhîVecSize
; i ++)

190 { c⁄° 
Löe
* 
vÆue
 = 
	`löeI¡î£˘s
(
ŸhîVec
[
i
]);

191 i‡(
vÆue
)

193  
vÆue
;

196  
nuŒ±r
;

197 
	}
}

198 
vútuÆ
 c⁄° 
Löe
* 
	$löeI¡î£˘s
(c⁄° 
Löe
& 
löe
) const

200 
size
 = 
löes
.
	`size
();

201 
j
 = 0; j < 
size
; j ++)

203 i‡(
	`LöeAndLöeI¡î£˘
(
löes
[
j
],
löe
))

205  &
löe
;

208  
nuŒ±r
;

209 
	}
}

210 
vútuÆ
 
	$ö¸emít
(
xDi°™˚
, 
yDi°™˚
)

212 
size
 = 
löes
.
	`size
();

213 
i
 = 0; i < 
size
; i ++)

215 
löes
[
i
].
a
.
x
 +
xDi°™˚
;

216 
löes
[
i
].
a
.
y
 +
yDi°™˚
;

217 
löes
[
i
].
b
.
x
 +
xDi°™˚
;

218 
löes
[
i
].
b
.
y
 +
yDi°™˚
;

220 
möX
 +
xDi°™˚
;

221 
maxX
 +
xDi°™˚
;

222 
möY
 +
yDi°™˚
;

223 
maxY
 +
yDi°™˚
;

224 
	}
}

225 c⁄° 
	g°d
::
ve˘‹
<
Löe
>& 
	$gëLöes
() const

227  
löes
;

228 
	}
}

232 ˛as†
	cRe˘
 : 
public
 
Pﬁyg⁄


234 
public
:

235 
x
,
	my
,
	mw
,
	mh
;

236 
	$Re˘
(
xCo‹d
 = 0, 
yCo‹d
 = 0, 
width
 = 0, 
height
 = 0)

238 
x
 = 
xCo‹d
;

239 
y
 = 
yCo‹d
;

240 
w
 = 
width
;

241 
h
 = 
height
;

243 
	`lﬂd
({
	`Poöt
(
xCo‹d
,
yCo‹d
), Poöt(xCo‹d + 
width
,yCo‹d), Poöt(xCo‹d + width, yCo‹d + 
height
),Point(xCoord, yCoord + height),Point(xCoord, yCoord)});

246 
Re˘
 
	$gëBoundögRe˘
()const

249  
	`Re˘
(*
this
);

250 
	}
}

251 
	$ö¸emít
(
xDi°™˚
, 
yDi°™˚
)

253 
x
 +
xDi°™˚
;

254 
y
 +
yDi°™˚
;

255 
Pﬁyg⁄
::
	`ö¸emít
(
xDi°™˚
, 
yDi°™˚
);

256 
	}
}

258 
usög
 
	gPﬁyg⁄
::
öãr£˘s
;

259 
boﬁ
 
	$öãr£˘s
(
Re˘
& 
r2
)

261 i‡(
this
->
x
 <
r2
.x +Ñ2.
w
 &&Åhis->x +Åhis->w >r2.x &&Åhis->
y
 <r2.y +Ñ2.
h
 &&Åhis->y +Åhis->h >=Ñ2.y)

263  
åue
;

265  
Ál£
;

266 
	}
}

270 
¥ötRe˘
(c⁄° 
Re˘
& 
r
);

271 
boﬁ
 
PoötInRe˘
(c⁄° 
Poöt
& 
poöt
, c⁄° 
Re˘
& 
ª˘
);

273 
boﬁ
 
LöeAndLöeI¡î£˘
(c⁄° 
Poöt
& 
a
, c⁄° Poöt& 
b
, c⁄° Poöt& 
c
, c⁄° Poöt& 
d
);

275 
boﬁ
 
LöeAndLöeI¡î£˘
(c⁄° 
Löe
& 
l1
, c⁄° Löe& 
l2
);

277 
boﬁ
 
LöeAndRe˘I¡î£˘
(c⁄° 
Re˘
& 
r
, 
x1
, 
y1
, 
x2
, 
y2
 );

279 
boﬁ
 
Re˘I¡î£˘
(c⁄° 
Re˘
& 
r1
, c⁄° Re˘& 
r2
);

281 
PoötDi°™˚
(c⁄° 
Poöt
& 
p1
, c⁄° Poöt& 
p2
);

283 
c⁄vîtTo1
(
numbî
);

285 ˛as†
	cGødõ¡Numbî


287 
	mgﬂl
 = 0;

288 
	mcuºít
 = 0;

289 
	m•ìd
 = 0;

290 
	mpublic
:

291 
Gødõ¡Numbî
(
a
 = 0, 
b
 = 0, 
vñocôy
= 1);

292 
lﬂd
 (
a
,
b
, 
vñocôy
);

293 
upd©e
();

294 
£tVÆue
(
d
);

295 
£tGﬂl
(
d
);

296 
£tS≥ed
(
s
);

297 
gëVÆue
();

298 
boﬁ
 
©T¨gë
();

302 
round
(
decimÆ
, 
n
);

303 
boﬁ
 
™gÀR™ge
(
ød1
, 
ød2
, 
ønge
);

304 
øndomDecimÆ
(
∂a˚s
);

305 
födI¡Lígth
(
x
);

306 
	g°d
::
°rög
 
c⁄vît
(
öput
);

308 
	g°d
::
°rög
 
c⁄vît
(
öput
);

310 
c⁄vît
(
°d
::
°rög
 
öput
);

312 
ch¨Cou¡
(
°d
::
°rög
 
s
, 
c
);

314 
	g°d
::
°rög
* 
divideSåög
(
°d
::°rög 
öput
);

315 
boﬁ
 
ª˘I¡î£˘WôhöR™ge
(c⁄° 
Re˘
& 
r1
, 
di°
,c⁄° Re˘& 
r2
);

316 
boﬁ
 
ª˘I¡î£˘WôhöR™ge
(
x1
, 
y1
, 
w1
, 
h1
, 
di°
, 
x2
, 
y2
, 
w2
, 
h2
);

318 
absMö
(
x
, 
y
);

319 
absMax
(
x
, 
y
);

321 
Á°Pröt
(
°d
::
°rög
 
°r
);

323 
	gãm∂©e
 <
ty≥«me
 
	gT
>

324 ˛as†
	cMöHóp


326 
	$boﬁ
(*
	tCom∑ªr
)(
	tT
& 
	tobj1
, T& 
	tobj2
);

327 
	sMöHópNode


329 
°d
::
∑ú
<
T
,> 
d©a
;

331 
°d
::
ve˘‹
<
MöHópNode
*> 
nodes
;

332 
boﬁ
 
	`vÆid
(
ödex
);

333 
	`gëP¨ít
(
ödex
);

334 
	`gëLe·Chûd
(
ödex
);

335 
	`gëRightChûd
(
ödex
);

336 
	`sw≠
(
i1
, 
i2
);

337 
	`si·
(
ödex
);

338 
public
:

339 
	`MöHóp
();

340 ~
	`MöHóp
();

341 
	`add
(
T
 
ôem
, 
vÆ
);

342 
	`föd
(
T
 
ôem
, 
vÆ
, 
Com∑ªr
 
comp
 = 
nuŒ±r
);

343 
	`föd
(
T
 
ôem
);

344 
	`upd©e
(
T
 
ôem
, 
ﬁdVÆ
, 
vÆ
, 
Com∑ªr
 
comp
 = 
nuŒ±r
);

345 
T
 
	`≥ak
();

346 
	`p›
();

347 
	`¥öt
();

348 
	`size
();

349 
	}
};

351 
	gãm∂©e
 <
ty≥«me
 
	gT
>

352 
boﬁ
 
	gMöHóp
<
	gT
>::
	$vÆid
(
ödex
)

354  
ödex
 >0 && index < 
nodes
.
	`size
();

355 
	}
}

357 
	gãm∂©e
 <
ty≥«me
 
	gT
>

358 
	gMöHóp
<
	gT
>::
	$gëP¨ít
(
ödex
)

360  (
ödex
 - 1)/2;

361 
	}
}

363 
	gãm∂©e
 <
ty≥«me
 
	gT
>

364 
	gMöHóp
<
	gT
>::
	$gëLe·Chûd
(
ödex
)

366  2*
ödex
 + 1;

367 
	}
}

369 
	gãm∂©e
 <
ty≥«me
 
	gT
>

370 
	gMöHóp
<
	gT
>::
	$gëRightChûd
(
ödex
)

372  2*
ödex
 + 2;

373 
	}
}

375 
	gãm∂©e
 <
ty≥«me
 
	gT
>

376 
	gMöHóp
<
	gT
>::
	$sw≠
(
i1
, 
i2
)

378 
MöHópNode
* 
ãmp
 = 
nodes
[
i2
];

379 
nodes
[
i2
] =Çodes[
i1
];

380 
nodes
[
i1
] = 
ãmp
;

381 
	}
}

383 
	gãm∂©e
 <
ty≥«me
 
	gT
>

384 
	gMöHóp
<
	gT
>::
	$si·
(
ödex
)

386 
∑ª¡
 = 
	`gëP¨ít
(
ödex
);

387 
	`vÆid
(
∑ª¡
Ë&& 
nodes
[
ödex
]->
d©a
.
£c⁄d
 <Çodes[parent]->data.second)

389 
	`sw≠
(
ödex
, 
∑ª¡
);

390 
ödex
 = 
∑ª¡
;

391 
∑ª¡
 = 
	`gëP¨ít
(
ödex
);

394 
À·Chûd
 = 
	`gëLe·Chûd
(
ödex
);

395 
rightChûd
 = 
	`gëRightChûd
(
ödex
);

396 
	`vÆid
(
À·Chûd
))

398 
cuºít
 = 
nodes
[
ödex
]->
d©a
.
£c⁄d
;

399 
À·VÆ
 = 
nodes
[
À·Chûd
]->
d©a
.
£c⁄d
;

400 i‡(
	`vÆid
(
rightChûd
))

402 
rightVÆ
 = 
nodes
[
rightChûd
]->
d©a
.
£c⁄d
;

403 i‡(
cuºít
 > 
rightVÆ
 || cuºíà> 
À·VÆ
)

405 i‡(
rightVÆ
 > 
À·VÆ
)

407 
	`sw≠
(
ödex
, 
À·Chûd
);

408 
ödex
 = 
À·Chûd
;

412 
	`sw≠
(
ödex
, 
rightChûd
);

413 
ödex
 = 
rightChûd
;

423 i‡(
cuºít
 > 
À·VÆ
)

425 
	`sw≠
(
ödex
,
À·Chûd
);

429 
À·Chûd
 = 
	`gëLe·Chûd
(
ödex
);

430 
rightChûd
 = 
	`gëRightChûd
(
ödex
);

432 
	}
}

434 
	gãm∂©e
 <
ty≥«me
 
	gT
>

435 
	gMöHóp
<
	gT
>::
	$MöHóp
()

438 
	}
}

440 
ãm∂©e
 <
ty≥«me
 
T
>

441 
MöHóp
<
T
>::~
	$MöHóp
()

443 
size
 = 
nodes
.
	`size
();

444 i‡(
size
 > 0)

446 
i
 = 0; i < 
size
; ++i)

448 
dñëe
 
nodes
[
i
];

450 
nodes
.
	`˛ór
();

452 
	}
}

454 
	gãm∂©e
 <
ty≥«me
 
	gT
>

455 
	gMöHóp
<
	gT
>::
	$add
(
T
 
ôem
, 
vÆ
)

457 
nodes
.
	`push_back
(
√w
 
	`MöHópNode
({{
ôem
, 
vÆ
}}) );

458 
ödex
 = 
nodes
.
	`size
() - 1;

459 
∑ª¡
 = 
	`gëP¨ít
(
ödex
);

460 
nodes
[
∑ª¡
]->
d©a
.
£c⁄d
 > 
vÆ
 && 
	`vÆid
(
ödex
))

462 
	`sw≠
(
ödex
,
∑ª¡
);

463 
ödex
 = 
∑ª¡
;

464 
∑ª¡
 = 
	`gëP¨ít
(
ödex
);

467 
	}
}

469 
	gãm∂©e
 <
ty≥«me
 
	gT
>

470 
	gMöHóp
<
	gT
>::
	$föd
(
T
 
ôem
)

472 
size
 = 
nodes
.
	`size
();

473 
i
 = 0; i < 
size
; ++i)

475 i‡(
nodes
[
i
]->
d©a
.
fú°
 =
ôem
)

477  
i
;

481 
	}
}

483 
	gãm∂©e
 <
ty≥«me
 
	gT
>

484 
	gMöHóp
<
	gT
>::
	$föd
(
T
 
ôem
, 
vÆ
, 
Com∑ªr
 
equÆs
)

486 
ödex
 = 0;

487 
°d
::
°ack
<> 
dfs
;

488 
	`vÆid
(
ödex
Ë|| 
dfs
.
	`size
() != 0)

490 
cuºít
 = 
nodes
[
ödex
]->
d©a
.
£c⁄d
;

491 i‡(
cuºít
 !
vÆ
 || (!
equÆs
 && 
nodes
[
ödex
]->
d©a
.
fú°
 !
ôem
Ë|| (equÆ†&& !
	`equÆs
(nodes[index]->data.first,item)))

493 
À·Chûd
 = 
	`gëLe·Chûd
(
ödex
);

494 i‡(
cuºít
 > 
vÆ
 || !
	`vÆid
(
À·Chûd
))

496 i‡(
dfs
.
	`size
() > 0)

498 
ödex
 = 
dfs
.
	`t›
();

499 
dfs
.
	`p›
();

509 
rightChûd
 = 
	`gëRightChûd
(
ödex
);

510 
ödex
 = 
À·Chûd
;

511 i‡(
	`vÆid
(
rightChûd
))

513 
dfs
.
	`push
(
rightChûd
);

519  
ödex
;

523 
	}
}

525 
	gãm∂©e
 <
ty≥«me
 
	gT
>

526 
	gMöHóp
<
	gT
>::
	$upd©e
(
T
 
ôem
, 
ﬁdVÆ
, 
vÆ
, 
Com∑ªr
 
equÆs
)

528 
ödex
 = 
	`föd
(
ôem
, 
ﬁdVÆ
,
equÆs
);

529 i‡(
ödex
 != -1)

531 
nodes
[
ödex
]->
d©a
.
£c⁄d
 = 
vÆ
;

532 
	`si·
(
ödex
);

536 
	`add
(
ôem
,
vÆ
);

538 
	}
}

540 
	gãm∂©e
 <
ty≥«me
 
	gT
>

541 
T
 
	gMöHóp
<
	gT
>::
	$≥ak
()

543 i‡(
nodes
.
	`size
() == 0)

545 
throw
 
°d
::
	`logic_îr‹
 ("Can'tÖeakátÉmpty MinHeap");

547  
nodes
[0]->
d©a
.
fú°
;

548 
	}
}

550 
	gãm∂©e
 <
ty≥«me
 
	gT
>

551 
	gMöHóp
<
	gT
>::
	$p›
()

553 
MöHópNode
* 
±r
 = 
nodes
[0];

554 
dñëe
 
±r
;

555 
	`sw≠
(
nodes
.
	`size
() - 1, 0);

556 
nodes
.
	`p›_back
();

557 
size
 = 
nodes
.
	`size
();

558 
	`si·
(0);

559 
	}
}

561 
	gãm∂©e
 <
ty≥«me
 
	gT
>

562 
	gMöHóp
<
	gT
>::
	$¥öt
()

564 
size
 = 
nodes
.
	`size
();

565 
°d
::
o°rög°ªam
 
°ªam
;

566 
°ªam
 << "[";

567 
i
 = 0; i < 
size
; ++i)

569 
°ªam
 << 
	`c⁄vît
(
nodes
[
i
]->
d©a
.
£c⁄d
);

570 i‡(
i
 < 
size
 - 1)

572 
°ªam
 << ",";

575 
°ªam
 <<"]\n";

576 
	`Á°Pröt
(
°ªam
.
	`°r
());

577 
	}
}

579 
	gãm∂©e
 <
ty≥«me
 
	gT
>

580 
	gMöHóp
<
	gT
>::
	$size
()

582  
nodes
.
	`size
();

583 
	}
}

585 
	gãm∂©e
 <
ty≥«me
 
	gT
>

586 ˛as†
	cGlobÆMou¡


589 
	m°d
::
sh¨ed_±r
<
T
> 
±r
;

590 
	mpublic
:

591 
°d
::
sh¨ed_±r
<
T
> 
	$gëSh¨edPå
()

593 i‡(!
±r
.
	`gë
())

595 
±r
.
	`ª£t
(
√w
 
T
);

597  
±r
;

599 
T
* 
	$gëPå
()

601  
	`gëSh¨edPå
().
	`gë
();

602 
	}
}

605 
	gãm∂©e
 <
ty≥«me
 
	gT
>

606 
	g°d
::
sh¨ed_±r
<
T
> 
GlobÆMou¡
<T>::
±r
;

608 
	gãm∂©e
 <
ty≥«me
 
	gT
>

609 ˛as†
	cReußbÀVe˘‹


614 
	mödex
 = 0;

615 
	m°d
::
ve˘‹
<
T
> 
vec
;

616 
	mpublic
:

617 
T
& 
›î©‹
[](
i
)

619  
vec
[
i
];

621 
push_back
(
T
 
t
, (*
ª∂a˚
)(TË
nuŒ±r
)

623 i‡(
ödex
 >
vec
.
	`size
())

625 
vec
.
	`push_back
(
t
);

629 i‡(
ª∂a˚
)

631 
	`ª∂a˚
(
vec
[
ödex
]);

633 i‡(
vec
[
ödex
] !
t
)

635 
vec
[
ödex
] = 
t
;

638 ++
ödex
;

639 
	}
}

640 
T
* 
	$gëAºay
()

642 i‡(
ödex
 > 0)

644  &
vec
[0];

646  
nuŒ±r
;

647 
	}
}

648 
	$size
()

650  
ödex
;

651 
	}
}

652 
	$˛ór
()

654 
ödex
 = 0;

655 
	}
}

656 
	$em±y
()

658 
vec
.
	`˛ór
();

659 
ödex
 = 0;

660 
	}
}

	@bacteria.h

1 #i‚de‡
BACTERIA_H_INCLUDED


2 
	#BACTERIA_H_INCLUDED


	)

4 
	~"ªndî.h
"

5 
	~"comp⁄íts.h
"

9 
	gBa˘îüCﬁ‹
 : 
public
 
RídîComp⁄ít
, 
	gComp⁄ítC⁄èöî
<BacteriaColor>

11 
	gglm
::
vec4
 
cﬁ‹
;

12 
øndNum
()

14  
	g°d
::
mö
(
ønd
()%1000/1000.0,.5);

16 
Ba˘îüCﬁ‹
(
E¡ôy
& 
ítôy
Ë: 
RídîComp⁄ít
”¡ôy,
nuŒ±r
), 
	gComp⁄ítC⁄èöî
<
	gBa˘îüCﬁ‹
>(
	gítôy
), 
cﬁ‹
(
øndNum
(),randNum(),randNum(),1)

20 
upd©e
()

22 
	gcﬁ‹
 = {0,0,0,1};

23 i‡(
Re˘Comp⁄ít
* 
	gª˘
 = 
ítôy
->
gëComp⁄ít
<RectComponent>())

25 
PﬁyRídî
::
ªque°Re˘
(
ª˘
->
gëRe˘
(),
cﬁ‹
,
Ál£
,ª˘->
gëTût
(),0);

29 
cﬁlide
(
E¡ôy
& 
Ÿhî
)

31 
	gcﬁ‹
 = {1,0,0,1};

42 
	gBa˘îüMove
 : 
public
 
MoveComp⁄ít
, 
	gComp⁄ítC⁄èöî
<BacteriaMove>

44 
c⁄°ex¥
 
	gdimí
 = 10;

45 
boﬁ
 
	gdoMove
;

46 
	gglm
::
vec4
 
øndRe˘
()

48 
glm
::
vec2
 
s¸ìnDimí
 = 
RídîProgøm
::
gëS¸ìnDimí
();

49  
	gglm
::
vec4
(
ønd
()%(()
s¸ìnDimí
.
x
),ønd()%(()s¸ìnDimí.
y
),
dimí
,dimen);

51 
Ba˘îüMove
(
E¡ôy
& 
ítôy
Ë: 
MoveComp⁄ít
(.1,
øndRe˘
(),ítôy), 
	gComp⁄ítC⁄èöî
<
	gBa˘îüMove
>(
	gítôy
)

53 
	gtût
 = 0;

55 
Ba˘îüMove
(
x
, 
y
, 
tût
, 
E¡ôy
& 
ítôy
Ë: 
MoveComp⁄ít
(.1,{x,y,
dimí
,dimí},ítôy), 
	gComp⁄ítC⁄èöî
<
	gBa˘îüMove
>(
	gítôy
)

57 
	gthis
->
	gtût
 = 
tût
;

59 
upd©e
()

61 i‡(
	gdoMove
)

63 i‡(
©T¨gë
())

65 
	gglm
::
vec2
 
s¸ìnDimí
 = 
RídîProgøm
::
gëS¸ìnDimí
();

66 
£tT¨gë
({
ønd
()%(()
s¸ìnDimí
.
x
),ønd()%(()s¸ìnDimí.
y
)});

68 
	gMoveComp⁄ít
::
upd©e
();

73 
boﬁ
 
	gBa˘îüMove
::
doMove
 = 
åue
;

75 
E¡ôy
* 
	$ba˘îüAs£mbÀ
()

77 
E¡ôy
* 
ít
 = 
√w
 
	`E¡ôy
();

78 
ít
->
	`addComp⁄ít
(*(
√w
 
	`Ba˘îüMove
(*ent)));

79 
ít
->
	`addComp⁄ít
(*(
√w
 
	`Ba˘îüCﬁ‹
(*ent)));

80  
ít
;

81 
	}
}

83 
E¡ôy
* 
	$ba˘îüAs£mbÀ
(
x
, 
y
, 
tût
)

85 
E¡ôy
* 
ít
 = 
√w
 
	`E¡ôy
();

86 
ít
->
	`addComp⁄ít
(*(
√w
 
	`Ba˘îüMove
(
x
,
y
,
tût
,*ent)));

87 
ít
->
	`addComp⁄ít
(*(
√w
 
	`Ba˘îüCﬁ‹
(*ent)));

88  
ít
;

89 
	}
}

	@
1
.
1
/usr/include
33
1958
C:\Users\leoou\OneDrive\Desktop\LodePNG\lodepng\lodepng.cpp
C:\Users\leoou\OneDrive\Desktop\LodePNG\lodepng\lodepng.h
C:\Users\leoou\OneDrive\Desktop\projects\ResourcesTest\bacteria.h
C:\Users\leoou\OneDrive\Desktop\projects\ResourcesTest\main.cpp
C:\Users\leoou\OneDrive\Desktop\resources\FreeTypeHelper.cpp
C:\Users\leoou\OneDrive\Desktop\resources\FreeTypeHelper.h
C:\Users\leoou\OneDrive\Desktop\resources\SDLhelper.cpp
C:\Users\leoou\OneDrive\Desktop\resources\SDLhelper.h
C:\Users\leoou\OneDrive\Desktop\resources\components.cpp
C:\Users\leoou\OneDrive\Desktop\resources\components.h
C:\Users\leoou\OneDrive\Desktop\resources\geometry.cpp
C:\Users\leoou\OneDrive\Desktop\resources\geometry.h
C:\Users\leoou\OneDrive\Desktop\resources\glGame.cpp
C:\Users\leoou\OneDrive\Desktop\resources\glGame.h
C:\Users\leoou\OneDrive\Desktop\resources\glInterface.cpp
C:\Users\leoou\OneDrive\Desktop\resources\glInterface.h
C:\Users\leoou\OneDrive\Desktop\resources\physics.cpp
C:\Users\leoou\OneDrive\Desktop\resources\physics.h
C:\Users\leoou\OneDrive\Desktop\resources\render.cpp
C:\Users\leoou\OneDrive\Desktop\resources\render.h
C:\Users\leoou\OneDrive\Desktop\resources\shaders\fragment\fragmentShader.h
C:\Users\leoou\OneDrive\Desktop\resources\shaders\fragment\outlineShader.h
C:\Users\leoou\OneDrive\Desktop\resources\shaders\fragment\paintShader.h
C:\Users\leoou\OneDrive\Desktop\resources\shaders\fragment\simpleFragment.h
C:\Users\leoou\OneDrive\Desktop\resources\shaders\fragment\wordFragment.h
C:\Users\leoou\OneDrive\Desktop\resources\shaders\vertex\polygonVertex.h
C:\Users\leoou\OneDrive\Desktop\resources\shaders\vertex\simpleVertex.h
C:\Users\leoou\OneDrive\Desktop\resources\shaders\vertex\vertexShader.h
C:\Users\leoou\OneDrive\Desktop\resources\shaders\vertex\wordVertex.h
C:\Users\leoou\OneDrive\Desktop\resources\stb_image.h
C:\Users\leoou\OneDrive\Desktop\resources\vanilla.cpp
C:\Users\leoou\OneDrive\Desktop\resources\vanilla.h
bacteria.h
